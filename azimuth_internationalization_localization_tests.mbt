// Azimuth å›½é™…åŒ–å’Œæœ¬åœ°åŒ–æµ‹è¯•ç”¨ä¾‹
// ä¸“æ³¨äºå¤šè¯­è¨€æ”¯æŒå’Œåœ°åŒºé€‚é…éªŒè¯

// æµ‹è¯•1: å¤šè¯­è¨€æ”¯æŒæµ‹è¯•
test "å¤šè¯­è¨€æ”¯æŒæµ‹è¯•" {
  // åˆ›å»ºå›½é™…åŒ–èµ„æºç®¡ç†å™¨
  let i18n_manager = I18nManager::new()
  
  // åŠ è½½ä¸åŒè¯­è¨€çš„èµ„æºæ–‡ä»¶
  I18nManager::load_resource(i18n_manager, "en", "resources/messages_en.properties")
  I18nManager::load_resource(i18n_manager, "zh", "resources/messages_zh.properties")
  I18nManager::load_resource(i18n_manager, "ja", "resources/messages_ja.properties")
  I18nManager::load_resource(i18n_manager, "fr", "resources/messages_fr.properties")
  I18nManager::load_resource(i18n_manager, "de", "resources/messages_de.properties")
  I18nManager::load_resource(i18n_manager, "es", "resources/messages_es.properties")
  I18nManager::load_resource(i18n_manager, "ru", "resources/messages_ru.properties")
  I18nManager::load_resource(i18n_manager, "ar", "resources/messages_ar.properties")
  
  // æµ‹è¯•è‹±æ–‡æœ¬åœ°åŒ–
  let en_messages = I18nManager::get_messages(i18n_manager, "en")
  assert_true(en_messages.length() > 0)
  
  let en_welcome = I18nManager::get_message(i18n_manager, "en", "welcome.message")
  assert_eq(en_welcome, Some("Welcome to Azimuth Telemetry System"))
  
  let en_error = I18nManager::get_message(i18n_manager, "en", "error.connection.failed")
  assert_eq(en_error, Some("Connection failed: {0}"))
  
  // æµ‹è¯•ä¸­æ–‡æœ¬åœ°åŒ–
  let zh_messages = I18nManager::get_messages(i18n_manager, "zh")
  assert_true(zh_messages.length() > 0)
  
  let zh_welcome = I18nManager::get_message(i18n_manager, "zh", "welcome.message")
  assert_eq(zh_welcome, Some("æ¬¢è¿ä½¿ç”¨Azimuthé¥æµ‹ç³»ç»Ÿ"))
  
  let zh_error = I18nManager::get_message(i18n_manager, "zh", "error.connection.failed")
  assert_eq(zh_error, Some("è¿æ¥å¤±è´¥ï¼š{0}"))
  
  // æµ‹è¯•æ—¥æ–‡æœ¬åœ°åŒ–
  let ja_messages = I18nManager::get_messages(i18n_manager, "ja")
  assert_true(ja_messages.length() > 0)
  
  let ja_welcome = I18nManager::get_message(i18n_manager, "ja", "welcome.message")
  assert_eq(ja_welcome, Some("Azimuthãƒ†ãƒ¬ãƒ¡ãƒˆãƒªã‚·ã‚¹ãƒ†ãƒ ã¸ã‚ˆã†ã“ã"))
  
  let ja_error = I18nManager::get_message(i18n_manager, "ja", "error.connection.failed")
  assert_eq(ja_error, Some("æ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸï¼š{0}"))
  
  // æµ‹è¯•æ³•æ–‡æœ¬åœ°åŒ–
  let fr_messages = I18nManager::get_messages(i18n_manager, "fr")
  assert_true(fr_messages.length() > 0)
  
  let fr_welcome = I18nManager::get_message(i18n_manager, "fr", "welcome.message")
  assert_eq(fr_welcome, Some("Bienvenue dans le systÃ¨me de tÃ©lÃ©mÃ©trie Azimuth"))
  
  let fr_error = I18nManager::get_message(i18n_manager, "fr", "error.connection.failed")
  assert_eq(fr_error, Some("Ã‰chec de la connexion : {0}"))
  
  // æµ‹è¯•å¾·æ–‡æœ¬åœ°åŒ–
  let de_messages = I18nManager::get_messages(i18n_manager, "de")
  assert_true(de_messages.length() > 0)
  
  let de_welcome = I18nManager::get_message(i18n_manager, "de", "welcome.message")
  assert_eq(de_welcome, Some("Willkommen beim Azimuth-Telemetriesystem"))
  
  let de_error = I18nManager::get_message(i18n_manager, "de", "error.connection.failed")
  assert_eq(de_error, Some("Verbindung fehlgeschlagen: {0}"))
  
  // æµ‹è¯•è¥¿ç­ç‰™æ–‡æœ¬åœ°åŒ–
  let es_messages = I18nManager::get_messages(i18n_manager, "es")
  assert_true(es_messages.length() > 0)
  
  let es_welcome = I18nManager::get_message(i18n_manager, "es", "welcome.message")
  assert_eq(es_welcome, Some("Bienvenido al sistema de telemetrÃ­a Azimuth"))
  
  let es_error = I18nManager::get_message(i18n_manager, "es", "error.connection.failed")
  assert_eq(es_error, Some("Error de conexiÃ³n: {0}"))
  
  // æµ‹è¯•ä¿„æ–‡æœ¬åœ°åŒ–
  let ru_messages = I18nManager::get_messages(i18n_manager, "ru")
  assert_true(ru_messages.length() > 0)
  
  let ru_welcome = I18nManager::get_message(i18n_manager, "ru", "welcome.message")
  assert_eq(ru_welcome, Some("Ğ”Ğ¾Ğ±Ñ€Ğ¾ Ğ¿Ğ¾Ğ¶Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ² ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ Ñ‚ĞµĞ»ĞµĞ¼ĞµÑ‚Ñ€Ğ¸Ğ¸ Azimuth"))
  
  let ru_error = I18nManager::get_message(i18n_manager, "ru", "error.connection.failed")
  assert_eq(ru_error, Some("ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ: {0}"))
  
  // æµ‹è¯•é˜¿æ‹‰ä¼¯æ–‡æœ¬åœ°åŒ–ï¼ˆä»å³åˆ°å·¦ï¼‰
  let ar_messages = I18nManager::get_messages(i18n_manager, "ar")
  assert_true(ar_messages.length() > 0)
  
  let ar_welcome = I18nManager::get_message(i18n_manager, "ar", "welcome.message")
  assert_eq(ar_welcome, Some("Ù…Ø±Ø­Ø¨Ø§ Ø¨Ùƒ ÙÙŠ Ù†Ø¸Ø§Ù… Ù‚ÙŠØ§Ø³ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ Azimuth"))
  
  let ar_error = I18nManager::get_message(i18n_manager, "ar", "error.connection.failed")
  assert_eq(ar_error, Some("ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„: {0}"))
  
  // éªŒè¯é˜¿æ‹‰ä¼¯è¯­æ–‡æœ¬æ–¹å‘
  assert_true(I18nManager::is_rtl(i18n_manager, "ar"))
  assert_false(I18nManager::is_rtl(i18n_manager, "en"))
  assert_false(I18nManager::is_rtl(i18n_manager, "zh"))
}

// æµ‹è¯•2: æ¶ˆæ¯æ ¼å¼åŒ–æµ‹è¯•
test "æ¶ˆæ¯æ ¼å¼åŒ–æµ‹è¯•" {
  let i18n_manager = I18nManager::new()
  
  // åŠ è½½èµ„æºæ–‡ä»¶
  I18nManager::load_resource(i18n_manager, "en", "resources/messages_en.properties")
  I18nManager::load_resource(i18n_manager, "zh", "resources/messages_zh.properties")
  I18nManager::load_resource(i18n_manager, "ja", "resources/messages_ja.properties")
  
  // æµ‹è¯•è‹±æ–‡æ¶ˆæ¯æ ¼å¼åŒ–
  let en_template = I18nManager::get_message(i18n_manager, "en", "user.greeting")
  assert_eq(en_template, Some("Hello, {0}! You have {1} new messages."))
  
  let en_formatted = I18nManager::format_message(i18n_manager, "en", "user.greeting", ["Alice", "5"])
  assert_eq(en_formatted, Some("Hello, Alice! You have 5 new messages."))
  
  // æµ‹è¯•ä¸­æ–‡æ¶ˆæ¯æ ¼å¼åŒ–
  let zh_template = I18nManager::get_message(i18n_manager, "zh", "user.greeting")
  assert_eq(zh_template, Some("ä½ å¥½ï¼Œ{0}ï¼æ‚¨æœ‰{1}æ¡æ–°æ¶ˆæ¯ã€‚"))
  
  let zh_formatted = I18nManager::format_message(i18n_manager, "zh", "user.greeting", ["çˆ±ä¸½ä¸", "5"])
  assert_eq(zh_formatted, Some("ä½ å¥½ï¼Œçˆ±ä¸½ä¸ï¼æ‚¨æœ‰5æ¡æ–°æ¶ˆæ¯ã€‚"))
  
  // æµ‹è¯•æ—¥æ–‡æ¶ˆæ¯æ ¼å¼åŒ–
  let ja_template = I18nManager::get_message(i18n_manager, "ja", "user.greeting")
  assert_eq(ja_template, Some("{0}ã•ã‚“ã€ã“ã‚“ã«ã¡ã¯ï¼{1}ä»¶ã®æ–°ã—ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã‚ã‚Šã¾ã™ã€‚"))
  
  let ja_formatted = I18nManager::format_message(i18n_manager, "ja", "user.greeting", ["ã‚¢ãƒªã‚¹", "5"])
  assert_eq(ja_formatted, Some("ã‚¢ãƒªã‚¹ã•ã‚“ã€ã“ã‚“ã«ã¡ã¯ï¼5ä»¶ã®æ–°ã—ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã‚ã‚Šã¾ã™ã€‚"))
  
  // æµ‹è¯•å¤æ•°å½¢å¼å¤„ç†
  let en_plural_template = I18nManager::get_message(i18n_manager, "en", "item.count")
  assert_eq(en_plural_template, Some("You have {0, plural, one{# item} other{# items}}."))
  
  let en_singular = I18nManager::format_message(i18n_manager, "en", "item.count", ["1"])
  assert_eq(en_singular, Some("You have 1 item."))
  
  let en_plural = I18nManager::format_message(i18n_manager, "en", "item.count", ["5"])
  assert_eq(en_plural, Some("You have 5 items."))
  
  // æµ‹è¯•æ—¥æœŸæ ¼å¼åŒ–
  let test_date = DateTime::new(2023, 1, 15, 14, 30, 0)
  
  let en_date = I18nManager::format_date(i18n_manager, "en", test_date, "medium")
  assert_eq(en_date, Some("Jan 15, 2023, 2:30:00 PM"))
  
  let zh_date = I18nManager::format_date(i18n_manager, "zh", test_date, "medium")
  assert_eq(zh_date, Some("2023å¹´1æœˆ15æ—¥ ä¸‹åˆ2:30:00"))
  
  let ja_date = I18nManager::format_date(i18n_manager, "ja", test_date, "medium")
  assert_eq(ja_date, Some("2023/01/15 14:30:00"))
  
  // æµ‹è¯•æ•°å­—æ ¼å¼åŒ–
  let en_number = I18nManager::format_number(i18n_manager, "en", 1234567.89, "currency", "USD")
  assert_eq(en_number, Some("$1,234,567.89"))
  
  let zh_number = I18nManager::format_number(i18n_manager, "zh", 1234567.89, "currency", "CNY")
  assert_eq(zh_number, Some("Â¥1,234,567.89"))
  
  let ja_number = I18nManager::format_number(i18n_manager, "ja", 1234567.89, "currency", "JPY")
  assert_eq(ja_number, Some("Â¥1,234,568"))  // æ—¥å…ƒæ²¡æœ‰å°æ•°
  
  // æµ‹è¯•ç™¾åˆ†æ¯”æ ¼å¼åŒ–
  let en_percent = I18nManager::format_number(i18n_manager, "en", 0.75, "percent", "")
  assert_eq(en_percent, Some("75%"))
  
  let zh_percent = I18nManager::format_number(i18n_manager, "zh", 0.75, "percent", "")
  assert_eq(zh_percent, Some("75%"))
  
  let ja_percent = I18nManager::format_number(i18n_manager, "ja", 0.75, "percent", "")
  assert_eq(ja_percent, Some("75%"))
}

// æµ‹è¯•3: åœ°åŒºè®¾ç½®æµ‹è¯•
test "åœ°åŒºè®¾ç½®æµ‹è¯•" {
  let locale_manager = LocaleManager::new()
  
  // æµ‹è¯•ä¸åŒåœ°åŒºè®¾ç½®
  let en_us = Locale::new("en", "US")
  let en_gb = Locale::new("en", "GB")
  let zh_cn = Locale::new("zh", "CN")
  let zh_tw = Locale::new("zh", "TW")
  let ja_jp = Locale::new("ja", "JP")
  let fr_fr = Locale::new("fr", "FR")
  let de_de = Locale::new("de", "DE")
  let es_es = Locale::new("es", "ES")
  let ru_ru = Locale::new("ru", "RU")
  let ar_sa = Locale::new("ar", "SA")
  
  // æµ‹è¯•åœ°åŒºä»£ç 
  assert_eq(Locale::language(en_us), "en")
  assert_eq(Locale::country(en_us), "US")
  assert_eq(Locale::to_string(en_us), "en_US")
  
  assert_eq(Locale::language(zh_cn), "zh")
  assert_eq(Locale::country(zh_cn), "CN")
  assert_eq(Locale::to_string(zh_cn), "zh_CN")
  
  // æµ‹è¯•åœ°åŒºç‰¹å®šæ ¼å¼
  let test_date = DateTime::new(2023, 1, 15, 14, 30, 0)
  
  let en_us_date = LocaleManager::format_date(locale_manager, en_us, test_date, "short")
  assert_eq(en_us_date, Some("1/15/23, 2:30 PM"))
  
  let en_gb_date = LocaleManager::format_date(locale_manager, en_gb, test_date, "short")
  assert_eq(en_gb_date, Some("15/01/2023, 14:30"))
  
  let zh_cn_date = LocaleManager::format_date(locale_manager, zh_cn, test_date, "short")
  assert_eq(zh_cn_date, Some("2023/1/15 ä¸‹åˆ2:30"))
  
  let zh_tw_date = LocaleManager::format_date(locale_manager, zh_tw, test_date, "short")
  assert_eq(zh_tw_date, Some("2023/1/15 ä¸‹åˆ2:30"))
  
  // æµ‹è¯•åœ°åŒºç‰¹å®šæ•°å­—æ ¼å¼
  let en_us_number = LocaleManager::format_number(locale_manager, en_us, 1234567.89, "decimal", "")
  assert_eq(en_us_number, Some("1,234,567.89"))
  
  let en_gb_number = LocaleManager::format_number(locale_manager, en_gb, 1234567.89, "decimal", "")
  assert_eq(en_gb_number, Some("1,234,567.89"))
  
  let de_de_number = LocaleManager::format_number(locale_manager, de_de, 1234567.89, "decimal", "")
  assert_eq(de_de_number, Some("1.234.567,89"))  // å¾·è¯­ä½¿ç”¨ç‚¹ä½œä¸ºåƒä½åˆ†éš”ç¬¦ï¼Œé€—å·ä½œä¸ºå°æ•°ç‚¹
  
  let fr_fr_number = LocaleManager::format_number(locale_manager, fr_fr, 1234567.89, "decimal", "")
  assert_eq(fr_fr_number, Some("1 234 567,89"))  // æ³•è¯­ä½¿ç”¨ç©ºæ ¼ä½œä¸ºåƒä½åˆ†éš”ç¬¦
  
  // æµ‹è¯•åœ°åŒºç‰¹å®šè´§å¸æ ¼å¼
  let en_us_currency = LocaleManager::format_currency(locale_manager, en_us, 1234.56, "USD")
  assert_eq(en_us_currency, Some("$1,234.56"))
  
  let en_gb_currency = LocaleManager::format_currency(locale_manager, en_gb, 1234.56, "GBP")
  assert_eq(en_gb_currency, Some("Â£1,234.56"))
  
  let zh_cn_currency = LocaleManager::format_currency(locale_manager, zh_cn, 1234.56, "CNY")
  assert_eq(zh_cn_currency, Some("Â¥1,234.56"))
  
  let ja_jp_currency = LocaleManager::format_currency(locale_manager, ja_jp, 1234.56, "JPY")
  assert_eq(ja_jp_currency, Some("Â¥1,235"))  // æ—¥å…ƒæ²¡æœ‰å°æ•°
  
  // æµ‹è¯•åœ°åŒºç‰¹å®šæ—¶é—´æ ¼å¼
  let test_time = Time::new(14, 30, 0)
  
  let en_us_time = LocaleManager::format_time(locale_manager, en_us, test_time, "short")
  assert_eq(en_us_time, Some("2:30 PM"))
  
  let en_gb_time = LocaleManager::format_time(locale_manager, en_gb, test_time, "short")
  assert_eq(en_gb_time, Some("14:30"))
  
  let de_de_time = LocaleManager::format_time(locale_manager, de_de, test_time, "short")
  assert_eq(de_de_time, Some("14:30"))
  
  // æµ‹è¯•åœ°åŒºç‰¹å®šæ’åºè§„åˆ™
  let strings = ["apple", "banana", "cherry", "date"]
  
  let en_sort = LocaleManager::sort_strings(locale_manager, en_us, strings)
  assert_eq(en_sort, ["apple", "banana", "cherry", "date"])
  
  let zh_sort = LocaleManager::sort_strings(locale_manager, zh_cn, strings)
  // ä¸­æ–‡æ’åºå¯èƒ½åŸºäºæ‹¼éŸ³æˆ–å…¶ä»–è§„åˆ™
  assert_eq(zh_sort, ["apple", "banana", "cherry", "date"])
  
  let ar_sort = LocaleManager::sort_strings(locale_manager, ar_sa, strings)
  // é˜¿æ‹‰ä¼¯è¯­æ’åºå¯èƒ½ä¸åŒ
  assert_eq(ar_sort, ["apple", "banana", "cherry", "date"])
}

// æµ‹è¯•4: æ–‡æœ¬æ–¹å‘æµ‹è¯•
test "æ–‡æœ¬æ–¹å‘æµ‹è¯•" {
  let i18n_manager = I18nManager::new()
  
  // åŠ è½½èµ„æºæ–‡ä»¶
  I18nManager::load_resource(i18n_manager, "en", "resources/messages_en.properties")
  I18nManager::load_resource(i18n_manager, "zh", "resources/messages_zh.properties")
  I18nManager::load_resource(i18n_manager, "ja", "resources/messages_ja.properties")
  I18nManager::load_resource(i18n_manager, "ar", "resources/messages_ar.properties")
  I18nManager::load_resource(i18n_manager, "he", "resources/messages_he.properties")
  
  // æµ‹è¯•ä»å·¦åˆ°å³è¯­è¨€
  assert_false(I18nManager::is_rtl(i18n_manager, "en"))
  assert_false(I18nManager::is_rtl(i18n_manager, "zh"))
  assert_false(I18nManager::is_rtl(i18n_manager, "ja"))
  assert_false(I18nManager::is_rtl(i18n_manager, "fr"))
  assert_false(I18nManager::is_rtl(i18n_manager, "de"))
  assert_false(I18nManager::is_rtl(i18n_manager, "es"))
  assert_false(I18nManager::is_rtl(i18n_manager, "ru"))
  
  // æµ‹è¯•ä»å³åˆ°å·¦è¯­è¨€
  assert_true(I18nManager::is_rtl(i18n_manager, "ar"))
  assert_true(I18nManager::is_rtl(i18n_manager, "he"))
  assert_true(I18nManager::is_rtl(i18n_manager, "fa"))  // æ³¢æ–¯è¯­
  assert_true(I18nManager::is_rtl(i18n_manager, "ur"))  // ä¹Œå°”éƒ½è¯­
  
  // æµ‹è¯•æ–‡æœ¬æ–¹å‘æ£€æµ‹
  let ltr_text = "Hello, world!"
  let rtl_text = "Ù…Ø±Ø­Ø¨Ø§ Ø¨Ø§Ù„Ø¹Ø§Ù„Ù…!"
  let mixed_text = "Hello, Ù…Ø±Ø­Ø¨Ø§ Ø¨Ø§Ù„Ø¹Ø§Ù„Ù…!"
  
  assert_eq(I18nManager::detect_text_direction(i18n_manager, ltr_text), "ltr")
  assert_eq(I18nManager::detect_text_direction(i18n_manager, rtl_text), "rtl")
  assert_eq(I18nManager::detect_text_direction(i18n_manager, mixed_text), "mixed")
  
  // æµ‹è¯•æ–‡æœ¬å¯¹é½
  let ltr_alignment = I18nManager::get_text_alignment(i18n_manager, "en", "start")
  assert_eq(ltr_alignment, "left")
  
  let rtl_alignment = I18nManager::get_text_alignment(i18n_manager, "ar", "start")
  assert_eq(rtl_alignment, "right")
  
  let ltr_end_alignment = I18nManager::get_text_alignment(i18n_manager, "en", "end")
  assert_eq(ltr_end_alignment, "right")
  
  let rtl_end_alignment = I18nManager::get_text_alignment(i18n_manager, "ar", "end")
  assert_eq(rtl_end_alignment, "left")
  
  // æµ‹è¯•å¸ƒå±€æ–¹å‘
  let ltr_layout = I18nManager::get_layout_direction(i18n_manager, "en")
  assert_eq(ltr_layout, "ltr")
  
  let rtl_layout = I18nManager::get_layout_direction(i18n_manager, "ar")
  assert_eq(rtl_layout, "rtl")
  
  // æµ‹è¯•è¾¹è·å’Œå¡«å……è°ƒæ•´
  let ltr_margin = I18nManager::adjust_margin_for_direction(i18n_manager, "en", {
    top: 10,
    right: 20,
    bottom: 10,
    left: 20
  })
  assert_eq(ltr_margin, { top: 10, right: 20, bottom: 10, left: 20 })
  
  let rtl_margin = I18nManager::adjust_margin_for_direction(i18n_manager, "ar", {
    top: 10,
    right: 20,
    bottom: 10,
    left: 20
  })
  assert_eq(rtl_margin, { top: 10, right: 20, bottom: 10, left: 20 })
  
  // æµ‹è¯•å›¾æ ‡ç¿»è½¬
  let ltr_icons = I18nManager::adjust_icons_for_direction(i18n_manager, "en", ["arrow-left", "arrow-right"])
  assert_eq(ltr_icons, ["arrow-left", "arrow-right"])
  
  let rtl_icons = I18nManager::adjust_icons_for_direction(i18n_manager, "ar", ["arrow-left", "arrow-right"])
  assert_eq(rtl_icons, ["arrow-right", "arrow-left"])  // æ–¹å‘å›¾æ ‡åº”è¯¥ç¿»è½¬
}

// æµ‹è¯•5: æ—¶åŒºå¤„ç†æµ‹è¯•
test "æ—¶åŒºå¤„ç†æµ‹è¯•" {
  let timezone_manager = TimezoneManager::new()
  
  // æµ‹è¯•ä¸åŒæ—¶åŒº
  let utc = Timezone::new("UTC")
  let us_eastern = Timezone::new("America/New_York")
  let us_western = Timezone::new("America/Los_Angeles")
  let europe_london = Timezone::new("Europe/London")
  let europe_paris = Timezone::new("Europe/Paris")
  let asia_shanghai = Timezone::new("Asia/Shanghai")
  let asia_tokyo = Timezone::new("Asia/Tokyo")
  let australia_sydney = Timezone::new("Australia/Sydney")
  
  // åˆ›å»ºæµ‹è¯•æ—¶é—´ï¼ˆUTCæ—¶é—´2023-01-15 14:30:00ï¼‰
  let utc_time = DateTime::new(2023, 1, 15, 14, 30, 0)
  
  // æµ‹è¯•æ—¶åŒºè½¬æ¢
  let us_eastern_time = TimezoneManager::convert(timezone_manager, utc_time, utc, us_eastern)
  // 1æœˆ15æ—¥æ˜¯å†¬å¤©ï¼Œçº½çº¦æ˜¯UTC-5
  assert_eq(us_eastern_time, DateTime::new(2023, 1, 15, 9, 30, 0))
  
  let us_western_time = TimezoneManager::convert(timezone_manager, utc_time, utc, us_western)
  // 1æœˆ15æ—¥æ˜¯å†¬å¤©ï¼Œæ´›æ‰çŸ¶æ˜¯UTC-8
  assert_eq(us_western_time, DateTime::new(2023, 1, 15, 6, 30, 0))
  
  let europe_london_time = TimezoneManager::convert(timezone_manager, utc_time, utc, europe_london)
  // 1æœˆ15æ—¥æ˜¯å†¬å¤©ï¼Œä¼¦æ•¦æ˜¯UTC+0
  assert_eq(europe_london_time, DateTime::new(2023, 1, 15, 14, 30, 0))
  
  let europe_paris_time = TimezoneManager::convert(timezone_manager, utc_time, utc, europe_paris)
  // 1æœˆ15æ—¥æ˜¯å†¬å¤©ï¼Œå·´é»æ˜¯UTC+1
  assert_eq(europe_paris_time, DateTime::new(2023, 1, 15, 15, 30, 0))
  
  let asia_shanghai_time = TimezoneManager::convert(timezone_manager, utc_time, utc, asia_shanghai)
  // ä¸Šæµ·æ˜¯UTC+8
  assert_eq(asia_shanghai_time, DateTime::new(2023, 1, 15, 22, 30, 0))
  
  let asia_tokyo_time = TimezoneManager::convert(timezone_manager, utc_time, utc, asia_tokyo)
  // ä¸œäº¬æ˜¯UTC+9
  assert_eq(asia_tokyo_time, DateTime::new(2023, 1, 15, 23, 30, 0))
  
  let australia_sydney_time = TimezoneManager::convert(timezone_manager, utc_time, utc, australia_sydney)
  // 1æœˆ15æ—¥æ˜¯å¤å¤©ï¼Œæ‚‰å°¼æ˜¯UTC+11
  assert_eq(australia_sydney_time, DateTime::new(2023, 1, 16, 1, 30, 0))
  
  // æµ‹è¯•å¤ä»¤æ—¶å¤„ç†
  let summer_utc_time = DateTime::new(2023, 7, 15, 14, 30, 0)
  
  let us_eastern_summer = TimezoneManager::convert(timezone_manager, summer_utc_time, utc, us_eastern)
  // 7æœˆ15æ—¥æ˜¯å¤å¤©ï¼Œçº½çº¦æ˜¯UTC-4ï¼ˆå¤ä»¤æ—¶ï¼‰
  assert_eq(us_eastern_summer, DateTime::new(2023, 7, 15, 10, 30, 0))
  
  let europe_london_summer = TimezoneManager::convert(timezone_manager, summer_utc_time, utc, europe_london)
  // 7æœˆ15æ—¥æ˜¯å¤å¤©ï¼Œä¼¦æ•¦æ˜¯UTC+1ï¼ˆå¤ä»¤æ—¶ï¼‰
  assert_eq(europe_london_summer, DateTime::new(2023, 7, 15, 15, 30, 0))
  
  let europe_paris_summer = TimezoneManager::convert(timezone_manager, summer_utc_time, utc, europe_paris)
  // 7æœˆ15æ—¥æ˜¯å¤å¤©ï¼Œå·´é»æ˜¯UTC+2ï¼ˆå¤ä»¤æ—¶ï¼‰
  assert_eq(europe_paris_summer, DateTime::new(2023, 7, 15, 16, 30, 0))
  
  // æµ‹è¯•æ—¶åŒºæ ¼å¼åŒ–
  let en_us_locale = Locale::new("en", "US")
  
  let utc_formatted = TimezoneManager::format_with_timezone(timezone_manager, utc_time, utc, en_us_locale, "full")
  assert_eq(utc_formatted, Some("Sunday, January 15, 2023 at 2:30:00 PM UTC"))
  
  let us_eastern_formatted = TimezoneManager::format_with_timezone(timezone_manager, utc_time, us_eastern, en_us_locale, "full")
  assert_eq(us_eastern_formatted, Some("Sunday, January 15, 2023 at 9:30:00 AM EST"))
  
  let asia_shanghai_formatted = TimezoneManager::format_with_timezone(timezone_manager, utc_time, asia_shanghai, en_us_locale, "full")
  assert_eq(asia_shanghai_formatted, Some("Sunday, January 15, 2023 at 10:30:00 PM CST"))
  
  // æµ‹è¯•æ—¶åŒºåç§»è®¡ç®—
  let us_eastern_offset = TimezoneManager::get_offset(timezone_manager, us_eastern, utc_time)
  assert_eq(us_eastern_offset, -18000)  // -5å°æ—¶ = -18000ç§’
  
  let asia_shanghai_offset = TimezoneManager::get_offset(timezone_manager, asia_shanghai, utc_time)
  assert_eq(asia_shanghai_offset, 28800)  // +8å°æ—¶ = 28800ç§’
  
  // æµ‹è¯•æ—¶åŒºåç§°
  let us_eastern_name = TimezoneManager::get_name(timezone_manager, us_eastern, utc_time)
  assert_eq(us_eastern_name, Some("Eastern Standard Time"))
  
  let us_eastern_summer_name = TimezoneManager::get_name(timezone_manager, us_eastern, summer_utc_time)
  assert_eq(us_eastern_summer_name, Some("Eastern Daylight Time"))
  
  let asia_shanghai_name = TimezoneManager::get_name(timezone_manager, asia_shanghai, utc_time)
  assert_eq(asia_shanghai_name, Some("China Standard Time"))
}

// æµ‹è¯•6: å­—ç¬¦é›†å’Œç¼–ç æµ‹è¯•
test "å­—ç¬¦é›†å’Œç¼–ç æµ‹è¯•" {
  let encoding_manager = EncodingManager::new()
  
  // æµ‹è¯•ä¸åŒå­—ç¬¦é›†
  let utf8_text = "Hello, ä¸–ç•Œ! ã“ã‚“ã«ã¡ã¯! Ù…Ø±Ø­Ø¨Ø§! Bonjour! Â¡Hola!"
  let utf16_text = EncodingManager::convert_encoding(encoding_manager, utf8_text, "UTF-8", "UTF-16")
  let iso88591_text = EncodingManager::convert_encoding(encoding_manager, "Hello, world!", "UTF-8", "ISO-8859-1")
  
  // æµ‹è¯•ç¼–ç æ£€æµ‹
  let detected_utf8 = EncodingManager::detect_encoding(encoding_manager, utf8_text)
  assert_eq(detected_utf8, Some("UTF-8"))
  
  let detected_utf16 = EncodingManager::detect_encoding(encoding_manager, utf16_text)
  assert_eq(detected_utf16, Some("UTF-16"))
  
  // æµ‹è¯•ç¼–ç è½¬æ¢
  let back_to_utf8 = EncodingManager::convert_encoding(encoding_manager, utf16_text, "UTF-16", "UTF-8")
  assert_eq(back_to_utf8, utf8_text)
  
  // æµ‹è¯•ç‰¹æ®Šå­—ç¬¦å¤„ç†
  let special_chars = "Ã©Ã Ã¨Ã¹Ã¢ÃªÃ®Ã´Ã»Ã«Ã¯Ã¼Ã¿Ã§Ã±Ã¥Ã¸ÃŸÃ¦Å“"
  let encoded_special = EncodingManager::encode_utf8(encoding_manager, special_chars)
  let decoded_special = EncodingManager::decode_utf8(encoding_manager, encoded_special)
  assert_eq(decoded_special, special_chars)
  
  // æµ‹è¯•è¡¨æƒ…ç¬¦å·
  let emoji_text = "ğŸ˜€ğŸ˜ƒğŸ˜„ğŸ˜ğŸ˜†ğŸ˜…ğŸ˜‚ğŸ¤£ğŸ˜ŠğŸ˜‡ğŸ™‚ğŸ™ƒğŸ˜‰ğŸ˜ŒğŸ˜ğŸ¥°ğŸ˜˜ğŸ˜—ğŸ˜™ğŸ˜šğŸ˜‹ğŸ˜›ğŸ˜ğŸ˜œğŸ¤ªğŸ¤¨ğŸ§ğŸ¤“ğŸ˜ğŸ¤©ğŸ¥³ğŸ˜ğŸ˜’ğŸ˜ğŸ˜”ğŸ˜ŸğŸ˜•ğŸ™â˜¹ï¸ğŸ˜£ğŸ˜–ğŸ˜«ğŸ˜©ğŸ¥ºğŸ˜¢ğŸ˜­ğŸ˜¤ğŸ˜ ğŸ˜¡ğŸ¤¬ğŸ¤¯ğŸ˜³ğŸ¥µğŸ¥¶ğŸ˜±ğŸ˜¨ğŸ˜°ğŸ˜¥ğŸ˜“ğŸ¤—ğŸ¤”ğŸ¤­ğŸ¤«ğŸ¤¥ğŸ˜¶ğŸ˜ğŸ˜‘ğŸ˜¬ğŸ™„ğŸ˜¯ğŸ˜¦ğŸ˜§ğŸ˜®ğŸ˜²ğŸ¥±ğŸ˜´ğŸ¤¤ğŸ˜ªğŸ˜µğŸ¤ğŸ¥´ğŸ¤¢ğŸ¤®ğŸ¤§ğŸ˜·ğŸ¤’ğŸ¤•ğŸ¤‘ğŸ¤ ğŸ˜ˆğŸ‘¿ğŸ‘¹ğŸ‘ºğŸ¤¡ğŸ’©ğŸ‘»ğŸ’€â˜ ï¸ğŸ‘½ğŸ‘¾ğŸ¤–ğŸƒğŸ˜ºğŸ˜¸ğŸ˜¹ğŸ˜»ğŸ˜¼ğŸ˜½ğŸ™€ğŸ˜¿ğŸ˜¾")
  let encoded_emoji = EncodingManager::encode_utf8(encoding_manager, emoji_text)
  let decoded_emoji = EncodingManager::decode_utf8(encoding_manager, encoded_emoji)
  assert_eq(decoded_emoji, emoji_text)
  
  // æµ‹è¯•ç»„åˆå­—ç¬¦
  let combining_chars = "e\u0301a\u0300o\u0302u\u0308"  // Ã©Ã Ã´Ã¼
  let normalized = EncodingManager::normalize_unicode(encoding_manager, combining_chars, "NFC")
  assert_eq(normalized, "Ã©Ã Ã´Ã¼")
  
  // æµ‹è¯•å¤§å°å†™è½¬æ¢ï¼ˆè€ƒè™‘ä¸åŒè¯­è¨€ï¼‰
  let english_text = "Hello World"
  let english_upper = EncodingManager::to_upper_case(encoding_manager, english_text, "en")
  let english_lower = EncodingManager::to_lower_case(encoding_manager, english_text, "en")
  assert_eq(english_upper, "HELLO WORLD")
  assert_eq(english_lower, "hello world")
  
  let turkish_text = "Ä±Ä°gÄ"  // åœŸè€³å…¶è¯­ç‰¹æ®Šå­—ç¬¦
  let turkish_upper = EncodingManager::to_upper_case(encoding_manager, turkish_text, "tr")
  let turkish_lower = EncodingManager::to_lower_case(encoding_manager, turkish_text, "tr")
  assert_eq(turkish_upper, "IÄ°GÄ")
  assert_eq(turkish_lower, "Ä±iÄŸÄŸ")
  
  // æµ‹è¯•æ–‡æœ¬å®½åº¦è®¡ç®—ï¼ˆè€ƒè™‘å…¨è§’å­—ç¬¦ï¼‰
  let latin_text = "Hello"
  let latin_width = EncodingManager::get_text_width(encoding_manager, latin_text)
  assert_eq(latin_width, 5)  // æ‹‰ä¸å­—ç¬¦æ¯ä¸ªå 1ä¸ªå•ä½å®½åº¦
  
  let chinese_text = "ä½ å¥½ä¸–ç•Œ"
  let chinese_width = EncodingManager::get_text_width(encoding_manager, chinese_text)
  assert_eq(chinese_width, 8)  // ä¸­æ–‡å­—ç¬¦æ¯ä¸ªå 2ä¸ªå•ä½å®½åº¦
  
  let mixed_text = "Helloä¸–ç•Œ"
  let mixed_width = EncodingManager::get_text_width(encoding_manager, mixed_text)
  assert_eq(mixed_width, 9)  // 5 + 4
  
  // æµ‹è¯•å­—ç¬¦ä¸²æˆªæ–­ï¼ˆè€ƒè™‘å­—ç¬¦è¾¹ç•Œï¼‰
  let long_text = "Hello, ä¸–ç•Œ! This is a long text that needs to be truncated."
  let truncated = EncodingManager::truncate_by_width(encoding_manager, long_text, 20, "...")
  assert_true(truncated.length() <= 23)  // 20 + "..."é•¿åº¦
  assert_true(truncated.ends_with("..."))
  
  // æµ‹è¯•åŒå‘æ–‡æœ¬å¤„ç†
  let bidi_text = "Hello Ù…Ø±Ø­Ø¨Ø§ World"
  let bidi_visual = EncodingManager::to_visual_order(encoding_manager, bidi_text)
  let bidi_logical = EncodingManager::to_logical_order(encoding_manager, bidi_visual)
  assert_eq(bidi_logical, bidi_text)
}

// æµ‹è¯•7: é¥æµ‹æ•°æ®å›½é™…åŒ–æµ‹è¯•
test "é¥æµ‹æ•°æ®å›½é™…åŒ–æµ‹è¯•" {
  let i18n_manager = I18nManager::new()
  
  // åŠ è½½èµ„æºæ–‡ä»¶
  I18nManager::load_resource(i18n_manager, "en", "resources/messages_en.properties")
  I18nManager::load_resource(i18n_manager, "zh", "resources/messages_zh.properties")
  I18nManager::load_resource(i18n_manager, "ja", "resources/messages_ja.properties")
  
  // åˆ›å»ºå›½é™…åŒ–é¥æµ‹ç»„ä»¶
  let tracer_provider = TracerProvider::default()
  let tracer = TracerProvider::get_tracer(tracer_provider, "i18n.telemetry.test")
  
  let meter_provider = MeterProvider::default()
  let meter = MeterProvider::get_meter(meter_provider, "i18n.telemetry.test")
  
  let logger_provider = LoggerProvider::default()
  let logger = LoggerProvider::get_logger(logger_provider, "i18n.telemetry.test")
  
  // æµ‹è¯•å¤šè¯­è¨€Spanåç§°
  let en_span = Tracer::start_span(tracer, "user.login")
  let zh_span = Tracer::start_span(tracer, "ç”¨æˆ·ç™»å½•")
  let ja_span = Tracer::start_span(tracer, "ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ã‚°ã‚¤ãƒ³")
  
  // è®¾ç½®å¤šè¯­è¨€å±æ€§
  Span::set_attribute(en_span, "operation.name.en", StringValue("user.login"))
  Span::set_attribute(en_span, "operation.name.zh", StringValue("ç”¨æˆ·ç™»å½•"))
  Span::set_attribute(en_span, "operation.name.ja", StringValue("ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ã‚°ã‚¤ãƒ³"))
  
  Span::set_attribute(zh_span, "operation.name.en", StringValue("user.login"))
  Span::set_attribute(zh_span, "operation.name.zh", StringValue("ç”¨æˆ·ç™»å½•"))
  Span::set_attribute(zh_span, "operation.name.ja", StringValue("ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ã‚°ã‚¤ãƒ³"))
  
  Span::set_attribute(ja_span, "operation.name.en", StringValue("user.login"))
  Span::set_attribute(ja_span, "operation.name.zh", StringValue("ç”¨æˆ·ç™»å½•"))
  Span::set_attribute(ja_span, "operation.name.ja", StringValue("ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ã‚°ã‚¤ãƒ³"))
  
  // æµ‹è¯•å¤šè¯­è¨€äº‹ä»¶
  let en_event_attrs = Attributes::new()
  Attributes::set(en_event_attrs, "event.message.en", StringValue("User authentication successful"))
  Attributes::set(en_event_attrs, "event.message.zh", StringValue("ç”¨æˆ·è®¤è¯æˆåŠŸ"))
  Attributes::set(en_event_attrs, "event.message.ja", StringValue("ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼æˆåŠŸ"))
  
  Span::add_event(en_span, "authentication.success", Some(en_event_attrs))
  
  // æµ‹è¯•å¤šè¯­è¨€æŒ‡æ ‡åç§°
  let en_counter = Meter::create_counter(meter, "user.login.attempts")
  let zh_counter = Meter::create_counter(meter, "ç”¨æˆ·ç™»å½•å°è¯•æ¬¡æ•°")
  let ja_counter = Meter::create_counter(meter, "ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ã‚°ã‚¤ãƒ³è©¦è¡Œå›æ•°")
  
  // è®°å½•å¤šè¯­è¨€æŒ‡æ ‡
  let en_attrs = [("locale", StringValue("en"))]
  let zh_attrs = [("locale", StringValue("zh"))]
  let ja_attrs = [("locale", StringValue("ja"))]
  
  Counter::add(en_counter, 1.0, Some(en_attrs))
  Counter::add(zh_counter, 1.0, Some(zh_attrs))
  Counter::add(ja_counter, 1.0, Some(ja_attrs))
  
  // æµ‹è¯•å¤šè¯­è¨€æ—¥å¿—
  let en_log_attrs = Attributes::new()
  Attributes::set(en_log_attrs, "locale", StringValue("en"))
  Attributes::set(en_log_attrs, "log.message.en", StringValue("User login attempt from IP: {0}"))
  Attributes::set(en_log_attrs, "log.message.zh", StringValue("ç”¨æˆ·ä»IP {0} å°è¯•ç™»å½•"))
  Attributes::set(en_log_attrs, "log.message.ja", StringValue("IP {0} ã‹ã‚‰ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ã‚°ã‚¤ãƒ³è©¦è¡Œ"))
  
  let en_log_record = LogRecord::new(
    Info,
    Some("User login attempt from IP: 192.168.1.1"),
    Some(en_log_attrs),
    Some(Time::now()),
    Some(Time::now() + 1),
    Some("i18n-test-trace"),
    Some("i18n-test-span")
  )
  Logger::emit(logger, en_log_record)
  
  // éªŒè¯å¤šè¯­è¨€é¥æµ‹æ•°æ®
  let en_name = Span::get_attribute(en_span, "operation.name.en")
  match en_name {
    StringValue(value) => assert_eq(value, "user.login")
    _ => assert_true(false)
  }
  
  let zh_name = Span::get_attribute(zh_span, "operation.name.zh")
  match zh_name {
    StringValue(value) => assert_eq(value, "ç”¨æˆ·ç™»å½•")
    _ => assert_true(false)
  }
  
  let ja_name = Span::get_attribute(ja_span, "operation.name.ja")
  match ja_name {
    StringValue(value) => assert_eq(value, "ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ã‚°ã‚¤ãƒ³")
    _ => assert_true(false)
  }
  
  // ç»“æŸSpan
  Span::end(en_span)
  Span::end(zh_span)
  Span::end(ja_span)
  
  // æµ‹è¯•å¤šè¯­è¨€ä»ªè¡¨æ¿
  let dashboard = I18nDashboard::new()
  
  // è®¾ç½®ä»ªè¡¨æ¿è¯­è¨€
  I18nDashboard::set_language(dashboard, "en")
  let en_title = I18nDashboard::get_title(dashboard)
  assert_eq(en_title, Some("Azimuth Telemetry Dashboard"))
  
  I18nDashboard::set_language(dashboard, "zh")
  let zh_title = I18nDashboard::get_title(dashboard)
  assert_eq(zh_title, Some("Azimuth é¥æµ‹ä»ªè¡¨æ¿"))
  
  I18nDashboard::set_language(dashboard, "ja")
  let ja_title = I18nDashboard::get_title(dashboard)
  assert_eq(ja_title, Some("Azimuth ãƒ†ãƒ¬ãƒ¡ãƒˆãƒªãƒ¼ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰"))
}