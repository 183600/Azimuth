// Azimuth Telemetry System - High Quality Comprehensive Tests
// This file contains comprehensive high-quality test cases for core functionality

// Test 1: ç»¼åˆä¸Šä¸‹æ–‡ä¼ æ’­æµ‹è¯•
test "comprehensive_context_propagation_test" {
  // åˆ›å»ºæ ¹ä¸Šä¸‹æ–‡
  let root_ctx = Context::root()
  
  // è®¾ç½®ä¸Šä¸‹æ–‡å€¼
  let correlation_key = ContextKey::new("correlation.id")
  let user_key = ContextKey::new("user.id")
  let request_key = ContextKey::new("request.id")
  
  let ctx_with_correlation = Context::with_value(root_ctx, correlation_key, "corr-12345")
  let ctx_with_user = Context::with_value(ctx_with_correlation, user_key, "user-67890")
  let ctx_with_request = Context::with_value(ctx_with_user, request_key, "req-abcde")
  
  // éªŒè¯ä¸Šä¸‹æ–‡å€¼ä¼ æ’­
  assert_eq(Context::get(ctx_with_request, correlation_key), Some("corr-12345"))
  assert_eq(Context::get(ctx_with_request, user_key), Some("user-67890"))
  assert_eq(Context::get(ctx_with_request, request_key), Some("req-abcde"))
  
  // æµ‹è¯•Baggageä¼ æ’­
  let baggage = Baggage::new()
  let baggage_with_user = Baggage::set_entry(baggage, "user.id", "user-67890")
  let baggage_with_session = Baggage::set_entry(baggage_with_user, "session.id", "session-11111")
  
  assert_eq(Baggage::get_entry(baggage_with_session, "user.id"), Some("user-67890"))
  assert_eq(Baggage::get_entry(baggage_with_session, "session.id"), Some("session-11111"))
  
  // æµ‹è¯•ä¼ æ’­å™¨æ³¨å…¥å’Œæå–
  let carrier = TextMapCarrier::new()
  let propagator = CompositePropagator::new([W3CTraceContextPropagator::new()])
  
  CompositePropagator::inject(propagator, ctx_with_request, carrier)
  let extracted_ctx = CompositePropagator::extract(propagator, carrier)
  
  // éªŒè¯æå–çš„ä¸Šä¸‹æ–‡åŒ…å«é¢„æœŸå€¼
  let extracted_value = Context::get(extracted_ctx, ContextKey::new("extracted"))
  assert_eq(extracted_value, Some("true"))
}

// Test 2: è·¨æœåŠ¡è¿½è¸ªä¸€è‡´æ€§æµ‹è¯•
test "cross_service_tracing_consistency_test" {
  let tracer_provider = TracerProvider::default()
  let tracer = TracerProvider::get_tracer(tracer_provider, "cross-service-test")
  
  // åˆ›å»ºæœåŠ¡Açš„æ ¹Span
  let service_a_span = Tracer::start_span(tracer, "service-a.operation")
  let service_a_ctx = Span::span_context(service_a_span)
  
  // éªŒè¯æœåŠ¡Açš„Spanä¸Šä¸‹æ–‡
  assert_true(SpanContext::is_valid(service_a_ctx))
  assert_true(SpanContext::is_sampled(service_a_ctx))
  
  // æ·»åŠ æœåŠ¡Açš„äº‹ä»¶
  Span::add_event(service_a_span, "service-a.started", Some([
    ("service.name", StringValue("service-a")),
    ("operation.type", StringValue("api-request"))
  ]))
  
  // æ¨¡æ‹Ÿè·¨æœåŠ¡è°ƒç”¨ - åˆ›å»ºæœåŠ¡Bçš„å­Span
  let service_b_span = Tracer::start_span(tracer, "service-b.operation")
  let service_b_ctx = Span::span_context(service_b_span)
  
  // æ·»åŠ æœåŠ¡Bçš„äº‹ä»¶å’Œå±æ€§
  Span::add_event(service_b_span, "service-b.started", Some([
    ("service.name", StringValue("service-b")),
    ("parent.trace", StringValue(SpanContext::trace_id(service_a_ctx))),
    ("parent.span", StringValue(SpanContext::span_id(service_a_ctx)))
  ]))
  
  // æ¨¡æ‹ŸæœåŠ¡Bè°ƒç”¨æœåŠ¡C
  let service_c_span = Tracer::start_span(tracer, "service-c.operation")
  let service_c_ctx = Span::span_context(service_c_span)
  
  Span::add_event(service_c_span, "service-c.started", Some([
    ("service.name", StringValue("service-c")),
    ("root.trace", StringValue(SpanContext::trace_id(service_a_ctx))),
    ("intermediate.trace", StringValue(SpanContext::trace_id(service_b_ctx)))
  ]))
  
  // æŒ‰é¡ºåºç»“æŸSpanï¼ˆC -> B -> Aï¼‰
  Span::set_status(service_c_span, Ok)
  Span::end(service_c_span)
  
  Span::add_event(service_b_span, "service-c.completed", None)
  Span::set_status(service_b_span, Ok)
  Span::end(service_b_span)
  
  Span::add_event(service_a_span, "service-b.completed", None)
  Span::set_status(service_a_span, Ok)
  Span::end(service_a_span)
  
  // éªŒè¯æ‰€æœ‰Spanéƒ½å·²ç»“æŸ
  assert_false(Span::is_recording(service_a_span))
  assert_false(Span::is_recording(service_b_span))
  assert_false(Span::is_recording(service_c_span))
}

// Test 3: åº¦é‡ç³»ç»Ÿèšåˆæ“ä½œæµ‹è¯•
test "metrics_aggregation_operations_test" {
  let meter_provider = MeterProvider::default()
  let meter = MeterProvider::get_meter(meter_provider, "aggregation-test")
  
  // åˆ›å»ºå„ç§ç±»å‹çš„åº¦é‡
  let request_counter = Meter::create_counter(meter, "http.requests.total")
  let response_histogram = Meter::create_histogram(meter, "http.response.time")
  let active_connections_gauge = Meter::create_gauge(meter, "http.active.connections")
  let error_updown_counter = Meter::create_updown_counter(meter, "http.errors.current")
  
  // éªŒè¯åº¦é‡åˆ›å»º
  assert_eq(request_counter.name, "http.requests.total")
  assert_eq(response_histogram.name, "http.response.time")
  assert_eq(active_connections_gauge.name, "http.active.connections")
  assert_eq(error_updown_counter.name, "http.errors.current")
  
  // æ¨¡æ‹Ÿåº¦é‡æ“ä½œ
  let attrs = Attributes::new()
  Attributes::set(attrs, "method", StringValue("GET"))
  Attributes::set(attrs, "status", StringValue("200"))
  
  // Counteræ“ä½œ
  Counter::add(request_counter, 100.0, Some(attrs))
  Counter::add(request_counter, 50.0, Some(attrs))
  
  // Histogramæ“ä½œ
  Histogram::record(response_histogram, 150.0, Some(attrs))
  Histogram::record(response_histogram, 200.0, Some(attrs))
  Histogram::record(response_histogram, 100.0, Some(attrs))
  
  // UpDownCounteræ“ä½œ
  let error_attrs = Attributes::new()
  Attributes::set(error_attrs, "error.type", StringValue("timeout"))
  UpDownCounter::add(error_updown_counter, 5.0, Some(error_attrs))
  UpDownCounter::add(error_updown_counter, -2.0, Some(error_attrs))
  
  // æµ‹è¯•åº¦é‡ä½œä¸ºInstrumentçš„è½¬æ¢
  let counter_instrument = Histogram::as_instrument(response_histogram)
  assert_eq(Instrument::name(counter_instrument), "http.response.time")
  assert_eq(Instrument::description(counter_instrument), Some("HTTP response time"))
  assert_eq(Instrument::unit(counter_instrument), Some("ms"))
  
  // æµ‹è¯•ä¸åŒå±æ€§çš„åº¦é‡
  let post_attrs = Attributes::new()
  Attributes::set(post_attrs, "method", StringValue("POST"))
  Attributes::set(post_attrs, "status", StringValue("201"))
  
  Counter::add(request_counter, 25.0, Some(post_attrs))
  Histogram::record(response_histogram, 300.0, Some(post_attrs))
  
  // éªŒè¯åº¦é‡æ“ä½œå®Œæˆ
  assert_true(true)
}

// Test 4: æ—¥å¿—è®°å½•ä¸è¿½è¸ªå…³è”æµ‹è¯•
test "log_record_trace_correlation_test" {
  let logger_provider = LoggerProvider::default()
  let logger = LoggerProvider::get_logger(logger_provider, "correlation-test")
  
  let tracer_provider = TracerProvider::default()
  let tracer = TracerProvider::get_tracer(tracer_provider, "correlation-test")
  
  // åˆ›å»ºSpanç”¨äºè¿½è¸ª
  let span = Tracer::start_span(tracer, "operation.with.logs")
  let span_ctx = Span::span_context(span)
  
  // åˆ›å»ºä¸è¿½è¸ªå…³è”çš„æ—¥å¿—è®°å½•
  let info_log = LogRecord::new_with_context(
    Info,
    Some("Operation started successfully"),
    None,
    Some(Clock::now_unix_nanos(Clock::system())),
    None,
    Some(SpanContext::trace_id(span_ctx)),
    Some(SpanContext::span_id(span_ctx)),
    None
  )
  
  // æ·»åŠ Spanäº‹ä»¶
  Span::add_event(span, "log.recorded", Some([
    ("log.level", StringValue("INFO")),
    ("log.message", StringValue("Operation started successfully"))
  ]))
  
  // åˆ›å»ºè­¦å‘Šæ—¥å¿—
  let warn_attrs = Attributes::new()
  Attributes::set(warn_attrs, "warning.type", StringValue("performance"))
  
  let warn_log = LogRecord::new_with_context(
    Warn,
    Some("Operation taking longer than expected"),
    Some(warn_attrs),
    Some(Clock::now_unix_nanos(Clock::system())),
    None,
    Some(SpanContext::trace_id(span_ctx)),
    Some(SpanContext::span_id(span_ctx)),
    None
  )
  
  // æ·»åŠ è­¦å‘Šäº‹ä»¶åˆ°Span
  Span::add_event(span, "warning.issued", Some([
    ("warning.type", StringValue("performance")),
    ("log.message", StringValue("Operation taking longer than expected"))
  ]))
  
  // åˆ›å»ºé”™è¯¯æ—¥å¿—
  let error_attrs = Attributes::new()
  Attributes::set(error_attrs, "error.code", IntValue(500))
  Attributes::set(error_attrs, "error.type", StringValue("internal"))
  
  let error_log = LogRecord::new_with_context(
    Error,
    Some("Internal server error occurred"),
    Some(error_attrs),
    Some(Clock::now_unix_nanos(Clock::system())),
    None,
    Some(SpanContext::trace_id(span_ctx)),
    Some(SpanContext::span_id(span_ctx)),
    None
  )
  
  // è®¾ç½®Spané”™è¯¯çŠ¶æ€
  Span::set_status(span, Error)
  
  // å‘å‡ºæ‰€æœ‰æ—¥å¿—
  Logger::emit(logger, info_log)
  Logger::emit(logger, warn_log)
  Logger::emit(logger, error_log)
  
  // ç»“æŸSpan
  Span::end(span)
  
  // éªŒè¯æ—¥å¿—å’Œè¿½è¸ªå…³è”
  assert_eq(LogRecord::trace_id(info_log), Some(SpanContext::trace_id(span_ctx)))
  assert_eq(LogRecord::span_id(info_log), Some(SpanContext::span_id(span_ctx)))
  assert_eq(LogRecord::severity_number(info_log), Info)
  
  assert_eq(LogRecord::trace_id(warn_log), Some(SpanContext::trace_id(span_ctx)))
  assert_eq(LogRecord::span_id(warn_log), Some(SpanContext::span_id(span_ctx)))
  assert_eq(LogRecord::severity_number(warn_log), Warn)
  
  assert_eq(LogRecord::trace_id(error_log), Some(SpanContext::trace_id(span_ctx)))
  assert_eq(LogRecord::span_id(error_log), Some(SpanContext::span_id(span_ctx)))
  assert_eq(LogRecord::severity_number(error_log), Error)
}

// Test 5: èµ„æºåˆå¹¶ç­–ç•¥æµ‹è¯•
test "resource_merge_strategy_test" {
  // åˆ›å»ºåŸºç¡€èµ„æº
  let base_resource = Resource::new()
  let base_attrs = [
    ("service.name", StringValue("azimuth-service")),
    ("service.version", StringValue("1.0.0")),
    ("deployment.environment", StringValue("production"))
  ]
  let base_resource_with_attrs = Resource::with_attributes(base_resource, base_attrs)
  
  // åˆ›å»ºè¦†ç›–èµ„æº
  let override_resource = Resource::new()
  let override_attrs = [
    ("service.instance.id", StringValue("instance-12345")),
    ("host.name", StringValue("server-01")),
    ("deployment.environment", StringValue("staging")) // è¿™ä¸ªåº”è¯¥è¦†ç›–åŸºç¡€èµ„æº
  ]
  let override_resource_with_attrs = Resource::with_attributes(override_resource, override_attrs)
  
  // æ‰§è¡Œèµ„æºåˆå¹¶
  let merged_resource = Resource::merge(base_resource_with_attrs, override_resource_with_attrs)
  
  // éªŒè¯åˆå¹¶ç»“æœ
  assert_eq(Resource::get_attribute(merged_resource, "service.name"), Some(StringValue("azimuth-service")))
  assert_eq(Resource::get_attribute(merged_resource, "service.version"), Some(StringValue("1.0.0")))
  assert_eq(Resource::get_attribute(merged_resource, "deployment.environment"), Some(StringValue("staging"))) // è¢«è¦†ç›–
  assert_eq(Resource::get_attribute(merged_resource, "service.instance.id"), Some(StringValue("instance-12345")))
  assert_eq(Resource::get_attribute(merged_resource, "host.name"), Some(StringValue("server-01")))
  
  // æµ‹è¯•å¤šçº§åˆå¹¶
  let additional_resource = Resource::new()
  let additional_attrs = [
    ("service.namespace", StringValue("backend")),
    ("service.version", StringValue("1.1.0")), // å†æ¬¡è¦†ç›–ç‰ˆæœ¬
    ("region", StringValue("us-west"))
  ]
  let additional_resource_with_attrs = Resource::with_attributes(additional_resource, additional_attrs)
  
  let final_merged = Resource::merge(merged_resource, additional_resource_with_attrs)
  
  // éªŒè¯æœ€ç»ˆåˆå¹¶ç»“æœ
  assert_eq(Resource::get_attribute(final_merged, "service.name"), Some(StringValue("azimuth-service")))
  assert_eq(Resource::get_attribute(final_merged, "service.version"), Some(StringValue("1.1.0"))) // æœ€ç»ˆç‰ˆæœ¬
  assert_eq(Resource::get_attribute(final_merged, "deployment.environment"), Some(StringValue("staging")))
  assert_eq(Resource::get_attribute(final_merged, "service.instance.id"), Some(StringValue("instance-12345")))
  assert_eq(Resource::get_attribute(final_merged, "host.name"), Some(StringValue("server-01")))
  assert_eq(Resource::get_attribute(final_merged, "service.namespace"), Some(StringValue("backend")))
  assert_eq(Resource::get_attribute(final_merged, "region"), Some(StringValue("us-west")))
  
  // æµ‹è¯•ç©ºèµ„æºåˆå¹¶
  let empty_resource = Resource::new()
  let merged_with_empty = Resource::merge(final_merged, empty_resource)
  
  // éªŒè¯ä¸ç©ºèµ„æºåˆå¹¶ä¸å½±å“åŸèµ„æº
  assert_eq(Resource::get_attribute(merged_with_empty, "service.name"), Some(StringValue("azimuth-service")))
  assert_eq(Resource::get_attribute(merged_with_empty, "service.version"), Some(StringValue("1.1.0")))
}

// Test 6: å¹¶å‘å®‰å…¨æ€§æµ‹è¯•
test "concurrent_safety_test" {
  let meter_provider = MeterProvider::default()
  let meter = MeterProvider::get_meter(meter_provider, "concurrent-test")
  
  let tracer_provider = TracerProvider::default()
  let tracer = TracerProvider::get_tracer(tracer_provider, "concurrent-test")
  
  let logger_provider = LoggerProvider::default()
  let logger = LoggerProvider::get_logger(logger_provider, "concurrent-test")
  
  // åˆ›å»ºå…±äº«èµ„æº
  let shared_counter = Meter::create_counter(meter, "concurrent.operations")
  let shared_histogram = Meter::create_histogram(meter, "concurrent.duration")
  let shared_gauge = Meter::create_gauge(meter, "concurrent.active")
  
  // æ¨¡æ‹Ÿå¹¶å‘æ“ä½œ
  let spans = []
  let logs = []
  
  // åˆ›å»ºå¤šä¸ªSpanï¼ˆæ¨¡æ‹Ÿå¹¶å‘ï¼‰
  for i in 0..50 {
    let span = Tracer::start_span(tracer, "concurrent.operation." + i.to_string())
    
    // ä¸ºæ¯ä¸ªSpanæ·»åŠ å”¯ä¸€å±æ€§
    let attrs = Attributes::new()
    Attributes::set(attrs, "operation.id", IntValue(i))
    Attributes::set(attrs, "thread.id", StringValue("thread-" + (i % 5).to_string()))
    
    Span::add_event(span, "operation.started", Some(attrs))
    spans.push(span)
    
    // åˆ›å»ºå¯¹åº”çš„æ—¥å¿—è®°å½•
    let log = LogRecord::new_with_context(
      Info,
      Some("Concurrent operation " + i.to_string() + " started"),
      Some(attrs),
      Some(Clock::now_unix_nanos(Clock::system())),
      None,
      Some(SpanContext::trace_id(Span::span_context(span))),
      Some(SpanContext::span_id(Span::span_context(span))),
      None
    )
    logs.push(log)
  }
  
  // æ¨¡æ‹Ÿå¹¶å‘åº¦é‡æ“ä½œ
  for i in 0..50 {
    let attrs = Attributes::new()
    Attributes::set(attrs, "operation.id", IntValue(i))
    
    // å¹¶å‘Counteræ“ä½œ
    Counter::add(shared_counter, 1.0, Some(attrs))
    
    // å¹¶å‘Histogramæ“ä½œ
    Histogram::record(shared_histogram, (i % 100).to_double(), Some(attrs))
    
    // å¹¶å‘æ—¥å¿—è®°å½•
    Logger::emit(logger, logs[i])
  }
  
  // éªŒè¯æ‰€æœ‰SpançŠ¶æ€
  for span in spans {
    assert_true(Span::is_recording(span))
    Span::set_status(span, Ok)
    Span::end(span)
  }
  
  // éªŒè¯æ‰€æœ‰Spanéƒ½å·²ç»“æŸ
  for span in spans {
    assert_false(Span::is_recording(span))
  }
  
  // éªŒè¯å…±äº«èµ„æºä»ç„¶æœ‰æ•ˆ
  assert_eq(shared_counter.name, "concurrent.operations")
  assert_eq(shared_histogram.name, "concurrent.duration")
  assert_eq(shared_gauge.name, "concurrent.active")
}

// Test 7: åºåˆ—åŒ–å®Œæ•´æ€§æµ‹è¯•
test "serialization_integrity_test" {
  // åˆ›å»ºå¤æ‚çš„å±æ€§é›†åˆ
  let complex_attrs = Attributes::new()
  
  // è®¾ç½®å„ç§ç±»å‹çš„å±æ€§
  Attributes::set(complex_attrs, "string.value", StringValue("test string"))
  Attributes::set(complex_attrs, "int.value", IntValue(42))
  Attributes::set(complex_attrs, "float.value", FloatValue(3.14159))
  Attributes::set(complex_attrs, "bool.value", BoolValue(true))
  
  // è®¾ç½®æ•°ç»„å±æ€§
  let string_array = ["value1", "value2", "value3"]
  let int_array = [1, 2, 3, 4, 5]
  
  // éªŒè¯å±æ€§æ£€ç´¢
  assert_eq(Attributes::get(complex_attrs, "string.value"), Some(StringValue("test string")))
  assert_eq(Attributes::get(complex_attrs, "int.value"), Some(IntValue(42)))
  assert_eq(Attributes::get(complex_attrs, "float.value"), Some(FloatValue(3.14159)))
  assert_eq(Attributes::get(complex_attrs, "bool.value"), Some(BoolValue(true)))
  
  // æµ‹è¯•SpanContextåºåˆ—åŒ–
  let trace_id = "0af7651916cd43dd8448eb211c80319c"
  let span_id = "b7ad6b7169203331"
  let span_ctx = SpanContext::new(trace_id, span_id, true, "key1=value1,key2=value2")
  
  // éªŒè¯SpanContextå±æ€§
  assert_eq(SpanContext::trace_id(span_ctx), trace_id)
  assert_eq(SpanContext::span_id(span_ctx), span_id)
  assert_true(SpanContext::is_sampled(span_ctx))
  assert_true(SpanContext::is_valid(span_ctx))
  
  // æµ‹è¯•HTTPè¯·æ±‚/å“åº”åºåˆ—åŒ–
  let headers = [
    ("Content-Type", "application/json"),
    ("Authorization", "Bearer token123"),
    ("X-Trace-ID", trace_id),
    ("X-Request-ID", "req-12345")
  ]
  
  let request = HttpRequest::new("POST", "https://api.example.com/data", headers, Some("{\"test\": \"data\"}"))
  
  // éªŒè¯è¯·æ±‚å±æ€§
  assert_eq(HttpRequest::http_method(request), "POST")
  assert_eq(HttpRequest::url(request), "https://api.example.com/data")
  assert_eq(HttpRequest::body(request), Some("{\"test\": \"data\"}"))
  
  let response_headers = [
    ("Content-Type", "application/json"),
    ("X-Response-Time", "150ms"),
    ("X-Trace-ID", trace_id)
  ]
  
  let response = HttpResponse::new(200, response_headers, Some("{\"result\": \"success\"}"))
  
  // éªŒè¯å“åº”å±æ€§
  assert_eq(HttpResponse::status_code(response), 200)
  assert_eq(HttpResponse::body(response), Some("{\"result\": \"success\"}"))
  
  // æµ‹è¯•TextMapCarrieråºåˆ—åŒ–
  let carrier = TextMapCarrier::new()
  TextMapCarrier::set(carrier, "traceparent", "00-0af7651916cd43dd8448eb211c80319c-b7ad6b7169203331-01")
  TextMapCarrier::set(carrier, " baggage", "user.id=12345,session.id=abcdef")
  
  // éªŒè¯Carrierå±æ€§
  assert_eq(TextMapCarrier::get(carrier, "traceparent"), Some("00-0af7651916cd43dd8448eb211c80319c-b7ad6b7169203331-01"))
}

// Test 8: è¾¹ç•Œæ¡ä»¶å’Œé”™è¯¯æ¢å¤æµ‹è¯•
test "boundary_conditions_error_recovery_test" {
  // æµ‹è¯•ç©ºå­—ç¬¦ä¸²å’ŒNoneå€¼
  let empty_trace_id = ""
  let empty_span_id = ""
  let invalid_span_ctx = SpanContext::new(empty_trace_id, empty_span_id, true, "")
  
  // éªŒè¯æ— æ•ˆSpanContext
  assert_false(SpanContext::is_valid(invalid_span_ctx))
  
  // æµ‹è¯•éƒ¨åˆ†æœ‰æ•ˆçš„SpanContext
  let valid_trace_invalid_span = SpanContext::new("1234567890abcdef1234567890abcdef", "", true, "")
  let invalid_trace_valid_span = SpanContext::new("", "1234567890abcdef", true, "")
  
  assert_false(SpanContext::is_valid(valid_trace_invalid_span))
  assert_false(SpanContext::is_valid(invalid_trace_valid_span))
  
  // æµ‹è¯•è¾¹ç•Œå€¼çš„åº¦é‡åˆ›å»º
  let meter_provider = MeterProvider::default()
  let meter = MeterProvider::get_meter(meter_provider, "boundary-test")
  
  // ç©ºåç§°åº¦é‡
  let empty_name_counter = Meter::create_counter(meter, "")
  assert_eq(empty_name_counter.name, "")
  
  // æé•¿åç§°åº¦é‡
  let very_long_name = "this.is.a.very.long.metric.name.that.exceeds.normal.expectations.and.tests.boundary.conditions"
  let long_name_gauge = Meter::create_gauge(meter, very_long_name)
  assert_eq(long_name_gauge.name, very_long_name)
  
  // æµ‹è¯•ç‰¹æ®Šå­—ç¬¦åº¦é‡åç§°
  let special_chars_name = "metric.with-special_chars_123!@#$%"
  let special_chars_histogram = Meter::create_histogram(meter, special_chars_name)
  assert_eq(special_chars_histogram.name, special_chars_name)
  
  // æµ‹è¯•Unicodeåº¦é‡åç§°
  let unicode_name = "æµ‹è¯•åº¦é‡ğŸš€"
  let unicode_updown_counter = Meter::create_updown_counter(meter, unicode_name)
  assert_eq(unicode_updown_counter.name, unicode_name)
  
  // æµ‹è¯•è¾¹ç•Œå€¼çš„æ—¥å¿—è®°å½•
  let logger_provider = LoggerProvider::default()
  let logger = LoggerProvider::get_logger(logger_provider, "boundary-test")
  
  // ç©ºæ—¥å¿—æ¶ˆæ¯
  let empty_log = LogRecord::new(Info, "")
  assert_eq(LogRecord::body(empty_log), Some(""))
  
  // æé•¿æ—¥å¿—æ¶ˆæ¯
  let very_long_message = "this.is.a.very.long.log.message.that.exceeds.normal.expectations.and.tests.boundary.conditions".repeat(10)
  let long_log = LogRecord::new(Info, very_long_message)
  assert_eq(LogRecord::body(long_log), Some(very_long_message))
  
  // ç‰¹æ®Šå­—ç¬¦æ—¥å¿—æ¶ˆæ¯
  let special_chars_message = "Special chars: !@#$%^&*()_+-=[]{}|;':\",./<>?"
  let special_chars_log = LogRecord::new(Warn, special_chars_message)
  assert_eq(LogRecord::body(special_chars_log), Some(special_chars_message))
  
  // Unicodeæ—¥å¿—æ¶ˆæ¯
  let unicode_message = "Unicodeæµ‹è¯•æ¶ˆæ¯ğŸš€ with Ã©mojis and Ã± special chars"
  let unicode_log = LogRecord::new(Error, unicode_message)
  assert_eq(LogRecord::body(unicode_log), Some(unicode_message))
  
  // æµ‹è¯•è¾¹ç•Œå€¼çš„æ—¶é—´æˆ³
  let zero_timestamp = 0L
  let max_timestamp = 9223372036854775807L
  let negative_timestamp = -1L
  
  let zero_log = LogRecord::new_with_context(
    Info,
    Some("Zero timestamp"),
    None,
    Some(zero_timestamp),
    None,
    None,
    None,
    None
  )
  
  let max_log = LogRecord::new_with_context(
    Info,
    Some("Max timestamp"),
    None,
    Some(max_timestamp),
    None,
    None,
    None,
    None
  )
  
  // éªŒè¯è¾¹ç•Œå€¼æ—¶é—´æˆ³æ—¥å¿—
  assert_eq(LogRecord::body(zero_log), Some("Zero timestamp"))
  assert_eq(LogRecord::body(max_log), Some("Max timestamp"))
  
  // æµ‹è¯•é”™è¯¯æ¢å¤
  let tracer_provider = TracerProvider::default()
  let tracer = TracerProvider::get_tracer(tracer_provider, "error-recovery-test")
  
  let error_span = Tracer::start_span(tracer, "error.operation")
  
  // æ·»åŠ é”™è¯¯äº‹ä»¶
  let error_attrs = Attributes::new()
  Attributes::set(error_attrs, "error.type", StringValue("BoundaryCondition"))
  Attributes::set(error_attrs, "error.message", StringValue("Test boundary condition error"))
  Attributes::set(error_attrs, "error.recovered", BoolValue(true))
  
  Span::add_event(error_span, "error.occurred", Some(error_attrs))
  Span::add_event(error_span, "recovery.attempted", Some([
    ("recovery.strategy", StringValue("retry")),
    ("retry.count", IntValue(3))
  ]))
  
  // è®¾ç½®é”™è¯¯çŠ¶æ€ç„¶åæ¢å¤
  Span::set_status(error_span, Error)
  Span::add_event(error_span, "recovery.successful", None)
  Span::set_status(error_span, Ok)
  
  // ç»“æŸSpan
  Span::end(error_span)
  
  // éªŒè¯é”™è¯¯æ¢å¤
  assert_false(Span::is_recording(error_span))
}