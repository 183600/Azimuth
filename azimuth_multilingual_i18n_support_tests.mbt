// Azimuth å¤šè¯­è¨€å›½é™…åŒ–æ”¯æŒæµ‹è¯•ç”¨ä¾‹
// ä¸“æ³¨äºé¥æµ‹ç³»ç»Ÿçš„å¤šè¯­è¨€æ”¯æŒå’Œå›½é™…åŒ–åŠŸèƒ½

// æµ‹è¯•1: å¤šè¯­è¨€é”™è¯¯æ¶ˆæ¯æœ¬åœ°åŒ–
test "å¤šè¯­è¨€é”™è¯¯æ¶ˆæ¯æœ¬åœ°åŒ–æµ‹è¯•" {
  // å®šä¹‰å¤šè¯­è¨€é”™è¯¯æ¶ˆæ¯
  let error_messages = [
    ("en", "Database connection failed"),
    ("zh", "æ•°æ®åº“è¿æ¥å¤±è´¥"),
    ("ja", "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸ"),
    ("es", "Error de conexiÃ³n a la base de datos"),
    ("fr", "Ã‰chec de la connexion Ã  la base de donnÃ©es"),
    ("de", "Datenbankverbindung fehlgeschlagen"),
    ("ko", "ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹¤íŒ¨"),
    ("ru", "ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒÑÑ Ğº Ğ±Ğ°Ğ·Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…")
  ]
  
  // åˆ›å»ºæœ¬åœ°åŒ–èµ„æº
  let mut resources = []
  for (locale, message) in error_messages {
    let resource_attrs = [
      ("error.locale", StringValue(locale)),
      ("error.message", StringValue(message)),
      ("error.code", StringValue("DB_CONNECTION_ERROR"))
    ]
    let resource = Resource::with_attributes(Resource::new(), resource_attrs)
    resources = resources.push(resource)
  }
  
  // éªŒè¯æ‰€æœ‰æœ¬åœ°åŒ–èµ„æºåˆ›å»ºæˆåŠŸ
  assert_eq(resources.length(), 8)
  
  // éªŒè¯æ¯ç§è¯­è¨€çš„é”™è¯¯æ¶ˆæ¯
  for i in 0..=7 {
    let (expected_locale, expected_message) = error_messages[i]
    let resource = resources[i]
    
    assert_eq(Resource::get_attribute(resource, "error.locale"), Some(StringValue(expected_locale)))
    assert_eq(Resource::get_attribute(resource, "error.message"), Some(StringValue(expected_message)))
    assert_eq(Resource::get_attribute(resource, "error.code"), Some(StringValue("DB_CONNECTION_ERROR")))
  }
}

// æµ‹è¯•2: å¤šè¯­è¨€æ—¥å¿—è®°å½•
test "å¤šè¯­è¨€æ—¥å¿—è®°å½•æµ‹è¯•" {
  let logger_provider = LoggerProvider::default()
  
  // ä¸ºä¸åŒè¯­è¨€åˆ›å»ºæ—¥å¿—è®°å½•å™¨
  let loggers = [
    LoggerProvider::get_logger(logger_provider, "zh.logger"),
    LoggerProvider::get_logger(logger_provider, "en.logger"),
    LoggerProvider::get_logger(logger_provider, "ja.logger"),
    LoggerProvider::get_logger(logger_provider, "es.logger")
  ]
  
  // å¤šè¯­è¨€æ—¥å¿—æ¶ˆæ¯
  let log_messages = [
    ("zh", [
      ("ç”¨æˆ·è®¤è¯æˆåŠŸ", Info),
      ("å¼€å§‹å¤„ç†è®¢å•", Info),
      ("æ•°æ®åº“æŸ¥è¯¢å®Œæˆ", Info),
      ("æ”¯ä»˜å¤„ç†å¤±è´¥", Error),
      ("ç³»ç»Ÿç»´æŠ¤é€šçŸ¥", Warn)
    ]),
    ("en", [
      ("User authentication successful", Info),
      ("Order processing started", Info),
      ("Database query completed", Info),
      ("Payment processing failed", Error),
      ("System maintenance notification", Warn)
    ]),
    ("ja", [
      ("ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼æˆåŠŸ", Info),
      ("æ³¨æ–‡å‡¦ç†é–‹å§‹", Info),
      ("ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªå®Œäº†", Info),
      ("æ”¯æ‰•ã„å‡¦ç†å¤±æ•—", Error),
      ("ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹é€šçŸ¥", Warn)
    ]),
    ("es", [
      ("AutenticaciÃ³n de usuario exitosa", Info),
      ("Procesamiento de pedido iniciado", Info),
      ("Consulta de base de datos completada", Info),
      ("Error en el procesamiento de pago", Error),
      ("NotificaciÃ³n de mantenimiento del sistema", Warn)
    ])
  ]
  
  // è®°å½•å¤šè¯­è¨€æ—¥å¿—
  for i in 0..=3 {
    let (locale, messages) = log_messages[i]
    let logger = loggers[i]
    
    for (message, severity) in messages {
      let log_record = LogRecord::new(severity, message)
      Logger::emit(logger, log_record)
      
      // éªŒè¯æ—¥å¿—è®°å½•
      assert_eq(LogRecord::severity_number(log_record), severity)
      assert_eq(LogRecord::body(log_record), Some(message))
    }
  }
}

// æµ‹è¯•3: å¤šè¯­è¨€Spanå±æ€§å’Œäº‹ä»¶
test "å¤šè¯­è¨€Spanå±æ€§å’Œäº‹ä»¶æµ‹è¯•" {
  let tracer_provider = TracerProvider::default()
  let tracer = TracerProvider::get_tracer(tracer_provider, "i18n.tracer")
  
  // åˆ›å»ºå¤šè¯­è¨€Span
  let span_names = [
    ("zh", "ç”¨æˆ·æ³¨å†Œæµç¨‹"),
    ("en", "User Registration Flow"),
    ("ja", "ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ•ãƒ­ãƒ¼"),
    ("es", "Flujo de Registro de Usuario")
  ]
  
  let mut spans = []
  for (locale, name) in span_names {
    let span = Tracer::start_span(tracer, name)
    spans = spans.push((locale, span))
  }
  
  // ä¸ºæ¯ä¸ªspanæ·»åŠ å¤šè¯­è¨€å±æ€§å’Œäº‹ä»¶
  let span_attributes = [
    ("zh", [
      ("ç”¨æˆ·ID", StringValue("user-12345")),
      ("ç”¨æˆ·ç±»å‹", StringValue("premium")),
      ("æ³¨å†Œæ¸ é“", StringValue("mobile.app"))
    ]),
    ("en", [
      ("User ID", StringValue("user-12345")),
      ("User Type", StringValue("premium")),
      ("Registration Channel", StringValue("mobile.app"))
    ]),
    ("ja", [
      ("ãƒ¦ãƒ¼ã‚¶ãƒ¼ID", StringValue("user-12345")),
      ("ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¿ã‚¤ãƒ—", StringValue("premium")),
      ("ç™»éŒ²ãƒãƒ£ãƒãƒ«", StringValue("mobile.app"))
    ]),
    ("es", [
      ("ID de Usuario", StringValue("user-12345")),
      ("Tipo de Usuario", StringValue("premium")),
      ("Canal de Registro", StringValue("mobile.app"))
    ])
  ]
  
  let span_events = [
    ("zh", [
      "å¼€å§‹ç”¨æˆ·éªŒè¯",
      "éªŒè¯ç å‘é€æˆåŠŸ",
      "ç”¨æˆ·ä¿¡æ¯éªŒè¯å®Œæˆ",
      "è´¦æˆ·åˆ›å»ºæˆåŠŸ",
      "æ¬¢è¿é‚®ä»¶å‘é€"
    ]),
    ("en", [
      "User verification started",
      "Verification code sent successfully",
      "User information verified",
      "Account created successfully",
      "Welcome email sent"
    ]),
    ("ja", [
      "ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼é–‹å§‹",
      "èªè¨¼ã‚³ãƒ¼ãƒ‰é€ä¿¡æˆåŠŸ",
      "ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ç¢ºèªå®Œäº†",
      "ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆæˆåŠŸ",
      "ã‚ˆã†ã“ããƒ¡ãƒ¼ãƒ«é€ä¿¡"
    ]),
    ("es", [
      "VerificaciÃ³n de usuario iniciada",
      "CÃ³digo de verificaciÃ³n enviado exitosamente",
      "InformaciÃ³n de usuario verificada",
      "Cuenta creada exitosamente",
      "Correo de bienvenida enviado"
    ])
  ]
  
  // æ·»åŠ å±æ€§å’Œäº‹ä»¶åˆ°span
  for i in 0..=3 {
    let (locale, span) = spans[i]
    let attributes = span_attributes[i]
    let events = span_events[i]
    
    // æ·»åŠ å±æ€§ï¼ˆåœ¨å®é™…å®ç°ä¸­ï¼Œè¿™ä¼šè°ƒç”¨Span::set_attributeï¼‰
    for (key, value) in attributes {
      // Span::set_attribute(span, key, value)
      // ç”±äºç®€åŒ–å®ç°ï¼Œè¿™é‡ŒåªéªŒè¯å±æ€§ç»“æ„
      assert_true(key.length() > 0)
    }
    
    // æ·»åŠ äº‹ä»¶
    for event in events {
      Span::add_event(span, event, None)
    }
    
    // è®¾ç½®spançŠ¶æ€
    Span::set_status(span, Ok)
    Span::end(span)
    
    // éªŒè¯spançŠ¶æ€
    assert_eq(Span::status(span), Ok)
  }
}

// æµ‹è¯•4: å¤šè¯­è¨€æŒ‡æ ‡åç§°å’Œæè¿°
test "å¤šè¯­è¨€æŒ‡æ ‡åç§°å’Œæè¿°æµ‹è¯•" {
  let provider = MeterProvider::default()
  
  // åˆ›å»ºå¤šè¯­è¨€æŒ‡æ ‡
  let metric_definitions = [
    ("zh", [
      ("ç”¨æˆ·æ€»æ•°", "å½“å‰ç³»ç»Ÿä¸­çš„æ³¨å†Œç”¨æˆ·æ€»æ•°"),
      ("è®¢å•æ•°é‡", "åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´å†…åˆ›å»ºçš„è®¢å•æ•°é‡"),
      ("æ”¯ä»˜æˆåŠŸç‡", "æˆåŠŸæ”¯ä»˜å æ€»æ”¯ä»˜å°è¯•çš„ç™¾åˆ†æ¯”"),
      ("ç³»ç»Ÿå“åº”æ—¶é—´", "ç³»ç»Ÿå¤„ç†è¯·æ±‚çš„å¹³å‡å“åº”æ—¶é—´")
    ]),
    ("en", [
      ("Total Users", "Total number of registered users in the system"),
      ("Order Count", "Number of orders created within the specified time range"),
      ("Payment Success Rate", "Percentage of successful payments out of total payment attempts"),
      ("System Response Time", "Average response time for system to process requests")
    ]),
    ("ja", [
      ("ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°", "ã‚·ã‚¹ãƒ†ãƒ ã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç·æ•°"),
      ("æ³¨æ–‡æ•°", "æŒ‡å®šã•ã‚ŒãŸæ™‚é–“ç¯„å›²å†…ã§ä½œæˆã•ã‚ŒãŸæ³¨æ–‡ã®æ•°"),
      ("æ”¯æ‰•ã„æˆåŠŸç‡", "ç·æ”¯æ‰•ã„è©¦è¡Œã«å¯¾ã™ã‚‹æˆåŠŸã—ãŸæ”¯æ‰•ã„ã®å‰²åˆ"),
      ("ã‚·ã‚¹ãƒ†ãƒ å¿œç­”æ™‚é–“", "ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã™ã‚‹ãŸã‚ã®ã‚·ã‚¹ãƒ†ãƒ ã®å¹³å‡å¿œç­”æ™‚é–“")
    ]),
    ("es", [
      ("Total de Usuarios", "NÃºmero total de usuarios registrados en el sistema"),
      ("Cantidad de Pedidos", "NÃºmero de pedidos creados dentro del rango de tiempo especificado"),
      ("Tasa de Ã‰xito de Pago", "Porcentaje de pagos exitosos del total de intentos de pago"),
      ("Tiempo de Respuesta del Sistema", "Tiempo de respuesta promedio del sistema para procesar solicitudes")
    ])
  ]
  
  // åˆ›å»ºå¤šè¯­è¨€æŒ‡æ ‡
  for i in 0..=3 {
    let (locale, definitions) = metric_definitions[i]
    let meter = MeterProvider::get_meter(provider, locale + ".metrics")
    
    for (name, description) in definitions {
      let counter = Meter::create_counter(meter, name)
      // åœ¨å®é™…å®ç°ä¸­ï¼Œè¿™é‡Œä¼šè®¾ç½®æŒ‡æ ‡çš„æè¿°
      // Counter::set_description(counter, description)
      
      // è®°å½•æŒ‡æ ‡å€¼
      Counter::add(counter, 1.0)
      
      // éªŒè¯æŒ‡æ ‡åˆ›å»º
      assert_eq(Instrument::name(counter), name)
    }
  }
}

// æµ‹è¯•5: å¤šè¯­è¨€ä¸Šä¸‹æ–‡ä¼ æ’­
test "å¤šè¯­è¨€ä¸Šä¸‹æ–‡ä¼ æ’­æµ‹è¯•" {
  // åˆ›å»ºå¤šè¯­è¨€ä¸Šä¸‹æ–‡é”®
  let zh_keys = [
    ContextKey::new("ç”¨æˆ·ID"),
    ContextKey::new("ä¼šè¯ID"),
    ContextKey::new("è¯·æ±‚ID"),
    ContextKey::new("ç§Ÿæˆ·ID")
  ]
  
  let en_keys = [
    ContextKey::new("user.id"),
    ContextKey::new("session.id"),
    ContextKey::new("request.id"),
    ContextKey::new("tenant.id")
  ]
  
  // åˆ›å»ºä¸­æ–‡ä¸Šä¸‹æ–‡
  let zh_ctx = Context::root()
    |> Context::with_value(zh_keys[0], "ç”¨æˆ·-123")
    |> Context::with_value(zh_keys[1], "ä¼šè¯-456")
    |> Context::with_value(zh_keys[2], "è¯·æ±‚-789")
    |> Context::with_value(zh_keys[3], "ç§Ÿæˆ·-001")
  
  // åˆ›å»ºè‹±æ–‡ä¸Šä¸‹æ–‡
  let en_ctx = Context::root()
    |> Context::with_value(en_keys[0], "user-123")
    |> Context::with_value(en_keys[1], "session-456")
    |> Context::with_value(en_keys[2], "request-789")
    |> Context::with_value(en_keys[3], "tenant-001")
  
  // éªŒè¯ä¸­æ–‡ä¸Šä¸‹æ–‡
  assert_eq(Context::get(zh_ctx, zh_keys[0]), Some("ç”¨æˆ·-123"))
  assert_eq(Context::get(zh_ctx, zh_keys[1]), Some("ä¼šè¯-456"))
  assert_eq(Context::get(zh_ctx, zh_keys[2]), Some("è¯·æ±‚-789"))
  assert_eq(Context::get(zh_ctx, zh_keys[3]), Some("ç§Ÿæˆ·-001"))
  
  // éªŒè¯è‹±æ–‡ä¸Šä¸‹æ–‡
  assert_eq(Context::get(en_ctx, en_keys[0]), Some("user-123"))
  assert_eq(Context::get(en_ctx, en_keys[1]), Some("session-456"))
  assert_eq(Context::get(en_ctx, en_keys[2]), Some("request-789"))
  assert_eq(Context::get(en_ctx, en_keys[3]), Some("tenant-001"))
  
  // åˆ›å»ºä¼ æ’­å™¨å¹¶æµ‹è¯•è·¨è¯­è¨€ä¸Šä¸‹æ–‡ä¼ æ’­
  let propagator = W3CTraceContextPropagator::new()
  let carrier = TextMapCarrier::new()
  
  // æ³¨å…¥ä¸­æ–‡ä¸Šä¸‹æ–‡
  CompositePropagator::inject(CompositePropagator::new([propagator]), zh_ctx, carrier)
  
  // æå–ä¸Šä¸‹æ–‡
  let extracted_ctx = CompositePropagator::extract(CompositePropagator::new([propagator]), carrier)
  
  // éªŒè¯æå–çš„ä¸Šä¸‹æ–‡ï¼ˆåœ¨å®é™…å®ç°ä¸­ï¼Œè¿™é‡Œä¼šæ­£ç¡®å¤„ç†å¤šè¯­è¨€é”®ï¼‰
  let extracted_value = Context::get(extracted_ctx, zh_keys[0])
  // ç”±äºç®€åŒ–å®ç°ï¼Œè¿™é‡ŒåªéªŒè¯å‡½æ•°è°ƒç”¨ä¸å‡ºé”™
}

// æµ‹è¯•6: å¤šè¯­è¨€èµ„æºç®¡ç†
test "å¤šè¯­è¨€èµ„æºç®¡ç†æµ‹è¯•" {
  // åˆ›å»ºå¤šè¯­è¨€èµ„æº
  let resource_definitions = [
    ("zh", [
      ("æœåŠ¡åç§°", StringValue("æ”¯ä»˜æœåŠ¡")),
      ("æœåŠ¡ç‰ˆæœ¬", StringValue("2.1.0")),
      ("éƒ¨ç½²ç¯å¢ƒ", StringValue("ç”Ÿäº§ç¯å¢ƒ")),
      ("æ•°æ®ä¸­å¿ƒ", StringValue("äºšå¤ªåŒºåŸŸ"))
    ]),
    ("en", [
      ("service.name", StringValue("Payment Service")),
      ("service.version", StringValue("2.1.0")),
      ("deployment.environment", StringValue("production")),
      ("data.center", StringValue("Asia Pacific Region"))
    ]),
    ("ja", [
      ("ã‚µãƒ¼ãƒ“ã‚¹å", StringValue("æ±ºæ¸ˆã‚µãƒ¼ãƒ“ã‚¹")),
      ("ã‚µãƒ¼ãƒ“ã‚¹ãƒãƒ¼ã‚¸ãƒ§ãƒ³", StringValue("2.1.0")),
      ("ãƒ‡ãƒ—ãƒ­ã‚¤ç’°å¢ƒ", StringValue("æœ¬ç•ªç’°å¢ƒ")),
      ("ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼", StringValue("ã‚¢ã‚¸ã‚¢å¤ªå¹³æ´‹åœ°åŸŸ"))
    ]),
    ("es", [
      ("nombre.servicio", StringValue("Servicio de Pago")),
      ("version.servicio", StringValue("2.1.0")),
      ("entorno.despliegue", StringValue("producciÃ³n")),
      ("centro.datos", StringValue("RegiÃ³n Asia PacÃ­fico"))
    ])
  ]
  
  // åˆ›å»ºå¤šè¯­è¨€èµ„æº
  let mut resources = []
  for (locale, attributes) in resource_definitions {
    let resource = Resource::with_attributes(Resource::new(), attributes)
    resources = resources.push((locale, resource))
  }
  
  // éªŒè¯æ‰€æœ‰èµ„æºåˆ›å»ºæˆåŠŸ
  assert_eq(resources.length(), 4)
  
  // éªŒè¯æ¯ç§è¯­è¨€çš„èµ„æºå±æ€§
  for i in 0..=3 {
    let (locale, resource) = resources[i]
    let expected_attributes = resource_definitions[i]
    
    for (key, expected_value) in expected_attributes {
      let actual_value = Resource::get_attribute(resource, key)
      assert_eq(actual_value, Some(expected_value))
    }
  }
  
  // æµ‹è¯•èµ„æºåˆå¹¶ï¼ˆè·¨è¯­è¨€ï¼‰
  let base_resource = Resource::with_attributes(Resource::new(), [
    ("global.attribute", StringValue("global.value")),
    ("service.type", StringValue("payment"))
  ])
  
  let mut merged_resources = []
  for i in 0..=3 {
    let (locale, resource) = resources[i]
    let merged = Resource::merge(base_resource, resource)
    merged_resources = merged.push((locale, merged))
  }
  
  // éªŒè¯åˆå¹¶åçš„èµ„æºåŒ…å«å…¨å±€å±æ€§
  for i in 0..=3 {
    let (locale, merged_resource) = merged_resources[i]
    assert_eq(Resource::get_attribute(merged_resource, "global.attribute"), Some(StringValue("global.value")))
    assert_eq(Resource::get_attribute(merged_resource, "service.type"), Some(StringValue("payment")))
  }
}

// æµ‹è¯•7: å¤šè¯­è¨€æ—¶åŒºå’Œæ—¥æœŸæ ¼å¼å¤„ç†
test "å¤šè¯­è¨€æ—¶åŒºå’Œæ—¥æœŸæ ¼å¼å¤„ç†æµ‹è¯•" {
  let clock = Clock::system()
  let base_timestamp = Clock::now_unix_nanos(clock)
  
  // å®šä¹‰å¤šè¯­è¨€æ—¶åŒºå’Œæ—¥æœŸæ ¼å¼
  let timezone_formats = [
    ("zh", "Asia/Shanghai", "2025-01-03 15:30:45 CST"),
    ("en", "America/New_York", "01/03/2025 02:30:45 EST"),
    ("ja", "Asia/Tokyo", "2025-01-03 16:30:45 JST"),
    ("es", "Europe/Madrid", "03/01/2025 08:30:45 CET"),
    ("de", "Europe/Berlin", "03.01.2025 08:30:45 CET"),
    ("fr", "Europe/Paris", "03/01/2025 08:30:45 CET"),
    ("ko", "Asia/Seoul", "2025-01-03 16:30:45 KST"),
    ("ru", "Europe/Moscow", "03.01.2025 10:30:45 MSK")
  ]
  
  // åˆ›å»ºå¤šè¯­è¨€æ—¥å¿—è®°å½•å™¨
  let logger_provider = LoggerProvider::default()
  
  for (locale, timezone, formatted_time) in timezone_formats {
    let logger = LoggerProvider::get_logger(logger_provider, locale + ".timezone.logger")
    
    // åˆ›å»ºå¸¦æœ‰æ—¶åŒºä¿¡æ¯çš„æ—¥å¿—è®°å½•
    let log_record = LogRecord::new_with_context(
      Info,
      Some("Localized timestamp: " + formatted_time),
      None,
      Some(base_timestamp),
      Some(base_timestamp + 1000000L),  // 1ms later
      Some("trace-" + locale),
      Some("span-" + locale),
      None
    )
    
    // æ·»åŠ æ—¶åŒºå±æ€§
    // åœ¨å®é™…å®ç°ä¸­ï¼Œè¿™é‡Œä¼šæ·»åŠ æ—¶åŒºå±æ€§åˆ°æ—¥å¿—è®°å½•
    // LogRecord::set_attribute(log_record, "timezone", StringValue(timezone))
    
    Logger::emit(logger, log_record)
    
    // éªŒè¯æ—¥å¿—è®°å½•
    assert_eq(LogRecord::severity_number(log_record), Info)
    assert_eq(LogRecord::body(log_record), Some("Localized timestamp: " + formatted_time))
    assert_eq(LogRecord::timestamp(log_record), Some(base_timestamp))
    assert_eq(LogRecord::trace_id(log_record), Some("trace-" + locale))
    assert_eq(LogRecord::span_id(log_record), Some("span-" + locale))
  }
}

// æµ‹è¯•8: å¤šè¯­è¨€Unicodeå’Œç‰¹æ®Šå­—ç¬¦å¤„ç†
test "å¤šè¯­è¨€Unicodeå’Œç‰¹æ®Šå­—ç¬¦å¤„ç†æµ‹è¯•" {
  let tracer_provider = TracerProvider::default()
  let tracer = TracerProvider::get_tracer(tracer_provider, "unicode.test.tracer")
  
  // å®šä¹‰åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„å¤šè¯­è¨€æ–‡æœ¬
  let unicode_texts = [
    ("zh", "ç”¨æˆ·ğŸ†å¼ ä¸‰ğŸ‰è´­ä¹°äº†ğŸ“±iPhoneğŸ”‹å……ç”µå™¨ğŸ’°"),
    ("ja", "ãƒ¦ãƒ¼ã‚¶ãƒ¼ğŸ†ç”°ä¸­ğŸ‰ãŒğŸ“±iPhoneğŸ”‹å……é›»å™¨ğŸ’°ã‚’è³¼å…¥"),
    ("ar", "Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ğŸ†Ø£Ø­Ù…Ø¯ğŸ‰Ø§Ø´ØªØ±Ù‰ğŸ“±Ø¢ÙŠÙÙˆÙ†ğŸ”‹Ø´Ø§Ø­Ù†ğŸ’°"),
    ("hi", "à¤‰à¤ªà¤¯à¥‹à¤—à¤•à¤°à¥à¤¤à¤¾ğŸ†à¤°à¤¾à¤œğŸ‰à¤¨à¥‡ğŸ“±à¤†à¤ˆà¤«à¥‹à¤¨ğŸ”‹à¤šà¤¾à¤°à¥à¤œà¤°ğŸ’°à¤–à¤°à¥€à¤¦à¤¾"),
    ("th", "à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰ğŸ†à¸ªà¸¡à¸Šà¸²à¸¢ğŸ‰à¸‹à¸·à¹‰à¸­ğŸ“±à¹„à¸­à¹‚à¸Ÿà¸™ğŸ”‹à¸Šà¸²à¸£à¹Œà¸ˆà¹€à¸ˆà¸­à¸£à¹ŒğŸ’°"),
    ("he", "××©×ª××©ğŸ†×“×•×“ğŸ‰×§× ×”ğŸ“±××™×™×¤×•×ŸğŸ”‹××˜×¢×ŸğŸ’°"),
    ("ru", "ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒğŸ†Ğ˜Ğ²Ğ°Ğ½ğŸ‰ĞºÑƒĞ¿Ğ¸Ğ»ğŸ“±iPhoneğŸ”‹Ğ·Ğ°Ñ€ÑĞ´Ğ½Ğ¾Ğµ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ¾ğŸ’°"),
    ("ko", "ì‚¬ìš©ìğŸ†ê¹€ì² ìˆ˜ğŸ‰ê°€ğŸ“±ì•„ì´í°ğŸ”‹ì¶©ì „ê¸°ğŸ’°ë¥¼ êµ¬ë§¤")
  ]
  
  // åˆ›å»ºåŒ…å«Unicodeå­—ç¬¦çš„span
  for (locale, text) in unicode_texts {
    let span = Tracer::start_span(tracer, "unicode.span." + locale)
    
    // æ·»åŠ åŒ…å«Unicodeå­—ç¬¦çš„å±æ€§
    // Span::set_attribute(span, "unicode.message", StringValue(text))
    // Span::set_attribute(span, "locale", StringValue(locale))
    
    // æ·»åŠ åŒ…å«Unicodeå­—ç¬¦çš„äº‹ä»¶
    Span::add_event(span, "Unicode event: " + text, None)
    
    // è®¾ç½®çŠ¶æ€å¹¶ç»“æŸspan
    Span::set_status(span, Ok)
    Span::end(span)
    
    // éªŒè¯span
    assert_eq(Span::status(span), Ok)
  }
  
  // åˆ›å»ºåŒ…å«ç‰¹æ®Šå­—ç¬¦çš„æ—¥å¿—è®°å½•
  let logger_provider = LoggerProvider::default()
  let logger = LoggerProvider::get_logger(logger_provider, "unicode.logger")
  
  for (locale, text) in unicode_texts {
    let log_record = LogRecord::new(Info, "Unicode log: " + text)
    Logger::emit(logger, log_record)
    
    // éªŒè¯æ—¥å¿—è®°å½•
    assert_eq(LogRecord::severity_number(log_record), Info)
    assert_eq(LogRecord::body(log_record), Some("Unicode log: " + text))
  }
  
  // åˆ›å»ºåŒ…å«ç‰¹æ®Šå­—ç¬¦çš„æŒ‡æ ‡
  let provider = MeterProvider::default()
  let meter = MeterProvider::get_meter(provider, "unicode.metrics")
  
  for (locale, text) in unicode_texts {
    let counter = Meter::create_counter(meter, "unicode.counter." + locale)
    // Counter::set_description(counter, "Unicode counter: " + text)
    
    Counter::add(counter, 1.0)
    
    // éªŒè¯æŒ‡æ ‡
    assert_eq(Instrument::name(counter), "unicode.counter." + locale)
  }
}