# Azimuth 新增 MoonBit 测试用例

## 概述
本文档描述了为 Azimuth 遥测系统新增的 10 个 MoonBit 测试用例。

## 测试文件
- 文件名: `azimuth_new_moonbit_tests.mbt`
- 测试用例数量: 10 个
- 测试类型: 单元测试

## 测试用例详情

### 1. 属性值类型转换测试 (`attribute value type conversion`)
- 测试不同类型的属性值（字符串、整数、浮点数、布尔值、数组）
- 验证属性值类型的正确性
- 测试数组属性的处理

### 2. 跨服务传播测试 (`cross-service propagation`)
- 测试跨服务的遥测数据传播
- 验证复合传播器的功能
- 测试注入和提取操作

### 3. 时间序列操作测试 (`time series operations`)
- 测试时间序列数据处理
- 验证时间戳顺序
- 测试时间序列聚合计算（总和、平均值、最大值、最小值）

### 4. 仪表盘数据聚合测试 (`dashboard data aggregation`)
- 测试仪表盘数据的聚合计算
- 验证请求计数、错误率、成功率等指标
- 测试延迟指标的计算

### 5. 实时流处理测试 (`real-time stream processing`)
- 测试实时流数据的处理
- 验证窗口聚合操作
- 测试处理速率和吞吐量计算

### 6. 错误边界处理测试 (`error boundary handling`)
- 测试错误恢复机制
- 验证错误传播和上下文
- 测试错误日志记录

### 7. 并发安全性测试 (`concurrent safety`)
- 测试并发环境下的指标更新
- 验证跨操作的并发安全性
- 测试上下文操作的并发处理

### 8. 国际化支持测试 (`internationalization support`)
- 测试 Unicode 文本处理
- 验证多语言支持（中文、英文）
- 测试特殊字符和表情符号的处理

### 9. 资源管理测试 (`resource management`)
- 测试资源的创建和合并
- 验证资源属性的管理
- 测试资源清理和释放

### 10. 性能基准测试 (`performance benchmarks`)
- 测试操作计时
- 验证吞吐量计算
- 测试内存使用情况

## 运行测试
要运行这些测试，请使用 MoonBit 测试框架：

```bash
# 确保测试文件已添加到 moon.pkg.json 的 test 部分
moon test
```

## 注意事项
- 这些测试用例使用简化的实现，主要验证接口和基本功能
- 部分测试使用模拟数据，实际应用中需要替换为真实数据
- 测试中的辅助函数（如 `string_length` 和 `string_contains`）是简化实现，实际应用中需要使用标准库函数

## 总结
这 10 个测试用例覆盖了 Azimuth 遥测系统的核心功能，包括属性处理、跨服务传播、时间序列操作、仪表盘聚合、实时流处理、错误处理、并发安全、国际化、资源管理和性能基准。这些测试有助于确保系统的稳定性和可靠性。