// èµ„æºåˆå¹¶ç­–ç•¥æµ‹è¯•
// æµ‹è¯•Azimuthé¥æµ‹ç³»ç»Ÿä¸­èµ„æºåˆå¹¶çš„å„ç§ç­–ç•¥å’Œè¡Œä¸º

// æµ‹è¯•1: åŸºæœ¬èµ„æºåˆå¹¶ç­–ç•¥
pub test "åŸºæœ¬èµ„æºåˆå¹¶ç­–ç•¥æµ‹è¯•" {
  // åˆ›å»ºåŸºç¡€èµ„æº
  let base_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("service.name", azimuth::StringValue("base-service")),
    ("service.version", azimuth::StringValue("1.0.0")),
    ("deployment.environment", azimuth::StringValue("development"))
  ])
  
  // åˆ›å»ºè¦†ç›–èµ„æº
  let override_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("service.version", azimuth::StringValue("2.0.0")),  // è¦†ç›–ç°æœ‰å±æ€§
    ("service.instance.id", azimuth::StringValue("instance-123")),  // æ–°å¢å±æ€§
    ("host.name", azimuth::StringValue("test-host"))  // æ–°å¢å±æ€§
  ])
  
  // æ‰§è¡Œèµ„æºåˆå¹¶
  let merged_resource = azimuth::Resource::merge(base_resource, override_resource)
  
  // éªŒè¯åˆå¹¶ç»“æœ
  // åŸºç¡€å±æ€§ä¸­æœªè¢«è¦†ç›–çš„åº”è¯¥ä¿æŒ
  assert_eq(azimuth::Resource::get_attribute(merged_resource, "service.name"), Some(azimuth::StringValue("base-service")))
  assert_eq(azimuth::Resource::get_attribute(merged_resource, "deployment.environment"), Some(azimuth::StringValue("development")))
  
  // è¢«è¦†ç›–çš„å±æ€§åº”è¯¥ä½¿ç”¨æ–°å€¼
  assert_eq(azimuth::Resource::get_attribute(merged_resource, "service.version"), Some(azimuth::StringValue("2.0.0")))
  
  // æ–°å¢å±æ€§åº”è¯¥å­˜åœ¨
  assert_eq(azimuth::Resource::get_attribute(merged_resource, "service.instance.id"), Some(azimuth::StringValue("instance-123")))
  assert_eq(azimuth::Resource::get_attribute(merged_resource, "host.name"), Some(azimuth::StringValue("test-host")))
  
  // éªŒè¯åŸå§‹èµ„æºæœªè¢«ä¿®æ”¹
  assert_eq(azimuth::Resource::get_attribute(base_resource, "service.version"), Some(azimuth::StringValue("1.0.0")))
  assert_eq(azimuth::Resource::get_attribute(override_resource, "service.instance.id"), Some(azimuth::StringValue("instance-123")))
}

// æµ‹è¯•2: å¤šçº§èµ„æºåˆå¹¶ç­–ç•¥
pub test "å¤šçº§èµ„æºåˆå¹¶ç­–ç•¥æµ‹è¯•" {
  // åˆ›å»ºç¬¬ä¸€çº§èµ„æºï¼ˆåŸºç¡€æœåŠ¡ä¿¡æ¯ï¼‰
  let level1_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("service.name", azimuth::StringValue("multi-level-service")),
    ("service.version", azimuth::StringValue("1.0.0")),
    ("service.namespace", azimuth::StringValue("production"))
  ])
  
  // åˆ›å»ºç¬¬äºŒçº§èµ„æºï¼ˆéƒ¨ç½²ä¿¡æ¯ï¼‰
  let level2_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("deployment.environment", azimuth::StringValue("staging")),
    ("deployment.region", azimuth::StringValue("us-west-1")),
    ("service.version", azimuth::StringValue("1.1.0"))  // è¦†ç›–ç‰ˆæœ¬
  ])
  
  // åˆ›å»ºç¬¬ä¸‰çº§èµ„æºï¼ˆè¿è¡Œæ—¶ä¿¡æ¯ï¼‰
  let level3_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("service.instance.id", azimuth::StringValue("instance-456")),
    ("host.name", azimuth::StringValue("prod-host-1")),
    ("process.id", azimuth::IntValue(7890))
  ])
  
  // æ‰§è¡Œå¤šçº§åˆå¹¶
  let merged_level1_2 = azimuth::Resource::merge(level1_resource, level2_resource)
  let merged_all = azimuth::Resource::merge(merged_level1_2, level3_resource)
  
  // éªŒè¯ä¸€çº§åˆå¹¶ç»“æœ
  assert_eq(azimuth::Resource::get_attribute(merged_level1_2, "service.name"), Some(azimuth::StringValue("multi-level-service")))
  assert_eq(azimuth::Resource::get_attribute(merged_level1_2, "service.version"), Some(azimuth::StringValue("1.1.0")))  // è¢«è¦†ç›–
  assert_eq(azimuth::Resource::get_attribute(merged_level1_2, "service.namespace"), Some(azimuth::StringValue("production")))
  assert_eq(azimuth::Resource::get_attribute(merged_level1_2, "deployment.environment"), Some(azimuth::StringValue("staging")))
  assert_eq(azimuth::Resource::get_attribute(merged_level1_2, "deployment.region"), Some(azimuth::StringValue("us-west-1")))
  
  // éªŒè¯ä¸‰çº§åˆå¹¶ç»“æœ
  assert_eq(azimuth::Resource::get_attribute(merged_all, "service.name"), Some(azimuth::StringValue("multi-level-service")))
  assert_eq(azimuth::Resource::get_attribute(merged_all, "service.version"), Some(azimuth::StringValue("1.1.0")))
  assert_eq(azimuth::Resource::get_attribute(merged_all, "service.namespace"), Some(azimuth::StringValue("production")))
  assert_eq(azimuth::Resource::get_attribute(merged_all, "deployment.environment"), Some(azimuth::StringValue("staging")))
  assert_eq(azimuth::Resource::get_attribute(merged_all, "deployment.region"), Some(azimuth::StringValue("us-west-1")))
  assert_eq(azimuth::Resource::get_attribute(merged_all, "service.instance.id"), Some(azimuth::StringValue("instance-456")))
  assert_eq(azimuth::Resource::get_attribute(merged_all, "host.name"), Some(azimuth::StringValue("prod-host-1")))
  assert_eq(azimuth::Resource::get_attribute(merged_all, "process.id"), Some(azimuth::IntValue(7890)))
}

// æµ‹è¯•3: ä¸åŒç±»å‹å±æ€§å€¼çš„åˆå¹¶ç­–ç•¥
pub test "ä¸åŒç±»å‹å±æ€§å€¼çš„åˆå¹¶ç­–ç•¥æµ‹è¯•" {
  // åˆ›å»ºåŒ…å«ä¸åŒç±»å‹å±æ€§çš„åŸºç¡€èµ„æº
  let base_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("string.attr", azimuth::StringValue("base-value")),
    ("int.attr", azimuth::IntValue(100)),
    ("bool.attr", azimuth::BoolValue(true)),
    ("float.attr", azimuth::FloatValue(3.14))
  ])
  
  // åˆ›å»ºåŒ…å«ä¸åŒç±»å‹å±æ€§çš„è¦†ç›–èµ„æº
  let override_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("string.attr", azimuth::StringValue("override-value")),  // è¦†ç›–å­—ç¬¦ä¸²
    ("int.attr", azimuth::IntValue(200)),  // è¦†ç›–æ•´æ•°
    ("bool.attr", azimuth::BoolValue(false)),  // è¦†ç›–å¸ƒå°”å€¼
    ("float.attr", azimuth::FloatValue(2.71)),  // è¦†ç›–æµ®ç‚¹æ•°
    ("new.string.attr", azimuth::StringValue("new-string")),  // æ–°å¢å­—ç¬¦ä¸²
    ("new.int.attr", azimuth::IntValue(300))  // æ–°å¢æ•´æ•°
  ])
  
  // æ‰§è¡Œåˆå¹¶
  let merged_resource = azimuth::Resource::merge(base_resource, override_resource)
  
  // éªŒè¯ç±»å‹è¦†ç›–
  assert_eq(azimuth::Resource::get_attribute(merged_resource, "string.attr"), Some(azimuth::StringValue("override-value")))
  assert_eq(azimuth::Resource::get_attribute(merged_resource, "int.attr"), Some(azimuth::IntValue(200)))
  assert_eq(azimuth::Resource::get_attribute(merged_resource, "bool.attr"), Some(azimuth::BoolValue(false)))
  assert_eq(azimuth::Resource::get_attribute(merged_resource, "float.attr"), Some(azimuth::FloatValue(2.71)))
  
  // éªŒè¯æ–°å¢å±æ€§
  assert_eq(azimuth::Resource::get_attribute(merged_resource, "new.string.attr"), Some(azimuth::StringValue("new-string")))
  assert_eq(azimuth::Resource::get_attribute(merged_resource, "new.int.attr"), Some(azimuth::IntValue(300)))
}

// æµ‹è¯•4: ç©ºèµ„æºå’Œç‰¹æ®Šå±æ€§åˆå¹¶ç­–ç•¥
pub test "ç©ºèµ„æºå’Œç‰¹æ®Šå±æ€§åˆå¹¶ç­–ç•¥æµ‹è¯•" {
  // åˆ›å»ºç©ºèµ„æº
  let empty_resource = azimuth::Resource::new()
  
  // åˆ›å»ºéç©ºèµ„æº
  let non_empty_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("service.name", azimuth::StringValue("test-service")),
    ("service.version", azimuth::StringValue("1.0.0"))
  ])
  
  // æµ‹è¯•ç©ºèµ„æºä¸éç©ºèµ„æºåˆå¹¶ï¼ˆç©ºèµ„æºåœ¨å‰ï¼‰
  let merged_empty_first = azimuth::Resource::merge(empty_resource, non_empty_resource)
  assert_eq(azimuth::Resource::get_attribute(merged_empty_first, "service.name"), Some(azimuth::StringValue("test-service")))
  assert_eq(azimuth::Resource::get_attribute(merged_empty_first, "service.version"), Some(azimuth::StringValue("1.0.0")))
  
  // æµ‹è¯•ç©ºèµ„æºä¸éç©ºèµ„æºåˆå¹¶ï¼ˆç©ºèµ„æºåœ¨åï¼‰
  let merged_empty_last = azimuth::Resource::merge(non_empty_resource, empty_resource)
  assert_eq(azimuth::Resource::get_attribute(merged_empty_last, "service.name"), Some(azimuth::StringValue("test-service")))
  assert_eq(azimuth::Resource::get_attribute(merged_empty_last, "service.version"), Some(azimuth::StringValue("1.0.0")))
  
  // æµ‹è¯•ç©ºå­—ç¬¦ä¸²å±æ€§
  let resource_with_empty_string = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("empty.string", azimuth::StringValue("")),
    ("normal.string", azimuth::StringValue("normal-value"))
  ])
  
  let merged_empty_string = azimuth::Resource::merge(non_empty_resource, resource_with_empty_string)
  assert_eq(azimuth::Resource::get_attribute(merged_empty_string, "empty.string"), Some(azimuth::StringValue("")))
  assert_eq(azimuth::Resource::get_attribute(merged_empty_string, "normal.string"), Some(azimuth::StringValue("normal-value")))
  assert_eq(azimuth::Resource::get_attribute(merged_empty_string, "service.name"), Some(azimuth::StringValue("test-service")))
  
  // æµ‹è¯•é›¶å€¼å±æ€§
  let resource_with_zero_values = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("zero.int", azimuth::IntValue(0)),
    ("zero.float", azimuth::FloatValue(0.0)),
    ("false.bool", azimuth::BoolValue(false))
  ])
  
  let merged_zero_values = azimuth::Resource::merge(non_empty_resource, resource_with_zero_values)
  assert_eq(azimuth::Resource::get_attribute(merged_zero_values, "zero.int"), Some(azimuth::IntValue(0)))
  assert_eq(azimuth::Resource::get_attribute(merged_zero_values, "zero.float"), Some(azimuth::FloatValue(0.0)))
  assert_eq(azimuth::Resource::get_attribute(merged_zero_values, "false.bool"), Some(azimuth::BoolValue(false)))
}

// æµ‹è¯•5: å¤§é‡å±æ€§èµ„æºåˆå¹¶ç­–ç•¥
pub test "å¤§é‡å±æ€§èµ„æºåˆå¹¶ç­–ç•¥æµ‹è¯•" {
  // åˆ›å»ºåŒ…å«å¤§é‡å±æ€§çš„åŸºç¡€èµ„æº
  let base_attrs = []
  for i in 0..100 {
    base_attrs.push(("base.attr." + i.to_string(), azimuth::StringValue("base-value-" + i.to_string())))
  }
  
  let base_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), base_attrs)
  
  // åˆ›å»ºåŒ…å«å¤§é‡å±æ€§çš„è¦†ç›–èµ„æº
  let override_attrs = []
  for i in 0..50 {
    // è¦†ç›–å‰50ä¸ªå±æ€§
    override_attrs.push(("base.attr." + i.to_string(), azimuth::StringValue("override-value-" + i.to_string())))
  }
  
  for i in 50..100 {
    // æ–°å¢50ä¸ªå±æ€§
    override_attrs.push(("new.attr." + i.to_string(), azimuth::StringValue("new-value-" + i.to_string())))
  }
  
  let override_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), override_attrs)
  
  // æ‰§è¡Œåˆå¹¶
  let merged_resource = azimuth::Resource::merge(base_resource, override_resource)
  
  // éªŒè¯è¦†ç›–çš„å±æ€§
  for i in 0..50 {
    let key = "base.attr." + i.to_string()
    let expected_value = "override-value-" + i.to_string()
    assert_eq(azimuth::Resource::get_attribute(merged_resource, key), Some(azimuth::StringValue(expected_value)))
  }
  
  // éªŒè¯æœªè¦†ç›–çš„å±æ€§
  for i in 50..100 {
    let key = "base.attr." + i.to_string()
    let expected_value = "base-value-" + i.to_string()
    assert_eq(azimuth::Resource::get_attribute(merged_resource, key), Some(azimuth::StringValue(expected_value)))
  }
  
  // éªŒè¯æ–°å¢çš„å±æ€§
  for i in 50..100 {
    let key = "new.attr." + i.to_string()
    let expected_value = "new-value-" + i.to_string()
    assert_eq(azimuth::Resource::get_attribute(merged_resource, key), Some(azimuth::StringValue(expected_value)))
  }
}

// æµ‹è¯•6: ç‰¹æ®Šå­—ç¬¦å’ŒUnicodeå±æ€§åˆå¹¶ç­–ç•¥
pub test "ç‰¹æ®Šå­—ç¬¦å’ŒUnicodeå±æ€§åˆå¹¶ç­–ç•¥æµ‹è¯•" {
  // åˆ›å»ºåŒ…å«ç‰¹æ®Šå­—ç¬¦å’ŒUnicodeçš„åŸºç¡€èµ„æº
  let base_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("special.chars.key", azimuth::StringValue("!@#$%^&*()")),
    ("unicode.key", azimuth::StringValue("æµ‹è¯•ä¸­æ–‡")),
    ("emoji.key", azimuth::StringValue("ğŸš€ğŸŒŸ")),
    ("mixed.key", azimuth::StringValue("Mixed!æµ‹è¯•123ğŸš€"))
  ])
  
  // åˆ›å»ºåŒ…å«ç‰¹æ®Šå­—ç¬¦å’ŒUnicodeçš„è¦†ç›–èµ„æº
  let override_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("special.chars.key", azimuth::StringValue("[]{}|;':\",./<>?")),  // è¦†ç›–ç‰¹æ®Šå­—ç¬¦
    ("unicode.key", azimuth::StringValue("æ—¥æœ¬èª")),  // è¦†ç›–Unicode
    ("emoji.key", azimuth::StringValue("ğŸ’¯ğŸ‰")),  // è¦†ç›–Emoji
    ("new.special.key", azimuth::StringValue("æ–°!@#$%")),  // æ–°å¢ç‰¹æ®Šå­—ç¬¦
    ("new.unicode.key", azimuth::StringValue("í•œêµ­ì–´"))  // æ–°å¢Unicode
  ])
  
  // æ‰§è¡Œåˆå¹¶
  let merged_resource = azimuth::Resource::merge(base_resource, override_resource)
  
  // éªŒè¯è¦†ç›–çš„å±æ€§
  assert_eq(azimuth::Resource::get_attribute(merged_resource, "special.chars.key"), Some(azimuth::StringValue("[]{}|;':\",./<>?")))
  assert_eq(azimuth::Resource::get_attribute(merged_resource, "unicode.key"), Some(azimuth::StringValue("æ—¥æœ¬èª")))
  assert_eq(azimuth::Resource::get_attribute(merged_resource, "emoji.key"), Some(azimuth::StringValue("ğŸ’¯ğŸ‰")))
  
  // éªŒè¯æœªè¦†ç›–çš„å±æ€§
  assert_eq(azimuth::Resource::get_attribute(merged_resource, "mixed.key"), Some(azimuth::StringValue("Mixed!æµ‹è¯•123ğŸš€")))
  
  // éªŒè¯æ–°å¢çš„å±æ€§
  assert_eq(azimuth::Resource::get_attribute(merged_resource, "new.special.key"), Some(azimuth::StringValue("æ–°!@#$%")))
  assert_eq(azimuth::Resource::get_attribute(merged_resource, "new.unicode.key"), Some(azimuth::StringValue("í•œêµ­ì–´")))
}

// æµ‹è¯•7: èµ„æºåˆå¹¶æ€§èƒ½æµ‹è¯•
pub test "èµ„æºåˆå¹¶æ€§èƒ½æµ‹è¯•" {
  // åˆ›å»ºå¤§å‹åŸºç¡€èµ„æº
  let base_attrs = []
  for i in 0..1000 {
    base_attrs.push(("base.attr." + i.to_string(), azimuth::StringValue("base-value-" + i.to_string())))
  }
  
  let base_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), base_attrs)
  
  // åˆ›å»ºå¤§å‹è¦†ç›–èµ„æº
  let override_attrs = []
  for i in 0..500 {
    override_attrs.push(("base.attr." + i.to_string(), azimuth::StringValue("override-value-" + i.to_string())))
  }
  
  for i in 500..1000 {
    override_attrs.push(("new.attr." + i.to_string(), azimuth::StringValue("new-value-" + i.to_string())))
  }
  
  let override_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), override_attrs)
  
  // æµ‹è¯•åˆå¹¶æ€§èƒ½
  let start_time = azimuth::Clock::now_unix_nanos(azimuth::Clock::system())
  
  let merged_resource = azimuth::Resource::merge(base_resource, override_resource)
  
  let end_time = azimuth::Clock::now_unix_nanos(azimuth::Clock::system())
  
  // éªŒè¯æ€§èƒ½
  let merge_duration = end_time - start_time
  assert_true(merge_duration < 5000000000L)  // åˆå¹¶åº”åœ¨5ç§’å†…å®Œæˆ
  
  // éªŒè¯åˆå¹¶ç»“æœæ­£ç¡®æ€§
  for i in 0..500 {
    let key = "base.attr." + i.to_string()
    let expected_value = "override-value-" + i.to_string()
    assert_eq(azimuth::Resource::get_attribute(merged_resource, key), Some(azimuth::StringValue(expected_value)))
  }
  
  for i in 500..1000 {
    let key = "base.attr." + i.to_string()
    let expected_value = "base-value-" + i.to_string()
    assert_eq(azimuth::Resource::get_attribute(merged_resource, key), Some(azimuth::StringValue(expected_value)))
  }
  
  for i in 500..1000 {
    let key = "new.attr." + i.to_string()
    let expected_value = "new-value-" + i.to_string()
    assert_eq(azimuth::Resource::get_attribute(merged_resource, key), Some(azimuth::StringValue(expected_value)))
  }
}

// æµ‹è¯•8: èµ„æºåˆå¹¶å¹‚ç­‰æ€§æµ‹è¯•
pub test "èµ„æºåˆå¹¶å¹‚ç­‰æ€§æµ‹è¯•" {
  // åˆ›å»ºåŸºç¡€èµ„æº
  let base_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("service.name", azimuth::StringValue("idempotent-service")),
    ("service.version", azimuth::StringValue("1.0.0"))
  ])
  
  // åˆ›å»ºè¦†ç›–èµ„æº
  let override_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("service.instance.id", azimuth::StringValue("instance-789"))
  ])
  
  // æ‰§è¡Œç¬¬ä¸€æ¬¡åˆå¹¶
  let merged1 = azimuth::Resource::merge(base_resource, override_resource)
  
  // æ‰§è¡Œç¬¬äºŒæ¬¡åˆå¹¶ï¼ˆåˆå¹¶ç»“æœä¸ç©ºèµ„æºåˆå¹¶ï¼‰
  let merged2 = azimuth::Resource::merge(merged1, azimuth::Resource::new())
  
  // æ‰§è¡Œç¬¬ä¸‰æ¬¡åˆå¹¶ï¼ˆç©ºèµ„æºä¸åˆå¹¶ç»“æœåˆå¹¶ï¼‰
  let merged3 = azimuth::Resource::merge(azimuth::Resource::new(), merged2)
  
  // éªŒè¯å¹‚ç­‰æ€§
  assert_eq(azimuth::Resource::get_attribute(merged1, "service.name"), azimuth::Resource::get_attribute(merged2, "service.name"))
  assert_eq(azimuth::Resource::get_attribute(merged2, "service.name"), azimuth::Resource::get_attribute(merged3, "service.name"))
  
  assert_eq(azimuth::Resource::get_attribute(merged1, "service.version"), azimuth::Resource::get_attribute(merged2, "service.version"))
  assert_eq(azimuth::Resource::get_attribute(merged2, "service.version"), azimuth::Resource::get_attribute(merged3, "service.version"))
  
  assert_eq(azimuth::Resource::get_attribute(merged1, "service.instance.id"), azimuth::Resource::get_attribute(merged2, "service.instance.id"))
  assert_eq(azimuth::Resource::get_attribute(merged2, "service.instance.id"), azimuth::Resource::get_attribute(merged3, "service.instance.id"))
  
  // éªŒè¯å…·ä½“å€¼
  assert_eq(azimuth::Resource::get_attribute(merged1, "service.name"), Some(azimuth::StringValue("idempotent-service")))
  assert_eq(azimuth::Resource::get_attribute(merged1, "service.version"), Some(azimuth::StringValue("1.0.0")))
  assert_eq(azimuth::Resource::get_attribute(merged1, "service.instance.id"), Some(azimuth::StringValue("instance-789")))
}

// æµ‹è¯•9: èµ„æºåˆå¹¶äº¤æ¢å¾‹æµ‹è¯•
pub test "èµ„æºåˆå¹¶äº¤æ¢å¾‹æµ‹è¯•" {
  // åˆ›å»ºç¬¬ä¸€ä¸ªèµ„æº
  let resource1 = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("service.name", azimuth::StringValue("commutative-service")),
    ("service.version", azimuth::StringValue("1.0.0")),
    ("deployment.environment", azimuth::StringValue("test"))
  ])
  
  // åˆ›å»ºç¬¬äºŒä¸ªèµ„æº
  let resource2 = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("service.instance.id", azimuth::StringValue("instance-abc")),
    ("host.name", azimuth::StringValue("test-host"))
  ])
  
  // æ‰§è¡Œ A + B åˆå¹¶
  let merged_ab = azimuth::Resource::merge(resource1, resource2)
  
  // æ‰§è¡Œ B + A åˆå¹¶
  let merged_ba = azimuth::Resource::merge(resource2, resource1)
  
  // éªŒè¯äº¤æ¢å¾‹ä¸æˆç«‹ï¼ˆè¦†ç›–é¡ºåºä¸åŒä¼šå¯¼è‡´ç»“æœä¸åŒï¼‰
  // resource1 çš„å±æ€§åœ¨ merged_ab ä¸­åº”è¯¥ä¿æŒåŸæ ·ï¼Œåœ¨ merged_ba ä¸­å¯èƒ½è¢«è¦†ç›–
  // resource2 çš„å±æ€§åœ¨ merged_ba ä¸­åº”è¯¥ä¿æŒåŸæ ·ï¼Œåœ¨ merged_ab ä¸­å¯èƒ½è¢«è¦†ç›–
  
  // éªŒè¯å…±åŒå±æ€§ï¼ˆä¸¤ä¸ªèµ„æºéƒ½æ²¡æœ‰çš„å±æ€§ï¼‰
  assert_eq(azimuth::Resource::get_attribute(merged_ab, "service.name"), azimuth::Resource::get_attribute(merged_ba, "service.name"))
  assert_eq(azimuth::Resource::get_attribute(merged_ab, "service.version"), azimuth::Resource::get_attribute(merged_ba, "service.version"))
  assert_eq(azimuth::Resource::get_attribute(merged_ab, "deployment.environment"), azimuth::Resource::get_attribute(merged_ba, "deployment.environment"))
  assert_eq(azimuth::Resource::get_attribute(merged_ab, "service.instance.id"), azimuth::Resource::get_attribute(merged_ba, "service.instance.id"))
  assert_eq(azimuth::Resource::get_attribute(merged_ab, "host.name"), azimuth::Resource::get_attribute(merged_ba, "host.name"))
  
  // éªŒè¯å…·ä½“å€¼
  assert_eq(azimuth::Resource::get_attribute(merged_ab, "service.name"), Some(azimuth::StringValue("commutative-service")))
  assert_eq(azimuth::Resource::get_attribute(merged_ab, "service.version"), Some(azimuth::StringValue("1.0.0")))
  assert_eq(azimuth::Resource::get_attribute(merged_ab, "deployment.environment"), Some(azimuth::StringValue("test")))
  assert_eq(azimuth::Resource::get_attribute(merged_ab, "service.instance.id"), Some(azimuth::StringValue("instance-abc")))
  assert_eq(azimuth::Resource::get_attribute(merged_ab, "host.name"), Some(azimuth::StringValue("test-host")))
}

// æµ‹è¯•10: èµ„æºåˆå¹¶ç»“åˆå¾‹æµ‹è¯•
pub test "èµ„æºåˆå¹¶ç»“åˆå¾‹æµ‹è¯•" {
  // åˆ›å»ºä¸‰ä¸ªèµ„æº
  let resource_a = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("service.name", azimuth::StringValue("associative-service")),
    ("service.version", azimuth::StringValue("1.0.0"))
  ])
  
  let resource_b = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("service.instance.id", azimuth::StringValue("instance-123")),
    ("deployment.environment", azimuth::StringValue("production"))
  ])
  
  let resource_c = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("host.name", azimuth::StringValue("prod-host")),
    ("service.version", azimuth::StringValue("2.0.0"))  // è¦†ç›–ç‰ˆæœ¬
  ])
  
  // æ‰§è¡Œ (A + B) + C åˆå¹¶
  let merged_ab = azimuth::Resource::merge(resource_a, resource_b)
  let merged_abc = azimuth::Resource::merge(merged_ab, resource_c)
  
  // æ‰§è¡Œ A + (B + C) åˆå¹¶
  let merged_bc = azimuth::Resource::merge(resource_b, resource_c)
  let merged_abc2 = azimuth::Resource::merge(resource_a, merged_bc)
  
  // éªŒè¯ç»“åˆå¾‹ä¸æˆç«‹ï¼ˆè¦†ç›–é¡ºåºä¸åŒä¼šå¯¼è‡´ç»“æœä¸åŒï¼‰
  // åœ¨ (A + B) + C ä¸­ï¼ŒC çš„ service.version ä¼šè¦†ç›– A çš„ service.version
  // åœ¨ A + (B + C) ä¸­ï¼ŒC çš„ service.version ä¼šè¦†ç›– B çš„ï¼Œç„¶å A çš„ service.version ä¼šä¿æŒ
  
  // éªŒè¯ç»“æœå·®å¼‚ï¼ˆä¸»è¦ä½“ç°åœ¨ service.version å±æ€§ä¸Šï¼‰
  let version_abc = azimuth::Resource::get_attribute(merged_abc, "service.version")
  let version_abc2 = azimuth::Resource::get_attribute(merged_abc2, "service.version")
  
  // éªŒè¯å…¶ä»–å±æ€§ä¸€è‡´
  assert_eq(azimuth::Resource::get_attribute(merged_abc, "service.name"), azimuth::Resource::get_attribute(merged_abc2, "service.name"))
  assert_eq(azimuth::Resource::get_attribute(merged_abc, "service.instance.id"), azimuth::Resource::get_attribute(merged_abc2, "service.instance.id"))
  assert_eq(azimuth::Resource::get_attribute(merged_abc, "deployment.environment"), azimuth::Resource::get_attribute(merged_abc2, "deployment.environment"))
  assert_eq(azimuth::Resource::get_attribute(merged_abc, "host.name"), azimuth::Resource::get_attribute(merged_abc2, "host.name"))
  
  // éªŒè¯å…·ä½“å€¼
  assert_eq(azimuth::Resource::get_attribute(merged_abc, "service.name"), Some(azimuth::StringValue("associative-service")))
  assert_eq(azimuth::Resource::get_attribute(merged_abc, "service.instance.id"), Some(azimuth::StringValue("instance-123")))
  assert_eq(azimuth::Resource::get_attribute(merged_abc, "deployment.environment"), Some(azimuth::StringValue("production")))
  assert_eq(azimuth::Resource::get_attribute(merged_abc, "host.name"), Some(azimuth::StringValue("prod-host")))
}