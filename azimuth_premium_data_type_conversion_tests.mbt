// Azimuth Premium Data Type Conversion Tests
// é«˜è´¨é‡æ•°æ®ç±»å‹è½¬æ¢æµ‹è¯•ç”¨ä¾‹
// ä¸“æ³¨äºæµ‹è¯•é¥æµ‹ç³»ç»Ÿä¸­å„ç§æ•°æ®ç±»å‹çš„è½¬æ¢å’Œä¸€è‡´æ€§

// æµ‹è¯•1: AttributeValueç±»å‹è½¬æ¢å’ŒéªŒè¯
test "AttributeValueç±»å‹è½¬æ¢å®Œæ•´æ€§æµ‹è¯•" {
  // 1. å­—ç¬¦ä¸²å€¼è½¬æ¢æµ‹è¯•
  let string_attr = AttributeValue::StringValue("test_value")
  match string_attr {
    AttributeValue::StringValue(s) => {
      assert_eq(s, "test_value")
      assert_eq(s.length(), 11)
    }
    _ => assert_true(false, "å­—ç¬¦ä¸²å€¼è½¬æ¢å¤±è´¥")
  }
  
  // 2. æ•´æ•°å€¼è½¬æ¢æµ‹è¯•
  let int_attr = AttributeValue::IntValue(42)
  match int_attr {
    AttributeValue::IntValue(i) => {
      assert_eq(i, 42)
      assert_true(i > 0)
    }
    _ => assert_true(false, "æ•´æ•°å€¼è½¬æ¢å¤±è´¥")
  }
  
  // 3. æµ®ç‚¹æ•°å€¼è½¬æ¢æµ‹è¯•
  let float_attr = AttributeValue::FloatValue(3.14159)
  match float_attr {
    AttributeValue::FloatValue(f) => {
      assert_true(f > 3.14 && f < 3.15)
      assert_true(f > 0.0)
    }
    _ => assert_true(false, "æµ®ç‚¹æ•°å€¼è½¬æ¢å¤±è´¥")
  }
  
  // 4. å¸ƒå°”å€¼è½¬æ¢æµ‹è¯•
  let bool_attr = AttributeValue::BoolValue(true)
  match bool_attr {
    AttributeValue::BoolValue(b) => {
      assert_true(b)
    }
    _ => assert_true(false, "å¸ƒå°”å€¼è½¬æ¢å¤±è´¥")
  }
  
  // 5. å­—ç¬¦ä¸²æ•°ç»„è½¬æ¢æµ‹è¯•
  let string_array_attr = AttributeValue::ArrayStringValue(["value1", "value2", "value3"])
  match string_array_attr {
    AttributeValue::ArrayStringValue(arr) => {
      assert_eq(arr.length(), 3)
      assert_eq(arr[0], "value1")
      assert_eq(arr[1], "value2")
      assert_eq(arr[2], "value3")
    }
    _ => assert_true(false, "å­—ç¬¦ä¸²æ•°ç»„è½¬æ¢å¤±è´¥")
  }
  
  // 6. æ•´æ•°æ•°ç»„è½¬æ¢æµ‹è¯•
  let int_array_attr = AttributeValue::ArrayIntValue([1, 2, 3, 4, 5])
  match int_array_attr {
    AttributeValue::ArrayIntValue(arr) => {
      assert_eq(arr.length(), 5)
      assert_eq(arr[0], 1)
      assert_eq(arr[4], 5)
      // éªŒè¯æ•°ç»„æ€»å’Œ
      let mut sum = 0
      for i in arr {
        sum = sum + i
      }
      assert_eq(sum, 15)
    }
    _ => assert_true(false, "æ•´æ•°æ•°ç»„è½¬æ¢å¤±è´¥")
  }
}

// æµ‹è¯•2: Attributesç»“æ„ä½“æ“ä½œå’Œç±»å‹è½¬æ¢
test "Attributesç»“æ„ä½“é«˜çº§æ“ä½œæµ‹è¯•" {
  // 1. åˆ›å»ºåŒ…å«å¤šç§ç±»å‹çš„Attributes
  let attributes = Attributes({
    values: [
      ("string_key", AttributeValue::StringValue("string_value")),
      ("int_key", AttributeValue::IntValue(100)),
      ("float_key", AttributeValue::FloatValue(2.71828)),
      ("bool_key", AttributeValue::BoolValue(false)),
      ("string_array_key", AttributeValue::ArrayStringValue(["a", "b", "c"])),
      ("int_array_key", AttributeValue::ArrayIntValue([10, 20, 30]))
    ]
  })
  
  // 2. éªŒè¯Attributesé•¿åº¦
  assert_eq(attributes.values.length(), 6)
  
  // 3. éªŒè¯ç‰¹å®šå±æ€§çš„å­˜åœ¨å’Œç±»å‹
  let mut found_string = false
  let mut found_int = false
  let mut found_float = false
  let mut found_bool = false
  let mut found_string_array = false
  let mut found_int_array = false
  
  for (key, value) in attributes.values {
    match key {
      "string_key" => {
        match value {
          AttributeValue::StringValue(s) => {
            assert_eq(s, "string_value")
            found_string = true
          }
          _ => assert_true(false, "å­—ç¬¦ä¸²å±æ€§ç±»å‹ä¸åŒ¹é…")
        }
      }
      "int_key" => {
        match value {
          AttributeValue::IntValue(i) => {
            assert_eq(i, 100)
            found_int = true
          }
          _ => assert_true(false, "æ•´æ•°å±æ€§ç±»å‹ä¸åŒ¹é…")
        }
      }
      "float_key" => {
        match value {
          AttributeValue::FloatValue(f) => {
            assert_true(f > 2.71 && f < 2.72)
            found_float = true
          }
          _ => assert_true(false, "æµ®ç‚¹æ•°å±æ€§ç±»å‹ä¸åŒ¹é…")
        }
      }
      "bool_key" => {
        match value {
          AttributeValue::BoolValue(b) => {
            assert_false(b)
            found_bool = true
          }
          _ => assert_true(false, "å¸ƒå°”å±æ€§ç±»å‹ä¸åŒ¹é…")
        }
      }
      "string_array_key" => {
        match value {
          AttributeValue::ArrayStringValue(arr) => {
            assert_eq(arr.length(), 3)
            found_string_array = true
          }
          _ => assert_true(false, "å­—ç¬¦ä¸²æ•°ç»„å±æ€§ç±»å‹ä¸åŒ¹é…")
        }
      }
      "int_array_key" => {
        match value {
          AttributeValue::ArrayIntValue(arr) => {
            assert_eq(arr.length(), 3)
            found_int_array = true
          }
          _ => assert_true(false, "æ•´æ•°æ•°ç»„å±æ€§ç±»å‹ä¸åŒ¹é…")
        }
      }
      _ => assert_true(false, "æœªçŸ¥çš„å±æ€§é”®: " + key)
    }
  }
  
  // 4. éªŒè¯æ‰€æœ‰å±æ€§éƒ½è¢«æ‰¾åˆ°
  assert_true(found_string, "å­—ç¬¦ä¸²å±æ€§æœªæ‰¾åˆ°")
  assert_true(found_int, "æ•´æ•°å±æ€§æœªæ‰¾åˆ°")
  assert_true(found_float, "æµ®ç‚¹æ•°å±æ€§æœªæ‰¾åˆ°")
  assert_true(found_bool, "å¸ƒå°”å±æ€§æœªæ‰¾åˆ°")
  assert_true(found_string_array, "å­—ç¬¦ä¸²æ•°ç»„å±æ€§æœªæ‰¾åˆ°")
  assert_true(found_int_array, "æ•´æ•°æ•°ç»„å±æ€§æœªæ‰¾åˆ°")
}

// æµ‹è¯•3: Resourceå±æ€§ç±»å‹è½¬æ¢å’ŒéªŒè¯
test "Resourceå±æ€§ç±»å‹è½¬æ¢éªŒè¯æµ‹è¯•" {
  // 1. åˆ›å»ºåŒ…å«å¤šç§èµ„æºå±æ€§çš„Resource
  let resource = Resource({
    attributes: [
      ("service.name", AttributeValue::StringValue("azimuth-telemetry")),
      ("service.version", AttributeValue::StringValue("1.0.0")),
      ("service.instance.id", AttributeValue::StringValue("instance-12345")),
      ("host.name", AttributeValue::StringValue("production-server")),
      ("host.cpu.count", AttributeValue::IntValue(8)),
      ("host.memory.total", AttributeValue::IntValue(16777216)),
      ("host.cpu.utilization", AttributeValue::FloatValue(0.75)),
      ("process.pid", AttributeValue::IntValue(1234)),
      ("process.executable.name", AttributeValue::StringValue("azimuth")),
      ("deployment.environment", AttributeValue::StringValue("production"))
    ]
  })
  
  // 2. éªŒè¯èµ„æºå±æ€§æ•°é‡
  assert_eq(resource.attributes.length(), 10)
  
  // 3. éªŒè¯å…³é”®æœåŠ¡å±æ€§
  let mut service_name_found = false
  let mut service_version_found = false
  let mut environment_found = false
  
  for (key, value) in resource.attributes {
    match key {
      "service.name" => {
        match value {
          AttributeValue::StringValue(name) => {
            assert_eq(name, "azimuth-telemetry")
            service_name_found = true
          }
          _ => assert_true(false, "æœåŠ¡åç§°ç±»å‹é”™è¯¯")
        }
      }
      "service.version" => {
        match value {
          AttributeValue::StringValue(version) => {
            assert_eq(version, "1.0.0")
            service_version_found = true
          }
          _ => assert_true(false, "æœåŠ¡ç‰ˆæœ¬ç±»å‹é”™è¯¯")
        }
      }
      "deployment.environment" => {
        match value {
          AttributeValue::StringValue(env) => {
            assert_eq(env, "production")
            environment_found = true
          }
          _ => assert_true(false, "éƒ¨ç½²ç¯å¢ƒç±»å‹é”™è¯¯")
        }
      }
      "host.cpu.count" => {
        match value {
          AttributeValue::IntValue(count) => {
            assert_eq(count, 8)
            assert_true(count > 0)
          }
          _ => assert_true(false, "CPUæ ¸å¿ƒæ•°ç±»å‹é”™è¯¯")
        }
      }
      "host.memory.total" => {
        match value {
          AttributeValue::IntValue(memory) => {
            assert_eq(memory, 16777216)
            assert_true(memory > 0)
          }
          _ => assert_true(false, "å†…å­˜æ€»é‡ç±»å‹é”™è¯¯")
        }
      }
      _ => () // å¿½ç•¥å…¶ä»–å±æ€§
    }
  }
  
  // 4. éªŒè¯å…³é”®å±æ€§å­˜åœ¨
  assert_true(service_name_found, "æœåŠ¡åç§°å±æ€§æœªæ‰¾åˆ°")
  assert_true(service_version_found, "æœåŠ¡ç‰ˆæœ¬å±æ€§æœªæ‰¾åˆ°")
  assert_true(environment_found, "éƒ¨ç½²ç¯å¢ƒå±æ€§æœªæ‰¾åˆ°")
}

// æµ‹è¯•4: è¾¹ç•Œæ¡ä»¶å’Œç‰¹æ®Šå€¼è½¬æ¢æµ‹è¯•
test "è¾¹ç•Œæ¡ä»¶å’Œç‰¹æ®Šå€¼è½¬æ¢æµ‹è¯•" {
  // 1. ç©ºå­—ç¬¦ä¸²å¤„ç†
  let empty_string = AttributeValue::StringValue("")
  match empty_string {
    AttributeValue::StringValue(s) => {
      assert_eq(s, "")
      assert_eq(s.length(), 0)
    }
    _ => assert_true(false, "ç©ºå­—ç¬¦ä¸²å¤„ç†å¤±è´¥")
  }
  
  // 2. é›¶å€¼å¤„ç†
  let zero_int = AttributeValue::IntValue(0)
  match zero_int {
    AttributeValue::IntValue(i) => {
      assert_eq(i, 0)
    }
    _ => assert_true(false, "é›¶å€¼å¤„ç†å¤±è´¥")
  }
  
  // 3. è´Ÿæ•°å¤„ç†
  let negative_int = AttributeValue::IntValue(-42)
  match negative_int {
    AttributeValue::IntValue(i) => {
      assert_eq(i, -42)
      assert_true(i < 0)
    }
    _ => assert_true(false, "è´Ÿæ•°å¤„ç†å¤±è´¥")
  }
  
  // 4. é›¶æµ®ç‚¹æ•°å¤„ç†
  let zero_float = AttributeValue::FloatValue(0.0)
  match zero_float {
    AttributeValue::FloatValue(f) => {
      assert_eq(f, 0.0)
    }
    _ => assert_true(false, "é›¶æµ®ç‚¹æ•°å¤„ç†å¤±è´¥")
  }
  
  // 5. è´Ÿæµ®ç‚¹æ•°å¤„ç†
  let negative_float = AttributeValue::FloatValue(-3.14159)
  match negative_float {
    AttributeValue::FloatValue(f) => {
      assert_true(f < -3.14 && f > -3.15)
    }
    _ => assert_true(false, "è´Ÿæµ®ç‚¹æ•°å¤„ç†å¤±è´¥")
  }
  
  // 6. æå¤§æ•°å€¼å¤„ç†
  let large_int = AttributeValue::IntValue(9223372036854775807) // Int64æœ€å¤§å€¼
  match large_int {
    AttributeValue::IntValue(i) => {
      assert_true(i > 9223372036854775806)
    }
    _ => assert_true(false, "æå¤§æ•°å€¼å¤„ç†å¤±è´¥")
  }
  
  // 7. æå°æ•°å€¼å¤„ç†
  let small_float = AttributeValue::FloatValue(0.0000001)
  match small_float {
    AttributeValue::FloatValue(f) => {
      assert_true(f > 0.0 && f < 0.000001)
    }
    _ => assert_true(false, "æå°æ•°å€¼å¤„ç†å¤±è´¥")
  }
  
  // 8. ç©ºæ•°ç»„å¤„ç†
  let empty_string_array = AttributeValue::ArrayStringValue([])
  match empty_string_array {
    AttributeValue::ArrayStringValue(arr) => {
      assert_eq(arr.length(), 0)
    }
    _ => assert_true(false, "ç©ºå­—ç¬¦ä¸²æ•°ç»„å¤„ç†å¤±è´¥")
  }
  
  let empty_int_array = AttributeValue::ArrayIntValue([])
  match empty_int_array {
    AttributeValue::ArrayIntValue(arr) => {
      assert_eq(arr.length(), 0)
    }
    _ => assert_true(false, "ç©ºæ•´æ•°æ•°ç»„å¤„ç†å¤±è´¥")
  }
}

// æµ‹è¯•5: å¤æ‚åµŒå¥—æ•°æ®ç±»å‹è½¬æ¢æµ‹è¯•
test "å¤æ‚åµŒå¥—æ•°æ®ç±»å‹è½¬æ¢æµ‹è¯•" {
  // 1. åˆ›å»ºåŒ…å«é•¿å­—ç¬¦ä¸²çš„å±æ€§
  let long_string = "è¿™æ˜¯ä¸€ä¸ªéå¸¸é•¿çš„å­—ç¬¦ä¸²ï¼Œç”¨äºæµ‹è¯•ç³»ç»Ÿå¯¹é•¿æ–‡æœ¬çš„å¤„ç†èƒ½åŠ›ã€‚"
                  + "å®ƒåŒ…å«äº†å¤šä¸ªå­—ç¬¦å’Œç‰¹æ®Šç¬¦å·ï¼š!@#$%^&*()_+-={}[]|\\:;\"'<>?,./"
                  + "ä»¥åŠä¸­æ–‡å­—ç¬¦ï¼šæµ‹è¯•æ•°æ®ç±»å‹è½¬æ¢çš„å®Œæ•´æ€§å’Œæ­£ç¡®æ€§ã€‚"
  let long_string_attr = AttributeValue::StringValue(long_string)
  match long_string_attr {
    AttributeValue::StringValue(s) => {
      assert_eq(s.length(), 78)
      assert_true(s.contains("æµ‹è¯•"))
      assert_true(s.contains("!@#$%^&*"))
    }
    _ => assert_true(false, "é•¿å­—ç¬¦ä¸²å¤„ç†å¤±è´¥")
  }
  
  // 2. åˆ›å»ºåŒ…å«ç‰¹æ®Šå­—ç¬¦çš„å­—ç¬¦ä¸²
  let special_chars = "!@#$%^&*()_+-={}[]|\\:;\"'<>?,./~`"
  let special_chars_attr = AttributeValue::StringValue(special_chars)
  match special_chars_attr {
    AttributeValue::StringValue(s) => {
      assert_eq(s.length(), 29)
      assert_true(s.contains("!@#$%^&*"))
      assert_true(s.contains("{}[]|\\"))
    }
    _ => assert_true(false, "ç‰¹æ®Šå­—ç¬¦å­—ç¬¦ä¸²å¤„ç†å¤±è´¥")
  }
  
  // 3. åˆ›å»ºåŒ…å«Unicodeå­—ç¬¦çš„å­—ç¬¦ä¸²
  let unicode_string = "Unicodeæµ‹è¯•: ğŸŒŸ é¥æµ‹ç³»ç»Ÿ ğŸ“Š æ•°æ®æ”¶é›† ğŸ”„"
  let unicode_attr = AttributeValue::StringValue(unicode_string)
  match unicode_attr {
    AttributeValue::StringValue(s) => {
      assert_eq(s.length(), 19)
      assert_true(s.contains("ğŸŒŸ"))
      assert_true(s.contains("ğŸ“Š"))
      assert_true(s.contains("ğŸ”„"))
    }
    _ => assert_true(false, "Unicodeå­—ç¬¦ä¸²å¤„ç†å¤±è´¥")
  }
  
  // 4. åˆ›å»ºåŒ…å«æ··åˆç±»å‹çš„å¤§æ•°ç»„
  let large_string_array = AttributeValue::ArrayStringValue([
    "item1", "item2", "item3", "item4", "item5",
    "item6", "item7", "item8", "item9", "item10"
  ])
  match large_string_array {
    AttributeValue::ArrayStringValue(arr) => {
      assert_eq(arr.length(), 10)
      assert_eq(arr[0], "item1")
      assert_eq(arr[9], "item10")
    }
    _ => assert_true(false, "å¤§å­—ç¬¦ä¸²æ•°ç»„å¤„ç†å¤±è´¥")
  }
  
  // 5. åˆ›å»ºåŒ…å«å¤§æ•°å€¼çš„æ•°ç»„
  let large_int_array = AttributeValue::ArrayIntValue([
    1000000, 2000000, 3000000, 4000000, 5000000
  ])
  match large_int_array {
    AttributeValue::ArrayIntValue(arr) => {
      assert_eq(arr.length(), 5)
      assert_eq(arr[0], 1000000)
      assert_eq(arr[4], 5000000)
      
      // éªŒè¯æ•°ç»„æ€»å’Œ
      let mut sum = 0
      for i in arr {
        sum = sum + i
      }
      assert_eq(sum, 15000000)
    }
    _ => assert_true(false, "å¤§æ•´æ•°æ•°ç»„å¤„ç†å¤±è´¥")
  }
}