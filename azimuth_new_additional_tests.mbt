// Azimuth é¡¹ç›®æ–°å¢æ ‡å‡† MoonBit æµ‹è¯•ç”¨ä¾‹
// ä½¿ç”¨æ ‡å‡† MoonBit æµ‹è¯•è¯­æ³•ï¼Œè‡ªåŒ…å«ç‰ˆæœ¬

// å®šä¹‰éœ€è¦çš„å‡½æ•°
fn add(a : Int, b : Int) -> Int {
  if a == 0 { return b }
  if b == 0 { return a }
  
  let min_val = -2147483648
  let max_val = 2147483647
  
  if a == min_val && b < 0 { return min_val }
  if b == min_val && a < 0 { return min_val }
  
  if a > 0 && b > 0 && a > max_val - b { return max_val }
  if a < 0 && b < 0 && a < min_val - b { return min_val }
  
  a + b
}

fn multiply(a : Int, b : Int) -> Int {
  let min_val = -2147483648
  let max_val = 2147483647
  
  if a == 0 || b == 0 { return 0 }
  if a == 1 { return b }
  if b == 1 { return a }
  
  if a == -1 { return if b == min_val { min_val } else { -b } }
  if b == -1 { return if a == min_val { min_val } else { -a } }
  
  if a == min_val { return if b > 1 || b < -1 { min_val } else { a * b } }
  if b == min_val { return if a > 1 || a < -1 { min_val } else { a * b } }
  
  let sign = if (a > 0 && b > 0) || (a < 0 && b < 0) { 1 } else { -1 }
  let abs_a = if a < 0 { -a } else { a }
  let abs_b = if b < 0 { -b } else { b }
  
  if abs_a > max_val / abs_b { return if sign > 0 { max_val } else { min_val } }
  
  a * b
}

fn greet(name : String) -> String {
  "Hello, " + name + "!"
}

// æ–­è¨€å‡½æ•°
fn assert_eq(expected : Int, actual : Int) -> Unit {
  if expected == actual {
    ()
  } else {
    // ä½¿ç”¨é™¤ä»¥é›¶æ¥è§¦å‘è¿è¡Œæ—¶é”™è¯¯
    let _ = 1 / 0
    ()
  }
}

fn assert_eq_string(expected : String, actual : String) -> Unit {
  if expected == actual {
    ()
  } else {
    // ä½¿ç”¨é™¤ä»¥é›¶æ¥è§¦å‘è¿è¡Œæ—¶é”™è¯¯
    let _ = 1 / 0
    ()
  }
}

test "safe_addition_edge_cases" {
  // æµ‹è¯•å®‰å…¨åŠ æ³•çš„è¾¹ç•Œæƒ…å†µ
  let max_val = 2147483647
  let min_val = -2147483648
  
  // æµ‹è¯•æœ€å¤§å€¼æº¢å‡ºä¿æŠ¤
  assert_eq(max_val, add(max_val, 1))
  assert_eq(max_val, add(max_val, 100))
  
  // æµ‹è¯•æœ€å°å€¼æº¢å‡ºä¿æŠ¤
  assert_eq(min_val, add(min_val, -1))
  assert_eq(min_val, add(min_val, -100))
  
  // æµ‹è¯•æ­£å¸¸åŠ æ³•
  assert_eq(0, add(max_val, min_val))
  assert_eq(100, add(50, 50))
}

test "safe_multiplication_precision" {
  // æµ‹è¯•å®‰å…¨ä¹˜æ³•çš„ç²¾åº¦å’Œæº¢å‡ºå¤„ç†
  let max_val = 2147483647
  let min_val = -2147483648
  
  // æµ‹è¯•ä¹˜æ³•æº¢å‡ºä¿æŠ¤
  assert_eq(max_val, multiply(max_val, 2))
  assert_eq(min_val, multiply(min_val, -1))
  
  // æµ‹è¯•ç‰¹æ®Šå€¼ä¹˜æ³•
  assert_eq(0, multiply(0, max_val))
  assert_eq(max_val, multiply(max_val, 1))
  assert_eq(min_val, multiply(min_val, 1))
  
  // æµ‹è¯•æ­£å¸¸ä¹˜æ³•
  assert_eq(100, multiply(10, 10))
  assert_eq(-100, multiply(-10, 10))
}

test "string_greeting_functionality" {
  // æµ‹è¯•å­—ç¬¦ä¸²é—®å€™åŠŸèƒ½
  // æµ‹è¯•åŸºæœ¬åŠŸèƒ½
  assert_eq_string("Hello, World!", greet("World"))
  
  // æµ‹è¯•ç©ºå­—ç¬¦ä¸²
  assert_eq_string("Hello, !", greet(""))
  
  // æµ‹è¯•åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„å­—ç¬¦ä¸²
  assert_eq_string("Hello, MoonBit@2023!", greet("MoonBit@2023"))
  
  // æµ‹è¯•Unicodeå­—ç¬¦
  assert_eq_string("Hello, æµ‹è¯•!", greet("æµ‹è¯•"))
  assert_eq_string("Hello, ğŸš€!", greet("ğŸš€"))
}

test "mathematical_properties_validation" {
  // æµ‹è¯•æ•°å­¦æ€§è´¨éªŒè¯
  let a = 12
  let b = 8
  let c = 5
  
  // éªŒè¯åŠ æ³•äº¤æ¢å¾‹
  assert_eq(add(a, b), add(b, a))
  
  // éªŒè¯ä¹˜æ³•äº¤æ¢å¾‹
  assert_eq(multiply(a, b), multiply(b, a))
  
  // éªŒè¯åˆ†é…å¾‹
  let distributive1 = multiply(a, add(b, c))
  let distributive2 = add(multiply(a, b), multiply(a, c))
  assert_eq(distributive1, distributive2)
  
  // éªŒè¯ç»“åˆå¾‹
  let associative1 = add(add(a, b), c)
  let associative2 = add(a, add(b, c))
  assert_eq(associative1, associative2)
}

test "financial_calculations_scenario" {
  // æµ‹è¯•é‡‘èè®¡ç®—åœºæ™¯
  let principal = 10000  // æœ¬é‡‘
  let rate = 5          // å¹´åˆ©ç‡ï¼ˆç™¾åˆ†æ¯”ï¼‰
  let years = 3         // å¹´æ•°
  
  // è®¡ç®—ç®€å•åˆ©æ¯
  let interest = multiply(principal, multiply(rate, years))
  let total = add(principal, interest)
  
  // éªŒè¯è®¡ç®—ç»“æœï¼š10000 + 10000Ã—5Ã—3 = 160000
  assert_eq(160000, total)
  
  // æµ‹è¯•è´·æ¬¾è®¡ç®—
  let loan_amount = 50000
  let monthly_payment = 2000
  let months = 24
  
  let total_payment = multiply(monthly_payment, months)
  let total_interest = add(total_payment, -loan_amount)
  
  assert_eq(48000, total_payment)
  assert_eq(-2000, total_interest)
}

test "geometry_calculations_scenario" {
  // æµ‹è¯•å‡ ä½•è®¡ç®—åœºæ™¯
  let length = 10
  let width = 6
  let height = 4
  
  // è®¡ç®—çŸ©å½¢å‘¨é•¿
  let perimeter = multiply(2, add(length, width))
  assert_eq(32, perimeter)
  
  // è®¡ç®—çŸ©å½¢é¢ç§¯
  let area = multiply(length, width)
  assert_eq(60, area)
  
  // è®¡ç®—é•¿æ–¹ä½“ä½“ç§¯
  let volume = multiply(area, height)
  assert_eq(240, volume)
  
  // è®¡ç®—è¡¨é¢ç§¯
  let surface_area = add(
    add(multiply(2, multiply(length, width)), 
        multiply(2, multiply(length, height))),
    multiply(2, multiply(width, height))
  )
  assert_eq(148, surface_area)
}

test "temperature_conversion_scenario" {
  // æµ‹è¯•æ¸©åº¦è½¬æ¢åœºæ™¯ï¼ˆç®€åŒ–ç‰ˆï¼šF = C Ã— 2 + 30ï¼‰
  // æµ‹è¯•å†°ç‚¹
  let freezing_celsius = 0
  let freezing_fahrenheit = add(multiply(freezing_celsius, 2), 30)
  assert_eq(30, freezing_fahrenheit)
  
  // æµ‹è¯•å®¤æ¸©
  let room_celsius = 20
  let room_fahrenheit = add(multiply(room_celsius, 2), 30)
  assert_eq(70, room_fahrenheit)
  
  // æµ‹è¯•æ²¸ç‚¹
  let boiling_celsius = 100
  let boiling_fahrenheit = add(multiply(boiling_celsius, 2), 30)
  assert_eq(230, boiling_fahrenheit)
  
  // æµ‹è¯•åå‘è½¬æ¢ï¼ˆç®€åŒ–ç‰ˆï¼šC = (F - 30) Ã· 2ï¼‰
  let fahrenheit = 80
  let celsius = add(fahrenheit, -30) / 2
  assert_eq(25, celsius)
}

test "shopping_cart_business_scenario" {
  // æµ‹è¯•è´­ç‰©è½¦ä¸šåŠ¡åœºæ™¯
  let item1_price = 299
  let item1_quantity = 2
  let item2_price = 199
  let item2_quantity = 3
  let discount_threshold = 1000
  let discount_rate = 10
  let shipping_fee = 20
  
  // è®¡ç®—å•†å“æ€»ä»·
  let item1_total = multiply(item1_price, item1_quantity)
  let item2_total = multiply(item2_price, item2_quantity)
  let subtotal = add(item1_total, item2_total)
  
  // è®¡ç®—æŠ˜æ‰£
  let discount = if (subtotal > discount_threshold) {
    multiply(subtotal, discount_rate) / 100
  } else {
    0
  }
  
  // è®¡ç®—æœ€ç»ˆæ€»ä»·
  let final_total = add(add(subtotal, -discount), shipping_fee)
  
  // éªŒè¯è®¡ç®—ç»“æœ
  assert_eq(1194, subtotal)
  assert_eq(119, discount)
  assert_eq(1095, final_total)
}

test "time_calculations_scenario" {
  // æµ‹è¯•æ—¶é—´è®¡ç®—åœºæ™¯
  let hours = 2
  let minutes = 45
  
  // è½¬æ¢ä¸ºæ€»åˆ†é’Ÿæ•°
  let total_minutes = add(multiply(hours, 60), minutes)
  assert_eq(165, total_minutes)
  
  // è½¬æ¢ä¸ºæ€»ç§’æ•°
  let total_seconds = multiply(total_minutes, 60)
  assert_eq(9900, total_seconds)
  
  // è®¡ç®—æ—¶é—´å·®
  let start_hour = 8
  let start_minute = 30
  let end_hour = 17
  let end_minute = 45
  
  let start_total = add(multiply(start_hour, 60), start_minute)
  let end_total = add(multiply(end_hour, 60), end_minute)
  let duration = add(end_total, -start_total)
  
  assert_eq(555, duration)  // 9å°æ—¶15åˆ†é’Ÿ = 555åˆ†é’Ÿ
  
  // è®¡ç®—å·¥ä½œæ—¶é•¿ï¼ˆæ‰£é™¤1å°æ—¶åˆé¤æ—¶é—´ï¼‰
  let work_duration = add(duration, -60)
  assert_eq(495, work_duration)  // 8å°æ—¶15åˆ†é’Ÿ = 495åˆ†é’Ÿ
}