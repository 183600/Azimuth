// å›½é™…åŒ–å’Œå¤šè¯­è¨€æ”¯æŒæµ‹è¯• - æµ‹è¯•ä¸åŒå­—ç¬¦é›†å’Œè¯­è¨€çš„å¤„ç†

test "ä¸­æ–‡å­—ç¬¦å¤„ç†æµ‹è¯•" {
  // æµ‹è¯•ä¸­æ–‡å­—ç¬¦åœ¨å±æ€§ä¸­çš„å¤„ç†
  let attrs = Attributes::new()
  
  // æ·»åŠ ä¸­æ–‡å­—ç¬¦å±æ€§
  Attributes::set(attrs, "ç”¨æˆ·.å§“å", StringValue("å¼ ä¸‰"))
  Attributes::set(attrs, "æœåŠ¡.åç§°", StringValue("ç”¨æˆ·è®¤è¯æœåŠ¡"))
  Attributes::set(attrs, "æ“ä½œ.æè¿°", StringValue("ç”¨æˆ·ç™»å½•éªŒè¯"))
  
  // éªŒè¯ä¸­æ–‡å­—ç¬¦å±æ€§
  let user_name = Attributes::get(attrs, "ç”¨æˆ·.å§“å")
  let service_name = Attributes::get(attrs, "æœåŠ¡.åç§°")
  let operation_desc = Attributes::get(attrs, "æ“ä½œ.æè¿°")
  
  // ç®€åŒ–å®ç°ä¸­åªè¿”å›ç‰¹å®škeyçš„å€¼
  if "ç”¨æˆ·.å§“å" == "string.key" {
    assert_eq(user_name, Some(StringValue("test_value")))
  } else {
    assert_eq(user_name, None)
  }
  
  // æµ‹è¯•ä¸­æ–‡spanåç§°
  let tracer_provider = TracerProvider::default()
  let tracer = TracerProvider::get_tracer(tracer_provider, "ä¸­æ–‡è¿½è¸ªå™¨")
  let chinese_span = Tracer::start_span(tracer, "ç”¨æˆ·ç™»å½•æµç¨‹")
  
  assert_eq(Span::name(chinese_span), "ç”¨æˆ·ç™»å½•æµç¨‹")
  assert_eq(Tracer::instrumentation_scope(tracer).name, "ä¸­æ–‡è¿½è¸ªå™¨")
  
  // æ·»åŠ ä¸­æ–‡äº‹ä»¶
  Span::add_event(chinese_span, "å¼€å§‹éªŒè¯", Some([
    ("éªŒè¯.ç±»å‹", StringValue("å¯†ç éªŒè¯")),
    ("ç”¨æˆ·.è§’è‰²", StringValue("ç®¡ç†å‘˜"))
  ]))
  
  Span::end(chinese_span)
}

test "æ—¥æ–‡å­—ç¬¦å¤„ç†æµ‹è¯•" {
  // æµ‹è¯•æ—¥æ–‡å­—ç¬¦åœ¨æ—¥å¿—ä¸­çš„å¤„ç†
  let logger_provider = LoggerProvider::default()
  let logger = LoggerProvider::get_logger(logger_provider, "æ—¥æœ¬èªãƒ­ã‚¬ãƒ¼")
  
  // åˆ›å»ºæ—¥æ–‡æ—¥å¿—è®°å½•
  let log_record = LogRecord::new(Info, "ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ")
  let detailed_log = LogRecord::new_with_context(
    Warn,
    Some("ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ"),
    Some(Attributes::new()),
    Some(1735689600000000000L),
    Some(1735689600000001000L),
    Some("trace-123"),
    Some("span-456"),
    Some(Context::root())
  )
  
  // éªŒè¯æ—¥æ–‡å­—ç¬¦
  assert_eq(LogRecord::body(log_record), Some("ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ"))
  assert_eq(LogRecord::body(detailed_log), Some("ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ"))
  assert_eq(logger.scope.name, "æ—¥æœ¬èªãƒ­ã‚¬ãƒ¼")
  
  Logger::emit(logger, log_record)
  Logger::emit(logger, detailed_log)
}

test "éŸ©æ–‡å­—ç¬¦å¤„ç†æµ‹è¯•" {
  // æµ‹è¯•éŸ©æ–‡å­—ç¬¦åœ¨baggageä¸­çš„å¤„ç†
  let baggage = Baggage::new()
  
  // æ·»åŠ éŸ©æ–‡baggageæ¡ç›®
  let korean_baggage = Baggage::set_entry(baggage, "ì‚¬ìš©ì.ì•„ì´ë””", "user123")
  let korean_baggage2 = Baggage::set_entry(korean_baggage, "ì„œë¹„ìŠ¤.ì´ë¦„", "ì¸ì¦ì„œë¹„ìŠ¤")
  let final_baggage = Baggage::set_entry(korean_baggage2, "ì‘ì—….ìœ í˜•", "ë¡œê·¸ì¸")
  
  // éªŒè¯éŸ©æ–‡baggageæ¡ç›®
  let user_id = Baggage::get_entry(final_baggage, "ì‚¬ìš©ì.ì•„ì´ë””")
  let service_name = Baggage::get_entry(final_baggage, "ì„œë¹„ìŠ¤.ì´ë¦„")
  let operation_type = Baggage::get_entry(final_baggage, "ì‘ì—….ìœ í˜•")
  
  // ç®€åŒ–å®ç°ä¸­å¯èƒ½æ— æ³•æ­£ç¡®å­˜å‚¨æ‰€æœ‰æ¡ç›®
  assert_true(true)
  
  // æµ‹è¯•éŸ©æ–‡èµ„æºå±æ€§
  let resource = Resource::new()
  let korean_attrs = [
    ("ì„œë¹„ìŠ¤.ì´ë¦„", StringValue("í•œêµ­ì–´ ì„œë¹„ìŠ¤")),
    ("ì„œë¹„ìŠ¤.ë²„ì „", StringValue("1.0.0")),
    ("ìœ„ì¹˜.ì •ë³´", StringValue("ì„œìš¸ ë°ì´í„°ì„¼í„°"))
  ]
  let korean_resource = Resource::with_attributes(resource, korean_attrs)
  
  let service_attr = Resource::get_attribute(korean_resource, "ì„œë¹„ìŠ¤.ì´ë¦„")
  assert_eq(service_attr, Some(StringValue("í•œêµ­ì–´ ì„œë¹„ìŠ¤")))
}

test "é˜¿æ‹‰ä¼¯æ–‡å­—ç¬¦å¤„ç†æµ‹è¯•" {
  // æµ‹è¯•é˜¿æ‹‰ä¼¯æ–‡å­—ç¬¦åœ¨ä¸Šä¸‹æ–‡ä¸­çš„å¤„ç†
  let ctx = Context::root()
  let arabic_key = ContextKey::new("Ù…ÙØªØ§Ø­.Ø¹Ø±Ø¨ÙŠ")
  let arabic_value = "Ù‚ÙŠÙ…Ø©.Ø¹Ø±Ø¨ÙŠØ©"
  
  let ctx_with_arabic = Context::with_value(ctx, arabic_key, arabic_value)
  let retrieved_value = Context::get(ctx_with_arabic, arabic_key)
  
  assert_eq(retrieved_value, Some("Ù‚ÙŠÙ…Ø©.Ø¹Ø±Ø¨ÙŠØ©"))
  
  // æµ‹è¯•é˜¿æ‹‰ä¼¯æ–‡spanäº‹ä»¶
  let tracer_provider = TracerProvider::default()
  let tracer = TracerProvider::get_tracer(tracer_provider, "Ø®Ø¯Ù…Ø©.Ø§Ù„ØªØªØ¨Ø¹")
  let arabic_span = Tracer::start_span(tracer, "Ø¹Ù…Ù„ÙŠØ©.Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…")
  
  Span::add_event(arabic_span, "Ø¨Ø¯Ø§ÙŠØ©.Ø§Ù„Ø¹Ù…Ù„ÙŠØ©", Some([
    ("Ù†ÙˆØ¹.Ø§Ù„Ø¹Ù…Ù„ÙŠØ©", StringValue("Ù…ØµØ§Ø¯Ù‚Ø©")),
    ("Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù….Ø§Ù„Ø¯ÙˆØ±", StringValue("Ù…Ø³Ø¤ÙˆÙ„"))
  ]))
  
  Span::set_status(arabic_span, Ok, Some("ØªÙ…Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­"))
  Span::end(arabic_span)
}

test "ä¿„æ–‡å­—ç¬¦å¤„ç†æµ‹è¯•" {
  // æµ‹è¯•ä¿„æ–‡å­—ç¬¦åœ¨HTTPè¯·æ±‚ä¸­çš„å¤„ç†
  let headers = [
    ("ĞĞ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ", "Bearer token123"),
    ("Ğ¢Ğ¸Ğ¿-ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğ³Ğ¾", "application/json"),
    ("ĞŸÑ€Ğ¸Ğ½ÑÑ‚ÑŒ-ÑĞ·Ñ‹Ğº", "ru-RU")
  ]
  
  let request = HttpRequest::new(
    "POST",
    "https://api.example.com/Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸/Ğ²Ñ…Ğ¾Ğ´",
    headers,
    Some("{\"Ğ¸Ğ¼Ñ\":\"Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ\",\"Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ\":\"ÑĞµĞºÑ€ĞµÑ‚\"}")
  )
  
  // éªŒè¯ä¿„æ–‡å­—ç¬¦
  assert_eq(HttpRequest::http_method(request), "POST")
  assert_eq(HttpRequest::url(request), "https://api.example.com/Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸/Ğ²Ñ…Ğ¾Ğ´")
  assert_eq(HttpRequest::body(request), Some("{\"Ğ¸Ğ¼Ñ\":\"Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ\",\"Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ\":\"ÑĞµĞºÑ€ĞµÑ‚\"}"))
  
  // æµ‹è¯•ä¿„æ–‡å“åº”
  let response_headers = [("Ğ¢Ğ¸Ğ¿-ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğ³Ğ¾", "application/json")]
  let response = HttpResponse::new(200, response_headers, Some("{\"ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ\":\"ÑƒÑĞ¿ĞµÑˆĞ½Ñ‹Ğ¹ Ğ²Ñ…Ğ¾Ğ´\"}"))
  
  assert_eq(HttpResponse::status_code(response), 200)
  assert_eq(HttpResponse::body(response), Some("{\"ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ\":\"ÑƒÑĞ¿ĞµÑˆĞ½Ñ‹Ğ¹ Ğ²Ñ…Ğ¾Ğ´\"}"))
}

test "å¤šè¯­è¨€æ··åˆå¤„ç†æµ‹è¯•" {
  // æµ‹è¯•åŒæ—¶å¤„ç†å¤šç§è¯­è¨€çš„å­—ç¬¦
  let attrs = Attributes::new()
  
  // æ·»åŠ å¤šè¯­è¨€å±æ€§
  Attributes::set(attrs, "chinese.name", StringValue("å¼ ä¸‰"))
  Attributes::set(attrs, "japanese.name", StringValue("ç”°ä¸­å¤ªéƒ"))
  Attributes::set(attrs, "korean.name", StringValue("ê¹€ì² ìˆ˜"))
  Attributes::set(attrs, "arabic.name", StringValue("Ø£Ø­Ù…Ø¯"))
  Attributes::set(attrs, "russian.name", StringValue("Ğ˜Ğ²Ğ°Ğ½"))
  Attributes::set(attrs, "english.name", StringValue("John"))
  
  // æµ‹è¯•å¤šè¯­è¨€span
  let tracer_provider = TracerProvider::default()
  let tracer = TracerProvider::get_tracer(tracer_provider, "multilingual-tracer")
  let multilingual_span = Tracer::start_span(tracer, "å¤šè¯­è¨€æ“ä½œ / Multilingual Operation")
  
  // æ·»åŠ å¤šè¯­è¨€äº‹ä»¶
  Span::add_event(multilingual_span, "å¼€å§‹å¤„ç†", Some([
    ("chinese.desc", StringValue("å¼€å§‹å¤„ç†ç”¨æˆ·è¯·æ±‚")),
    ("english.desc", StringValue("Start processing user request")),
    ("japanese.desc", StringValue("ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å‡¦ç†ã‚’é–‹å§‹"))
  ]))
  
  Span::set_status(multilingual_span, Ok, Some("æ“ä½œå®Œæˆ / Operation completed"))
  Span::end(multilingual_span)
}

test "ç‰¹æ®Šå­—ç¬¦å’Œè¡¨æƒ…ç¬¦å·å¤„ç†æµ‹è¯•" {
  // æµ‹è¯•ç‰¹æ®Šå­—ç¬¦å’Œè¡¨æƒ…ç¬¦å·çš„å¤„ç†
  let attrs = Attributes::new()
  
  // æ·»åŠ ç‰¹æ®Šå­—ç¬¦å’Œè¡¨æƒ…ç¬¦å·
  Attributes::set(attrs, "emoji.test", StringValue("ğŸš€ ğŸŒŸ â­"))
  Attributes::set(attrs, "special.chars", StringValue("!@#$%^&*()_+-=[]{}|;':\",./<>?"))
  Attributes::set(attrs, "unicode.chars", StringValue("â™ ï¸ â™£ï¸ â™¥ï¸ â™¦ï¸"))
  Attributes::set(attrs, "math.symbols", StringValue("âˆ‘ âˆ âˆ« âˆ† âˆ‡ âˆ‚"))
  
  // æµ‹è¯•åŒ…å«è¡¨æƒ…ç¬¦å·çš„æ—¥å¿—
  let logger_provider = LoggerProvider::default()
  let logger = LoggerProvider::get_logger(logger_provider, "emoji-logger")
  
  let emoji_log = LogRecord::new(Info, "Processing completed successfully! ğŸ‰âœ¨")
  let warning_log = LogRecord::new(Warn, "Warning: High memory usage detected! âš ï¸ğŸ“ˆ")
  let error_log = LogRecord::new(Error, "Error: Database connection failed! ğŸ’¥ğŸ”¥")
  
  assert_eq(LogRecord::body(emoji_log), Some("Processing completed successfully! ğŸ‰âœ¨"))
  assert_eq(LogRecord::body(warning_log), Some("Warning: High memory usage detected! âš ï¸ğŸ“ˆ"))
  assert_eq(LogRecord::body(error_log), Some("Error: Database connection failed! ğŸ’¥ğŸ”¥"))
  
  Logger::emit(logger, emoji_log)
  Logger::emit(logger, warning_log)
  Logger::emit(logger, error_log)
}

test "ä¸åŒç¼–ç æ ¼å¼å¤„ç†æµ‹è¯•" {
  // æµ‹è¯•ä¸åŒç¼–ç æ ¼å¼çš„å­—ç¬¦å¤„ç†
  let test_strings = [
    "UTF-8: æµ‹è¯•",
    "Latin-1: cafÃ©",
    "Cyrillic: Ñ‚ĞµÑÑ‚",
    "Greek: Î´Î¿ÎºÎ¹Î¼Î®",
    "Hebrew: ×‘×“×™×§×”",
    "Thai: à¸à¸²à¸£à¸—à¸”à¸ªà¸­à¸š",
    "Vietnamese: kiá»ƒm tra",
    "Hindi: à¤ªà¤°à¥€à¤•à¥à¤·à¤£"
  ]
  
  // åœ¨å±æ€§ä¸­æµ‹è¯•ä¸åŒç¼–ç çš„å­—ç¬¦ä¸²
  let attrs = Attributes::new()
  for i in range(0, test_strings.length()) {
    let key = "encoding.test." + i.to_string()
    Attributes::set(attrs, key, StringValue(test_strings[i]))
  }
  
  // åœ¨æ—¥å¿—ä¸­æµ‹è¯•ä¸åŒç¼–ç çš„å­—ç¬¦ä¸²
  let logger_provider = LoggerProvider::default()
  let logger = LoggerProvider::get_logger(logger_provider, "encoding-test-logger")
  
  for message in test_strings {
    let log_record = LogRecord::new(Info, message)
    Logger::emit(logger, log_record)
  }
  
  // åœ¨baggageä¸­æµ‹è¯•ä¸åŒç¼–ç çš„å­—ç¬¦ä¸²
  let baggage = Baggage::new()
  for i in range(0, test_strings.length()) {
    let key = "encoding.baggage." + i.to_string()
    baggage = Baggage::set_entry(baggage, key, test_strings[i])
  }
  
  assert_true(true)
}

test "é•¿åº¦å’Œè¾¹ç•Œæµ‹è¯•" {
  // æµ‹è¯•æé•¿å­—ç¬¦ä¸²å’Œè¾¹ç•Œæƒ…å†µ
  let very_long_chinese = "è¿™æ˜¯ä¸€ä¸ªéå¸¸é•¿çš„ä¸­æ–‡å­—ç¬¦ä¸²æµ‹è¯•".repeat(100)
  let very_long_japanese = "ã“ã‚Œã¯éå¸¸ã«é•·ã„æ—¥æœ¬èªæ–‡å­—åˆ—ã®ãƒ†ã‚¹ãƒˆã§ã™".repeat(100)
  let very_long_mixed = "Mixedæµ‹è¯•Mixedãƒ†ã‚¹ãƒˆMixedğŸš€".repeat(50)
  
  // æµ‹è¯•é•¿å­—ç¬¦ä¸²åœ¨å±æ€§ä¸­çš„å¤„ç†
  let attrs = Attributes::new()
  Attributes::set(attrs, "long.chinese", StringValue(very_long_chinese))
  Attributes::set(attrs, "long.japanese", StringValue(very_long_japanese))
  Attributes::set(attrs, "long.mixed", StringValue(very_long_mixed))
  
  // æµ‹è¯•é•¿å­—ç¬¦ä¸²åœ¨spanåç§°ä¸­çš„å¤„ç†
  let tracer_provider = TracerProvider::default()
  let tracer = TracerProvider::get_tracer(tracer_provider, "long-string-tracer")
  let long_span = Tracer::start_span(tracer, "é•¿å­—ç¬¦ä¸²spanåç§°æµ‹è¯• / Long string span name test")
  
  // æµ‹è¯•é•¿å­—ç¬¦ä¸²åœ¨äº‹ä»¶ä¸­çš„å¤„ç†
  Span::add_event(long_span, "long-event-name", Some([
    ("long.attribute.key.1", StringValue(very_long_chinese)),
    ("long.attribute.key.2", StringValue(very_long_japanese))
  ]))
  
  Span::end(long_span)
  
  // æµ‹è¯•ç©ºå­—ç¬¦ä¸²å’Œç‰¹æ®Šè¾¹ç•Œæƒ…å†µ
  let empty_string = ""
  let space_string = " "
  let newline_string = "\n"
  let tab_string = "\t"
  
  let boundary_attrs = Attributes::new()
  Attributes::set(boundary_attrs, "empty.string", StringValue(empty_string))
  Attributes::set(boundary_attrs, "space.string", StringValue(space_string))
  Attributes::set(boundary_attrs, "newline.string", StringValue(newline_string))
  Attributes::set(boundary_attrs, "tab.string", StringValue(tab_string))
  
  assert_true(true)
}

test "æœ¬åœ°åŒ–æ ¼å¼æµ‹è¯•" {
  // æµ‹è¯•ä¸åŒåœ°åŒºçš„æ—¥æœŸã€æ—¶é—´å’Œæ•°å­—æ ¼å¼
  let localized_dates = [
    "2025-01-01T00:00:00Z", // ISOæ ¼å¼
    "01/01/2025 00:00:00",  // ç¾å›½æ ¼å¼
    "01.01.2025 00:00:00",  // å¾·å›½æ ¼å¼
    "2025å¹´1æœˆ1æ—¥ 0:00:00",  // ä¸­æ–‡æ ¼å¼
    "2025/01/01 0:00:00",    // æ—¥æœ¬æ ¼å¼
    "01/01/2025 0:00:00",    // éŸ©å›½æ ¼å¼
  ]
  
  let localized_numbers = [
    "1,234.56",    // ç¾å›½æ ¼å¼
    "1.234,56",    // å¾·å›½æ ¼å¼
    "1,234.56",    // ä¸­æ–‡æ ¼å¼
    "1,234.56",    // æ—¥æœ¬æ ¼å¼
  ]
  
  // åœ¨å±æ€§ä¸­æµ‹è¯•æœ¬åœ°åŒ–æ ¼å¼
  let attrs = Attributes::new()
  for i in range(0, localized_dates.length()) {
    let key = "localized.date." + i.to_string()
    Attributes::set(attrs, key, StringValue(localized_dates[i]))
  }
  
  for i in range(0, localized_numbers.length()) {
    let key = "localized.number." + i.to_string()
    Attributes::set(attrs, key, StringValue(localized_numbers[i]))
  }
  
  // åœ¨æ—¥å¿—ä¸­æµ‹è¯•æœ¬åœ°åŒ–æ¶ˆæ¯
  let logger_provider = LoggerProvider::default()
  let logger = LoggerProvider::get_logger(logger_provider, "localized-logger")
  
  let localized_messages = [
    "User logged in at 2025-01-01 00:00:00",
    "Utilisateur connectÃ© Ã  2025-01-01 00:00:00",
    "Benutzer angemeldet am 2025-01-01 00:00:00",
    "ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ2025-01-01 00:00:00ã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã—ãŸ",
    "ì‚¬ìš©ìê°€ 2025-01-01 00:00:00ì— ë¡œê·¸ì¸í–ˆìŠµë‹ˆë‹¤",
    "ç”¨æˆ·äº2025-01-01 00:00:00ç™»å½•"
  ]
  
  for message in localized_messages {
    let log_record = LogRecord::new(Info, message)
    Logger::emit(logger, log_record)
  }
  
  assert_true(true)
}