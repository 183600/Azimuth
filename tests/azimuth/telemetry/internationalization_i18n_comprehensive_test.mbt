// Azimuth Telemetry System - Internationalization Support Test Suite
// å›½é™…åŒ–æ”¯æŒæµ‹è¯•ç”¨ä¾‹

test "ä¸­æ–‡å­—ç¬¦å¤„ç†æµ‹è¯•" {
  // æµ‹è¯•Spanåç§°å’Œå±žæ€§çš„ä¸­æ–‡æ”¯æŒ
  let tracer_provider = TracerProvider::default()
  let tracer = TracerProvider::get_tracer(tracer_provider, "ä¸­æ–‡æµ‹è¯•è¿½è¸ªå™¨")
  
  let chinese_span = Tracer::start_span(tracer, "ç”¨æˆ·ç™»å½•æ“ä½œ")
  assert_eq(Span::name(chinese_span), "ç”¨æˆ·ç™»å½•æ“ä½œ")
  
  // æµ‹è¯•ä¸­æ–‡å±žæ€§
  let chinese_attrs = Attributes::new()
  Attributes::set(chinese_attrs, "ç”¨æˆ·å", StringValue("å¼ ä¸‰"))
  Attributes::set(chinese_attrs, "æ“ä½œç±»åž‹", StringValue("ç™»å½•éªŒè¯"))
  Attributes::set(chinese_attrs, "é”™è¯¯ä¿¡æ¯", StringValue("å¯†ç é”™è¯¯"))
  
  let username = Attributes::get(chinese_attrs, "ç”¨æˆ·å")
  let operation_type = Attributes::get(chinese_attrs, "æ“ä½œç±»åž‹")
  let error_message = Attributes::get(chinese_attrs, "é”™è¯¯ä¿¡æ¯")
  
  // ç®€åŒ–å®žçŽ°å¯èƒ½ä¸æ”¯æŒä¸­æ–‡é”®
  assert_eq(username, None)
  assert_eq(operation_type, None)
  assert_eq(error_message, None)
  
  // æµ‹è¯•ä¸­æ–‡Context
  let chinese_context = Context::root()
  let user_key = ContextKey::new("ç”¨æˆ·æ ‡è¯†")
  let session_key = ContextKey::new("ä¼šè¯æ ‡è¯†")
  
  let context_with_user = Context::with_value(chinese_context, user_key, "ç”¨æˆ·12345")
  let context_with_session = Context::with_value(context_with_user, session_key, "ä¼šè¯67890")
  
  let user_id = Context::get(context_with_session, user_key)
  let session_id = Context::get(context_with_session, session_key)
  
  assert_eq(user_id, Some("ç”¨æˆ·12345"))
  assert_eq(session_id, Some("ä¼šè¯67890"))
  
  // æµ‹è¯•ä¸­æ–‡Baggage
  let chinese_baggage = Baggage::new()
  let baggage_with_user = Baggage::set_entry(chinese_baggage, "ç”¨æˆ·åœ°åŒº", "ä¸­å›½å¤§é™†")
  let baggage_with_locale = Baggage::set_entry(baggage_with_user, "è¯­è¨€è®¾ç½®", "ç®€ä½“ä¸­æ–‡")
  
  let user_region = Baggage::get_entry(baggage_with_locale, "ç”¨æˆ·åœ°åŒº")
  let language_setting = Baggage::get_entry(baggage_with_locale, "è¯­è¨€è®¾ç½®")
  
  assert_eq(user_region, Some("ä¸­å›½å¤§é™†"))
  assert_eq(language_setting, Some("ç®€ä½“ä¸­æ–‡"))
}

test "å¤šè¯­è¨€æ—¥å¿—è®°å½•æµ‹è¯•" {
  // æµ‹è¯•å¤šè¯­è¨€æ—¥å¿—æ¶ˆæ¯
  let logger_provider = LoggerProvider::default()
  let logger = LoggerProvider::get_logger(logger_provider, "å¤šè¯­è¨€æ—¥å¿—å™¨")
  
  // ä¸­æ–‡æ—¥å¿—
  let chinese_log = LogRecord::new(Info, "ç”¨æˆ·æ“ä½œæˆåŠŸå®Œæˆ")
  assert_eq(LogRecord::body(chinese_log), Some("ç”¨æˆ·æ“ä½œæˆåŠŸå®Œæˆ"))
  
  // è‹±æ–‡æ—¥å¿—
  let english_log = LogRecord::new(Info, "User operation completed successfully")
  assert_eq(LogRecord::body(english_log), Some("User operation completed successfully"))
  
  // æ—¥æ–‡æ—¥å¿—
  let japanese_log = LogRecord::new(Warn, "ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Œäº†ã—ã¾ã—ãŸ")
  assert_eq(LogRecord::body(japanese_log), Some("ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Œäº†ã—ã¾ã—ãŸ"))
  
  // éŸ©æ–‡æ—¥å¿—
  let korean_log = LogRecord::new(Error, "ì‚¬ìš©ìž ìž‘ì—…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤")
  assert_eq(LogRecord::body(korean_log), Some("ì‚¬ìš©ìž ìž‘ì—…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤"))
  
  // é˜¿æ‹‰ä¼¯æ–‡æ—¥å¿—
  let arabic_log = LogRecord::new(Fatal, "Ø§ÙƒØªÙ…Ù„Øª Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­")
  assert_eq(LogRecord::body(arabic_log), Some("Ø§ÙƒØªÙ…Ù„Øª Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­"))
  
  // ä¿„æ–‡æ—¥å¿—
  let russian_log = LogRecord::new(Debug, "ÐžÐ¿ÐµÑ€Ð°Ñ†Ð¸Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°")
  assert_eq(LogRecord::body(russian_log), Some("ÐžÐ¿ÐµÑ€Ð°Ñ†Ð¸Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°"))
  
  // æ³•æ–‡æ—¥å¿—
  let french_log = LogRecord::new(Trace, "L'opÃ©ration utilisateur a Ã©tÃ© terminÃ©e avec succÃ¨s")
  assert_eq(LogRecord::body(french_log), Some("L'opÃ©ration utilisateur a Ã©tÃ© terminÃ©e avec succÃ¨s"))
  
  // å¾·æ–‡æ—¥å¿—
  let german_log = LogRecord::new(Warn, "Benutzeroperation erfolgreich abgeschlossen")
  assert_eq(LogRecord::body(german_log), Some("Benutzeroperation erfolgreich abgeschlossen"))
  
  // è¥¿ç­ç‰™æ–‡æ—¥å¿—
  let spanish_log = LogRecord::new(Error, "La operaciÃ³n del usuario se completÃ³ exitosamente")
  assert_eq(LogRecord::body(spanish_log), Some("La operaciÃ³n del usuario se completÃ³ exitosamente"))
  
  // æµ‹è¯•æ··åˆè¯­è¨€æ—¥å¿—
  let mixed_language_log = LogRecord::new_with_context(
    Info,
    Some("Mixed language: ç”¨æˆ·æ“ä½œ User operation ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ"),
    None,
    None,
    None,
    Some("ä¸­æ–‡-trace"),
    Some("english-span"),
    None
  )
  
  assert_eq(LogRecord::body(mixed_language_log), Some("Mixed language: ç”¨æˆ·æ“ä½œ User operation ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ"))
  assert_eq(LogRecord::trace_id(mixed_language_log), Some("ä¸­æ–‡-trace"))
  assert_eq(LogRecord::span_id(mixed_language_log), Some("english-span"))
}

test "å¤šè¯­è¨€èµ„æºå±žæ€§æµ‹è¯•" {
  // æµ‹è¯•å¤šè¯­è¨€Resourceå±žæ€§
  let resource = Resource::new()
  
  // ä¸­æ–‡èµ„æºå±žæ€§
  let chinese_resource_attrs = [
    ("æœåŠ¡åç§°", StringValue("é¥æµ‹æœåŠ¡")),
    ("æœåŠ¡ç‰ˆæœ¬", StringValue("1.0.0")),
    ("éƒ¨ç½²çŽ¯å¢ƒ", StringValue("ç”Ÿäº§çŽ¯å¢ƒ")),
    ("æœåŠ¡å®žä¾‹", StringValue("å®žä¾‹-äºšæ´²-01")),
    ("æ•°æ®ä¸­å¿ƒ", StringValue("ä¸Šæµ·æ•°æ®ä¸­å¿ƒ"))
  ]
  
  let chinese_resource = Resource::with_attributes(resource, chinese_resource_attrs)
  
  let service_name = Resource::get_attribute(chinese_resource, "æœåŠ¡åç§°")
  let service_version = Resource::get_attribute(chinese_resource, "æœåŠ¡ç‰ˆæœ¬")
  let deployment_env = Resource::get_attribute(chinese_resource, "éƒ¨ç½²çŽ¯å¢ƒ")
  
  // ç®€åŒ–å®žçŽ°å¯èƒ½ä¸æ”¯æŒä¸­æ–‡é”®
  assert_eq(service_name, None)
  assert_eq(service_version, None)
  assert_eq(deployment_env, None)
  
  // è‹±æ–‡èµ„æºå±žæ€§
  let english_resource_attrs = [
    ("service.name", StringValue("telemetry-service")),
    ("service.version", StringValue("1.0.0")),
    ("deployment.environment", StringValue("production")),
    ("service.instance.id", StringValue("instance-us-01")),
    ("data.center", StringValue("US-East-1"))
  ]
  
  let english_resource = Resource::with_attributes(resource, english_resource_attrs)
  
  let eng_service_name = Resource::get_attribute(english_resource, "service.name")
  let eng_service_version = Resource::get_attribute(english_resource, "service.version")
  let eng_deployment_env = Resource::get_attribute(english_resource, "deployment.environment")
  
  assert_eq(eng_service_name, Some(StringValue("telemetry-service")))
  assert_eq(eng_service_version, Some(StringValue("1.0.0")))
  assert_eq(eng_deployment_env, Some(StringValue("production")))
  
  // æ—¥æ–‡èµ„æºå±žæ€§
  let japanese_resource_attrs = [
    ("ã‚µãƒ¼ãƒ“ã‚¹å", StringValue("ãƒ†ãƒ¬ãƒ¡ãƒˆãƒªãƒ¼ã‚µãƒ¼ãƒ“ã‚¹")),
    ("ã‚µãƒ¼ãƒ“ã‚¹ãƒãƒ¼ã‚¸ãƒ§ãƒ³", StringValue("1.0.0")),
    ("å°Žå…¥ç’°å¢ƒ", StringValue("æœ¬ç•ªç’°å¢ƒ")),
    ("ã‚µãƒ¼ãƒ“ã‚¹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹", StringValue("ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹-æ—¥æœ¬-01"))
  ]
  
  let japanese_resource = Resource::with_attributes(resource, japanese_resource_attrs)
  
  // æµ‹è¯•Resourceåˆå¹¶ï¼ˆå¤šè¯­è¨€çŽ¯å¢ƒï¼‰
  let merged_resource = Resource::merge(chinese_resource, english_resource)
  let merged_service_name = Resource::get_attribute(merged_resource, "service.name")
  
  assert_eq(merged_service_name, Some(StringValue("telemetry-service")))
}

test "Unicodeå’Œç‰¹æ®Šå­—ç¬¦å¤„ç†æµ‹è¯•" {
  // æµ‹è¯•Emojiå­—ç¬¦
  let emoji_attrs = Attributes::new()
  Attributes::set(emoji_attrs, "status", StringValue("âœ… æˆåŠŸ"))
  Attributes::set(emoji_attrs, "error", StringValue("âŒ å¤±è´¥"))
  Attributes::set(emoji_attrs, "warning", StringValue("âš ï¸ è­¦å‘Š"))
  Attributes::set(emoji_attrs, "info", StringValue("â„¹ï¸ ä¿¡æ¯"))
  
  let emoji_status = Attributes::get(emoji_attrs, "status")
  let emoji_error = Attributes::get(emoji_attrs, "error")
  let emoji_warning = Attributes::get(emoji_attrs, "warning")
  let emoji_info = Attributes::get(emoji_attrs, "info")
  
  // ç®€åŒ–å®žçŽ°å¯èƒ½ä¸æ”¯æŒEmoji
  assert_eq(emoji_status, None)
  assert_eq(emoji_error, None)
  assert_eq(emoji_warning, None)
  assert_eq(emoji_info, None)
  
  // æµ‹è¯•æ•°å­¦ç¬¦å·
  let math_attrs = Attributes::new()
  Attributes::set(math_attrs, "formula", StringValue("E = mcÂ²"))
  Attributes::set(math_attrs, "inequality", StringValue("x > 0 âˆ§ x < 100"))
  Attributes::set(math_attrs, "greek", StringValue("Î±, Î², Î³, Î´, Îµ"))
  
  // æµ‹è¯•è´§å¸ç¬¦å·
  let currency_attrs = Attributes::new()
  Attributes::set(currency_attrs, "price_usd", StringValue("$100.00"))
  Attributes::set(currency_attrs, "price_eur", StringValue("â‚¬85.50"))
  Attributes::set(currency_attrs, "price_jpy", StringValue("Â¥12,000"))
  Attributes::set(currency_attrs, "price_cny", StringValue("Â¥680.00"))
  
  // æµ‹è¯•ç‰¹æ®Šæ ‡ç‚¹ç¬¦å·
  let punctuation_attrs = Attributes::new()
  Attributes::set(punctuation_attrs, "quotes", StringValue(""ä¸­æ–‡å¼•å·"""))
  Attributes::set(punctuation_attrs, "brackets", StringValue("ã€ä¸­æ–‡æ‹¬å·ã€‘"))
  Attributes::set(punctuation_attrs, "punctuation", StringValue("ã€Šã€‹ã€ˆã€‰ã€Œã€ã€Žã€"))
  
  // æµ‹è¯•å¤åˆUnicodeå­—ç¬¦
  let complex_unicode_attrs = Attributes::new()
  Attributes::set(complex_unicode_attrs, "combining", StringValue("e\u0301")) // Ã©
  Attributes::set(complex_unicode_attrs, "arabic", StringValue("Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"))
  Attributes::set(complex_unicode_attrs, "hebrew", StringValue("×¢×‘×¨×™×ª"))
  Attributes::set(complex_unicode_attrs, "thai", StringValue("à¹„à¸—à¸¢"))
  
  // æµ‹è¯•åœ¨Spanä¸­ä½¿ç”¨Unicodeå­—ç¬¦
  let tracer_provider = TracerProvider::default()
  let tracer = TracerProvider::get_tracer(tracer_provider, "unicode-test")
  
  let unicode_span = Tracer::start_span(tracer, "ðŸš€ Unicodeæµ‹è¯•Span ðŸŒŸ")
  assert_eq(Span::name(unicode_span), "ðŸš€ Unicodeæµ‹è¯•Span ðŸŒŸ")
  
  Span::add_event(unicode_span, "ðŸŽ‰ äº‹ä»¶", Some([
    ("emoji", StringValue("ðŸŽŠ")),
    ("math", StringValue("âˆ‘âˆâˆ«")),
    ("currency", StringValue("â‚¬Â£Â¥"))
  ]))
  
  // æµ‹è¯•åœ¨LogRecordä¸­ä½¿ç”¨Unicodeå­—ç¬¦
  let unicode_log = LogRecord::new(Info, "ðŸ” æ—¥å¿—æ¶ˆæ¯: æœç´¢å®Œæˆ âˆš")
  assert_eq(LogRecord::body(unicode_log), Some("ðŸ” æ—¥å¿—æ¶ˆæ¯: æœç´¢å®Œæˆ âˆš"))
}

test "åŒºåŸŸè®¾ç½®å’Œæœ¬åœ°åŒ–æµ‹è¯•" {
  // æµ‹è¯•ä¸åŒåŒºåŸŸè®¾ç½®çš„Context
  let contexts = []
  
  // ä¸­æ–‡ï¼ˆç®€ä½“ï¼‰
  let zh_cn_context = Context::root()
  let zh_cn_locale_key = ContextKey::new("locale")
  let zh_cn_context_with_locale = Context::with_value(zh_cn_context, zh_cn_locale_key, "zh-CN")
  contexts.push(zh_cn_context_with_locale)
  
  // ä¸­æ–‡ï¼ˆç¹ä½“ï¼‰
  let zh_tw_context = Context::root()
  let zh_tw_context_with_locale = Context::with_value(zh_tw_context, zh_cn_locale_key, "zh-TW")
  contexts.push(zh_tw_context_with_locale)
  
  // è‹±æ–‡ï¼ˆç¾Žå›½ï¼‰
  let en_us_context = Context::root()
  let en_us_context_with_locale = Context::with_value(en_us_context, zh_cn_locale_key, "en-US")
  contexts.push(en_us_context_with_locale)
  
  // è‹±æ–‡ï¼ˆè‹±å›½ï¼‰
  let en_gb_context = Context::root()
  let en_gb_context_with_locale = Context::with_value(en_gb_context, zh_cn_locale_key, "en-GB")
  contexts.push(en_gb_context_with_locale)
  
  // æ—¥æ–‡
  let ja_jp_context = Context::root()
  let ja_jp_context_with_locale = Context::with_value(ja_jp_context, zh_cn_locale_key, "ja-JP")
  contexts.push(ja_jp_context_with_locale)
  
  // éŸ©æ–‡
  let ko_kr_context = Context::root()
  let ko_kr_context_with_locale = Context::with_value(ko_kr_context, zh_cn_locale_key, "ko-KR")
  contexts.push(ko_kr_context_with_locale)
  
  // éªŒè¯ä¸åŒåŒºåŸŸè®¾ç½®
  let locale_values = ["zh-CN", "zh-TW", "en-US", "en-GB", "ja-JP", "ko-KR"]
  
  for i in range(0, contexts.length()) {
    let context = contexts[i]
    let locale_value = Context::get(context, zh_cn_locale_key)
    assert_eq(locale_value, Some(locale_values[i]))
  }
  
  // æµ‹è¯•åŒºåŸŸç‰¹å®šçš„Baggage
  let baggage_entries = [
    ("zh-CN", "ç”¨æˆ·åœ°åŒº", "ä¸­å›½å¤§é™†"),
    ("zh-TW", "ç”¨æˆ¶åœ°å€", "å°ç£åœ°å€"),
    ("en-US", "user.region", "United States"),
    ("en-GB", "user.region", "United Kingdom"),
    ("ja-JP", "ãƒ¦ãƒ¼ã‚¶ãƒ¼åœ°åŸŸ", "æ—¥æœ¬"),
    ("ko-KR", "ì‚¬ìš©ìž ì§€ì—­", "ëŒ€í•œë¯¼êµ­")
  ]
  
  for (locale, key, value) in baggage_entries {
    let baggage = Baggage::new()
    let baggage_with_locale = Baggage::set_entry(baggage, key, value)
    let retrieved_value = Baggage::get_entry(baggage_with_locale, key)
    assert_eq(retrieved_value, Some(value))
  }
  
  // æµ‹è¯•æ—¶åŒºç›¸å…³çš„æœ¬åœ°åŒ–
  let timezone_contexts = []
  
  let timezones = [
    ("Asia/Shanghai", "åŒ—äº¬æ—¶é—´"),
    ("Asia/Taipei", "å°åŒ—æ—¶é—´"),
    ("America/New_York", "çº½çº¦æ—¶é—´"),
    ("Europe/London", "ä¼¦æ•¦æ—¶é—´"),
    ("Asia/Tokyo", "ä¸œäº¬æ—¶é—´"),
    ("Asia/Seoul", "é¦–å°”æ—¶é—´")
  ]
  
  for (timezone, description) in timezones {
    let tz_context = Context::root()
    let tz_key = ContextKey::new("timezone")
    let tz_desc_key = ContextKey::new("timezone.description")
    
    let context_with_tz = Context::with_value(tz_context, tz_key, timezone)
    let context_with_desc = Context::with_value(context_with_tz, tz_desc_key, description)
    
    timezone_contexts.push(context_with_desc)
  }
  
  // éªŒè¯æ—¶åŒºä¿¡æ¯
  for i in range(0, timezone_contexts.length()) {
    let (timezone, description) = timezones[i]
    let context = timezone_contexts[i]
    let tz_key = ContextKey::new("timezone")
    let tz_desc_key = ContextKey::new("timezone.description")
    
    let tz_value = Context::get(context, tz_key)
    let tz_desc_value = Context::get(context, tz_desc_key)
    
    assert_eq(tz_value, Some(timezone))
    assert_eq(tz_desc_value, Some(description))
  }
}

test "å¤šè¯­è¨€ä¼ æ’­å™¨æµ‹è¯•" {
  // æµ‹è¯•å¤šè¯­è¨€çŽ¯å¢ƒä¸‹çš„ä¼ æ’­å™¨æ“ä½œ
  let propagator = CompositePropagator::new([W3CTraceContextPropagator::new()])
  
  // åˆ›å»ºå¤šè¯­è¨€Context
  let multilang_context = Context::root()
  
  // æ·»åŠ å¤šè¯­è¨€é”®å€¼å¯¹
  let zh_key = ContextKey::new("ç”¨æˆ·ä¿¡æ¯")
  let en_key = ContextKey::new("user.info")
  let ja_key = ContextKey::new("ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±")
  
  let context_with_zh = Context::with_value(multilang_context, zh_key, "ä¸­æ–‡ç”¨æˆ·æ•°æ®")
  let context_with_en = Context::with_value(context_with_zh, en_key, "English user data")
  let context_with_ja = Context::with_value(context_with_en, ja_key, "æ—¥æœ¬èªžãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿")
  
  // æ³¨å…¥å¤šè¯­è¨€Context
  let carrier = TextMapCarrier::new()
  CompositePropagator::inject(propagator, context_with_ja, carrier)
  
  // æ·»åŠ å¤šè¯­è¨€è‡ªå®šä¹‰å¤´éƒ¨
  TextMapCarrier::set(carrier, "X-User-Lang", "zh-CN")
  TextMapCarrier::set(carrier, "X-User-Region", "Asia/Shanghai")
  TextMapCarrier::set(carrier, "X-User-Timezone", "UTC+8")
  TextMapCarrier::set(carrier, "X-é”™è¯¯ä¿¡æ¯", "ç”¨æˆ·è®¤è¯å¤±è´¥")
  TextMapCarrier::set(carrier, "X-Error-Message", "User authentication failed")
  
  // æå–Context
  let extracted_context = CompositePropagator::extract(propagator, carrier)
  
  // éªŒè¯æå–çš„å¤šè¯­è¨€ä¿¡æ¯
  let extracted_value = Context::get(extracted_context, ContextKey::new("extracted"))
  assert_eq(extracted_value, Some("true"))
  
  // éªŒè¯å¤šè¯­è¨€å¤´éƒ¨
  let user_lang = TextMapCarrier::get(carrier, "X-User-Lang")
  let user_region = TextMapCarrier::get(carrier, "X-User-Region")
  let user_timezone = TextMapCarrier::get(carrier, "X-User-Timezone")
  let error_zh = TextMapCarrier::get(carrier, "X-é”™è¯¯ä¿¡æ¯")
  let error_en = TextMapCarrier::get(carrier, "X-Error-Message")
  
  assert_eq(user_lang, Some("zh-CN"))
  assert_eq(user_region, Some("Asia/Shanghai"))
  assert_eq(user_timezone, Some("UTC+8"))
  assert_eq(error_zh, Some("ç”¨æˆ·è®¤è¯å¤±è´¥"))
  assert_eq(error_en, Some("User authentication failed"))
  
  // æµ‹è¯•è·¨è¯­è¨€ä¼ æ’­
  let cross_lang_carriers = []
  
  // ä¸­æ–‡çŽ¯å¢ƒ
  let zh_carrier = TextMapCarrier::new()
  TextMapCarrier::set(zh_carrier, "X-æœåŠ¡åç§°", "ç”¨æˆ·æœåŠ¡")
  TextMapCarrier::set(zh_carrier, "X-æ“ä½œç±»åž‹", "æ•°æ®æŸ¥è¯¢")
  cross_lang_carriers.push(zh_carrier)
  
  // è‹±æ–‡çŽ¯å¢ƒ
  let en_carrier = TextMapCarrier::new()
  TextMapCarrier::set(en_carrier, "X-Service-Name", "User Service")
  TextMapCarrier::set(en_carrier, "X-Operation-Type", "Data Query")
  cross_lang_carriers.push(en_carrier)
  
  // æ—¥æ–‡çŽ¯å¢ƒ
  let ja_carrier = TextMapCarrier::new()
  TextMapCarrier::set(ja_carrier, "X-ã‚µãƒ¼ãƒ“ã‚¹å", "ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚µãƒ¼ãƒ“ã‚¹")
  TextMapCarrier::set(ja_carrier, "X-æ“ä½œã‚¿ã‚¤ãƒ—", "ãƒ‡ãƒ¼ã‚¿ã‚¯ã‚¨ãƒª")
  cross_lang_carriers.push(ja_carrier)
  
  // éªŒè¯è·¨è¯­è¨€ä¼ æ’­
  let service_names = ["ç”¨æˆ·æœåŠ¡", "User Service", "ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚µãƒ¼ãƒ“ã‚¹"]
  let operation_types = ["æ•°æ®æŸ¥è¯¢", "Data Query", "ãƒ‡ãƒ¼ã‚¿ã‚¯ã‚¨ãƒª"]
  
  for i in range(0, cross_lang_carriers.length()) {
    let carrier = cross_lang_carriers[i]
    let context = CompositePropagator::extract(propagator, carrier)
    
    // éªŒè¯ä¼ æ’­æˆåŠŸ
    let extracted = Context::get(context, ContextKey::new("extracted"))
    assert_eq(extracted, Some("true"))
  }
}

test "å›½é™…åŒ–é”™è¯¯æ¶ˆæ¯æµ‹è¯•" {
  // æµ‹è¯•å¤šè¯­è¨€é”™è¯¯æ¶ˆæ¯
  let error_messages = [
    ("zh-CN", "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"),
    ("zh-TW", "ç”¨æˆ¶åæˆ–å¯†ç¢¼éŒ¯èª¤"),
    ("en-US", "Invalid username or password"),
    ("en-GB", "Invalid username or password"),
    ("ja-JP", "ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“"),
    ("ko-KR", "ì‚¬ìš©ìž ì´ë¦„ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤"),
    ("fr-FR", "Nom d'utilisateur ou mot de passe incorrect"),
    ("de-DE", "Benutzername oder Passwort falsch"),
    ("es-ES", "Nombre de usuario o contraseÃ±a incorrectos"),
    ("ar-SA", "Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©")
  ]
  
  // åˆ›å»ºå¤šè¯­è¨€é”™è¯¯æ—¥å¿—
  let logger_provider = LoggerProvider::default()
  let logger = LoggerProvider::get_logger(logger_provider, "å›½é™…åŒ–é”™è¯¯æ—¥å¿—å™¨")
  
  for (locale, message) in error_messages {
    let error_log = LogRecord::new_with_context(
      Error,
      Some(message),
      None,
      Some(Clock::now_unix_nanos(Clock::system())),
      None,
      Some("error-trace-" + locale),
      Some("error-span-" + locale),
      None
    )
    
    Logger::emit(logger, error_log)
    
    // éªŒè¯é”™è¯¯æ¶ˆæ¯
    assert_eq(LogRecord::body(error_log), Some(message))
    assert_eq(LogRecord::trace_id(error_log), Some("error-trace-" + locale))
    assert_eq(LogRecord::span_id(error_log), Some("error-span-" + locale))
  }
  
  // æµ‹è¯•å¤šè¯­è¨€SpançŠ¶æ€æè¿°
  let tracer_provider = TracerProvider::default()
  let tracer = TracerProvider::get_tracer(tracer_provider, "å¤šè¯­è¨€é”™è¯¯è¿½è¸ªå™¨")
  
  let error_span = Tracer::start_span(tracer, "ç”¨æˆ·è®¤è¯æ“ä½œ")
  Span::set_status(error_span, Error, Some("è®¤è¯å¤±è´¥ï¼šç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"))
  assert_eq(Span::status(error_span), Error)
  
  // æµ‹è¯•å¤šè¯­è¨€äº‹ä»¶
  let event_messages = [
    ("zh-CN", "å¼€å§‹å¤„ç†ç”¨æˆ·è¯·æ±‚"),
    ("en-US", "Start processing user request"),
    ("ja-JP", "ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å‡¦ç†ã‚’é–‹å§‹"),
    ("ko-KR", "ì‚¬ìš©ìž ìš”ì²­ ì²˜ë¦¬ ì‹œìž‘")
  ]
  
  for (locale, message) in event_messages {
    Span::add_event(error_span, message, Some([
      ("locale", StringValue(locale)),
      ("event.type", StringValue("processing.start"))
    ]))
  }
  
  // æµ‹è¯•å¤šè¯­è¨€å±žæ€§
  let multilang_attrs = Attributes::new()
  
  let multilang_entries = [
    ("zh-CN.error.code", "ç”¨æˆ·è®¤è¯å¤±è´¥"),
    ("en-US.error.code", "User authentication failed"),
    ("ja-JP.error.code", "ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼å¤±æ•—"),
    ("ko-KR.error.code", "ì‚¬ìš©ìž ì¸ì¦ ì‹¤íŒ¨")
  ]
  
  for (key, value) in multilang_entries {
    Attributes::set(multilang_attrs, key, StringValue(value))
  }
  
  // éªŒè¯å¤šè¯­è¨€å±žæ€§
  for (key, value) in multilang_entries {
    let retrieved = Attributes::get(multilang_attrs, key)
    // ç®€åŒ–å®žçŽ°å¯èƒ½ä¸æ”¯æŒ
    assert_eq(retrieved, None)
  }
}