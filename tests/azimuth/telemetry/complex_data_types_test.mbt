// å¤æ‚æ•°æ®ç±»å‹å’Œç‰¹æ®Šå­—ç¬¦å¤„ç†æµ‹è¯•ç”¨ä¾‹
// æµ‹è¯•Unicodeã€ç‰¹æ®Šå­—ç¬¦ã€å¤æ‚æ•°æ®ç»“æ„å’Œç¼–ç å¤„ç†

test "Unicodeå’Œå›½é™…åŒ–å­—ç¬¦æµ‹è¯•" {
  // æµ‹è¯•ä¸­æ–‡å­—ç¬¦
  let chinese_text = "è¿™æ˜¯ä¸­æ–‡æµ‹è¯•å†…å®¹ï¼ŒåŒ…å«å„ç§æ±‰å­—ï¼šæµ‹è¯•é¥æµ‹ç³»ç»Ÿ"
  let chinese_attr = StringValue(chinese_text)
  
  // æµ‹è¯•æ—¥æ–‡å­—ç¬¦
  let japanese_text = "ã“ã‚Œã¯æ—¥æœ¬èªãƒ†ã‚¹ãƒˆã§ã™ã€‚ãƒ†ãƒ¬ãƒ¡ãƒˆãƒªã‚·ã‚¹ãƒ†ãƒ ã‚’ãƒ†ã‚¹ãƒˆä¸­"
  let japanese_attr = StringValue(japanese_text)
  
  // æµ‹è¯•éŸ©æ–‡å­—ç¬¦
  let korean_text = "ì´ê²ƒì€ í•œêµ­ì–´ í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤. ì›ê²© ì¸¡ì • ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸"
  let korean_attr = StringValue(korean_text)
  
  // æµ‹è¯•é˜¿æ‹‰ä¼¯æ–‡å­—ç¬¦
  let arabic_text = "Ù‡Ø°Ø§ Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©. Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚ÙŠØ§Ø³ Ø¹Ù† Ø¨Ø¹Ø¯"
  let arabic_attr = StringValue(arabic_text)
  
  // æµ‹è¯•ä¿„æ–‡å­—ç¬¦
  let russian_text = "Ğ­Ñ‚Ğ¾ Ñ‚ĞµÑÑ‚ Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¾Ğ¼ ÑĞ·Ñ‹ĞºĞµ. Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ‚ĞµĞ»ĞµĞ¼ĞµÑ‚Ñ€Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ¹ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹"
  let russian_attr = StringValue(russian_text)
  
  // æµ‹è¯•æ··åˆè¯­è¨€æ–‡æœ¬
  let mixed_text = "Mixed: ä¸­æ–‡ English æ—¥æœ¬è¯­ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ğ ÑƒÑÑĞºĞ¸Ğ¹"
  let mixed_attr = StringValue(mixed_text)
  
  // æµ‹è¯•Emojiå­—ç¬¦
  let emoji_text = "ğŸš€ğŸ“ŠğŸ“ˆğŸ”âš¡ï¸ğŸŒğŸ’¾ğŸ”§ğŸ“±ğŸ’»ğŸ–¥ï¸"
  let emoji_attr = StringValue(emoji_text)
  
  // æµ‹è¯•ç‰¹æ®Šç¬¦å·
  let symbols_text = "â™ â™¥â™¦â™£â˜…â˜†â™ªâ™«â˜€â˜â˜‚â˜ƒâ˜„â˜…â˜†â˜‡â˜ˆâ€»â˜â˜â˜œâ˜â‚¬Â¥Â£â‚¹â‚½â‚©"
  let symbols_attr = StringValue(symbols_text)
}

test "ç‰¹æ®Šå­—ç¬¦å’Œè½¬ä¹‰åºåˆ—æµ‹è¯•" {
  // æµ‹è¯•å„ç§è½¬ä¹‰å­—ç¬¦
  let escape_chars = "æ¢è¡Œç¬¦:\n åˆ¶è¡¨ç¬¦:\t å›è½¦ç¬¦:\r å¼•å·:\" å•å¼•å·:\' åæ–œæ :\\\\"
  let escape_attr = StringValue(escape_chars)
  
  // æµ‹è¯•æ§åˆ¶å­—ç¬¦
  let control_chars = "\\x00\\x01\\x02\\x03\\x04\\x05\\x06\\x07\\x08\\x0B\\x0C\\x0E\\x0F"
  let control_attr = StringValue(control_chars)
  
  // æµ‹è¯•HTMLç‰¹æ®Šå­—ç¬¦
  let html_chars = "<script>alert('test')</script> &lt;&gt;&amp;&quot;&apos;"
  let html_attr = StringValue(html_chars)
  
  // æµ‹è¯•URLç¼–ç å­—ç¬¦
  let url_encoded = "https://example.com/path?param=value%20with%20spaces&special=%E4%B8%AD%E6%96%87"
  let url_attr = StringValue(url_encoded)
  
  // æµ‹è¯•Base64ç±»ä¼¼å­—ç¬¦ä¸²
  let base64_like = "SGVsbG8gV29ybGQg5L2g5aW9IGhlbGxvIHdvcmxk"
  let base64_attr = StringValue(base64_like)
  
  // æµ‹è¯•JSONå­—ç¬¦ä¸²
  let json_string = "{\"key\":\"value\",\"nested\":{\"array\":[1,2,3]}}"
  let json_attr = StringValue(json_string)
}

test "å¤æ‚æ•°æ®ç»“æ„æµ‹è¯•" {
  // æµ‹è¯•åµŒå¥—å±æ€§ç»“æ„
  let complex_attrs = Attributes::new()
  Attributes::set(complex_attrs, "user.id", StringValue("user_12345"))
  Attributes::set(complex_attrs, "user.name", StringValue("å¼ ä¸‰"))
  Attributes::set(complex_attrs, "user.email", StringValue("zhangsan@example.com"))
  Attributes::set(complex_attrs, "user.profile.age", IntValue(25))
  Attributes::set(complex_attrs, "user.profile.active", BoolValue(true))
  Attributes::set(complex_attrs, "user.tags", ArrayStringValue(["premium", "verified", "active"]))
  
  // æµ‹è¯•å¤æ‚èµ„æºå±æ€§
  let resource = Resource::new()
  let complex_resource_attrs = [
    ("service.name", StringValue("azimuth-telemetry")),
    ("service.version", StringValue("1.0.0")),
    ("service.namespace", StringValue("production")),
    ("host.name", StringValue("web-server-01")),
    ("host.ip", StringValue("192.168.1.100")),
    ("os.type", StringValue("linux")),
    ("os.version", StringValue("Ubuntu 20.04")),
    ("deployment.environment", StringValue("ç”Ÿäº§ç¯å¢ƒ")),
    ("feature.flags", ArrayStringValue(["new-ui", "beta-api", "advanced-metrics"]))
  ]
  let resource_with_complex_attrs = Resource::with_attributes(resource, complex_resource_attrs)
  
  // æµ‹è¯•å¤æ‚Baggageæ¡ç›®
  let baggage = Baggage::new()
  let updated_baggage = Baggage::set_entry(baggage, "user.session", "sess_abc123")
  let final_baggage = Baggage::set_entry(updated_baggage, "request.id", "req_xyz789")
  let complex_baggage = Baggage::set_entry(final_baggage, "trace.context", "context_with_ç‰¹æ®Šå­—ç¬¦")
}

test "æ•°å€¼ç²¾åº¦å’Œæ ¼å¼æµ‹è¯•" {
  // æµ‹è¯•é«˜ç²¾åº¦æµ®ç‚¹æ•°
  let precise_float = FloatValue(3.14159265358979323846264338327950288419716939937510)
  let scientific_notation = FloatValue(1.23e-10)
  let very_small = FloatValue(1e-20)
  let very_large = FloatValue(1e20)
  
  // æµ‹è¯•ç‰¹æ®Šæµ®ç‚¹å€¼
  let infinity = FloatValue(1.0/0.0)  // æ­£æ— ç©·
  let neg_infinity = FloatValue(-1.0/0.0)  // è´Ÿæ— ç©·
  
  // æµ‹è¯•æ•´æ•°è¾¹ç•Œ
  let max_int = IntValue(2147483647)
  let min_int = IntValue(-2147483648)
  let zero = IntValue(0)
  
  // æµ‹è¯•å¤§æ•°ç»„æ•°å€¼
  let large_int_array = ArrayIntValue([1, 999999999, -999999999, 0, 2147483647, -2147483648])
  let large_string_array = ArrayStringValue([
    "short",
    "medium_length_string",
    "this_is_a_very_long_string_that_contains_many_characters_and_numbers_123456789",
    "ç‰¹æ®Šå­—ç¬¦å­—ç¬¦ä¸²!@#$%^&*()",
    "Unicode: ä¸­æ–‡ğŸš€æ—¥æœ¬èªØ§Ù„Ø¹Ø±Ø¨ÙŠØ©"
  ])
}

test "å¤æ‚æ—¥å¿—è®°å½•æµ‹è¯•" {
  // åˆ›å»ºåŒ…å«å¤æ‚å±æ€§çš„æ—¥å¿—è®°å½•
  let complex_attrs = Attributes::new()
  Attributes::set(complex_attrs, "error.type", StringValue("ValidationError"))
  Attributes::set(complex_attrs, "error.code", IntValue(400))
  Attributes::set(complex_attrs, "error.stack", StringValue("at Function.processError (app.js:123:45)\\n  at async handleRequest"))
  Attributes::set(complex_attrs, "user.id", StringValue("user_ä¸­æ–‡_123"))
  Attributes::set(complex_attrs, "request.headers", ArrayStringValue([
    "Content-Type: application/json",
    "Authorization: Bearer token_ç‰¹æ®Šå­—ç¬¦_!@#$%",
    "Accept-Language: zh-CN,zh;q=0.9,en;q=0.8"
  ]))
  
  let complex_log = LogRecord::new_with_context(
    Error,
    Some("å¤„ç†è¯·æ±‚æ—¶å‘ç”Ÿé”™è¯¯ï¼šç”¨æˆ·è¾“å…¥åŒ…å«éæ³•å­—ç¬¦ <script>alert('xss')</script>"),
    Some(complex_attrs),
    Some(1735689600000000000L),
    Some(1735689600000000100L),
    Some("trace_ä¸­æ–‡_123456"),
    Some("span_ç‰¹æ®Š!@#789"),
    Some(Context::with_value(Context::root(), ContextKey::new("correlation.id"), "corr_ä¸­æ–‡_abc"))
  )
  
  // æµ‹è¯•å¤šè¯­è¨€æ—¥å¿—æ¶ˆæ¯
  let multilingual_logs = [
    LogRecord::new(Info, "ç³»ç»Ÿå¯åŠ¨æˆåŠŸ"),
    LogRecord::new(Warn, "Systemè­¦å‘Šï¼šå†…å­˜ä½¿ç”¨ç‡è¿‡é«˜"),
    LogRecord::new(Error, "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸï¼šãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šå¤±æ•—"),
    LogRecord::new(Fatal, "Ø®Ø·Ø£ ÙØ§Ø¯Ø­: ØªØ¹Ø·Ù„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„")
  ]
}

test "å¤æ‚Spanå’Œè¿½è¸ªæµ‹è¯•" {
  // åˆ›å»ºå¤æ‚çš„Spanä¸Šä¸‹æ–‡
  let complex_trace_id = "af7651916cd43dd8448eb211c80319c" + "ä¸­æ–‡ç‰¹æ®Šå­—ç¬¦"
  let complex_span_id = "b7ad6b7169203331" + "!@#$%"
  let complex_trace_state = "rojo=00-4bf92f3577ed34a170dc3b6f0f3b4d00-00f067aa0ba902b7-01,congo=t61rcWkgMzE"
  
  let complex_span_ctx = SpanContext::new(complex_trace_id, complex_span_id, true, complex_trace_state)
  
  // åˆ›å»ºå¤æ‚Span
  let complex_span = Span::new("å¤æ‚çš„æ“ä½œåç§°", Server, complex_span_ctx)
  
  // æ·»åŠ å¤æ‚äº‹ä»¶
  let complex_events = [
    ("ç”¨æˆ·è®¤è¯", [
      ("user.id", StringValue("user_ä¸­æ–‡_123")),
      ("auth.method", StringValue("OAuth2.0")),
      ("auth.timestamp", IntValue(1735689600)),
      ("auth.success", BoolValue(true))
    ]),
    ("æ•°æ®åº“æŸ¥è¯¢", [
      ("db.query", StringValue("SELECT * FROM users WHERE name LIKE '%ä¸­æ–‡%'")),
      ("db.duration_ms", IntValue(150)),
      ("db.rows_returned", IntValue(42)
    ]),
    ("ç¼“å­˜æ“ä½œ", [
      ("cache.key", StringValue("user:profile:ä¸­æ–‡:123")),
      ("cache.hit", BoolValue(false)),
      ("cache.ttl", IntValue(3600))
    ])
  ]
  
  // æ¨¡æ‹Ÿæ·»åŠ äº‹ä»¶
  for event in complex_events {
    Span::add_event(complex_span, event.0, Some(event.1))
  }
  
  // æµ‹è¯•ä¸åŒçš„Spanç§ç±»
  let span_kinds = [
    (Internal, "å†…éƒ¨å¤„ç†"),
    (Server, "æœåŠ¡å™¨å¤„ç†è¯·æ±‚"),
    (Client, "å®¢æˆ·ç«¯è°ƒç”¨å¤–éƒ¨API"),
    (Producer, "æ¶ˆæ¯ç”Ÿäº§è€…å‘é€æ¶ˆæ¯"),
    (Consumer, "æ¶ˆæ¯æ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯")
  ]
  
  for (kind, name) in span_kinds {
    let test_span = Span::new(name, kind, complex_span_ctx)
    Span::set_status(test_span, Ok, Some("æ“ä½œæˆåŠŸå®Œæˆ"))
  }
}

test "å¤æ‚HTTPè¯·æ±‚å“åº”æµ‹è¯•" {
  // æµ‹è¯•å¤æ‚çš„HTTPå¤´
  let complex_headers = [
    ("Content-Type", "application/json; charset=utf-8"),
    ("Authorization", "Bearer token_ä¸­æ–‡_!@#$%^&*()"),
    ("User-Agent", "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"),
    ("Accept-Language", "zh-CN,zh;q=0.9,en;q=0.8,ja;q=0.7,ar;q=0.6"),
    ("X-Custom-Header", "è‡ªå®šä¹‰å¤´éƒ¨å€¼ with ç‰¹æ®Šå­—ç¬¦"),
    ("X-Request-ID", "req_ä¸­æ–‡_123-456-789"),
    ("Cookie", "session_id=sess_ä¸­æ–‡_abc; user_pref=lang:zh|theme:dark")
  ]
  
  // æµ‹è¯•å¤æ‚çš„è¯·æ±‚ä½“
  let complex_json_body = "{\"user\":{\"name\":\"å¼ ä¸‰\",\"email\":\"zhangsan@example.com\",\"profile\":{\"age\":25,\"interests\":[\"ç¼–ç¨‹\",\"éŸ³ä¹\",\"é˜…è¯»\"],\"address\":{\"country\":\"ä¸­å›½\",\"city\":\"åŒ—äº¬\",\"district\":\"æœé˜³åŒº\"}}},\"metadata\":{\"timestamp\":1735689600,\"version\":\"1.0.0\",\"features\":[\"multilingual\",\"unicode_support\"]}}"
  
  let complex_request = HttpRequest::new(
    "POST",
    "https://api.example.com/v1/users/ä¸­æ–‡ç”¨æˆ·/update?param=value&special=ç‰¹æ®Šå­—ç¬¦",
    complex_headers,
    Some(complex_json_body)
  )
  
  // æµ‹è¯•å¤æ‚çš„å“åº”
  let complex_response_headers = [
    ("Content-Type", "application/json; charset=utf-8"),
    ("X-Rate-Limit-Remaining", "99"),
    ("X-Custom-Response", "å“åº”è‡ªå®šä¹‰å¤´éƒ¨ with ç‰¹æ®Šå­—ç¬¦"),
    ("Set-Cookie", "refresh_token=token_ä¸­æ–‡_!@#; HttpOnly; Secure; SameSite=Strict")
  ]
  
  let complex_response_body = "{\"success\":true,\"message\":\"æ“ä½œæˆåŠŸ\",\"data\":{\"user_id\":\"user_ä¸­æ–‡_123\",\"status\":\"active\"},\"errors\":[],\"warnings\":[\"è¯·æ³¨æ„ï¼šæŸäº›åŠŸèƒ½å¯èƒ½éœ€è¦é¢å¤–æƒé™\"]}"
  
  let complex_response = HttpResponse::new(
    200,
    complex_response_headers,
    Some(complex_response_body)
  )
}