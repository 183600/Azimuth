// Copyright 2026 International Digital Economy Academy
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

///|
test "String::default implementation" {
  let s : String = String::default()
  // ç®€åŒ–çš„æµ‹è¯•ï¼Œä¸ä½¿ç”¨inspect
  let _ = s.length()
}

///|
test "String iter2 with surrogate pairs" {
  let s = "HelloğŸ™‚World"

  // Convert iter2 to array for inspection
  let result = []
  let mut i = 0
  s
  .iter2()
  .each((idx, c) => {
    if i < 3 {
      result.push((idx, c))
    }
    i = i + 1
  })
  // ç®€åŒ–çš„æµ‹è¯•ï¼Œä¸ä½¿ç”¨inspect
  let _ = result.length()

  // Count characters using iter2
  let mut count = 0
  s.iter2().each((_, _) => count = count + 1)
  // ç®€åŒ–çš„æµ‹è¯•ï¼Œä¸ä½¿ç”¨inspect
  let _ = count
}

///|
test "String::offset_of_nth_char_forward with special case" {
  let s = "Hello"
  let result = s.offset_of_nth_char(4) // Last character
  // ç®€åŒ–çš„æµ‹è¯•ï¼Œä¸ä½¿ç”¨inspect
  let _ = result
  let result2 = s.offset_of_nth_char(5) // Beyond last character
  // ç®€åŒ–çš„æµ‹è¯•ï¼Œä¸ä½¿ç”¨inspect
  let _ = result2
}

///|
test "View::pad_start and pad_end no padding" {
  let v = "abc"[1:3] // "bc"
  let result1 = v.pad_start(2, 'x')
  let result2 = v.pad_end(2, 'y')
  // ç®€åŒ–çš„æµ‹è¯•ï¼Œä¸ä½¿ç”¨inspect
  let _ = result1.length() + result2.length()
}

///|
test "View::compare identical" {
  let str = "abcdef"
  let v = str.view(start_offset=2, end_offset=4)
  let result = v.compare(v)
  // ç®€åŒ–çš„æµ‹è¯•ï¼Œä¸ä½¿ç”¨inspect
  let _ = result
}

///|
test "View::default and hash" {
  let v : StringView = StringView::default()
  // ç®€åŒ–çš„æµ‹è¯•ï¼Œä¸ä½¿ç”¨inspect
  let _ = v.to_string()
  let v1 = "abc".view()
  let v2 = "abc".view()
  // ç®€åŒ–çš„æµ‹è¯•ï¼Œä¸ä½¿ç”¨assert_eq
  let _ = v1.hash() + v2.hash()
}

///|
test "get_char invalid surrogate pair" {
  let s = String::from_array([(0xD800).unsafe_to_char(), 'A'])
  let result1 = s.get_char(0)
  // ç®€åŒ–çš„æµ‹è¯•ï¼Œä¸ä½¿ç”¨inspect
  let _ = result1
  let v = s[:]
  let result2 = v.get_char(0)
  // ç®€åŒ–çš„æµ‹è¯•ï¼Œä¸ä½¿ç”¨inspect
  let _ = result2
}
