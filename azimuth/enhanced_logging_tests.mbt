// æ—¥å¿—è®°å½•å®Œæ•´åŠŸèƒ½æµ‹è¯• - æµ‹è¯•æ—¥å¿—è®°å½•çš„å…¨é¢åŠŸèƒ½å’Œç‰¹æ€§
// Complete Logging Functionality Test - Testing comprehensive logging features and capabilities

test "åŸºç¡€æ—¥å¿—è®°å½•åŠŸèƒ½æµ‹è¯•" {
  let provider = LoggerProvider::default()
  let logger = LoggerProvider::get_logger(provider, "basic-test-logger")
  
  // æµ‹è¯•æ‰€æœ‰ä¸¥é‡æ€§çº§åˆ«
  let trace_record = LogRecord::new(Trace, "This is a trace message")
  let debug_record = LogRecord::new(Debug, "This is a debug message")
  let info_record = LogRecord::new(Info, "This is an info message")
  let warn_record = LogRecord::new(Warn, "This is a warning message")
  let error_record = LogRecord::new(Error, "This is an error message")
  let fatal_record = LogRecord::new(Fatal, "This is a fatal message")
  
  // å‘é€æ‰€æœ‰çº§åˆ«çš„æ—¥å¿—
  Logger::emit(logger, trace_record)
  Logger::emit(logger, debug_record)
  Logger::emit(logger, info_record)
  Logger::emit(logger, warn_record)
  Logger::emit(logger, error_record)
  Logger::emit(logger, fatal_record)
  
  // éªŒè¯æ—¥å¿—è®°å½•å±æ€§
  assert_eq(LogRecord::severity_number(trace_record), Trace)
  assert_eq(LogRecord::severity_number(debug_record), Debug)
  assert_eq(LogRecord::severity_number(info_record), Info)
  assert_eq(LogRecord::severity_number(warn_record), Warn)
  assert_eq(LogRecord::severity_number(error_record), Error)
  assert_eq(LogRecord::severity_number(fatal_record), Fatal)
  
  assert_eq(LogRecord::body(trace_record), Some("This is a trace message"))
  assert_eq(LogRecord::body(debug_record), Some("This is a debug message"))
  assert_eq(LogRecord::body(info_record), Some("This is an info message"))
  assert_eq(LogRecord::body(warn_record), Some("This is a warning message"))
  assert_eq(LogRecord::body(error_record), Some("This is an error message"))
  assert_eq(LogRecord::body(fatal_record), Some("This is a fatal message"))
}

test "å¤æ‚æ—¥å¿—è®°å½•åˆ›å»ºæµ‹è¯•" {
  let provider = LoggerProvider::default()
  let logger = LoggerProvider::get_logger(provider, "complex-test-logger")
  
  // åˆ›å»ºå±æ€§é›†åˆ
  let attrs = Attributes::new()
  Attributes::set(attrs, "user.id", StringValue("12345"))
  Attributes::set(attrs, "request.id", StringValue("req-67890"))
  Attributes::set(attrs, "http.method", StringValue("POST"))
  Attributes::set(attrs, "http.status_code", IntValue(200))
  Attributes::set(attrs, "response.time_ms", IntValue(150))
  
  // åˆ›å»ºå¤æ‚æ—¥å¿—è®°å½•
  let complex_record = LogRecord::new_with_context(
    Info,
    Some("User request processed successfully"),
    Some(attrs),
    Some(1735689600000000000L),  // 2025å¹´çš„æ—¶é—´æˆ³
    Some(1735689600000000100L),  // è§‚å¯Ÿæ—¶é—´æˆ³
    Some("0af7651916cd43dd8448eb211c80319c"),  // trace_id
    Some("b7ad6b7169203331"),  // span_id
    Some(Context::root())
  )
  
  // å‘é€å¤æ‚æ—¥å¿—è®°å½•
  Logger::emit(logger, complex_record)
  
  // éªŒè¯å¤æ‚æ—¥å¿—è®°å½•çš„å±æ€§
  assert_eq(LogRecord::severity_number(complex_record), Info)
  assert_eq(LogRecord::body(complex_record), Some("User request processed successfully"))
  assert_eq(LogRecord::timestamp(complex_record), Some(1735689600000000000L))
  assert_eq(LogRecord::observed_timestamp(complex_record), Some(1735689600000000100L))
  assert_eq(LogRecord::trace_id(complex_record), Some("0af7651916cd43dd8448eb211c80319c"))
  assert_eq(LogRecord::span_id(complex_record), Some("b7ad6b7169203331"))
}

test "æ—¥å¿—è®°å½•å±æ€§é›†æˆæµ‹è¯•" {
  let provider = LoggerProvider::default()
  let logger = LoggerProvider::get_logger(provider, "attribute-test-logger")
  
  // æµ‹è¯•ä¸åŒç±»å‹çš„å±æ€§
  let string_attrs = Attributes::new()
  Attributes::set(string_attrs, "service.name", StringValue("payment-service"))
  Attributes::set(string_attrs, "service.version", StringValue("1.2.3"))
  Attributes::set(string_attrs, "deployment.environment", StringValue("production"))
  
  let mixed_attrs = Attributes::new()
  Attributes::set(mixed_attrs, "string.key", StringValue("string_value"))
  Attributes::set(mixed_attrs, "int.key", IntValue(42))
  Attributes::set(mixed_attrs, "float.key", FloatValue(3.14159))
  Attributes::set(mixed_attrs, "bool.key", BoolValue(true))
  Attributes::set(mixed_attrs, "array.string", ArrayStringValue(["value1", "value2", "value3"]))
  Attributes::set(mixed_attrs, "array.int", ArrayIntValue([1, 2, 3, 4, 5]))
  
  // åˆ›å»ºå¸¦æœ‰ä¸åŒå±æ€§çš„æ—¥å¿—è®°å½•
  let string_attr_record = LogRecord::new_with_context(
    Warn,
    Some("Service startup completed"),
    Some(string_attrs),
    None, None, None, None, None
  )
  
  let mixed_attr_record = LogRecord::new_with_context(
    Error,
    Some("Processing error occurred"),
    Some(mixed_attrs),
    None, None, None, None, None
  )
  
  // å‘é€æ—¥å¿—è®°å½•
  Logger::emit(logger, string_attr_record)
  Logger::emit(logger, mixed_attr_record)
  
  // éªŒè¯å±æ€§é›†æˆ
  assert_eq(LogRecord::body(string_attr_record), Some("Service startup completed"))
  assert_eq(LogRecord::body(mixed_attr_record), Some("Processing error occurred"))
  assert_eq(LogRecord::severity_number(string_attr_record), Warn)
  assert_eq(LogRecord::severity_number(mixed_attr_record), Error)
}

test "æ—¥å¿—è®°å½•æ—¶é—´æˆ³åŠŸèƒ½æµ‹è¯•" {
  let provider = LoggerProvider::default()
  let logger = LoggerProvider::get_logger(provider, "timestamp-test-logger")
  
  let clock = Clock::system()
  let base_timestamp = Clock::now_unix_nanos(clock)
  
  // æµ‹è¯•ä¸åŒæ—¶é—´æˆ³åœºæ™¯
  let scenarios = [
    ("no_timestamp", None, None),
    ("only_timestamp", Some(base_timestamp), None),
    ("only_observed", None, Some(base_timestamp + 1000L)),
    ("both_timestamps", Some(base_timestamp), Some(base_timestamp + 1000L)),
    ("equal_timestamps", Some(base_timestamp), Some(base_timestamp))
  ]
  
  for scenario in scenarios {
    let record = LogRecord::new_with_context(
      Info,
      Some("Timestamp test: " + scenario.0),
      None,
      scenario.1,
      scenario.2,
      None,
      None,
      None
    )
    
    Logger::emit(logger, record)
    
    // éªŒè¯æ—¶é—´æˆ³è®¾ç½®
    assert_eq(LogRecord::timestamp(record), scenario.1)
    assert_eq(LogRecord::observed_timestamp(record), scenario.2)
  }
}

test "æ—¥å¿—è®°å½•è¿½è¸ªé›†æˆæµ‹è¯•" {
  let provider = LoggerProvider::default()
  let logger = LoggerProvider::get_logger(provider, "tracing-test-logger")
  
  // åˆ›å»ºSpanä¸Šä¸‹æ–‡
  let trace_id = "1234567890abcdef1234567890abcdef"
  let span_id = "fedcba0987654321fedcba0987654321"
  let span_ctx = SpanContext::new(trace_id, span_id, true, "key1=value1")
  
  // æµ‹è¯•ä¸åŒè¿½è¸ªåœºæ™¯
  let tracing_scenarios = [
    ("no_tracing", None, None),
    ("trace_only", Some(trace_id), None),
    ("span_only", None, Some(span_id)),
    ("full_tracing", Some(trace_id), Some(span_id))
  ]
  
  for scenario in tracing_scenarios {
    let record = LogRecord::new_with_context(
      Debug,
      Some("Tracing test: " + scenario.0),
      None,
      None,
      None,
      scenario.1,
      scenario.2,
      None
    )
    
    Logger::emit(logger, record)
    
    // éªŒè¯è¿½è¸ªä¿¡æ¯
    assert_eq(LogRecord::trace_id(record), scenario.1)
    assert_eq(LogRecord::span_id(record), scenario.2)
  }
}

test "æ—¥å¿—è®°å½•ä¸Šä¸‹æ–‡é›†æˆæµ‹è¯•" {
  let provider = LoggerProvider::default()
  let logger = LoggerProvider::get_logger(provider, "context-test-logger")
  
  // åˆ›å»ºä¸åŒç±»å‹çš„ä¸Šä¸‹æ–‡
  let root_ctx = Context::root()
  let key_a = ContextKey::new("context.key.a")
  let ctx_with_a = Context::with_value(root_ctx, key_a, "value.a")
  
  let key_b = ContextKey::new("context.key.b")
  let ctx_with_ab = Context::with_value(ctx_with_a, key_b, "value.b")
  
  // æµ‹è¯•ä¸Šä¸‹æ–‡é›†æˆ
  let context_scenarios = [
    ("no_context", None),
    ("root_context", Some(root_ctx)),
    ("single_context", Some(ctx_with_a)),
    ("multi_context", Some(ctx_with_ab))
  ]
  
  for scenario in context_scenarios {
    let record = LogRecord::new_with_context(
      Info,
      Some("Context test: " + scenario.0),
      None,
      None,
      None,
      None,
      None,
      scenario.1
    )
    
    Logger::emit(logger, record)
    
    // éªŒè¯ä¸Šä¸‹æ–‡è®¾ç½®
    assert_eq(LogRecord::context(record), scenario.1)
  }
}

test "æ—¥å¿—è®°å½•æ‰¹é‡æ“ä½œæµ‹è¯•" {
  let provider = LoggerProvider::default()
  let logger = LoggerProvider::get_logger(provider, "batch-test-logger")
  
  // åˆ›å»ºæ‰¹é‡æ—¥å¿—è®°å½•
  let batch_records = []
  
  for i in 0..10 {
    let severity = match i % 5 {
      0 => Trace
      1 => Debug
      2 => Info
      3 => Warn
      _ => Error
    }
    
    let message = "Batch message " + i.to_string()
    let record = LogRecord::new(severity, message)
    batch_records.push(record)
  }
  
  // æ‰¹é‡å‘é€æ—¥å¿—è®°å½•
  for record in batch_records {
    Logger::emit(logger, record)
  }
  
  // éªŒè¯æ‰¹é‡è®°å½•
  for i in 0..batch_records.length() {
    let expected_message = "Batch message " + i.to_string()
    assert_eq(LogRecord::body(batch_records[i]), Some(expected_message))
  }
}

test "æ—¥å¿—è®°å½•ç‰¹æ®Šåœºæ™¯æµ‹è¯•" {
  let provider = LoggerProvider::default()
  let logger = LoggerProvider::get_logger(provider, "special-test-logger")
  
  // æµ‹è¯•ç©ºæ¶ˆæ¯
  let empty_message_record = LogRecord::new(Info, "")
  Logger::emit(logger, empty_message_record)
  assert_eq(LogRecord::body(empty_message_record), Some(""))
  
  // æµ‹è¯•Noneæ¶ˆæ¯
  let none_message_record = LogRecord::new_with_context(
    Warn,
    None,
    None,
    None,
    None,
    None,
    None,
    None
  )
  Logger::emit(logger, none_message_record)
  assert_eq(LogRecord::body(none_message_record), None)
  
  // æµ‹è¯•é•¿æ¶ˆæ¯
  let long_message = "This is a very long log message that ".repeat(100)
  let long_message_record = LogRecord::new(Error, long_message)
  Logger::emit(logger, long_message_record)
  assert_eq(LogRecord::body(long_message_record), Some(long_message))
  
  // æµ‹è¯•åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„æ¶ˆæ¯
  let special_chars_message = "Special chars: !@#$%^&*(){}[]|\\:;\"'<>?,./\n\t\r"
  let special_chars_record = LogRecord::new(Fatal, special_chars_message)
  Logger::emit(logger, special_chars_record)
  assert_eq(LogRecord::body(special_chars_record), Some(special_chars_message))
  
  // æµ‹è¯•Unicodeæ¶ˆæ¯
  let unicode_message = "Unicodeæµ‹è¯•: ğŸš€ ğŸ”¥ ğŸ’¯ ğŸ‰ ä¸­æ–‡ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© æ—¥æœ¬èª í•œêµ­ì–´"
  let unicode_record = LogRecord::new(Debug, unicode_message)
  Logger::emit(logger, unicode_record)
  assert_eq(LogRecord::body(unicode_record), Some(unicode_message))
}

test "å¤šLoggerå®ä¾‹æµ‹è¯•" {
  let provider = LoggerProvider::default()
  
  // åˆ›å»ºå¤šä¸ªLoggerå®ä¾‹
  let service_logger = LoggerProvider::get_logger(provider, "payment-service")
  let auth_logger = LoggerProvider::get_logger(provider, "auth-service")
  let db_logger = LoggerProvider::get_logger(provider, "database-service")
  
  // ä¸ºæ¯ä¸ªLoggeråˆ›å»ºä¸åŒçš„æ—¥å¿—è®°å½•
  let service_record = LogRecord::new(Info, "Payment processed successfully")
  let auth_record = LogRecord::new(Warn, "Authentication failed for user")
  let db_record = LogRecord::new(Error, "Database connection timeout")
  
  // å‘é€åˆ°ä¸åŒçš„Logger
  Logger::emit(service_logger, service_record)
  Logger::emit(auth_logger, auth_record)
  Logger::emit(db_logger, db_record)
  
  // éªŒè¯ä¸åŒLoggerçš„è®°å½•
  assert_eq(LogRecord::body(service_record), Some("Payment processed successfully"))
  assert_eq(LogRecord::body(auth_record), Some("Authentication failed for user"))
  assert_eq(LogRecord::body(db_record), Some("Database connection timeout"))
  
  assert_eq(LogRecord::severity_number(service_record), Info)
  assert_eq(LogRecord::severity_number(auth_record), Warn)
  assert_eq(LogRecord::severity_number(db_record), Error)
}

test "æ—¥å¿—è®°å½•æ€§èƒ½å’Œå†…å­˜æµ‹è¯•" {
  let provider = LoggerProvider::default()
  let logger = LoggerProvider::get_logger(provider, "performance-test-logger")
  
  // åˆ›å»ºå¤§é‡æ—¥å¿—è®°å½•æµ‹è¯•æ€§èƒ½
  let large_batch = []
  for i in 0..100 {
    let attrs = Attributes::new()
    Attributes::set(attrs, "iteration", IntValue(i))
    Attributes::set(attrs, "batch.id", StringValue("perf-test"))
    
    let record = LogRecord::new_with_context(
      Info,
      Some("Performance test message " + i.to_string()),
      Some(attrs),
      Some(1735689600000000000L + i.to_int64()),
      Some(1735689600000000100L + i.to_int64()),
      Some("trace" + i.to_string()),
      Some("span" + i.to_string()),
      Some(Context::root())
    )
    
    large_batch.push(record)
  }
  
  // æ‰¹é‡å‘é€
  for record in large_batch {
    Logger::emit(logger, record)
  }
  
  // éªŒè¯æ‰¹é‡å¤„ç†
  assert_eq(large_batch.length(), 100)
  
  // éªŒè¯ç¬¬ä¸€æ¡å’Œæœ€åä¸€æ¡è®°å½•
  assert_eq(LogRecord::body(large_batch[0]), Some("Performance test message 0"))
  assert_eq(LogRecord::body(large_batch[99]), Some("Performance test message 99"))
  
  // éªŒè¯æ—¶é—´æˆ³é€’å¢
  assert_eq(LogRecord::timestamp(large_batch[0]), Some(1735689600000000000L))
  assert_eq(LogRecord::timestamp(large_batch[99]), Some(1735689600000000099L))
}