// æ—¥å¿—è®°å½•ä¸¥é‡æ€§æµ‹è¯•ç”¨ä¾‹
// æµ‹è¯• Azimuth é¥æµ‹ç³»ç»Ÿä¸­çš„æ—¥å¿—è®°å½•å’Œä¸¥é‡æ€§çº§åˆ«åŠŸèƒ½

test "log_severity_levels" {
  // æµ‹è¯•æ‰€æœ‰ä¸¥é‡æ€§çº§åˆ«
  let trace_record = LogRecord::new(Trace, "Trace level message")
  let debug_record = LogRecord::new(Debug, "Debug level message")
  let info_record = LogRecord::new(Info, "Info level message")
  let warn_record = LogRecord::new(Warn, "Warning level message")
  let error_record = LogRecord::new(Error, "Error level message")
  let fatal_record = LogRecord::new(Fatal, "Fatal level message")
  
  // éªŒè¯ä¸¥é‡æ€§çº§åˆ«
  assert_eq(LogRecord::severity_number(trace_record), Trace)
  assert_eq(LogRecord::severity_number(debug_record), Debug)
  assert_eq(LogRecord::severity_number(info_record), Info)
  assert_eq(LogRecord::severity_number(warn_record), Warn)
  assert_eq(LogRecord::severity_number(error_record), Error)
  assert_eq(LogRecord::severity_number(fatal_record), Fatal)
  
  // éªŒè¯æ¶ˆæ¯å†…å®¹
  assert_eq(LogRecord::body(trace_record), Some("Trace level message"))
  assert_eq(LogRecord::body(debug_record), Some("Debug level message"))
  assert_eq(LogRecord::body(info_record), Some("Info level message"))
  assert_eq(LogRecord::body(warn_record), Some("Warning level message"))
  assert_eq(LogRecord::body(error_record), Some("Error level message"))
  assert_eq(LogRecord::body(fatal_record), Some("Fatal level message"))
}

test "log_record_with_context" {
  let timestamp = 1735689600000000000L
  let observed_timestamp = 1735689600000001000L
  let trace_id = "0af7651916cd43dd8448eb211c80319c"
  let span_id = "b7ad6b7169203331"
  
  let record = LogRecord::new_with_context(
    Error,
    Some("Database connection failed"),
    None,
    Some(timestamp),
    Some(observed_timestamp),
    Some(trace_id),
    Some(span_id),
    None
  )
  
  // éªŒè¯è®°å½•å±æ€§
  assert_eq(LogRecord::severity_number(record), Error)
  assert_eq(LogRecord::body(record), Some("Database connection failed"))
  assert_eq(LogRecord::trace_id(record), Some(trace_id))
  assert_eq(LogRecord::span_id(record), Some(span_id))
}

test "logger_operations" {
  let provider = LoggerProvider::default()
  let logger = LoggerProvider::get_logger(provider, "azimuth.logger")
  
  // æµ‹è¯•ä¸åŒä¸¥é‡æ€§çº§åˆ«çš„æ—¥å¿—è®°å½•
  let trace_log = LogRecord::new(Trace, "Starting operation")
  let info_log = LogRecord::new(Info, "Operation completed successfully")
  let warn_log = LogRecord::new(Warn, "Operation took longer than expected")
  let error_log = LogRecord::new(Error, "Operation failed due to timeout")
  
  // å‘é€æ—¥å¿—è®°å½•
  Logger::emit(logger, trace_log)
  Logger::emit(logger, info_log)
  Logger::emit(logger, warn_log)
  Logger::emit(logger, error_log)
  
  assert_true(true)
}

test "log_severity_priority_ordering" {
  // æµ‹è¯•ä¸¥é‡æ€§çº§åˆ«çš„ä¼˜å…ˆçº§é¡ºåº
  let severities = [Trace, Debug, Info, Warn, Error, Fatal]
  let expected_order = [1, 2, 3, 4, 5, 6]
  
  // éªŒè¯ä¸¥é‡æ€§çº§åˆ«çš„ç›¸å¯¹ä¼˜å…ˆçº§
  let trace_priority = match severities[0] {
    Trace => 1
    Debug => 2
    Info => 3
    Warn => 4
    Error => 5
    Fatal => 6
  }
  assert_eq(trace_priority, 1)
  
  let debug_priority = match severities[1] {
    Trace => 1
    Debug => 2
    Info => 3
    Warn => 4
    Error => 5
    Fatal => 6
  }
  assert_eq(debug_priority, 2)
  
  let info_priority = match severities[2] {
    Trace => 1
    Debug => 2
    Info => 3
    Warn => 4
    Error => 5
    Fatal => 6
  }
  assert_eq(info_priority, 3)
  
  let warn_priority = match severities[3] {
    Trace => 1
    Debug => 2
    Info => 3
    Warn => 4
    Error => 5
    Fatal => 6
  }
  assert_eq(warn_priority, 4)
  
  let error_priority = match severities[4] {
    Trace => 1
    Debug => 2
    Info => 3
    Warn => 4
    Error => 5
    Fatal => 6
  }
  assert_eq(error_priority, 5)
  
  let fatal_priority = match severities[5] {
    Trace => 1
    Debug => 2
    Info => 3
    Warn => 4
    Error => 5
    Fatal => 6
  }
  assert_eq(fatal_priority, 6)
}

test "log_record_with_attributes" {
  let attrs = Attributes::new()
  Attributes::set(attrs, "user.id", StringValue("user123"))
  Attributes::set(attrs, "request.id", StringValue("req456"))
  Attributes::set(attrs, "response.time", IntValue(250))
  
  let record = LogRecord::new_with_context(
    Info,
    Some("Request processed successfully"),
    Some(attrs),
    Some(1735689600000000000L),
    None,
    Some("0af7651916cd43dd8448eb211c80319c"),
    Some("b7ad6b7169203331"),
    None
  )
  
  // éªŒè¯è®°å½•åŒ…å«å±æ€§
  assert_eq(LogRecord::severity_number(record), Info)
  assert_eq(LogRecord::body(record), Some("Request processed successfully"))
  assert_eq(LogRecord::trace_id(record), Some("0af7651916cd43dd8448eb211c80319c"))
  assert_eq(LogRecord::span_id(record), Some("b7ad6b7169203331"))
}

test "log_record_edge_cases" {
  // æµ‹è¯•ç©ºæ¶ˆæ¯
  let empty_message = LogRecord::new(Info, "")
  assert_eq(LogRecord::body(empty_message), Some(""))
  
  // æµ‹è¯•é•¿æ¶ˆæ¯
  let long_message = "This is a very long log message that contains a lot of detail about what happened during the operation and might include stack traces or other diagnostic information"
  let long_record = LogRecord::new(Error, long_message)
  assert_eq(LogRecord::body(long_record), Some(long_message))
  
  // æµ‹è¯•ç‰¹æ®Šå­—ç¬¦
  let special_chars = "Special chars: !@#$%^&*()_+-=[]{}|;':\",./<>?"
  let special_record = LogRecord::new(Warn, special_chars)
  assert_eq(LogRecord::body(special_record), Some(special_chars))
  
  // æµ‹è¯•Unicodeå­—ç¬¦
  let unicode_message = "Unicode test: ä¸­æ–‡æµ‹è¯• ğŸš€ emoji test"
  let unicode_record = LogRecord::new(Info, unicode_message)
  assert_eq(LogRecord::body(unicode_record), Some(unicode_message))
}

test "log_severity_filtering" {
  // æ¨¡æ‹Ÿæ—¥å¿—ä¸¥é‡æ€§è¿‡æ»¤é€»è¾‘
  let records = [
    LogRecord::new(Trace, "Trace message"),
    LogRecord::new(Debug, "Debug message"),
    LogRecord::new(Info, "Info message"),
    LogRecord::new(Warn, "Warning message"),
    LogRecord::new(Error, "Error message"),
    LogRecord::new(Fatal, "Fatal message")
  ]
  
  // è¿‡æ»¤å‡ºè­¦å‘Šçº§åˆ«åŠä»¥ä¸Šçš„æ—¥å¿—
  let warning_and_above = []
  for record in records {
    let severity = LogRecord::severity_number(record)
    let should_include = match severity {
      Warn => true
      Error => true
      Fatal => true
      _ => false
    }
    if should_include {
      warning_and_above.push(record)
    }
  }
  
  assert_eq(warning_and_above.length(), 3)
  assert_eq(LogRecord::severity_number(warning_and_above[0]), Warn)
  assert_eq(LogRecord::severity_number(warning_and_above[1]), Error)
  assert_eq(LogRecord::severity_number(warning_and_above[2]), Fatal)
}

test "log_performance_scenarios" {
  let provider = LoggerProvider::default()
  let logger = LoggerProvider::get_logger(provider, "performance.logger")
  
  // æµ‹è¯•å¤§é‡æ—¥å¿—è®°å½•çš„æ€§èƒ½
  for i in 0..100 {
    let message = "Performance test message " + i.to_string()
    let record = LogRecord::new(Info, message)
    Logger::emit(logger, record)
  }
  
  // æµ‹è¯•ä¸åŒä¸¥é‡æ€§çº§åˆ«çš„æ··åˆæ—¥å¿—
  let mixed_records = [
    LogRecord::new(Trace, "Trace operation"),
    LogRecord::new(Debug, "Debug operation"),
    LogRecord::new(Info, "Info operation"),
    LogRecord::new(Warn, "Warning operation"),
    LogRecord::new(Error, "Error operation")
  ]
  
  for record in mixed_records {
    Logger::emit(logger, record)
  }
  
  assert_true(true)
}