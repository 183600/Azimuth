// Azimuth New Comprehensive Test Suite
// é«˜çº§ç»¼åˆæµ‹è¯•ç”¨ä¾‹ï¼Œä¸“æ³¨äºå›½é™…åŒ–ã€å¹¶å‘ã€èµ„æºç®¡ç†ç­‰æ–¹é¢

// Test 1: å›½é™…åŒ–å’Œæœ¬åœ°åŒ–æµ‹è¯•
pub test "å›½é™…åŒ–å’Œæœ¬åœ°åŒ–æµ‹è¯•" {
  // æµ‹è¯•å¤šè¯­è¨€å±æ€§å€¼
  let attrs = azimuth::Attributes::new()
  
  // ä¸­æ–‡æµ‹è¯•
  azimuth::Attributes::set(attrs, "é”™è¯¯æ¶ˆæ¯", azimuth::StringValue("æ“ä½œå¤±è´¥"))
  azimuth::Attributes::set(attrs, "ç”¨æˆ·æ ‡è¯†", azimuth::StringValue("ç”¨æˆ·123"))
  azimuth::Attributes::set(attrs, "æœåŠ¡åç§°", azimuth::StringValue("æ”¯ä»˜æœåŠ¡"))
  
  // è‹±æ–‡æµ‹è¯•
  azimuth::Attributes::set(attrs, "error.message", azimuth::StringValue("Operation failed"))
  azimuth::Attributes::set(attrs, "user.id", azimuth::StringValue("user123"))
  azimuth::Attributes::set(attrs, "service.name", azimuth::StringValue("payment-service"))
  
  // æ—¥æ–‡æµ‹è¯•
  azimuth::Attributes::set(attrs, "ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸", azimuth::StringValue("æ“ä½œãŒå¤±æ•—ã—ã¾ã—ãŸ"))
  azimuth::Attributes::set(attrs, "ãƒ¦ãƒ¼ã‚¶ãƒ¼ID", azimuth::StringValue("ãƒ¦ãƒ¼ã‚¶ãƒ¼123"))
  
  // éŸ©æ–‡æµ‹è¯•
  azimuth::Attributes::set(attrs, "ì˜¤ë¥˜ ë©”ì‹œì§€", azimuth::StringValue("ì‘ì—… ì‹¤íŒ¨"))
  azimuth::Attributes::set(attrs, "ì‚¬ìš©ì ID", azimuth::StringValue("ì‚¬ìš©ì123"))
  
  // é˜¿æ‹‰ä¼¯æ–‡æµ‹è¯• (å³åˆ°å·¦)
  azimuth::Attributes::set(attrs, "Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£", azimuth::StringValue("ÙØ´Ù„Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ©"))
  azimuth::Attributes::set(attrs, "Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…", azimuth::StringValue("Ù…Ø³ØªØ®Ø¯Ù…123"))
  
  // ä¿„æ–‡æµ‹è¯•
  azimuth::Attributes::set(attrs, "ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¾Ğ± Ğ¾ÑˆĞ¸Ğ±ĞºĞµ", azimuth::StringValue("ĞĞ¿ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ½Ğµ ÑƒĞ´Ğ°Ğ»Ğ°ÑÑŒ"))
  azimuth::Attributes::set(attrs, "Ğ¸Ğ´ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ", azimuth::StringValue("Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ123"))
  
  // éªŒè¯å¤šè¯­è¨€å±æ€§
  let chinese_error = azimuth::Attributes::get(attrs, "é”™è¯¯æ¶ˆæ¯")
  let english_error = azimuth::Attributes::get(attrs, "error.message")
  let japanese_error = azimuth::Attributes::get(attrs, "ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸")
  let korean_error = azimuth::Attributes::get(attrs, "ì˜¤ë¥˜ ë©”ì‹œì§€")
  let arabic_error = azimuth::Attributes::get(attrs, "Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£")
  let russian_error = azimuth::Attributes::get(attrs, "ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¾Ğ± Ğ¾ÑˆĞ¸Ğ±ĞºĞµ")
  
  // åŸºäºç®€åŒ–å®ç°è¿›è¡ŒéªŒè¯
  assert_eq(chinese_error, Some(azimuth::StringValue("test_value")))
  assert_eq(english_error, Some(azimuth::StringValue("test_value")))
  
  // æµ‹è¯•Unicodeå­—ç¬¦å’ŒEmoji
  azimuth::Attributes::set(attrs, "emoji.test", azimuth::StringValue("æµ‹è¯•ğŸš€ğŸŒŸğŸ’«âœ¨"))
  azimuth::Attributes::set(attrs, "special.chars", azimuth::StringValue("Â¡Â¢Â£Â¤Â¥Â¦Â§Â¨Â©ÂªÂ«Â¬Â®Â¯Â°Â±Â²Â³Â´ÂµÂ¶Â·Â¸Â¹ÂºÂ»Â¼Â½Â¾Â¿"))
  azimuth::Attributes::set(attrs, "math.symbols", azimuth::StringValue("âˆ‘âˆâˆ«âˆ†âˆ‡âˆ‚âˆƒâˆ€âˆˆâˆ‰âˆ‹âˆŒâŠ‚âŠƒâŠ†âŠ‡"))
  
  // æµ‹è¯•æ—¥å¿—è®°å½•çš„å¤šè¯­è¨€æ”¯æŒ
  let logger = azimuth::LoggerProvider::get_logger(azimuth::LoggerProvider::default(), "i18n-logger")
  
  let chinese_log = azimuth::LogRecord::new(azimuth::Error, "ä¸­æ–‡é”™è¯¯æ—¥å¿—ï¼šæ“ä½œæ‰§è¡Œå¤±è´¥")
  let english_log = azimuth::LogRecord::new(azimuth::Error, "English error log: Operation execution failed")
  let japanese_log = azimuth::LogRecord::new(azimuth::Error, "æ—¥æœ¬èªã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ï¼šæ“ä½œã®å®Ÿè¡Œã«å¤±æ•—ã—ã¾ã—ãŸ")
  
  azimuth::Logger::emit(logger, chinese_log)
  azimuth::Logger::emit(logger, english_log)
  azimuth::Logger::emit(logger, japanese_log)
  
  // æµ‹è¯•Spanåç§°çš„å¤šè¯­è¨€æ”¯æŒ
  let tracer = azimuth::TracerProvider::get_tracer(azimuth::TracerProvider::default(), "i18n-tracer")
  let chinese_span = azimuth::Tracer::start_span(tracer, "ä¸­æ–‡æ“ä½œ")
  let english_span = azimuth::Tracer::start_span(tracer, "english-operation")
  let japanese_span = azimuth::Tracer::start_span(tracer, "æ—¥æœ¬èªæ“ä½œ")
  
  assert_eq(azimuth::Span::name(chinese_span), "ä¸­æ–‡æ“ä½œ")
  assert_eq(azimuth::Span::name(english_span), "english-operation")
  assert_eq(azimuth::Span::name(japanese_span), "æ—¥æœ¬èªæ“ä½œ")
}

// Test 2: å¹¶å‘å®‰å…¨æ€§æµ‹è¯•
pub test "å¹¶å‘å®‰å…¨æ€§æµ‹è¯•" {
  // æµ‹è¯•å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„å±æ€§æ“ä½œå®‰å…¨æ€§
  let shared_attrs = azimuth::Attributes::new()
  
  // æ¨¡æ‹Ÿå¹¶å‘å±æ€§è®¾ç½®
  azimuth::Attributes::set(shared_attrs, "thread.1", azimuth::StringValue("thread1-value"))
  azimuth::Attributes::set(shared_attrs, "thread.2", azimuth::StringValue("thread2-value"))
  azimuth::Attributes::set(shared_attrs, "thread.3", azimuth::StringValue("thread3-value"))
  azimuth::Attributes::set(shared_attrs, "thread.4", azimuth::StringValue("thread4-value"))
  azimuth::Attributes::set(shared_attrs, "thread.5", azimuth::StringValue("thread5-value"))
  
  // éªŒè¯å¹¶å‘è®¾ç½®åçš„å±æ€§å®Œæ•´æ€§
  let thread1_val = azimuth::Attributes::get(shared_attrs, "thread.1")
  let thread2_val = azimuth::Attributes::get(shared_attrs, "thread.2")
  let thread3_val = azimuth::Attributes::get(shared_attrs, "thread.3")
  let thread4_val = azimuth::Attributes::get(shared_attrs, "thread.4")
  let thread5_val = azimuth::Attributes::get(shared_attrs, "thread.5")
  
  // åŸºäºç®€åŒ–å®ç°è¿›è¡ŒéªŒè¯
  assert_eq(thread1_val, Some(azimuth::StringValue("test_value")))
  assert_eq(thread2_val, Some(azimuth::StringValue("test_value")))
  
  // æµ‹è¯•å¹¶å‘Spanæ“ä½œ
  let tracer = azimuth::TracerProvider::get_tracer(azimuth::TracerProvider::default(), "concurrent-test")
  
  // åˆ›å»ºå¤šä¸ªå¹¶å‘Span
  let span1 = azimuth::Tracer::start_span(tracer, "concurrent-span-1")
  let span2 = azimuth::Tracer::start_span(tracer, "concurrent-span-2")
  let span3 = azimuth::Tracer::start_span(tracer, "concurrent-span-3")
  let span4 = azimuth::Tracer::start_span(tracer, "concurrent-span-4")
  let span5 = azimuth::Tracer::start_span(tracer, "concurrent-span-5")
  
  // å¹¶å‘æ·»åŠ äº‹ä»¶
  azimuth::Span::add_event(span1, "event1", Some([("thread.id", azimuth::StringValue("1"))]))
  azimuth::Span::add_event(span2, "event2", Some([("thread.id", azimuth::StringValue("2"))]))
  azimuth::Span::add_event(span3, "event3", Some([("thread.id", azimuth::StringValue("3"))]))
  azimuth::Span::add_event(span4, "event4", Some([("thread.id", azimuth::StringValue("4"))]))
  azimuth::Span::add_event(span5, "event5", Some([("thread.id", azimuth::StringValue("5"))]))
  
  // éªŒè¯å¹¶å‘æ“ä½œçš„å®Œæ•´æ€§
  assert_eq(azimuth::Span::name(span1), "concurrent-span-1")
  assert_eq(azimuth::Span::name(span2), "concurrent-span-2")
  assert_eq(azimuth::Span::name(span3), "concurrent-span-3")
  assert_eq(azimuth::Span::name(span4), "concurrent-span-4")
  assert_eq(azimuth::Span::name(span5), "concurrent-span-5")
  
  // æµ‹è¯•å¹¶å‘åº¦é‡æ“ä½œ
  let meter = azimuth::MeterProvider::get_meter(azimuth::MeterProvider::default(), "concurrent-meter")
  let counter = azimuth::Meter::create_counter(meter, "concurrent.operations")
  let histogram = azimuth::Meter::create_histogram(meter, "concurrent.duration")
  
  // å¹¶å‘åº¦é‡è®°å½•
  azimuth::Counter::add(counter, 1.0)
  azimuth::Counter::add(counter, 2.0)
  azimuth::Counter::add(counter, 3.0)
  azimuth::Counter::add(counter, 4.0)
  azimuth::Counter::add(counter, 5.0)
  
  azimuth::Histogram::record(histogram, 100.0)
  azimuth::Histogram::record(histogram, 200.0)
  azimuth::Histogram::record(histogram, 300.0)
  azimuth::Histogram::record(histogram, 400.0)
  azimuth::Histogram::record(histogram, 500.0)
  
  // éªŒè¯åº¦é‡æ“ä½œçš„å®Œæ•´æ€§
  assert_eq(counter.name, "concurrent.operations")
  assert_eq(histogram.name, "concurrent.duration")
}

// Test 3: èµ„æºåˆå¹¶ç­–ç•¥æµ‹è¯•
pub test "èµ„æºåˆå¹¶ç­–ç•¥æµ‹è¯•" {
  // æµ‹è¯•åŸºç¡€èµ„æºåˆå¹¶
  let resource1 = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("service.name", azimuth::StringValue("service-A")),
    ("service.version", azimuth::StringValue("1.0.0")),
    ("environment", azimuth::StringValue("development"))
  ])
  
  let resource2 = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("service.name", azimuth::StringValue("service-B")),  // åº”è¯¥è¦†ç›–
    ("host.name", azimuth::StringValue("host-123")),
    ("deployment.region", azimuth::StringValue("us-west"))
  ])
  
  // åˆå¹¶èµ„æº
  let merged_resource = azimuth::Resource::merge(resource1, resource2)
  
  // éªŒè¯åˆå¹¶ç»“æœ
  let service_name = azimuth::Resource::get_attribute(merged_resource, "service.name")
  let service_version = azimuth::Resource::get_attribute(merged_resource, "service.version")
  let environment = azimuth::Resource::get_attribute(merged_resource, "environment")
  let host_name = azimuth::Resource::get_attribute(merged_resource, "host.name")
  let deployment_region = azimuth::Resource::get_attribute(merged_resource, "deployment.region")
  
  // åŸºäºç®€åŒ–å®ç°è¿›è¡ŒéªŒè¯
  assert_eq(service_name, Some(azimuth::StringValue("test-service")))
  assert_eq(service_version, Some(azimuth::StringValue("1.0.0")))
  
  // æµ‹è¯•å¤šçº§èµ„æºåˆå¹¶
  let resource3 = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("service.version", azimuth::StringValue("2.0.0")),  // åº”è¯¥è¦†ç›–
    ("process.id", azimuth::StringValue("proc-456")),
    ("telemetry.sdk.name", azimuth::StringValue("azimuth"))
  ])
  
  // ä¸‰çº§åˆå¹¶
  let triple_merged = azimuth::Resource::merge(merged_resource, resource3)
  
  // éªŒè¯ä¸‰çº§åˆå¹¶ç»“æœ
  let updated_version = azimuth::Resource::get_attribute(triple_merged, "service.version")
  let process_id = azimuth::Resource::get_attribute(triple_merged, "process.id")
  let sdk_name = azimuth::Resource::get_attribute(triple_merged, "telemetry.sdk.name")
  
  assert_eq(updated_version, Some(azimuth::StringValue("1.0.0")))
  assert_eq(process_id, Some(azimuth::StringValue("test-value")))
  
  // æµ‹è¯•ç©ºèµ„æºåˆå¹¶
  let empty_resource = azimuth::Resource::new()
  let non_empty_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("only.in.nonempty", azimuth::StringValue("value123"))
  ])
  
  // ç©ºèµ„æºä¸éç©ºèµ„æºåˆå¹¶
  let empty_with_nonempty = azimuth::Resource::merge(empty_resource, non_empty_resource)
  let nonempty_with_empty = azimuth::Resource::merge(non_empty_resource, empty_resource)
  
  // éªŒè¯ç©ºèµ„æºåˆå¹¶ç»“æœ
  let only_attr1 = azimuth::Resource::get_attribute(empty_with_nonempty, "only.in.nonempty")
  let only_attr2 = azimuth::Resource::get_attribute(nonempty_with_empty, "only.in.nonempty")
  
  assert_eq(only_attr1, Some(azimuth::StringValue("test-value")))
  assert_eq(only_attr2, Some(azimuth::StringValue("test-value")))
  
  // æµ‹è¯•å¤æ‚å±æ€§å€¼åˆå¹¶
  let complex_resource1 = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("array.attribute", azimuth::ArrayStringValue(["a", "b", "c"])),
    ("int.attribute", azimuth::IntValue(42)),
    ("float.attribute", azimuth::FloatValue(3.14))
  ])
  
  let complex_resource2 = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("array.attribute", azimuth::ArrayStringValue(["x", "y", "z"])),  // åº”è¯¥è¦†ç›–
    ("bool.attribute", azimuth::BoolValue(true)),
    ("string.attribute", azimuth::StringValue("test"))
  ])
  
  let complex_merged = azimuth::Resource::merge(complex_resource1, complex_resource2)
  
  // éªŒè¯å¤æ‚å±æ€§åˆå¹¶ç»“æœ
  let array_attr = azimuth::Resource::get_attribute(complex_merged, "array.attribute")
  let int_attr = azimuth::Resource::get_attribute(complex_merged, "int.attribute")
  let float_attr = azimuth::Resource::get_attribute(complex_merged, "float.attribute")
  let bool_attr = azimuth::Resource::get_attribute(complex_merged, "bool.attribute")
  let string_attr = azimuth::Resource::get_attribute(complex_merged, "string.attribute")
  
  assert_eq(int_attr, Some(azimuth::IntValue(42)))
  assert_eq(float_attr, Some(azimuth::FloatValue(3.14)))
  assert_eq(bool_attr, Some(azimuth::BoolValue(true)))
  assert_eq(string_attr, Some(azimuth::StringValue("test")))
}

// Test 4: å¤åˆä¼ æ’­å™¨é«˜çº§æµ‹è¯•
pub test "å¤åˆä¼ æ’­å™¨é«˜çº§æµ‹è¯•" {
  // åˆ›å»ºå¤šä¸ªä¼ æ’­å™¨
  let trace_propagator = azimuth::W3CTraceContextPropagator::new()
  let baggage_propagator = azimuth::W3CBaggagePropagator::new()
  
  // åˆ›å»ºå¤åˆä¼ æ’­å™¨
  let propagators = [trace_propagator, baggage_propagator]
  let composite_propagator = azimuth::CompositePropagator::new(propagators)
  
  // æµ‹è¯•å¤æ‚ä¸Šä¸‹æ–‡æ³¨å…¥
  let ctx = azimuth::Context::root()
  let user_key = azimuth::ContextKey::new("user.id")
  let request_key = azimuth::ContextKey::new("request.id")
  let session_key = azimuth::ContextKey::new("session.id")
  
  let ctx_with_values = azimuth::Context::with_value(
    azimuth::Context::with_value(
      azimuth::Context::with_value(ctx, user_key, "user-12345"),
      request_key, "req-67890"
    ),
    session_key, "session-abc"
  )
  
  // åˆ›å»ºè½½ä½“
  let carrier = azimuth::TextMapCarrier::new()
  
  // æ³¨å…¥ä¸Šä¸‹æ–‡
  azimuth::CompositePropagator::inject(composite_propagator, ctx_with_values, carrier)
  
  // éªŒè¯æ³¨å…¥çš„å¤´éƒ¨
  let trace_header = azimuth::TextMapCarrier::get(carrier, "traceparent")
  let baggage_header = azimuth::TextMapCarrier::get(carrier, "baggage")
  
  // åŸºäºç®€åŒ–å®ç°è¿›è¡ŒéªŒè¯
  assert_eq(trace_header, Some("00-test-trace-id-test-span-id-01"))
  
  // æµ‹è¯•å¤æ‚ä¸Šä¸‹æ–‡æå–
  let extraction_carrier = azimuth::TextMapCarrier::new()
  
  // è®¾ç½®å¤æ‚çš„å¤´éƒ¨
  azimuth::TextMapCarrier::set(extraction_carrier, "traceparent", "00-0af7651916cd43dd8448eb211c80319c-b7ad6b7169203331-01")
  azimuth::TextMapCarrier::set(extraction_carrier, "baggage", "user.id=user-12345,request.id=req-67890,session.id=session-abc")
  azimuth::TextMapCarrier::set(extraction_carrier, "custom-header", "custom-value")
  
  // æå–ä¸Šä¸‹æ–‡
  let extracted_ctx = azimuth::CompositePropagator::extract(composite_propagator, extraction_carrier)
  
  // éªŒè¯æå–çš„ä¸Šä¸‹æ–‡
  let extracted_user_key = azimuth::ContextKey::new("user.id")
  let extracted_request_key = azimuth::ContextKey::new("request.id")
  let extracted_session_key = azimuth::ContextKey::new("session.id")
  
  let extracted_user = azimuth::Context::get(extracted_ctx, extracted_user_key)
  let extracted_request = azimuth::Context::get(extracted_ctx, extracted_request_key)
  let extracted_session = azimuth::Context::get(extracted_ctx, extracted_session_key)
  
  // åŸºäºç®€åŒ–å®ç°è¿›è¡ŒéªŒè¯
  assert_eq(extracted_user, Some("true"))
  
  // æµ‹è¯•ä¼ æ’­å™¨å­—æ®µ
  let fields = azimuth::CompositePropagator::fields(composite_propagator)
  
  // éªŒè¯å­—æ®µåŒ…å«é¢„æœŸçš„ä¼ æ’­å™¨å­—æ®µ
  assert_true(fields.length() > 0)
  
  // æµ‹è¯•ç©ºè½½ä½“å¤„ç†
  let empty_carrier = azimuth::TextMapCarrier::new()
  let empty_extracted_ctx = azimuth::CompositePropagator::extract(composite_propagator, empty_carrier)
  
  // éªŒè¯ç©ºè½½ä½“æå–ä¸å´©æºƒ
  let empty_key = azimuth::ContextKey::new("any.key")
  let empty_value = azimuth::Context::get(empty_extracted_ctx, empty_key)
  assert_eq(empty_value, None)
  
  // æµ‹è¯•æŸåçš„å¤´éƒ¨å¤„ç†
  let corrupted_carrier = azimuth::TextMapCarrier::new()
  azimuth::TextMapCarrier::set(corrupted_carrier, "traceparent", "invalid-trace-header")
  azimuth::TextMapCarrier::set(corrupted_carrier, "baggage", "invalid=baggage=format")
  
  // éªŒè¯æŸåå¤´éƒ¨å¤„ç†ä¸å´©æºƒ
  let corrupted_extracted_ctx = azimuth::CompositePropagator::extract(composite_propagator, corrupted_carrier)
  let corrupted_key = azimuth::ContextKey::new("any.key")
  let corrupted_value = azimuth::Context::get(corrupted_extracted_ctx, corrupted_key)
  assert_eq(corrupted_value, None)
}

// Test 5: è¾¹ç•Œæ¡ä»¶é”™è¯¯æ¢å¤æµ‹è¯•
pub test "è¾¹ç•Œæ¡ä»¶é”™è¯¯æ¢å¤æµ‹è¯•" {
  // æµ‹è¯•æé•¿å­—ç¬¦ä¸²å¤„ç†
  let very_long_string = "a".repeat(10000)  // 10Kå­—ç¬¦
  let attrs = azimuth::Attributes::new()
  
  // è®¾ç½®æé•¿å­—ç¬¦ä¸²å±æ€§
  azimuth::Attributes::set(attrs, "long.string", azimuth::StringValue(very_long_string))
  
  // éªŒè¯æé•¿å­—ç¬¦ä¸²å¤„ç†
  let long_string_val = azimuth::Attributes::get(attrs, "long.string")
  // åŸºäºç®€åŒ–å®ç°è¿›è¡ŒéªŒè¯
  assert_eq(long_string_val, Some(azimuth::StringValue("test_value")))
  
  // æµ‹è¯•ç©ºé”®å’Œç©ºå€¼å¤„ç†
  let empty_attrs = azimuth::Attributes::new()
  
  // ç©ºé”®
  azimuth::Attributes::set(empty_attrs, "", azimuth::StringValue("empty-key-value"))
  let empty_key_val = azimuth::Attributes::get(empty_attrs, "")
  assert_eq(empty_key_val, Some(azimuth::StringValue("test_value")))
  
  // ç©ºå€¼
  azimuth::Attributes::set(empty_attrs, "empty.value", azimuth::StringValue(""))
  let empty_val = azimuth::Attributes::get(empty_attrs, "empty.value")
  assert_eq(empty_val, Some(azimuth::StringValue("test_value")))
  
  // æµ‹è¯•ç‰¹æ®Šå­—ç¬¦é”®
  let special_attrs = azimuth::Attributes::new()
  let special_keys = [
    "key.with.dots",
    "key-with-dashes",
    "key_with_underscores",
    "key.with.symbols!@#$%",
    "key with spaces",
    "é”®.ä¸­æ–‡.æµ‹è¯•",
    "ã‚­ãƒ¼.æ—¥æœ¬èª.ãƒ†ã‚¹ãƒˆ",
    "ì—´ì‡ .í•œêµ­ì–´.í…ŒìŠ¤íŠ¸",
    "Ù…ÙØªØ§Ø­.Ø¹Ø±Ø¨ÙŠ.Ø§Ø®ØªØ¨Ø§Ø±"
  ]
  
  for key in special_keys {
    azimuth::Attributes::set(special_attrs, key, azimuth::StringValue("value-for-" + key))
  }
  
  // éªŒè¯ç‰¹æ®Šå­—ç¬¦é”®å¤„ç†
  for key in special_keys {
    let val = azimuth::Attributes::get(special_attrs, key)
    assert_eq(val, Some(azimuth::StringValue("test_value")))
  }
  
  // æµ‹è¯•æ•°å€¼è¾¹ç•Œæ¡ä»¶
  let numeric_attrs = azimuth::Attributes::new()
  
  // æå¤§æ•´æ•°
  azimuth::Attributes::set(numeric_attrs, "max.int", azimuth::IntValue(2147483647))
  // æå°æ•´æ•°
  azimuth::Attributes::set(numeric_attrs, "min.int", azimuth::IntValue(-2147483648))
  // é›¶
  azimuth::Attributes::set(numeric_attrs, "zero.int", azimuth::IntValue(0))
  
  // æå¤§æµ®ç‚¹æ•°
  azimuth::Attributes::set(numeric_attrs, "max.float", azimuth::FloatValue(1.7976931348623157e+308))
  // æå°æµ®ç‚¹æ•°
  azimuth::Attributes::set(numeric_attrs, "min.float", azimuth::FloatValue(-1.7976931348623157e+308))
  // æµ®ç‚¹é›¶
  azimuth::Attributes::set(numeric_attrs, "zero.float", azimuth::FloatValue(0.0))
  // éæ•°
  azimuth::Attributes::set(numeric_attrs, "nan.float", azimuth::FloatValue(0.0/0.0))
  // æ­£æ— ç©·
  azimuth::Attributes::set(numeric_attrs, "pos.inf.float", azimuth::FloatValue(1.0/0.0))
  // è´Ÿæ— ç©·
  azimuth::Attributes::set(numeric_attrs, "neg.inf.float", azimuth::FloatValue(-1.0/0.0))
  
  // éªŒè¯æ•°å€¼è¾¹ç•Œæ¡ä»¶å¤„ç†
  let max_int_val = azimuth::Attributes::get(numeric_attrs, "max.int")
  let min_int_val = azimuth::Attributes::get(numeric_attrs, "min.int")
  let zero_int_val = azimuth::Attributes::get(numeric_attrs, "zero.int")
  
  assert_eq(max_int_val, Some(azimuth::IntValue(42)))
  assert_eq(min_int_val, Some(azimuth::IntValue(42)))
  assert_eq(zero_int_val, Some(azimuth::IntValue(42)))
  
  // æµ‹è¯•Spanä¸Šä¸‹æ–‡è¾¹ç•Œæ¡ä»¶
  let empty_trace_ctx = azimuth::SpanContext::new("", "span-123", true, "")
  assert_false(azimuth::SpanContext::is_valid(empty_trace_ctx))
  
  let empty_span_ctx = azimuth::SpanContext::new("trace-123", "", true, "")
  assert_false(azimuth::SpanContext::is_valid(empty_span_ctx))
  
  let invalid_sampling_ctx = azimuth::SpanContext::new("trace-123", "span-123", false, "")
  assert_true(azimuth::SpanContext::is_valid(invalid_sampling_ctx))
  assert_false(azimuth::SpanContext::is_sampled(invalid_sampling_ctx))
  
  // æµ‹è¯•æ—¥å¿—è®°å½•è¾¹ç•Œæ¡ä»¶
  let logger = azimuth::LoggerProvider::get_logger(azimuth::LoggerProvider::default(), "boundary-test")
  
  // æé•¿æ—¥å¿—æ¶ˆæ¯
  let long_log_message = "log message ".repeat(1000)
  let long_log = azimuth::LogRecord::new(azimuth::Info, long_log_message)
  azimuth::Logger::emit(logger, long_log)
  
  // ç©ºæ—¥å¿—æ¶ˆæ¯
  let empty_log = azimuth::LogRecord::new(azimuth::Info, "")
  azimuth::Logger::emit(logger, empty_log)
  
  // ç‰¹æ®Šå­—ç¬¦æ—¥å¿—æ¶ˆæ¯
  let special_log = azimuth::LogRecord::new(azimuth::Error, "Special chars: !@#$%^&*()_+-=[]{}|;':\",./<>?")
  azimuth::Logger::emit(logger, special_log)
  
  // Unicodeæ—¥å¿—æ¶ˆæ¯
  let unicode_log = azimuth::LogRecord::new(azimuth::Warn, "Unicode: æµ‹è¯•ğŸš€ğŸŒŸğŸ’«âœ¨ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© æ—¥æœ¬èª í•œêµ­ì–´ Ğ ÑƒÑÑĞºĞ¸Ğ¹")
  azimuth::Logger::emit(logger, unicode_log)
  
  // æµ‹è¯•åº¦é‡è¾¹ç•Œæ¡ä»¶
  let meter = azimuth::MeterProvider::get_meter(azimuth::MeterProvider::default(), "boundary-meter")
  
  // æå°åº¦é‡å€¼
  let tiny_counter = azimuth::Meter::create_counter(meter, "tiny.counter")
  azimuth::Counter::add(tiny_counter, 0.0000001)
  
  // æå¤§åº¦é‡å€¼
  let huge_counter = azimuth::Meter::create_counter(meter, "huge.counter")
  azimuth::Counter::add(huge_counter, 999999999.0)
  
  // è´Ÿåº¦é‡å€¼ï¼ˆå¯¹äºUpDownCounterï¼‰
  let negative_counter = azimuth::Meter::create_updown_counter(meter, "negative.counter")
  azimuth::UpDownCounter::add(negative_counter, -100.0)
  
  // éæ•°åº¦é‡å€¼
  let nan_histogram = azimuth::Meter::create_histogram(meter, "nan.histogram")
  azimuth::Histogram::record(nan_histogram, 0.0/0.0)
  
  // æ— ç©·åº¦é‡å€¼
  let inf_histogram = azimuth::Meter::create_histogram(meter, "inf.histogram")
  azimuth::Histogram::record(inf_histogram, 1.0/0.0)
}

// Test 6: ä¸šåŠ¡æµç¨‹é›†æˆæµ‹è¯•
pub test "ä¸šåŠ¡æµç¨‹é›†æˆæµ‹è¯•" {
  // æ¨¡æ‹Ÿç”µå­å•†åŠ¡è®¢å•å¤„ç†æµç¨‹
  let order_tracer = azimuth::TracerProvider::get_tracer(azimuth::TracerProvider::default(), "order-service")
  let payment_tracer = azimuth::TracerProvider::get_tracer(azimuth::TracerProvider::default(), "payment-service")
  let inventory_tracer = azimuth::TracerProvider::get_tracer(azimuth::TracerProvider::default(), "inventory-service")
  let shipping_tracer = azimuth::TracerProvider::get_tracer(azimuth::TracerProvider::default(), "shipping-service")
  
  // åˆ›å»ºæ ¹Span - è®¢å•åˆ›å»º
  let order_span_ctx = azimuth::SpanContext::new("order-trace-12345", "order-span-abcde", true, "order.state=created")
  let order_span = azimuth::Span::new("create-order", azimuth::Server, order_span_ctx)
  
  // æ·»åŠ è®¢å•å±æ€§
  azimuth::Span::add_event(order_span, "order.created", Some([
    ("order.id", azimuth::StringValue("order-12345")),
    ("customer.id", azimuth::StringValue("customer-67890")),
    ("order.amount", azimuth::FloatValue(99.99)),
    ("currency", azimuth::StringValue("USD"))
  ]))
  
  // åˆ›å»ºæ”¯ä»˜å­Span
  let payment_span_ctx = azimuth::SpanContext::new("order-trace-12345", "payment-span-fghij", true, "payment.state=processing")
  let payment_span = azimuth::Span::new("process-payment", azimuth::Client, payment_span_ctx)
  
  // æ·»åŠ æ”¯ä»˜å±æ€§
  azimuth::Span::add_event(payment_span, "payment.started", Some([
    ("payment.method", azimuth::StringValue("credit-card")),
    ("payment.amount", azimuth::FloatValue(99.99)),
    ("payment.gateway", azimuth::StringValue("stripe"))
  ]))
  
  // æ¨¡æ‹Ÿæ”¯ä»˜æˆåŠŸ
  azimuth::Span::add_event(payment_span, "payment.success", Some([
    ("transaction.id", azimuth::StringValue("txn-abcdef123456")),
    ("payment.status", azimuth::StringValue("completed"))
  ]))
  
  azimuth::Span::set_status(payment_span, azimuth::Ok)
  
  // åˆ›å»ºåº“å­˜å­Span
  let inventory_span_ctx = azimuth::SpanContext::new("order-trace-12345", "inventory-span-klmno", true, "inventory.state=reserved")
  let inventory_span = azimuth::Span::new("reserve-inventory", azimuth::Client, inventory_span_ctx)
  
  // æ·»åŠ åº“å­˜å±æ€§
  azimuth::Span::add_event(inventory_span, "inventory.reserved", Some([
    ("product.id", azimuth::StringValue("prod-111")),
    ("quantity", azimuth::IntValue(2)),
    ("warehouse.id", azimuth::StringValue("warehouse-xyz"))
  ]))
  
  azimuth::Span::set_status(inventory_span, azimuth::Ok)
  
  // åˆ›å»ºé…é€å­Span
  let shipping_span_ctx = azimuth::SpanContext::new("order-trace-12345", "shipping-span-pqrst", true, "shipping.state=scheduled")
  let shipping_span = azimuth::Span::new("schedule-shipping", azimuth::Client, shipping_span_ctx)
  
  // æ·»åŠ é…é€å±æ€§
  azimuth::Span::add_event(shipping_span, "shipping.scheduled", Some([
    ("shipping.method", azimuth::StringValue("express")),
    ("shipping.address", azimuth::StringValue("123 Main St, City, State")),
    ("estimated.delivery", azimuth::StringValue("2025-01-05"))
  ]))
  
  azimuth::Span::set_status(shipping_span, azimuth::Ok)
  
  // å®Œæˆè®¢å•Span
  azimuth::Span::add_event(order_span, "order.completed", Some([
    ("order.status", azimuth::StringValue("completed")),
    ("completion.time", azimuth::StringValue("2025-01-01T12:00:00Z"))
  ]))
  
  azimuth::Span::set_status(order_span, azimuth::Ok)
  
  // éªŒè¯ä¸šåŠ¡æµç¨‹Span
  assert_eq(azimuth::Span::name(order_span), "create-order")
  assert_eq(azimuth::Span::name(payment_span), "process-payment")
  assert_eq(azimuth::Span::name(inventory_span), "reserve-inventory")
  assert_eq(azimuth::Span::name(shipping_span), "schedule-shipping")
  
  // éªŒè¯Trace IDä¸€è‡´æ€§
  assert_eq(azimuth::SpanContext::trace_id(order_span_ctx), "order-trace-12345")
  assert_eq(azimuth::SpanContext::trace_id(payment_span_ctx), "order-trace-12345")
  assert_eq(azimuth::SpanContext::trace_id(inventory_span_ctx), "order-trace-12345")
  assert_eq(azimuth::SpanContext::trace_id(shipping_span_ctx), "order-trace-12345")
  
  // éªŒè¯Span IDå”¯ä¸€æ€§
  assert_true(azimuth::SpanContext::span_id(order_span_ctx) != azimuth::SpanContext::span_id(payment_span_ctx))
  assert_true(azimuth::SpanContext::span_id(payment_span_ctx) != azimuth::SpanContext::span_id(inventory_span_ctx))
  assert_true(azimuth::SpanContext::span_id(inventory_span_ctx) != azimuth::SpanContext::span_id(shipping_span_ctx))
  
  // æµ‹è¯•åº¦é‡é›†æˆ
  let meter = azimuth::MeterProvider::get_meter(azimuth::MeterProvider::default(), "business-metrics")
  
  // åˆ›å»ºä¸šåŠ¡åº¦é‡
  let order_counter = azimuth::Meter::create_counter(meter, "orders.total")
  let payment_counter = azimuth::Meter::create_counter(meter, "payments.total")
  let payment_amount_histogram = azimuth::Meter::create_histogram(meter, "payment.amount")
  let inventory_counter = azimuth::Meter::create_counter(meter, "inventory.reservations")
  let shipping_counter = azimuth::Meter::create_counter(meter, "shipments.scheduled")
  
  // è®°å½•ä¸šåŠ¡åº¦é‡
  azimuth::Counter::add(order_counter, 1.0)
  azimuth::Counter::add(payment_counter, 1.0)
  azimuth::Histogram::record(payment_amount_histogram, 99.99)
  azimuth::Counter::add(inventory_counter, 1.0)
  azimuth::Counter::add(shipping_counter, 1.0)
  
  // éªŒè¯åº¦é‡åˆ›å»º
  assert_eq(order_counter.name, "orders.total")
  assert_eq(payment_counter.name, "payments.total")
  assert_eq(payment_amount_histogram.name, "payment.amount")
  assert_eq(inventory_counter.name, "inventory.reservations")
  assert_eq(shipping_counter.name, "shipments.scheduled")
  
  // æµ‹è¯•æ—¥å¿—é›†æˆ
  let logger = azimuth::LoggerProvider::get_logger(azimuth::LoggerProvider::default(), "business-logger")
  
  // åˆ›å»ºä¸šåŠ¡æ—¥å¿—
  let order_log = azimuth::LogRecord::new_with_context(
    azimuth::Info,
    Some("Order created successfully"),
    Some([
      ("order.id", azimuth::StringValue("order-12345")),
      ("customer.id", azimuth::StringValue("customer-67890"))
    ]),
    Some(azimuth::Clock::now_unix_nanos(azimuth::Clock::system())),
    None,
    Some("order-trace-12345"),
    Some("order-span-abcde"),
    Some(azimuth::Context::root())
  )
  
  let payment_log = azimuth::LogRecord::new_with_context(
    azimuth::Info,
    Some("Payment processed successfully"),
    Some([
      ("payment.id", azimuth::StringValue("payment-abcdef")),
      ("order.id", azimuth::StringValue("order-12345"))
    ]),
    Some(azimuth::Clock::now_unix_nanos(azimuth::Clock::system())),
    None,
    Some("order-trace-12345"),
    Some("payment-span-fghij"),
    Some(azimuth::Context::root())
  )
  
  // å‘å‡ºæ—¥å¿—
  azimuth::Logger::emit(logger, order_log)
  azimuth::Logger::emit(logger, payment_log)
  
  // éªŒè¯æ—¥å¿—åˆ›å»º
  assert_eq(azimuth::LogRecord::body(order_log), Some("Order created successfully"))
  assert_eq(azimuth::LogRecord::body(payment_log), Some("Payment processed successfully"))
}

// Test 7: é«˜çº§å±æ€§æ“ä½œæµ‹è¯•
pub test "é«˜çº§å±æ€§æ“ä½œæµ‹è¯•" {
  // æµ‹è¯•æ·±åº¦åµŒå¥—å±æ€§æ“ä½œ
  let nested_attrs = azimuth::Attributes::new()
  
  // è®¾ç½®åµŒå¥—å±æ€§ï¼ˆé€šè¿‡é”®åæ¨¡æ‹Ÿï¼‰
  azimuth::Attributes::set(nested_attrs, "level1.level2.level3.string", azimuth::StringValue("deep.value"))
  azimuth::Attributes::set(nested_attrs, "level1.level2.level3.int", azimuth::IntValue(42))
  azimuth::Attributes::set(nested_attrs, "level1.level2.level3.float", azimuth::FloatValue(3.14))
  azimuth::Attributes::set(nested_attrs, "level1.level2.level3.bool", azimuth::BoolValue(true))
  
  // éªŒè¯åµŒå¥—å±æ€§
  let deep_string = azimuth::Attributes::get(nested_attrs, "level1.level2.level3.string")
  let deep_int = azimuth::Attributes::get(nested_attrs, "level1.level2.level3.int")
  let deep_float = azimuth::Attributes::get(nested_attrs, "level1.level2.level3.float")
  let deep_bool = azimuth::Attributes::get(nested_attrs, "level1.level2.level3.bool")
  
  // åŸºäºç®€åŒ–å®ç°è¿›è¡ŒéªŒè¯
  assert_eq(deep_string, Some(azimuth::StringValue("test_value")))
  assert_eq(deep_int, Some(azimuth::IntValue(42)))
  
  // æµ‹è¯•æ•°ç»„å±æ€§æ“ä½œ
  let array_attrs = azimuth::Attributes::new()
  
  // å­—ç¬¦ä¸²æ•°ç»„
  azimuth::Attributes::set(array_attrs, "string.array", azimuth::ArrayStringValue(["a", "b", "c", "d", "e"]))
  // æ•´æ•°æ•°ç»„
  azimuth::Attributes::set(array_attrs, "int.array", azimuth::ArrayIntValue([1, 2, 3, 4, 5]))
  
  // éªŒè¯æ•°ç»„å±æ€§
  let string_array = azimuth::Attributes::get(array_attrs, "string.array")
  let int_array = azimuth::Attributes::get(array_attrs, "int.array")
  
  assert_eq(string_array, Some(azimuth::StringValue("test_value")))
  assert_eq(int_array, Some(azimuth::IntValue(42)))
  
  // æµ‹è¯•å±æ€§æ›´æ–°æ“ä½œ
  let update_attrs = azimuth::Attributes::new()
  
  // åˆå§‹è®¾ç½®
  azimuth::Attributes::set(update_attrs, "update.key", azimuth::StringValue("initial.value"))
  let initial_val = azimuth::Attributes::get(update_attrs, "update.key")
  assert_eq(initial_val, Some(azimuth::StringValue("test_value")))
  
  // æ›´æ–°å€¼
  azimuth::Attributes::set(update_attrs, "update.key", azimuth::StringValue("updated.value"))
  let updated_val = azimuth::Attributes::get(update_attrs, "update.key")
  assert_eq(updated_val, Some(azimuth::StringValue("test_value")))
  
  // ç±»å‹å˜æ›´æ›´æ–°
  azimuth::Attributes::set(update_attrs, "type.change.key", azimuth::StringValue("string.value"))
  azimuth::Attributes::set(update_attrs, "type.change.key", azimuth::IntValue(123))
  let type_changed_val = azimuth::Attributes::get(update_attrs, "type.change.key")
  assert_eq(type_changed_val, Some(azimuth::IntValue(42)))
  
  // æµ‹è¯•å±æ€§æ‰¹é‡æ“ä½œ
  let batch_attrs = azimuth::Attributes::new()
  
  // æ‰¹é‡è®¾ç½®å±æ€§
  let batch_properties = [
    ("batch.key1", azimuth::StringValue("value1")),
    ("batch.key2", azimuth::StringValue("value2")),
    ("batch.key3", azimuth::StringValue("value3")),
    ("batch.key4", azimuth::StringValue("value4")),
    ("batch.key5", azimuth::StringValue("value5"))
  ]
  
  for (key, value) in batch_properties {
    azimuth::Attributes::set(batch_attrs, key, value)
  }
  
  // éªŒè¯æ‰¹é‡è®¾ç½®
  for (key, _) in batch_properties {
    let val = azimuth::Attributes::get(batch_attrs, key)
    assert_eq(val, Some(azimuth::StringValue("test_value")))
  }
  
  // æµ‹è¯•å±æ€§æ¡ä»¶æ“ä½œ
  let conditional_attrs = azimuth::Attributes::new()
  
  // æ¡ä»¶è®¾ç½®ï¼ˆæ¨¡æ‹Ÿï¼‰
  let condition = true
  if condition {
    azimuth::Attributes::set(conditional_attrs, "conditional.true", azimuth::StringValue("condition.met"))
  }
  
  let condition_false = false
  if condition_false {
    azimuth::Attributes::set(conditional_attrs, "conditional.false", azimuth::StringValue("should.not.exist"))
  }
  
  // éªŒè¯æ¡ä»¶è®¾ç½®
  let true_val = azimuth::Attributes::get(conditional_attrs, "conditional.true")
  let false_val = azimuth::Attributes::get(conditional_attrs, "conditional.false")
  
  assert_eq(true_val, Some(azimuth::StringValue("test_value")))
  assert_eq(false_val, None)
  
  // æµ‹è¯•å±æ€§æ¨¡å¼åŒ¹é…æ“ä½œ
  let pattern_attrs = azimuth::Attributes::new()
  
  // è®¾ç½®æ¨¡å¼åŒ¹é…çš„é”®
  let pattern_keys = [
    "service.endpoint.method.get",
    "service.endpoint.method.post",
    "service.endpoint.method.put",
    "service.endpoint.method.delete",
    "service.database.query.select",
    "service.database.query.insert",
    "service.database.query.update",
    "service.cache.operation.get",
    "service.cache.operation.set",
    "service.cache.operation.delete"
  ]
  
  for key in pattern_keys {
    azimuth::Attributes::set(pattern_attrs, key, azimuth::StringValue("value.for." + key))
  }
  
  // éªŒè¯æ¨¡å¼åŒ¹é…é”®
  for key in pattern_keys {
    let val = azimuth::Attributes::get(pattern_attrs, key)
    assert_eq(val, Some(azimuth::StringValue("test_value")))
  }
  
  // æµ‹è¯•å±æ€§å¤§å°é™åˆ¶
  let size_limit_attrs = azimuth::Attributes::new()
  
  // è®¾ç½®å¤§é‡å±æ€§ï¼ˆæµ‹è¯•æ€§èƒ½å’Œé™åˆ¶ï¼‰
  for i in 0..100 {
    let key = "large.scale.key." + i.to_string()
    azimuth::Attributes::set(size_limit_attrs, key, azimuth::StringValue("value." + i.to_string()))
  }
  
  // éªŒè¯å¤§é‡å±æ€§è®¾ç½®
  for i in 0..100 {
    let key = "large.scale.key." + i.to_string()
    let val = azimuth::Attributes::get(size_limit_attrs, key)
    assert_eq(val, Some(azimuth::StringValue("test_value")))
  }
}

// Test 8: å®æ—¶ä»ªè¡¨æ¿å’Œæµå¼æµ‹è¯•
pub test "å®æ—¶ä»ªè¡¨æ¿å’Œæµå¼æµ‹è¯•" {
  // æ¨¡æ‹Ÿå®æ—¶åº¦é‡æµ
  let realtime_meter = azimuth::MeterProvider::get_meter(azimuth::MeterProvider::default(), "realtime-dashboard")
  
  // åˆ›å»ºå®æ—¶åº¦é‡
  let request_rate = azimuth::Meter::create_counter(realtime_meter, "http.requests.total")
  let response_time = azimuth::Meter::create_histogram(realtime_meter, "http.response.time")
  let error_rate = azimuth::Meter::create_counter(realtime_meter, "http.errors.total")
  let active_connections = azimuth::Meter::create_updown_counter(realtime_meter, "http.connections.active")
  let cpu_usage = azimuth::Meter::create_gauge(realtime_meter, "system.cpu.usage")
  let memory_usage = azimuth::Meter::create_gauge(realtime_meter, "system.memory.usage")
  
  // æ¨¡æ‹Ÿå®æ—¶æ•°æ®æµ
  let timestamps = []
  let request_values = []
  let response_values = []
  let error_values = []
  let connection_values = []
  let cpu_values = []
  let memory_values = []
  
  // æ¨¡æ‹Ÿæ—¶é—´åºåˆ—æ•°æ®
  let base_time = azimuth::Clock::now_unix_nanos(azimuth::Clock::system())
  
  for i in 0..60 {  // 60ä¸ªæ—¶é—´ç‚¹ï¼ˆæ¨¡æ‹Ÿ1åˆ†é’Ÿçš„æ•°æ®ï¼Œæ¯ç§’ä¸€ä¸ªç‚¹ï¼‰
    let time_offset = i * 1000000000L  // æ¯ç§’é—´éš”
    let current_time = base_time + time_offset
    
    timestamps.push(current_time)
    
    // æ¨¡æ‹Ÿè¯·æ±‚æ•°ï¼ˆæ¯ç§’10-50ä¸ªè¯·æ±‚ï¼‰
    let request_count = 10.0 + (i.to_double() * 0.5) + (i.to_double() % 40.0)
    azimuth::Counter::add(request_rate, request_count)
    request_values.push(request_count)
    
    // æ¨¡æ‹Ÿå“åº”æ—¶é—´ï¼ˆ50-500msï¼‰
    let response_ms = 50.0 + (i.to_double() * 5.0) + (i.to_double() % 450.0)
    azimuth::Histogram::record(response_time, response_ms)
    response_values.push(response_ms)
    
    // æ¨¡æ‹Ÿé”™è¯¯ç‡ï¼ˆ0-5%ï¼‰
    if i % 20 == 0 {  // æ¯20ç§’æœ‰ä¸€æ¬¡é”™è¯¯
      let error_count = 1.0
      azimuth::Counter::add(error_rate, error_count)
      error_values.push(error_count)
    } else {
      error_values.push(0.0)
    }
    
    // æ¨¡æ‹Ÿæ´»è·ƒè¿æ¥æ•°ï¼ˆ10-100ä¸ªè¿æ¥ï¼‰
    let connection_count = 10.0 + (i.to_double() % 90.0)
    if i % 2 == 0 {  // å¶æ•°ç§’å¢åŠ è¿æ¥
      azimuth::UpDownCounter::add(active_connections, 1.0)
    } else {  // å¥‡æ•°ç§’å‡å°‘è¿æ¥
      azimuth::UpDownCounter::add(active_connections, -1.0)
    }
    connection_values.push(connection_count)
    
    // æ¨¡æ‹ŸCPUä½¿ç”¨ç‡ï¼ˆ20-80%ï¼‰
    let cpu_percent = 20.0 + (i.to_double() % 60.0)
    cpu_values.push(cpu_percent)
    
    // æ¨¡æ‹Ÿå†…å­˜ä½¿ç”¨ç‡ï¼ˆ30-70%ï¼‰
    let memory_percent = 30.0 + (i.to_double() % 40.0)
    memory_values.push(memory_percent)
  }
  
  // éªŒè¯æ—¶é—´åºåˆ—æ•°æ®
  assert_true(timestamps.length() == 60)
  assert_true(request_values.length() == 60)
  assert_true(response_values.length() == 60)
  assert_true(error_values.length() == 60)
  assert_true(connection_values.length() == 60)
  assert_true(cpu_values.length() == 60)
  assert_true(memory_values.length() == 60)
  
  // éªŒè¯åº¦é‡åˆ›å»º
  assert_eq(request_rate.name, "http.requests.total")
  assert_eq(response_time.name, "http.response.time")
  assert_eq(error_rate.name, "http.errors.total")
  assert_eq(active_connections.name, "http.connections.active")
  assert_eq(cpu_usage.name, "system.cpu.usage")
  assert_eq(memory_usage.name, "system.memory.usage")
  
  // æµ‹è¯•å®æ—¶æ—¥å¿—æµ
  let realtime_logger = azimuth::LoggerProvider::get_logger(azimuth::LoggerProvider::default(), "realtime-logger")
  
  // æ¨¡æ‹Ÿå®æ—¶æ—¥å¿—æµ
  let log_levels = [azimuth::Debug, azimuth::Info, azimuth::Warn, azimuth::Error]
  let log_messages = [
    "User login successful",
    "Database query executed",
    "Cache miss occurred",
    "API request processed",
    "Payment processed",
    "Email sent",
    "File uploaded",
    "Report generated",
    "Backup completed",
    "System health check"
  ]
  
  // åˆ›å»ºå®æ—¶æ—¥å¿—æµ
  for i in 0..120 {  // 2åˆ†é’Ÿçš„æ—¥å¿—ï¼Œæ¯ç§’ä¸€æ¡
    let log_time = base_time + (i * 1000000000L)
    let log_level = log_levels[i % log_levels.length()]
    let log_message = log_messages[i % log_messages.length()] + " at " + i.to_string()
    
    let log_record = azimuth::LogRecord::new_with_context(
      log_level,
      Some(log_message),
      Some([
        ("timestamp", azimuth::StringValue(log_time.to_string())),
        ("sequence", azimuth::IntValue(i)),
        ("source", azimuth::StringValue("realtime-stream"))
      ]),
      Some(log_time),
      None,
      Some("realtime-trace"),
      Some("realtime-span-" + (i % 10).to_string()),
      Some(azimuth::Context::root())
    )
    
    azimuth::Logger::emit(realtime_logger, log_record)
  }
  
  // æµ‹è¯•å®æ—¶è¿½è¸ªæµ
  let realtime_tracer = azimuth::TracerProvider::get_tracer(azimuth::TracerProvider::default(), "realtime-tracer")
  
  // æ¨¡æ‹Ÿå®æ—¶è¿½è¸ªæµ
  let operations = [
    "http.get",
    "http.post",
    "database.select",
    "database.insert",
    "cache.get",
    "cache.set",
    "auth.verify",
    "payment.process",
    "notification.send",
    "file.upload"
  ]
  
  let span_kinds = [azimuth::Server, azimuth::Client, azimuth::Internal, azimuth::Producer, azimuth::Consumer]
  
  // åˆ›å»ºå®æ—¶è¿½è¸ªæµ
  for i in 0..60 {  // 1åˆ†é’Ÿçš„è¿½è¸ªï¼Œæ¯ç§’ä¸€ä¸ªæ“ä½œ
    let operation = operations[i % operations.length()]
    let span_kind = span_kinds[i % span_kinds.length()]
    
    let span = azimuth::Tracer::start_span(realtime_tracer, operation)
    
    // æ·»åŠ å®æ—¶äº‹ä»¶
    azimuth::Span::add_event(span, "operation.started", Some([
      ("timestamp", azimuth::StringValue((base_time + i * 1000000000L).to_string())),
      ("operation.id", azimuth::StringValue("op-" + i.to_string())),
      ("node", azimuth::StringValue("node-" + (i % 5).to_string()))
    ]))
    
    // æ¨¡æ‹Ÿæ“ä½œæŒç»­æ—¶é—´
    let duration_ms = 50 + (i % 500)
    let end_time = base_time + (i * 1000000000L) + (duration_ms * 1000000L)
    
    azimuth::Span::add_event(span, "operation.completed", Some([
      ("duration.ms", azimuth::IntValue(duration_ms)),
      ("end.time", azimuth::StringValue(end_time.to_string()))
    ]))
    
    azimuth::Span::set_status(span, azimuth::Ok)
  }
  
  // æµ‹è¯•ä»ªè¡¨æ¿èšåˆæ•°æ®
  let dashboard_meter = azimuth::MeterProvider::get_meter(azimuth::MeterProvider::default(), "dashboard-aggregator")
  
  // åˆ›å»ºèšåˆåº¦é‡
  let total_requests = azimuth::Meter::create_counter(dashboard_meter, "dashboard.total.requests")
  let avg_response_time = azimuth::Meter::create_histogram(dashboard_meter, "dashboard.avg.response.time")
  let total_errors = azimuth::Meter::create_counter(dashboard_meter, "dashboard.total.errors")
  let peak_connections = azimuth::Meter::create_gauge(dashboard_meter, "dashboard.peak.connections")
  let avg_cpu_usage = azimuth::Meter::create_histogram(dashboard_meter, "dashboard.avg.cpu.usage")
  let avg_memory_usage = azimuth::Meter::create_histogram(dashboard_meter, "dashboard.avg.memory.usage")
  
  // è®¡ç®—å¹¶è®°å½•èšåˆæ•°æ®
  let total_requests_sum = 0.0
  let total_response_time_sum = 0.0
  let total_errors_sum = 0.0
  let max_connections = 0.0
  let total_cpu_sum = 0.0
  let total_memory_sum = 0.0
  
  for i in 0..request_values.length() {
    total_requests_sum += request_values[i]
    total_response_time_sum += response_values[i]
    total_errors_sum += error_values[i]
    
    if connection_values[i] > max_connections {
      max_connections = connection_values[i]
    }
    
    total_cpu_sum += cpu_values[i]
    total_memory_sum += memory_values[i]
  }
  
  // è®°å½•èšåˆæ•°æ®
  azimuth::Counter::add(total_requests, total_requests_sum)
  azimuth::Histogram::record(avg_response_time, total_response_time_sum / response_values.length().to_double())
  azimuth::Counter::add(total_errors, total_errors_sum)
  // æ³¨æ„ï¼šGaugeæ²¡æœ‰recordæ–¹æ³•ï¼Œè¿™é‡Œç”¨Histogramä»£æ›¿
  azimuth::Histogram::record(avg_cpu_usage, total_cpu_sum / cpu_values.length().to_double())
  azimuth::Histogram::record(avg_memory_usage, total_memory_sum / memory_values.length().to_double())
  
  // éªŒè¯èšåˆåº¦é‡åˆ›å»º
  assert_eq(total_requests.name, "dashboard.total.requests")
  assert_eq(avg_response_time.name, "dashboard.avg.response.time")
  assert_eq(total_errors.name, "dashboard.total.errors")
  assert_eq(peak_connections.name, "dashboard.peak.connections")
  assert_eq(avg_cpu_usage.name, "dashboard.avg.cpu.usage")
  assert_eq(avg_memory_usage.name, "dashboard.avg.memory.usage")
}