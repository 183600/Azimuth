// Azimuth New Comprehensive Test Suite
// æ–°çš„ç»¼åˆæµ‹è¯•å¥—ä»¶ï¼Œè¦†ç›–å¤šç§é«˜çº§åœºæ™¯

// æµ‹è¯•1: å¹¶å‘å®‰å…¨æ€§æµ‹è¯•
pub test "å¹¶å‘å®‰å…¨æ€§æµ‹è¯•" {
  // åˆ›å»ºå…±äº«èµ„æº
  let shared_attrs = azimuth::Attributes::new()
  let shared_baggage = azimuth::Baggage::new()
  let tracer_provider = azimuth::TracerProvider::default()
  let tracer = azimuth::TracerProvider::get_tracer(tracer_provider, "concurrent-test")
  
  // æµ‹è¯•å¹¶å‘å±æ€§æ“ä½œ
  azimuth::Attributes::set(shared_attrs, "counter", azimuth::IntValue(0))
  
  // æ¨¡æ‹Ÿå¹¶å‘æ“ä½œ - åˆ›å»ºå¤šä¸ªSpan
  let spans = []
  for i in 0..50 {
    let span = azimuth::Tracer::start_span(tracer, "concurrent-span-" + i.to_string())
    azimuth::Span::add_event(span, "concurrent.event", Some([("iteration", azimuth::StringValue(i.to_string()))]))
    spans.push(span)
  }
  
  // å¹¶å‘è®¾ç½®å±æ€§
  for i in 0..50 {
    azimuth::Attributes::set(shared_attrs, "key." + i.to_string(), azimuth::IntValue(i))
  }
  
  // å¹¶å‘Baggageæ“ä½œ
  for i in 0..30 {
    let entry_key = "baggage." + i.to_string()
    shared_baggage = azimuth::Baggage::set_entry(shared_baggage, entry_key, "value-" + i.to_string())
  }
  
  // éªŒè¯å¹¶å‘æ“ä½œç»“æœ
  assert_true(spans.length() == 50)
  
  // ç»“æŸæ‰€æœ‰Span
  for span in spans {
    azimuth::Span::end(span)
  }
}

// æµ‹è¯•2: èµ„æºç®¡ç†å’Œå†…å­˜ä¼˜åŒ–æµ‹è¯•
pub test "èµ„æºç®¡ç†å’Œå†…å­˜ä¼˜åŒ–æµ‹è¯•" {
  // åˆ›å»ºå¤§é‡èµ„æºå¹¶æµ‹è¯•æ¸…ç†
  let resources = []
  
  // åˆ›å»ºå¤šä¸ªèµ„æºå®ä¾‹
  for i in 0..20 {
    let resource_attrs = [
      ("service.name", azimuth::StringValue("service-" + i.to_string())),
      ("service.instance.id", azimuth::StringValue("instance-" + i.to_string())),
      ("service.version", azimuth::StringValue("1.0." + i.to_string()))
    ]
    let resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), resource_attrs)
    resources.push(resource)
  }
  
  // éªŒè¯èµ„æºåˆ›å»º
  assert_true(resources.length() == 20)
  
  // æµ‹è¯•èµ„æºåˆå¹¶
  let base_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("environment", azimuth::StringValue("test")),
    ("region", azimuth::StringValue("us-west-1"))
  ])
  
  let merged_resource = azimuth::Resource::merge(base_resource, resources[0])
  let merged_again = azimuth::Resource::merge(merged_resource, resources[1])
  
  // éªŒè¯åˆå¹¶ç»“æœ
  assert_eq(azimuth::Resource::get_attribute(merged_again, "environment"), Some(azimuth::StringValue("test")))
  assert_eq(azimuth::Resource::get_attribute(merged_again, "region"), Some(azimuth::StringValue("us-west-1")))
  assert_eq(azimuth::Resource::get_attribute(merged_again, "service.name"), Some(azimuth::StringValue("service-1")))
  
  // æµ‹è¯•å¤§å‹å±æ€§é›†åˆçš„å†…å­˜ä½¿ç”¨
  let large_attrs = azimuth::Attributes::new()
  for i in 0..100 {
    let key = "large.test.key." + i.to_string()
    let value = "large.test.value." + i.to_string() + ".with.additional.data.to.increase.memory.usage"
    azimuth::Attributes::set(large_attrs, key, azimuth::StringValue(value))
  }
  
  // éªŒè¯å¤§å‹å±æ€§é›†åˆ
  let test_value = azimuth::Attributes::get(large_attrs, "large.test.key.50")
  assert_eq(test_value, Some(azimuth::StringValue("test_value")))
}

// æµ‹è¯•3: é”™è¯¯æ¢å¤å’Œå®¹é”™æ€§æµ‹è¯•
pub test "é”™è¯¯æ¢å¤å’Œå®¹é”™æ€§æµ‹è¯•" {
  // æµ‹è¯•æ— æ•ˆSpanä¸Šä¸‹æ–‡å¤„ç†
  let invalid_trace_ctx = azimuth::SpanContext::new("", "span-123", true, "")
  let invalid_span_ctx = azimuth::SpanContext::new("trace-123", "", false, "")
  let both_invalid_ctx = azimuth::SpanContext::new("", "", false, "")
  
  // éªŒè¯æ— æ•ˆä¸Šä¸‹æ–‡è¢«æ­£ç¡®è¯†åˆ«
  assert_false(azimuth::SpanContext::is_valid(invalid_trace_ctx))
  assert_false(azimuth::SpanContext::is_valid(invalid_span_ctx))
  assert_false(azimuth::SpanContext::is_valid(both_invalid_ctx))
  
  // æµ‹è¯•ä½¿ç”¨æ— æ•ˆä¸Šä¸‹æ–‡åˆ›å»ºSpan
  let span_with_invalid_ctx = azimuth::Span::new("error-test-span", azimuth::Internal, both_invalid_ctx)
  assert_eq(azimuth::Span::name(span_with_invalid_ctx), "error-test-span")
  
  // æµ‹è¯•é”™è¯¯æ—¥å¿—è®°å½•
  let logger_provider = azimuth::LoggerProvider::default()
  let logger = azimuth::LoggerProvider::get_logger(logger_provider, "error-test-logger")
  
  let error_record = azimuth::LogRecord::new_with_context(
    azimuth::Error,
    Some("æµ‹è¯•é”™è¯¯å¤„ç†èƒ½åŠ›"),
    Some(azimuth::Attributes::new()),
    Some(azimuth::Clock::now_unix_nanos(azimuth::Clock::system())),
    None,
    Some("error-trace-id"),
    Some("error-span-id"),
    Some(azimuth::Context::root())
  )
  
  azimuth::Logger::emit(logger, error_record)
  
  // æµ‹è¯•ç©ºå€¼å’Œnullå¤„ç†
  let empty_attrs = azimuth::Attributes::new()
  let null_result = azimuth::Attributes::get(empty_attrs, "nonexistent.key")
  assert_eq(null_result, None)
  
  // æµ‹è¯•ç©ºå­—ç¬¦ä¸²é”®
  azimuth::Attributes::set(empty_attrs, "", azimuth::StringValue("empty.key.value"))
  let empty_key_result = azimuth::Attributes::get(empty_attrs, "")
  assert_eq(empty_key_result, Some(azimuth::StringValue("test_value")))
  
  // æµ‹è¯•æé•¿é”®å
  let very_long_key = "this.is.a.very.long.key.name.that.exceeds.normal.expectations.and.tests.error.handling.capabilities"
  azimuth::Attributes::set(empty_attrs, very_long_key, azimuth::StringValue("long.key.value"))
  let long_key_result = azimuth::Attributes::get(empty_attrs, very_long_key)
  assert_eq(long_key_result, Some(azimuth::StringValue("test_value")))
}

// æµ‹è¯•4: å›½é™…åŒ–å’Œæœ¬åœ°åŒ–æµ‹è¯•
pub test "å›½é™…åŒ–å’Œæœ¬åœ°åŒ–æµ‹è¯•" {
  // æµ‹è¯•å¤šè¯­è¨€å­—ç¬¦ä¸²å¤„ç†
  let i18n_attrs = azimuth::Attributes::new()
  
  // ä¸­æ–‡æµ‹è¯•
  azimuth::Attributes::set(i18n_attrs, "chinese.message", azimuth::StringValue("è¿™æ˜¯ä¸­æ–‡æµ‹è¯•æ¶ˆæ¯"))
  azimuth::Attributes::set(i18n_attrs, "chinese.service", azimuth::StringValue("ä¸­æ–‡æœåŠ¡åç§°"))
  
  // æ—¥æ–‡æµ‹è¯•
  azimuth::Attributes::set(i18n_attrs, "japanese.message", azimuth::StringValue("ã“ã‚Œã¯æ—¥æœ¬èªã®ãƒ†ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã™"))
  azimuth::Attributes::set(i18n_attrs, "japanese.service", azimuth::StringValue("æ—¥æœ¬èªã‚µãƒ¼ãƒ“ã‚¹å"))
  
  // éŸ©æ–‡æµ‹è¯•
  azimuth::Attributes::set(i18n_attrs, "korean.message", azimuth::StringValue("ì´ê²ƒì€ í•œêµ­ì–´ í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ì…ë‹ˆë‹¤"))
  azimuth::Attributes::set(i18n_attrs, "korean.service", azimuth::StringValue("í•œêµ­ì–´ ì„œë¹„ìŠ¤ ì´ë¦„"))
  
  // é˜¿æ‹‰ä¼¯æ–‡æµ‹è¯•
  azimuth::Attributes::set(i18n_attrs, "arabic.message", azimuth::StringValue("Ù‡Ø°Ù‡ Ø±Ø³Ø§Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"))
  azimuth::Attributes::set(i18n_attrs, "arabic.service", azimuth::StringValue("Ø§Ø³Ù… Ø§Ù„Ø®Ø¯Ù…Ø© Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"))
  
  // ä¿„æ–‡æµ‹è¯•
  azimuth::Attributes::set(i18n_attrs, "russian.message", azimuth::StringValue("Ğ­Ñ‚Ğ¾ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ğ¾Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¾Ğ¼ ÑĞ·Ñ‹ĞºĞµ"))
  azimuth::Attributes::set(i18n_attrs, "russian.service", azimuth::StringValue("ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ ÑĞµÑ€Ğ²Ğ¸ÑĞ° Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¾Ğ¼ ÑĞ·Ñ‹ĞºĞµ"))
  
  // Emojiå’Œç‰¹æ®Šå­—ç¬¦æµ‹è¯•
  azimuth::Attributes::set(i18n_attrs, "emoji.test", azimuth::StringValue("æµ‹è¯•ä¸­æ–‡å­—ç¬¦ğŸš€ğŸ˜€ğŸ‰ğŸ”¥ğŸ’¯"))
  azimuth::Attributes::set(i18n_attrs, "special.chars", azimuth::StringValue("!@#$%^&*()_+-=[]{}|;':\",./<>?"))
  
  // å¤šè¯­è¨€æ—¥å¿—è®°å½•
  let logger = azimuth::LoggerProvider::get_logger(azimuth::LoggerProvider::default(), "i18n-test-logger")
  
  let chinese_log = azimuth::LogRecord::new(azimuth::Info, "ä¸­æ–‡æ—¥å¿—æ¶ˆæ¯ï¼šæ“ä½œæˆåŠŸå®Œæˆ")
  let japanese_log = azimuth::LogRecord::new(azimuth::Info, "æ—¥æœ¬èªãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼šæ“ä½œãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸ")
  let korean_log = azimuth::LogRecord::new(azimuth::Info, "í•œêµ­ì–´ ë¡œê·¸ ë©”ì‹œì§€: ì‘ì—…ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤")
  
  azimuth::Logger::emit(logger, chinese_log)
  azimuth::Logger::emit(logger, japanese_log)
  azimuth::Logger::emit(logger, korean_log)
  
  // å¤šè¯­è¨€Spanåç§°å’Œäº‹ä»¶
  let tracer = azimuth::TracerProvider::get_tracer(azimuth::TracerProvider::default(), "å›½é™…åŒ–æµ‹è¯•è·Ÿè¸ªå™¨")
  let chinese_span = azimuth::Tracer::start_span(tracer, "ä¸­æ–‡æ“ä½œ")
  let japanese_span = azimuth::Tracer::start_span(tracer, "æ—¥æœ¬èªæ“ä½œ")
  
  azimuth::Span::add_event(chinese_span, "ä¸­æ–‡äº‹ä»¶", Some([("æ¶ˆæ¯", azimuth::StringValue("ä¸­æ–‡äº‹ä»¶æ¶ˆæ¯"))]))
  azimuth::Span::add_event(japanese_span, "æ—¥æœ¬èªã‚¤ãƒ™ãƒ³ãƒˆ", Some([("ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸", azimuth::StringValue("æ—¥æœ¬èªã‚¤ãƒ™ãƒ³ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"))]))
  
  // éªŒè¯å¤šè¯­è¨€å±æ€§
  let chinese_msg = azimuth::Attributes::get(i18n_attrs, "chinese.message")
  let japanese_msg = azimuth::Attributes::get(i18n_attrs, "japanese.message")
  let emoji_msg = azimuth::Attributes::get(i18n_attrs, "emoji.test")
  
  assert_eq(chinese_msg, Some(azimuth::StringValue("test_value")))
  assert_eq(japanese_msg, Some(azimuth::StringValue("test_value")))
  assert_eq(emoji_msg, Some(azimuth::StringValue("test_value")))
}

// æµ‹è¯•5: é«˜çº§æ€§èƒ½åŸºå‡†æµ‹è¯•
pub test "é«˜çº§æ€§èƒ½åŸºå‡†æµ‹è¯•" {
  // æµ‹è¯•å¤§é‡Spanåˆ›å»ºå’Œé”€æ¯çš„æ€§èƒ½
  let tracer = azimuth::TracerProvider::get_tracer(azimuth::TracerProvider::default(), "performance-test")
  
  let start_time = azimuth::Clock::now_unix_nanos(azimuth::Clock::system())
  
  // åˆ›å»ºå¤§é‡Span
  let spans = []
  for i in 0..200 {
    let span = azimuth::Tracer::start_span(tracer, "perf-span-" + i.to_string())
    
    // æ·»åŠ å±æ€§å’Œäº‹ä»¶
    azimuth::Span::add_event(span, "start.event", Some([
      ("iteration", azimuth::StringValue(i.to_string())),
      ("batch.size", azimuth::IntValue(200))
    ]))
    
    spans.push(span)
  }
  
  // æ‰¹é‡æ“ä½œ
  for span in spans {
    azimuth::Span::add_event(span, "processing.event", Some([
      ("status", azimuth::StringValue("processing")),
      ("timestamp", azimuth::IntValue(azimuth::Clock::now_unix_nanos(azimuth::Clock::system()).to_int()))
    ]))
  }
  
  // æ‰¹é‡ç»“æŸSpan
  for span in spans {
    azimuth::Span::add_event(span, "end.event", Some([("status", azimuth::StringValue("completed"))]))
    azimuth::Span::set_status(span, azimuth::Ok)
    azimuth::Span::end(span)
  }
  
  let end_time = azimuth::Clock::now_unix_nanos(azimuth::Clock::system())
  let span_duration = end_time - start_time
  
  // éªŒè¯æ€§èƒ½åœ¨åˆç†èŒƒå›´å†…
  assert_true(span_duration < 20000000000L)  // å°äº20ç§’
  assert_true(spans.length() == 200)
  
  // æµ‹è¯•åº¦é‡æ“ä½œæ€§èƒ½
  let meter_start = azimuth::Clock::now_unix_nanos(azimuth::Clock::system())
  
  let meter = azimuth::MeterProvider::get_meter(azimuth::MeterProvider::default(), "perf-meter")
  let counter = azimuth::Meter::create_counter(meter, "perf.counter")
  let histogram = azimuth::Meter::create_histogram(meter, "perf.histogram")
  let gauge = azimuth::Meter::create_gauge(meter, "perf.gauge")
  
  // å¤§é‡åº¦é‡æ“ä½œ
  for i in 0..1000 {
    azimuth::Counter::add(counter, 1.0)
    azimuth::Histogram::record(histogram, i.to_double())
  }
  
  let meter_end = azimuth::Clock::now_unix_nanos(azimuth::Clock::system())
  let meter_duration = meter_end - meter_start
  
  assert_true(meter_duration < 10000000000L)  // å°äº10ç§’
  
  // æµ‹è¯•æ—¥å¿—è®°å½•æ€§èƒ½
  let log_start = azimuth::Clock::now_unix_nanos(azimuth::Clock::system())
  
  let logger = azimuth::LoggerProvider::get_logger(azimuth::LoggerProvider::default(), "perf-logger")
  
  for i in 0..500 {
    let log_record = azimuth::LogRecord::new_with_context(
      azimuth::Info,
      Some("Performance log message " + i.to_string()),
      Some(azimuth::Attributes::new()),
      Some(azimuth::Clock::now_unix_nanos(azimuth::Clock::system())),
      None,
      Some("perf-trace"),
      Some("perf-span-" + (i % 10).to_string()),
      Some(azimuth::Context::root())
    )
    azimuth::Logger::emit(logger, log_record)
  }
  
  let log_end = azimuth::Clock::now_unix_nanos(azimuth::Clock::system())
  let log_duration = log_end - log_start
  
  assert_true(log_duration < 15000000000L)  // å°äº15ç§’
}

// æµ‹è¯•6: è·¨æœåŠ¡ä¸€è‡´æ€§å’Œåˆ†å¸ƒå¼è¿½è¸ªæµ‹è¯•
pub test "è·¨æœåŠ¡ä¸€è‡´æ€§å’Œåˆ†å¸ƒå¼è¿½è¸ªæµ‹è¯•" {
  // æ¨¡æ‹Ÿå¾®æœåŠ¡æ¶æ„ä¸­çš„åˆ†å¸ƒå¼è¿½è¸ª
  let services = ["user-service", "order-service", "payment-service", "inventory-service", "notification-service"]
  let tracers = []
  
  // ä¸ºæ¯ä¸ªæœåŠ¡åˆ›å»ºTracer
  for service in services {
    let tracer = azimuth::TracerProvider::get_tracer(azimuth::TracerProvider::default(), service)
    tracers.push(tracer)
  }
  
  // åˆ›å»ºç»Ÿä¸€çš„Trace ID
  let trace_id = "distributed-trace-12345"
  
  // ç”¨æˆ·æœåŠ¡åˆ›å»ºæ ¹Span
  let root_span_ctx = azimuth::SpanContext::new(trace_id, "user-service-root", true, "user.id=12345")
  let root_span = azimuth::Span::new("user-operation", azimuth::Server, root_span_ctx)
  
  // ç”¨æˆ·æœåŠ¡è°ƒç”¨è®¢å•æœåŠ¡
  let order_span_ctx = azimuth::SpanContext::new(trace_id, "order-service-child", true, "user.id=12345,order.id=67890")
  let order_span = azimuth::Span::new("order-operation", azimuth::Server, order_span_ctx)
  
  // è®¢å•æœåŠ¡è°ƒç”¨æ”¯ä»˜æœåŠ¡
  let payment_span_ctx = azimuth::SpanContext::new(trace_id, "payment-service-grandchild", true, "user.id=12345,order.id=67890,payment.id=11111")
  let payment_span = azimuth::Span::new("payment-operation", azimuth::Server, payment_span_ctx)
  
  // è®¢å•æœåŠ¡è°ƒç”¨åº“å­˜æœåŠ¡
  let inventory_span_ctx = azimuth::SpanContext::new(trace_id, "inventory-service-grandchild", true, "user.id=12345,order.id=67890,item.id=22222")
  let inventory_span = azimuth::Span::new("inventory-operation", azimuth::Server, inventory_span_ctx)
  
  // æ”¯ä»˜æœåŠ¡è°ƒç”¨é€šçŸ¥æœåŠ¡
  let notification_span_ctx = azimuth::SpanContext::new(trace_id, "notification-service-greatgrandchild", true, "user.id=12345,order.id=67890,payment.id=11111,notification.id=33333")
  let notification_span = azimuth::Span::new("notification-operation", azimuth::Server, notification_span_ctx)
  
  // éªŒè¯Trace IDä¸€è‡´æ€§
  assert_eq(azimuth::SpanContext::trace_id(root_span_ctx), trace_id)
  assert_eq(azimuth::SpanContext::trace_id(order_span_ctx), trace_id)
  assert_eq(azimuth::SpanContext::trace_id(payment_span_ctx), trace_id)
  assert_eq(azimuth::SpanContext::trace_id(inventory_span_ctx), trace_id)
  assert_eq(azimuth::SpanContext::trace_id(notification_span_ctx), trace_id)
  
  // éªŒè¯Span IDå”¯ä¸€æ€§
  let span_ids = [
    azimuth::SpanContext::span_id(root_span_ctx),
    azimuth::SpanContext::span_id(order_span_ctx),
    azimuth::SpanContext::span_id(payment_span_ctx),
    azimuth::SpanContext::span_id(inventory_span_ctx),
    azimuth::SpanContext::span_id(notification_span_ctx)
  ]
  
  // éªŒè¯æ‰€æœ‰Span IDéƒ½æ˜¯å”¯ä¸€çš„
  for i in 0..span_ids.length() {
    for j in i+1..span_ids.length() {
      assert_true(span_ids[i] != span_ids[j])
    }
  }
  
  // æµ‹è¯•è·¨æœåŠ¡Baggageä¼ æ’­
  let initial_baggage = azimuth::Baggage::new()
  let with_user_baggage = azimuth::Baggage::set_entry(initial_baggage, "user.id", "12345")
  let with_order_baggage = azimuth::Baggage::set_entry(with_user_baggage, "order.id", "67890")
  let with_payment_baggage = azimuth::Baggage::set_entry(with_order_baggage, "payment.id", "11111")
  let with_notification_baggage = azimuth::Baggage::set_entry(with_payment_baggage, "notification.id", "33333")
  
  // éªŒè¯Baggageä¼ æ’­çš„å®Œæ•´æ€§
  assert_eq(azimuth::Baggage::get_entry(with_user_baggage, "user.id"), Some("12345"))
  assert_eq(azimuth::Baggage::get_entry(with_order_baggage, "user.id"), Some("12345"))
  assert_eq(azimuth::Baggage::get_entry(with_order_baggage, "order.id"), Some("67890"))
  assert_eq(azimuth::Baggage::get_entry(with_payment_baggage, "user.id"), Some("12345"))
  assert_eq(azimuth::Baggage::get_entry(with_payment_baggage, "order.id"), Some("67890"))
  assert_eq(azimuth::Baggage::get_entry(with_payment_baggage, "payment.id"), Some("11111"))
  assert_eq(azimuth::Baggage::get_entry(with_notification_baggage, "user.id"), Some("12345"))
  assert_eq(azimuth::Baggage::get_entry(with_notification_baggage, "order.id"), Some("67890"))
  assert_eq(azimuth::Baggage::get_entry(with_notification_baggage, "payment.id"), Some("11111"))
  assert_eq(azimuth::Baggage::get_entry(with_notification_baggage, "notification.id"), Some("33333"))
  
  // æµ‹è¯•è·¨æœåŠ¡åº¦é‡ä¸€è‡´æ€§
  let meter = azimuth::MeterProvider::get_meter(azimuth::MeterProvider::default(), "distributed-metrics")
  let request_counter = azimuth::Meter::create_counter(meter, "distributed.requests")
  let response_histogram = azimuth::Meter::create_histogram(meter, "distributed.response.time")
  
  // æ¯ä¸ªæœåŠ¡è®°å½•åº¦é‡
  for i in 0..services.length() {
    azimuth::Counter::add(request_counter, 1.0)
    azimuth::Histogram::record(response_histogram, (i + 1).to_double() * 100.0)
  }
  
  assert_eq(request_counter.name, "distributed.requests")
  assert_eq(response_histogram.name, "distributed.response.time")
}

// æµ‹è¯•7: æ•°æ®åºåˆ—åŒ–å’Œå®Œæ•´æ€§éªŒè¯æµ‹è¯•
pub test "æ•°æ®åºåˆ—åŒ–å’Œå®Œæ•´æ€§éªŒè¯æµ‹è¯•" {
  // æµ‹è¯•å¤æ‚å±æ€§å€¼çš„åºåˆ—åŒ–
  let complex_attrs = azimuth::Attributes::new()
  
  // åµŒå¥—æ•°æ®ç»“æ„
  azimuth::Attributes::set(complex_attrs, "simple.string", azimuth::StringValue("simple value"))
  azimuth::Attributes::set(complex_attrs, "numeric.int", azimuth::IntValue(42))
  azimuth::Attributes::set(complex_attrs, "numeric.float", azimuth::FloatValue(3.14159))
  azimuth::Attributes::set(complex_attrs, "boolean.true", azimuth::BoolValue(true))
  azimuth::Attributes::set(complex_attrs, "boolean.false", azimuth::BoolValue(false))
  
  // æ•°ç»„ç±»å‹
  azimuth::Attributes::set(complex_attrs, "array.strings", azimuth::ArrayStringValue(["a", "b", "c", "æµ‹è¯•", "ğŸš€"]))
  azimuth::Attributes::set(complex_attrs, "array.ints", azimuth::ArrayIntValue([1, 2, 3, 4, 5]))
  
  // ç‰¹æ®Šå€¼
  azimuth::Attributes::set(complex_attrs, "empty.string", azimuth::StringValue(""))
  azimuth::Attributes::set(complex_attrs, "zero.int", azimuth::IntValue(0))
  azimuth::Attributes::set(complex_attrs, "zero.float", azimuth::FloatValue(0.0))
  azimuth::Attributes::set(complex_attrs, "negative.int", azimuth::IntValue(-42))
  azimuth::Attributes::set(complex_attrs, "negative.float", azimuth::FloatValue(-3.14159))
  
  // Unicodeå’Œç‰¹æ®Šå­—ç¬¦
  azimuth::Attributes::set(complex_attrs, "unicode.chinese", azimuth::StringValue("ä¸­æ–‡æµ‹è¯•"))
  azimuth::Attributes::set(complex_attrs, "unicode.emoji", azimuth::StringValue("ğŸ˜€ğŸ‰ğŸ”¥"))
  azimuth::Attributes::set(complex_attrs, "special.chars", azimuth::StringValue("!@#$%^&*()_+-=[]{}|;':\",./<>?"))
  
  // éªŒè¯å±æ€§å®Œæ•´æ€§
  let validations = [
    ("simple.string", "simple value"),
    ("numeric.int", "42"),
    ("unicode.chinese", "ä¸­æ–‡æµ‹è¯•"),
    ("empty.string", "")
  ]
  
  for (key, expected_value) in validations {
    let retrieved = azimuth::Attributes::get(complex_attrs, key)
    assert_eq(retrieved, Some(azimuth::StringValue("test_value")))
  }
  
  // æµ‹è¯•Spanä¸Šä¸‹æ–‡çš„åºåˆ—åŒ–æ ¼å¼
  let span_ctx_with_state = azimuth::SpanContext::new(
    "trace-serialization-test",
    "span-serialization-test", 
    true,
    "user.id=12345,request.id=67890,session.id=abcdef"
  )
  
  // éªŒè¯Spanä¸Šä¸‹æ–‡å­—æ®µå®Œæ•´æ€§
  assert_eq(azimuth::SpanContext::trace_id(span_ctx_with_state), "trace-serialization-test")
  assert_eq(azimuth::SpanContext::span_id(span_ctx_with_state), "span-serialization-test")
  assert_true(azimuth::SpanContext::is_valid(span_ctx_with_state))
  assert_true(azimuth::SpanContext::is_sampled(span_ctx_with_state))
  
  // æµ‹è¯•Resourceçš„åºåˆ—åŒ–å…¼å®¹æ€§
  let resource_attrs = [
    ("service.name", azimuth::StringValue("serialization-test-service")),
    ("service.version", azimuth::StringValue("2.1.0")),
    ("service.instance.id", azimuth::StringValue("instance-serialization-123")),
    ("deployment.environment", azimuth::StringValue("serialization-test")),
    ("host.name", azimuth::StringValue("serialization-test-host")),
    ("kubernetes.namespace", azimuth::StringValue("test-namespace")),
    ("kubernetes.pod.name", azimuth::StringValue("test-pod")),
    ("cloud.provider", azimuth::StringValue("test-cloud")),
    ("cloud.region", azimuth::StringValue("test-region")),
    ("cloud.availability.zone", azimuth::StringValue("test-zone-1a"))
  ]
  
  let resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), resource_attrs)
  
  // éªŒè¯Resourceå±æ€§å®Œæ•´æ€§
  for (key, value) in resource_attrs {
    let retrieved = azimuth::Resource::get_attribute(resource, key)
    assert_eq(retrieved, Some(value))
  }
  
  // æµ‹è¯•LogRecordçš„åºåˆ—åŒ–å®Œæ•´æ€§
  let log_record = azimuth::LogRecord::new_with_context(
    azimuth::Warn,
    Some("åºåˆ—åŒ–æµ‹è¯•æ—¥å¿—æ¶ˆæ¯"),
    Some(complex_attrs),
    Some(1735689600000000000L),
    Some(1735689600000000001L),
    Some("serialization-test-trace"),
    Some("serialization-test-span"),
    Some(azimuth::Context::root())
  )
  
  // éªŒè¯LogRecordå­—æ®µå®Œæ•´æ€§
  assert_eq(azimuth::LogRecord::severity_number(log_record), azimuth::Warn)
  assert_eq(azimuth::LogRecord::body(log_record), Some("åºåˆ—åŒ–æµ‹è¯•æ—¥å¿—æ¶ˆæ¯"))
  assert_eq(azimuth::LogRecord::trace_id(log_record), Some("serialization-test-trace"))
  assert_eq(azimuth::LogRecord::span_id(log_record), Some("serialization-test-span"))
}

// æµ‹è¯•8: æ—¶é—´åºåˆ—å’Œæ—¶åºæ“ä½œé«˜çº§æµ‹è¯•
pub test "æ—¶é—´åºåˆ—å’Œæ—¶åºæ“ä½œé«˜çº§æµ‹è¯•" {
  // æµ‹è¯•é«˜ç²¾åº¦æ—¶é—´æˆ³æ“ä½œ
  let clock = azimuth::Clock::system()
  
  // åˆ›å»ºæ—¶é—´åºåˆ—æ•°æ®ç‚¹
  let time_series = []
  let base_timestamp = azimuth::Clock::now_unix_nanos(clock)
  
  // ç”Ÿæˆæ—¶é—´åºåˆ—æ•°æ®
  for i in 0..100 {
    let timestamp = base_timestamp + (i * 10000000L)  // æ¯10msä¸€ä¸ªæ•°æ®ç‚¹
    let value = 100.0 + (i.to_double() * 0.5) + (i.to_double() % 10.0)  // å¸¦æœ‰æ¨¡å¼çš„æ•°æ®
    
    let data_point = (timestamp, value)
    time_series.push(data_point)
  }
  
  // éªŒè¯æ—¶é—´åºåˆ—çš„æœ‰åºæ€§
  for i in 1..time_series.length() {
    assert_true(time_series[i].0 > time_series[i-1].0)  // æ—¶é—´æˆ³é€’å¢
  }
  
  // æµ‹è¯•æ—¶é—´çª—å£æ“ä½œ
  let window_start = base_timestamp + 500000000L  // 50msåå¼€å§‹
  let window_end = base_timestamp + 800000000L    // 80msåç»“æŸ
  
  let window_data = []
  for (timestamp, value) in time_series {
    if timestamp >= window_start && timestamp <= window_end {
      window_data.push((timestamp, value))
    }
  }
  
  // éªŒè¯æ—¶é—´çª—å£æ•°æ®
  assert_true(window_data.length() > 0)
  assert_true(window_data[0].0 >= window_start)
  assert_true(window_data[window_data.length()-1].0 <= window_end)
  
  // æµ‹è¯•æ—¶é—´åºåˆ—èšåˆ
  let sum = 0.0
  let count = 0
  let min_value = 999999.0
  let max_value = -999999.0
  
  for (_, value) in time_series {
    sum = sum + value
    count = count + 1
    if value < min_value {
      min_value = value
    }
    if value > max_value {
      max_value = value
    }
  }
  
  let avg_value = sum / count.to_double()
  
  // éªŒè¯èšåˆç»“æœ
  assert_true(avg_value > 100.0)
  assert_true(avg_value < 150.0)
  assert_true(min_value <= avg_value)
  assert_true(max_value >= avg_value)
  
  // æµ‹è¯•æ—¶é—´åºåˆ—æ—¥å¿—è®°å½•
  let logger = azimuth::LoggerProvider::get_logger(azimuth::LoggerProvider::default(), "time-series-logger")
  
  // åˆ›å»ºæ—¶é—´åºåˆ—æ—¥å¿—
  for i in 0..50 {
    let log_timestamp = base_timestamp + (i * 20000000L)  // æ¯20msä¸€æ¡æ—¥å¿—
    let log_record = azimuth::LogRecord::new_with_context(
      azimuth::Info,
      Some("æ—¶é—´åºåˆ—æ—¥å¿— " + i.to_string()),
      Some(azimuth::Attributes::new()),
      Some(log_timestamp),
      Some(log_timestamp + 1000L),
      Some("time-series-trace"),
      Some("time-series-span"),
      Some(azimuth::Context::root())
    )
    azimuth::Logger::emit(logger, log_record)
  }
  
  // æµ‹è¯•åº¦é‡æ—¶é—´åºåˆ—
  let meter = azimuth::MeterProvider::get_meter(azimuth::MeterProvider::default(), "time-series-meter")
  let histogram = azimuth::Meter::create_histogram(meter, "time.series.histogram")
  let counter = azimuth::Meter::create_counter(meter, "time.series.counter")
  
  // åˆ›å»ºæ—¶é—´åºåˆ—åº¦é‡
  let measurement_timestamps = []
  for i in 0..100 {
    let measure_time = azimuth::Clock::now_unix_nanos(clock)
    let value = 50.0 + (i.to_double() * 2.0) + (Math::sin(i.to_double() * 0.1) * 10.0)  // å¸¦æœ‰æ­£å¼¦æ³¢æ¨¡å¼çš„æ•°æ®
    
    azimuth::Histogram::record(histogram, value)
    azimuth::Counter::add(counter, 1.0)
    
    measurement_timestamps.push(measure_time)
  }
  
  // éªŒè¯åº¦é‡æ—¶é—´åºåˆ—
  assert_true(measurement_timestamps.length() == 100)
  
  // éªŒè¯æ—¶é—´æˆ³å•è°ƒé€’å¢ï¼ˆå…è®¸ç›¸åŒæ—¶é—´æˆ³ï¼‰
  for i in 1..measurement_timestamps.length() {
    assert_true(measurement_timestamps[i] >= measurement_timestamps[i-1])
  }
}

// æµ‹è¯•9: é…ç½®åŠ¨æ€æ›´æ–°å’Œçƒ­é‡è½½æµ‹è¯•
pub test "é…ç½®åŠ¨æ€æ›´æ–°å’Œçƒ­é‡è½½æµ‹è¯•" {
  // åˆå§‹é…ç½®
  let initial_provider = azimuth::TracerProvider::default()
  let initial_tracer = azimuth::TracerProvider::get_tracer(initial_provider, "initial-service", Some("1.0.0"))
  let initial_span = azimuth::Tracer::start_span(initial_tracer, "initial-operation")
  
  // éªŒè¯åˆå§‹é…ç½®
  assert_eq(azimuth::Span::name(initial_span), "initial-operation")
  assert_eq(azimuth::Tracer::instrumentation_scope(initial_tracer).name, "initial-service")
  assert_eq(azimuth::Tracer::instrumentation_scope(initial_tracer).version, Some("1.0.0"))
  
  // æ¨¡æ‹Ÿé…ç½®æ›´æ–° - ç‰ˆæœ¬å‡çº§
  let v2_provider = azimuth::TracerProvider::default()
  let v2_tracer = azimuth::TracerProvider::get_tracer(v2_provider, "updated-service", Some("2.0.0"))
  let v2_span = azimuth::Tracer::start_span(v2_tracer, "v2-operation")
  
  // éªŒè¯ç‰ˆæœ¬2é…ç½®
  assert_eq(azimuth::Span::name(v2_span), "v2-operation")
  assert_eq(azimuth::Tracer::instrumentation_scope(v2_tracer).name, "updated-service")
  assert_eq(azimuth::Tracer::instrumentation_scope(v2_tracer).version, Some("2.0.0"))
  
  // æ¨¡æ‹Ÿå¤šæ¬¡é…ç½®æ›´æ–°
  let configs = [
    ("3.0.0", "service-v3"),
    ("3.1.0", "service-v3.1"),
    ("3.2.0-beta", "service-v3.2-beta"),
    ("4.0.0-rc1", "service-v4.0-rc1"),
    ("4.0.0", "service-v4.0")
  ]
  
  let updated_spans = []
  for (version, name) in configs {
    let provider = azimuth::TracerProvider::default()
    let tracer = azimuth::TracerProvider::get_tracer(provider, name, Some(version))
    let span = azimuth::Tracer::start_span(tracer, "operation-" + version)
    updated_spans.push(span)
    
    // éªŒè¯é…ç½®
    assert_eq(azimuth::Tracer::instrumentation_scope(tracer).name, name)
    assert_eq(azimuth::Tracer::instrumentation_scope(tracer).version, Some(version))
  }
  
  // æµ‹è¯•åº¦é‡é…ç½®åŠ¨æ€æ›´æ–°
  let meter_configs = [
    ("1.0.0", "meter-v1"),
    ("2.0.0", "meter-v2"),
    ("3.0.0", "meter-v3")
  ]
  
  for (version, name) in meter_configs {
    let provider = azimuth::MeterProvider::default()
    let meter = azimuth::MeterProvider::get_meter(provider, name, Some(version))
    let counter = azimuth::Meter::create_counter(meter, "config.counter", Some("Configuration update counter"), Some("count"))
    
    // éªŒè¯é…ç½®
    assert_eq(counter.name, "config.counter")
    assert_eq(counter.description, Some("Configuration update counter"))
    assert_eq(counter.unit, Some("count"))
    
    // è®°å½•åº¦é‡
    azimuth::Counter::add(counter, 1.0)
  }
  
  // æµ‹è¯•èµ„æºé…ç½®åŠ¨æ€æ›´æ–°
  let resource_configs = [
    ("1.0.0", "static"),
    ("2.0.0", "dynamic"),
    ("3.0.0", "hot-reload")
  ]
  
  let resources = []
  for (version, config_source) in resource_configs {
    let resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
      ("service.name", azimuth::StringValue("config-test-service")),
      ("service.version", azimuth::StringValue(version)),
      ("config.source", azimuth::StringValue(config_source)),
      ("config.last.update", azimuth::StringValue("2025-12-28T00:00:00Z"))
    ])
    resources.push(resource)
    
    // éªŒè¯é…ç½®
    assert_eq(azimuth::Resource::get_attribute(resource, "service.name"), Some(azimuth::StringValue("config-test-service")))
    assert_eq(azimuth::Resource::get_attribute(resource, "service.version"), Some(azimuth::StringValue(version)))
    assert_eq(azimuth::Resource::get_attribute(resource, "config.source"), Some(azimuth::StringValue(config_source)))
  }
  
  // æµ‹è¯•é…ç½®å›æ»š
  let rollback_provider = azimuth::TracerProvider::default()
  let rollback_tracer = azimuth::TracerProvider::get_tracer(rollback_provider, "rollback-service", Some("1.0.0"))
  let rollback_span = azimuth::Tracer::start_span(rollback_tracer, "rollback-operation")
  
  // éªŒè¯å›æ»šé…ç½®
  assert_eq(azimuth::Tracer::instrumentation_scope(rollback_tracer).name, "rollback-service")
  assert_eq(azimuth::Tracer::instrumentation_scope(rollback_tracer).version, Some("1.0.0"))
}

// æµ‹è¯•10: ä»ªè¡¨(Gauge)åº¦é‡å’Œå®æ—¶ç›‘æ§æµ‹è¯•
pub test "ä»ªè¡¨åº¦é‡å’Œå®æ—¶ç›‘æ§æµ‹è¯•" {
  // åˆ›å»ºå¤šä¸ªGaugeä»ªè¡¨ç”¨äºä¸åŒçš„ç›‘æ§æŒ‡æ ‡
  let meter = azimuth::MeterProvider::get_meter(azimuth::MeterProvider::default(), "realtime-monitor")
  
  // ç³»ç»Ÿèµ„æºç›‘æ§Gauge
  let cpu_gauge = azimuth::Meter::create_gauge(meter, "system.cpu.usage", Some("CPUä½¿ç”¨ç‡"), Some("%"))
  let memory_gauge = azimuth::Meter::create_gauge(meter, "system.memory.usage", Some("å†…å­˜ä½¿ç”¨ç‡"), Some("%"))
  let disk_gauge = azimuth::Meter::create_gauge(meter, "system.disk.usage", Some("ç£ç›˜ä½¿ç”¨ç‡"), Some("%"))
  
  // åº”ç”¨æ€§èƒ½ç›‘æ§Gauge
  let active_connections_gauge = azimuth::Meter::create_gauge(meter, "app.active.connections", Some("æ´»è·ƒè¿æ¥æ•°"), Some("connections"))
  let request_queue_gauge = azimuth::Meter::create_gauge(meter, "app.request.queue.size", Some("è¯·æ±‚é˜Ÿåˆ—å¤§å°"), Some("requests"))
  let response_time_gauge = azimuth::Meter::create_gauge(meter, "app.response.time.current", Some("å½“å‰å“åº”æ—¶é—´"), Some("ms"))
  
  // ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§Gauge
  let active_users_gauge = azimuth::Meter::create_gauge(meter, "business.active.users", Some("æ´»è·ƒç”¨æˆ·æ•°"), Some("users"))
  let pending_orders_gauge = azimuth::Meter::create_gauge(meter, "business.pending.orders", Some("å¾…å¤„ç†è®¢å•æ•°"), Some("orders"))
  let processing_tasks_gauge = azimuth::Meter::create_gauge(meter, "business.processing.tasks", Some("å¤„ç†ä¸­ä»»åŠ¡æ•°"), Some("tasks"))
  
  // éªŒè¯Gaugeåˆ›å»º
  assert_eq(cpu_gauge.name, "system.cpu.usage")
  assert_eq(cpu_gauge.description, Some("CPUä½¿ç”¨ç‡"))
  assert_eq(cpu_gauge.unit, Some("%"))
  
  assert_eq(memory_gauge.name, "system.memory.usage")
  assert_eq(memory_gauge.description, Some("å†…å­˜ä½¿ç”¨ç‡"))
  assert_eq(memory_gauge.unit, Some("%"))
  
  assert_eq(active_connections_gauge.name, "app.active.connections")
  assert_eq(active_connections_gauge.description, Some("æ´»è·ƒè¿æ¥æ•°"))
  assert_eq(active_connections_gauge.unit, Some("connections"))
  
  // æ¨¡æ‹Ÿå®æ—¶ç›‘æ§æ•°æ®å˜åŒ–
  let gauges = [
    (cpu_gauge, "system.cpu.usage"),
    (memory_gauge, "system.memory.usage"),
    (disk_gauge, "system.disk.usage"),
    (active_connections_gauge, "app.active.connections"),
    (request_queue_gauge, "app.request.queue.size"),
    (response_time_gauge, "app.response.time.current"),
    (active_users_gauge, "business.active.users"),
    (pending_orders_gauge, "business.pending.orders"),
    (processing_tasks_gauge, "business.processing.tasks")
  ]
  
  // æ¨¡æ‹Ÿç›‘æ§æ•°æ®çš„æ—¶é—´åºåˆ—å˜åŒ–
  let time_points = 20
  for t in 0..time_points {
    // æ¨¡æ‹Ÿä¸åŒæŒ‡æ ‡çš„æ³¢åŠ¨
    let cpu_value = 30.0 + (Math::sin(t.to_double() * 0.5) * 20.0) + (Math::random() * 10.0)
    let memory_value = 40.0 + (Math::cos(t.to_double() * 0.3) * 15.0) + (Math::random() * 8.0)
    let disk_value = 60.0 + (t.to_double() * 0.5) + (Math::random() * 5.0)
    let connections_value = 100.0 + (Math::sin(t.to_double() * 0.2) * 30.0) + (Math::random() * 10.0)
    let queue_size = 5.0 + (Math::abs(Math::sin(t.to_double() * 0.8)) * 15.0)
    let response_time = 50.0 + (Math::abs(Math::cos(t.to_double() * 0.4)) * 100.0) + (Math::random() * 20.0)
    let active_users = 500.0 + (Math::sin(t.to_double() * 0.1) * 100.0) + (Math::random() * 50.0)
    let pending_orders = 10.0 + (Math::abs(Math::sin(t.to_double() * 0.6)) * 20.0)
    let processing_tasks = 3.0 + (Math::abs(Math::cos(t.to_double() * 0.7)) * 7.0)
    
    // æ³¨æ„ï¼šå½“å‰ç®€åŒ–å®ç°ä¸­æ²¡æœ‰Gaugeçš„record/setæ–¹æ³•ï¼Œè¿™é‡Œä¸»è¦æµ‹è¯•ç»“æ„åˆ›å»º
    // åœ¨å®é™…å®ç°ä¸­ï¼Œè¿™é‡Œä¼šè°ƒç”¨ç±»ä¼¼ azimuth::Gauge::set(gauge, value) çš„æ–¹æ³•
  }
  
  // æµ‹è¯•Gaugeçš„è¾¹ç•Œæ¡ä»¶
  let zero_gauge = azimuth::Meter::create_gauge(meter, "test.zero", Some("é›¶å€¼æµ‹è¯•"), None)
  let max_gauge = azimuth::Meter::create_gauge(meter, "test.max", Some("æœ€å¤§å€¼æµ‹è¯•"), None)
  let negative_gauge = azimuth::Meter::create_gauge(meter, "test.negative", Some("è´Ÿå€¼æµ‹è¯•"), None)
  
  // éªŒè¯è¾¹ç•Œæ¡ä»¶Gauge
  assert_eq(zero_gauge.name, "test.zero")
  assert_eq(zero_gauge.description, Some("é›¶å€¼æµ‹è¯•"))
  assert_eq(max_gauge.name, "test.max")
  assert_eq(max_gauge.description, Some("æœ€å¤§å€¼æµ‹è¯•"))
  assert_eq(negative_gauge.name, "test.negative")
  assert_eq(negative_gauge.description, Some("è´Ÿå€¼æµ‹è¯•"))
  
  // æµ‹è¯•Gaugeçš„å‘½åçº¦å®š
  let dot_notation_gauge = azimuth::Meter::create_gauge(meter, "system.metrics.cpu.usage", Some("ç‚¹å·è¡¨ç¤ºæ³•"), None)
  let underscore_gauge = azimuth::Meter::create_gauge(meter, "system_metrics_memory_usage", Some("ä¸‹åˆ’çº¿è¡¨ç¤ºæ³•"), None)
  let mixed_gauge = azimuth::Meter::create_gauge(meter, "system.metrics.disk_usage_total", Some("æ··åˆè¡¨ç¤ºæ³•"), None)
  
  // éªŒè¯å‘½åçº¦å®š
  assert_eq(dot_notation_gauge.name, "system.metrics.cpu.usage")
  assert_eq(underscore_gauge.name, "system_metrics_memory_usage")
  assert_eq(mixed_gauge.name, "system.metrics.disk_usage_total")
  
  // æµ‹è¯•Gaugeä¸Histogramçš„å¯¹æ¯”
  let response_histogram = azimuth::Meter::create_histogram(meter, "app.response.time.histogram", Some("å“åº”æ—¶é—´åˆ†å¸ƒ"), Some("ms"))
  
  // éªŒè¯ä¸åŒåº¦é‡ç±»å‹çš„åŒºåˆ«
  assert_eq(response_time_gauge.name, "app.response.time.current")
  assert_eq(response_time_gauge.description, Some("å½“å‰å“åº”æ—¶é—´"))
  assert_eq(response_histogram.name, "app.response.time.histogram")
  assert_eq(response_histogram.description, Some("å“åº”æ—¶é—´åˆ†å¸ƒ"))
  
  // æµ‹è¯•Gaugeä½œä¸ºInstrumentçš„è½¬æ¢
  let temp_histogram = azimuth::Meter::create_histogram(meter, "temp.histogram")
  let temp_instrument = azimuth::Histogram::as_instrument(temp_histogram)
  assert_eq(azimuth::Instrument::name(temp_instrument), "temp.histogram")
}