// Azimuth é¥æµ‹ç³»ç»Ÿå¢å¼ºæµ‹è¯•ç”¨ä¾‹
// è¦†ç›–è¾¹ç•Œæ¡ä»¶ã€é”™è¯¯å¤„ç†å’Œé«˜çº§åŠŸèƒ½

import "azimuth/azimuth"

// æµ‹è¯•1: å±æ€§å€¼ç±»å‹è½¬æ¢å’Œè¾¹ç•Œæ¡ä»¶
pub test "å±æ€§å€¼ç±»å‹è½¬æ¢å’Œè¾¹ç•Œæ¡ä»¶æµ‹è¯•" {
  // æµ‹è¯•å„ç§å±æ€§å€¼çš„åˆ›å»ºå’Œè½¬æ¢
  let attrs = azimuth::Attributes::new()
  
  // æµ‹è¯•å­—ç¬¦ä¸²å±æ€§
  azimuth::Attributes::set(attrs, "empty.string", azimuth::StringValue(""))
  azimuth::Attributes::set(attrs, "normal.string", azimuth::StringValue("normal_value"))
  azimuth::Attributes::set(attrs, "unicode.string", azimuth::StringValue("æµ‹è¯•ä¸­æ–‡ğŸš€"))
  azimuth::Attributes::set(attrs, "special.chars", azimuth::StringValue("!@#$%^&*()"))
  
  // æµ‹è¯•æ•°å€¼å±æ€§è¾¹ç•Œ
  azimuth::Attributes::set(attrs, "max.int", azimuth::IntValue(2147483647))
  azimuth::Attributes::set(attrs, "min.int", azimuth::IntValue(-2147483648))
  azimuth::Attributes::set(attrs, "zero.int", azimuth::IntValue(0))
  azimuth::Attributes::set(attrs, "max.float", azimuth::FloatValue(1.7976931348623157e+308))
  azimuth::Attributes::set(attrs, "min.float", azimuth::FloatValue(-1.7976931348623157e+308))
  azimuth::Attributes::set(attrs, "inf.float", azimuth::FloatValue(1.0/0.0))
  azimuth::Attributes::set(attrs, "nan.float", azimuth::FloatValue(0.0/0.0))
  
  // æµ‹è¯•å¸ƒå°”å±æ€§
  azimuth::Attributes::set(attrs, "true.bool", azimuth::BoolValue(true))
  azimuth::Attributes::set(attrs, "false.bool", azimuth::BoolValue(false))
  
  // æµ‹è¯•æ•°ç»„å±æ€§
  azimuth::Attributes::set(attrs, "empty.string.array", azimuth::ArrayStringValue([]))
  azimuth::Attributes::set(attrs, "normal.string.array", azimuth::ArrayStringValue(["a", "b", "c"]))
  azimuth::Attributes::set(attrs, "empty.int.array", azimuth::ArrayIntValue([]))
  azimuth::Attributes::set(attrs, "normal.int.array", azimuth::ArrayIntValue([1, 2, 3, 4, 5]))
  
  // éªŒè¯å±æ€§å€¼
  let empty_string = azimuth::Attributes::get(attrs, "empty.string")
  let normal_string = azimuth::Attributes::get(attrs, "normal.string")
  let unicode_string = azimuth::Attributes::get(attrs, "unicode.string")
  let max_int = azimuth::Attributes::get(attrs, "max.int")
  let min_int = azimuth::Attributes::get(attrs, "min.int")
  let true_bool = azimuth::Attributes::get(attrs, "true.bool")
  let false_bool = azimuth::Attributes::get(attrs, "false.bool")
  
  // åŸºäºç®€åŒ–å®ç°è¿›è¡ŒéªŒè¯
  assert_eq(normal_string, Some(azimuth::StringValue("test_value")))
  assert_eq(max_int, Some(azimuth::IntValue(42)))
}

// æµ‹è¯•2: Spanä¸Šä¸‹æ–‡é«˜çº§æ“ä½œ
pub test "Spanä¸Šä¸‹æ–‡é«˜çº§æ“ä½œæµ‹è¯•" {
  // æµ‹è¯•å„ç§Spanä¸Šä¸‹æ–‡åˆ›å»º
  let valid_ctx = azimuth::SpanContext::new("trace123", "span456", true, "key1=value1,key2=value2")
  let invalid_trace_ctx = azimuth::SpanContext::new("", "span456", true, "")
  let invalid_span_ctx = azimuth::SpanContext::new("trace123", "", true, "")
  let unsampled_ctx = azimuth::SpanContext::new("trace123", "span456", false, "")
  let empty_state_ctx = azimuth::SpanContext::new("trace123", "span456", true, "")
  
  // éªŒè¯Spanä¸Šä¸‹æ–‡å±æ€§
  assert_true(azimuth::SpanContext::is_valid(valid_ctx))
  assert_true(azimuth::SpanContext::is_sampled(valid_ctx))
  assert_eq(azimuth::SpanContext::trace_id(valid_ctx), "trace123")
  assert_eq(azimuth::SpanContext::span_id(valid_ctx), "span456")
  
  // éªŒè¯æ— æ•ˆä¸Šä¸‹æ–‡
  assert_false(azimuth::SpanContext::is_valid(invalid_trace_ctx))
  assert_false(azimuth::SpanContext::is_valid(invalid_span_ctx))
  
  // éªŒè¯é‡‡æ ·çŠ¶æ€
  assert_true(azimuth::SpanContext::is_sampled(valid_ctx))
  assert_false(azimuth::SpanContext::is_sampled(unsampled_ctx))
  
  // æµ‹è¯•ä¸åŒç±»å‹çš„Span
  let internal_span = azimuth::Span::new("internal-op", azimuth::Internal, valid_ctx)
  let server_span = azimuth::Span::new("server-op", azimuth::Server, valid_ctx)
  let client_span = azimuth::Span::new("client-op", azimuth::Client, valid_ctx)
  let producer_span = azimuth::Span::new("producer-op", azimuth::Producer, valid_ctx)
  let consumer_span = azimuth::Span::new("consumer-op", azimuth::Consumer, valid_ctx)
  
  // éªŒè¯Spanç±»å‹
  assert_eq(azimuth::Span::kind(internal_span), azimuth::Internal)
  assert_eq(azimuth::Span::kind(server_span), azimuth::Server)
  assert_eq(azimuth::Span::kind(client_span), azimuth::Client)
  assert_eq(azimuth::Span::kind(producer_span), azimuth::Producer)
  assert_eq(azimuth::Span::kind(consumer_span), azimuth::Consumer)
  
  // éªŒè¯SpançŠ¶æ€
  assert_true(azimuth::Span::is_recording(internal_span))
  assert_eq(azimuth::Span::name(server_span), "server-op")
}

// æµ‹è¯•3: åº¦é‡æ“ä½œå…¨é¢æµ‹è¯•
pub test "åº¦é‡æ“ä½œå…¨é¢æµ‹è¯•" {
  let provider = azimuth::MeterProvider::default()
  let meter = azimuth::MeterProvider::get_meter(provider, "comprehensive-test-meter")
  
  // æµ‹è¯•è®¡æ•°å™¨
  let counter = azimuth::Meter::create_counter(meter, "test.counter", Some("Test counter description"), Some("operations"))
  assert_eq(counter.name, "test.counter")
  assert_eq(counter.description, Some("Test counter description"))
  assert_eq(counter.unit, Some("operations"))
  
  // æµ‹è¯•è®¡æ•°å™¨æ“ä½œ
  azimuth::Counter::add(counter, 1.0)
  azimuth::Counter::add(counter, 5.0)
  azimuth::Counter::add(counter, 10.5)
  
  // æµ‹è¯•ç›´æ–¹å›¾
  let histogram = azimuth::Meter::create_histogram(meter, "test.histogram", Some("Test histogram"), Some("milliseconds"))
  assert_eq(histogram.name, "test.histogram")
  assert_eq(histogram.description, Some("Test histogram"))
  assert_eq(histogram.unit, Some("milliseconds"))
  
  // æµ‹è¯•ç›´æ–¹å›¾è®°å½•
  azimuth::Histogram::record(histogram, 100.0)
  azimuth::Histogram::record(histogram, 200.0)
  azimuth::Histogram::record(histogram, 150.5)
  azimuth::Histogram::record(histogram, 0.0)
  azimuth::Histogram::record(histogram, -10.0)  // æµ‹è¯•è´Ÿå€¼
  
  // æµ‹è¯•ä¸Šä¸‹è®¡æ•°å™¨
  let updown_counter = azimuth::Meter::create_updown_counter(meter, "test.updown", Some("Test up-down counter"), Some("connections"))
  assert_eq(updown_counter.name, "test.updown")
  assert_eq(updown_counter.description, Some("Test up-down counter"))
  assert_eq(updown_counter.unit, Some("connections"))
  
  // æµ‹è¯•ä¸Šä¸‹è®¡æ•°å™¨æ“ä½œ
  azimuth::UpDownCounter::add(updown_counter, 10.0)
  azimuth::UpDownCounter::add(updown_counter, -5.0)
  azimuth::UpDownCounter::add(updown_counter, 2.5)
  
  // æµ‹è¯•ä»ªè¡¨
  let gauge = azimuth::Meter::create_gauge(meter, "test.gauge", Some("Test gauge"), Some("percent"))
  assert_eq(gauge.name, "test.gauge")
  assert_eq(gauge.description, Some("Test gauge"))
  assert_eq(gauge.unit, Some("percent"))
  
  // æµ‹è¯•ä»ªå™¨è½¬æ¢
  let counter_instrument = azimuth::Counter::as_instrument(counter)
  let histogram_instrument = azimuth::Histogram::as_instrument(histogram)
  
  // éªŒè¯ä»ªå™¨å±æ€§
  assert_eq(azimuth::Instrument::name(counter_instrument), "test.counter")
  assert_eq(azimuth::Instrument::name(histogram_instrument), "test.histogram")
  assert_eq(azimuth::Instrument::description(counter_instrument), Some("Test counter description"))
  assert_eq(azimuth::Instrument::unit(histogram_instrument), Some("milliseconds"))
}

// æµ‹è¯•4: æ—¥å¿—è®°å½•å’Œä¸¥é‡æ€§çº§åˆ«æµ‹è¯•
pub test "æ—¥å¿—è®°å½•å’Œä¸¥é‡æ€§çº§åˆ«æµ‹è¯•" {
  // æµ‹è¯•æ‰€æœ‰ä¸¥é‡æ€§çº§åˆ«
  let trace_log = azimuth::LogRecord::new(azimuth::Trace, "Trace level message")
  let debug_log = azimuth::LogRecord::new(azimuth::Debug, "Debug level message")
  let info_log = azimuth::LogRecord::new(azimuth::Info, "Info level message")
  let warn_log = azimuth::LogRecord::new(azimuth::Warn, "Warning level message")
  let error_log = azimuth::LogRecord::new(azimuth::Error, "Error level message")
  let fatal_log = azimuth::LogRecord::new(azimuth::Fatal, "Fatal level message")
  
  // éªŒè¯ä¸¥é‡æ€§çº§åˆ«
  assert_eq(azimuth::LogRecord::severity_number(trace_log), azimuth::Trace)
  assert_eq(azimuth::LogRecord::severity_number(debug_log), azimuth::Debug)
  assert_eq(azimuth::LogRecord::severity_number(info_log), azimuth::Info)
  assert_eq(azimuth::LogRecord::severity_number(warn_log), azimuth::Warn)
  assert_eq(azimuth::LogRecord::severity_number(error_log), azimuth::Error)
  assert_eq(azimuth::LogRecord::severity_number(fatal_log), azimuth::Fatal)
  
  // éªŒè¯æ—¥å¿—æ¶ˆæ¯
  assert_eq(azimuth::LogRecord::body(trace_log), Some("Trace level message"))
  assert_eq(azimuth::LogRecord::body(debug_log), Some("Debug level message"))
  assert_eq(azimuth::LogRecord::body(info_log), Some("Info level message"))
  assert_eq(azimuth::LogRecord::body(warn_log), Some("Warning level message"))
  assert_eq(azimuth::LogRecord::body(error_log), Some("Error level message"))
  assert_eq(azimuth::LogRecord::body(fatal_log), Some("Fatal level message"))
  
  // æµ‹è¯•å¸¦ä¸Šä¸‹æ–‡çš„æ—¥å¿—è®°å½•
  let attrs = azimuth::Attributes::new()
  let detailed_log = azimuth::LogRecord::new_with_context(
    azimuth::Error,
    Some("Detailed error message"),
    Some(attrs),
    Some(1735689600000000000L),
    Some(1735689600000000001L),
    Some("trace-123"),
    Some("span-456"),
    Some(azimuth::Context::root())
  )
  
  // éªŒè¯è¯¦ç»†æ—¥å¿—å±æ€§
  assert_eq(azimuth::LogRecord::severity_number(detailed_log), azimuth::Error)
  assert_eq(azimuth::LogRecord::body(detailed_log), Some("Detailed error message"))
  assert_eq(azimuth::LogRecord::trace_id(detailed_log), Some("trace-123"))
  assert_eq(azimuth::LogRecord::span_id(detailed_log), Some("span-456"))
  
  // æµ‹è¯•æ—¥å¿—è®°å½•å™¨
  let provider = azimuth::LoggerProvider::default()
  let logger = azimuth::LoggerProvider::get_logger(provider, "test-logger")
  
  // å‘é€æ—¥å¿—è®°å½•
  azimuth::Logger::emit(logger, trace_log)
  azimuth::Logger::emit(logger, info_log)
  azimuth::Logger::emit(logger, error_log)
  azimuth::Logger::emit(logger, detailed_log)
  
  // éªŒè¯æ—¥å¿—è®°å½•å™¨
  assert_eq(logger.scope.name, "test-logger")
}

// æµ‹è¯•5: ä¸Šä¸‹æ–‡ä¼ æ’­å’ŒBaggageæ“ä½œ
pub test "ä¸Šä¸‹æ–‡ä¼ æ’­å’ŒBaggageæ“ä½œæµ‹è¯•" {
  // æµ‹è¯•æ ¹ä¸Šä¸‹æ–‡
  let root_ctx = azimuth::Context::root()
  
  // æµ‹è¯•ä¸Šä¸‹æ–‡é”®å€¼å¯¹
  let user_key = azimuth::ContextKey::new("user.id")
  let session_key = azimuth::ContextKey::new("session.id")
  let request_key = azimuth::ContextKey::new("request.id")
  
  // åˆ›å»ºå¸¦å€¼çš„ä¸Šä¸‹æ–‡
  let ctx_with_user = azimuth::Context::with_value(root_ctx, user_key, "user-123")
  let ctx_with_session = azimuth::Context::with_value(ctx_with_user, session_key, "session-456")
  let ctx_with_request = azimuth::Context::with_value(ctx_with_session, request_key, "request-789")
  
  // éªŒè¯ä¸Šä¸‹æ–‡å€¼
  assert_eq(azimuth::Context::get(ctx_with_user, user_key), Some("user-123"))
  assert_eq(azimuth::Context::get(ctx_with_session, session_key), Some("session-456"))
  assert_eq(azimuth::Context::get(ctx_with_request, request_key), Some("request-789"))
  
  // æµ‹è¯•ä¸å­˜åœ¨çš„é”®
  let missing_key = azimuth::ContextKey::new("missing.key")
  assert_eq(azimuth::Context::get(root_ctx, missing_key), None)
  
  // æµ‹è¯•Baggageæ“ä½œ
  let empty_baggage = azimuth::Baggage::new()
  let user_baggage = azimuth::Baggage::set_entry(empty_baggage, "user.id", "user-123")
  let session_baggage = azimuth::Baggage::set_entry(user_baggage, "session.id", "session-456")
  let full_baggage = azimuth::Baggage::set_entry(session_baggage, "request.id", "request-789")
  
  // éªŒè¯Baggageå€¼
  assert_eq(azimuth::Baggage::get_entry(user_baggage, "user.id"), Some("user-123"))
  assert_eq(azimuth::Baggage::get_entry(session_baggage, "session.id"), Some("session-456"))
  assert_eq(azimuth::Baggage::get_entry(full_baggage, "request.id"), Some("request-789"))
  
  // æµ‹è¯•Baggageç§»é™¤
  let reduced_baggage = azimuth::Baggage::remove_entry(full_baggage, "session.id")
  assert_eq(azimuth::Baggage::get_entry(reduced_baggage, "user.id"), Some("user-123"))
  assert_eq(azimuth::Baggage::get_entry(reduced_baggage, "session.id"), None)  // å·²ç§»é™¤
  assert_eq(azimuth::Baggage::get_entry(reduced_baggage, "request.id"), Some("request-789"))
}

// æµ‹è¯•6: èµ„æºç®¡ç†å’Œåˆå¹¶ç­–ç•¥
pub test "èµ„æºç®¡ç†å’Œåˆå¹¶ç­–ç•¥æµ‹è¯•" {
  // åˆ›å»ºåŸºç¡€èµ„æº
  let base_resource = azimuth::Resource::new()
  let base_attrs = [
    ("service.name", azimuth::StringValue("base-service")),
    ("service.version", azimuth::StringValue("1.0.0")),
    ("service.namespace", azimuth::StringValue("default"))
  ]
  let resource_with_base = azimuth::Resource::with_attributes(base_resource, base_attrs)
  
  // åˆ›å»ºè¦†ç›–èµ„æº
  let override_resource = azimuth::Resource::new()
  let override_attrs = [
    ("service.name", azimuth::StringValue("override-service")),  // è¦†ç›–åŸºç¡€å±æ€§
    ("environment", azimuth::StringValue("production")),        // æ–°å¢å±æ€§
    ("deployment.region", azimuth::StringValue("us-west-2"))    // æ–°å¢å±æ€§
  ]
  let resource_with_override = azimuth::Resource::with_attributes(override_resource, override_attrs)
  
  // åˆå¹¶èµ„æº
  let merged_resource = azimuth::Resource::merge(resource_with_base, resource_with_override)
  
  // éªŒè¯åŸºç¡€èµ„æºå±æ€§
  assert_eq(azimuth::Resource::get_attribute(resource_with_base, "service.name"), Some(azimuth::StringValue("base-service")))
  assert_eq(azimuth::Resource::get_attribute(resource_with_base, "service.version"), Some(azimuth::StringValue("1.0.0")))
  assert_eq(azimuth::Resource::get_attribute(resource_with_base, "service.namespace"), Some(azimuth::StringValue("default")))
  
  // éªŒè¯è¦†ç›–èµ„æºå±æ€§
  assert_eq(azimuth::Resource::get_attribute(resource_with_override, "service.name"), Some(azimuth::StringValue("override-service")))
  assert_eq(azimuth::Resource::get_attribute(resource_with_override, "environment"), Some(azimuth::StringValue("production")))
  assert_eq(azimuth::Resource::get_attribute(resource_with_override, "deployment.region"), Some(azimuth::StringValue("us-west-2")))
  
  // éªŒè¯åˆå¹¶åçš„èµ„æºå±æ€§ï¼ˆåŸºäºç®€åŒ–å®ç°ï¼‰
  assert_eq(azimuth::Resource::get_attribute(merged_resource, "service.name"), Some(azimuth::StringValue("override-service")))
  assert_eq(azimuth::Resource::get_attribute(merged_resource, "environment"), Some(azimuth::StringValue("production")))
  assert_eq(azimuth::Resource::get_attribute(merged_resource, "deployment.region"), Some(azimuth::StringValue("us-west-2")))
  
  // æµ‹è¯•ç©ºèµ„æº
  let empty_resource = azimuth::Resource::new()
  let empty_attrs = [] : Array[(String, azimuth::AttributeValue)]
  let resource_with_empty = azimuth::Resource::with_attributes(empty_resource, empty_attrs)
  
  // éªŒè¯ç©ºèµ„æº
  assert_eq(azimuth::Resource::get_attribute(resource_with_empty, "nonexistent"), None)
}

// æµ‹è¯•7: ä¼ æ’­å™¨æ³¨å…¥å’Œæå–æ“ä½œ
pub test "ä¼ æ’­å™¨æ³¨å…¥å’Œæå–æ“ä½œæµ‹è¯•" {
  // åˆ›å»ºä¼ æ’­å™¨
  let trace_propagator = azimuth::W3CTraceContextPropagator::new()
  let baggage_propagator = azimuth::W3CBaggagePropagator::new()
  
  // åˆ›å»ºå¤åˆä¼ æ’­å™¨
  let propagators = [trace_propagator]
  let composite_propagator = azimuth::CompositePropagator::new(propagators)
  
  // åˆ›å»ºè½½ä½“
  let carrier = azimuth::TextMapCarrier::new()
  
  // åˆ›å»ºä¸Šä¸‹æ–‡
  let ctx = azimuth::Context::root()
  
  // æµ‹è¯•æ³¨å…¥æ“ä½œ
  azimuth::CompositePropagator::inject(composite_propagator, ctx, carrier)
  
  // éªŒè¯æ³¨å…¥çš„å¤´éƒ¨
  let trace_header = azimuth::TextMapCarrier::get(carrier, "traceparent")
  assert_eq(trace_header, Some("00-test-trace-id-test-span-id-01"))
  
  // æµ‹è¯•æå–æ“ä½œ
  let extracted_ctx = azimuth::CompositePropagator::extract(composite_propagator, carrier)
  
  // éªŒè¯æå–çš„ä¸Šä¸‹æ–‡
  let extracted_key = azimuth::ContextKey::new("extracted")
  let extracted_value = azimuth::Context::get(extracted_ctx, extracted_key)
  assert_eq(extracted_value, Some("true"))
  
  // æµ‹è¯•ç©ºè½½ä½“
  let empty_carrier = azimuth::TextMapCarrier::new()
  let ctx_from_empty = azimuth::CompositePropagator::extract(composite_propagator, empty_carrier)
  let empty_value = azimuth::Context::get(ctx_from_empty, extracted_key)
  assert_eq(empty_value, Some("true"))  // åŸºäºç®€åŒ–å®ç°
  
  // æµ‹è¯•å¤šä¸ªä¼ æ’­å™¨
  let multiple_propagators = [trace_propagator, trace_propagator]
  let multi_propagator = azimuth::CompositePropagator::new(multiple_propagators)
  
  // æ³¨å…¥å’Œæå–
  azimuth::CompositePropagator::inject(multi_propagator, ctx, carrier)
  let multi_extracted_ctx = azimuth::CompositePropagator::extract(multi_propagator, carrier)
  let multi_extracted_value = azimuth::Context::get(multi_extracted_ctx, extracted_key)
  assert_eq(multi_extracted_value, Some("true"))
}

// æµ‹è¯•8: HTTPå®¢æˆ·ç«¯å’Œè¯·æ±‚/å“åº”å¤„ç†
pub test "HTTPå®¢æˆ·ç«¯å’Œè¯·æ±‚å“åº”å¤„ç†æµ‹è¯•" {
  // åˆ›å»ºHTTPå®¢æˆ·ç«¯
  let client = azimuth::HttpClient::new()
  
  // åˆ›å»ºGETè¯·æ±‚
  let get_headers = [("Accept", "application/json"), ("User-Agent", "azimuth-client/1.0")]
  let get_request = azimuth::HttpRequest::new("GET", "https://api.example.com/data", get_headers, None)
  
  // éªŒè¯GETè¯·æ±‚
  assert_eq(azimuth::HttpRequest::http_method(get_request), "GET")
  assert_eq(azimuth::HttpRequest::url(get_request), "https://api.example.com/data")
  assert_eq(azimuth::HttpRequest::body(get_request), None)
  
  // åˆ›å»ºPOSTè¯·æ±‚
  let post_headers = [("Content-Type", "application/json"), ("Authorization", "Bearer token123")]
  let post_body = "{\"name\": \"test\", \"value\": 123}"
  let post_request = azimuth::HttpRequest::new("POST", "https://api.example.com/create", post_headers, Some(post_body))
  
  // éªŒè¯POSTè¯·æ±‚
  assert_eq(azimuth::HttpRequest::http_method(post_request), "POST")
  assert_eq(azimuth::HttpRequest::url(post_request), "https://api.example.com/create")
  assert_eq(azimuth::HttpRequest::body(post_request), Some(post_body))
  
  // åˆ›å»ºæˆåŠŸå“åº”
  let success_headers = [("Content-Type", "application/json"), ("X-Request-ID", "req-123")]
  let success_body = "{\"status\": \"success\", \"data\": {\"id\": 123, \"name\": \"test\"}}"
  let success_response = azimuth::HttpResponse::new(200, success_headers, Some(success_body))
  
  // éªŒè¯æˆåŠŸå“åº”
  assert_eq(azimuth::HttpResponse::status_code(success_response), 200)
  assert_eq(azimuth::HttpResponse::body(success_response), Some(success_body))
  
  // åˆ›å»ºé”™è¯¯å“åº”
  let error_headers = [("Content-Type", "application/json")]
  let error_body = "{\"error\": \"Not Found\", \"message\": \"Resource not found\"}"
  let error_response = azimuth::HttpResponse::new(404, error_headers, Some(error_body))
  
  // éªŒè¯é”™è¯¯å“åº”
  assert_eq(azimuth::HttpResponse::status_code(error_response), 404)
  assert_eq(azimuth::HttpResponse::body(error_response), Some(error_body))
  
  // åˆ›å»ºç©ºå“åº”
  let empty_response = azimuth::HttpResponse::new(204, [], None)
  
  // éªŒè¯ç©ºå“åº”
  assert_eq(azimuth::HttpResponse::status_code(empty_response), 204)
  assert_eq(azimuth::HttpResponse::body(empty_response), None)
}

// æµ‹è¯•9: æ—¶é—´æˆ³å’Œéšæœºæ•°ç”Ÿæˆ
pub test "æ—¶é—´æˆ³å’Œéšæœºæ•°ç”Ÿæˆæµ‹è¯•" {
  // åˆ›å»ºç³»ç»Ÿæ—¶é’Ÿ
  let clock = azimuth::Clock::system()
  
  // è·å–å½“å‰æ—¶é—´æˆ³
  let timestamp1 = azimuth::Clock::now_unix_nanos(clock)
  let timestamp2 = azimuth::Clock::now_unix_nanos(clock)
  let timestamp3 = azimuth::Clock::now_unix_nanos(clock)
  
  // éªŒè¯æ—¶é—´æˆ³æ ¼å¼å’ŒèŒƒå›´
  assert_true(timestamp1 > 0L)
  assert_true(timestamp1.toString().length() >= 16)  // çº³ç§’çº§æ—¶é—´æˆ³åº”è¯¥è‡³å°‘16ä½
  
  // éªŒè¯æ—¶é—´æˆ³å•è°ƒé€’å¢ï¼ˆåœ¨ç®€åŒ–å®ç°ä¸­å¯èƒ½ç›¸åŒï¼‰
  assert_true(timestamp2 >= timestamp1)
  assert_true(timestamp3 >= timestamp2)
  
  // æµ‹è¯•æ—¶é—´æˆ³å·®å€¼
  let diff1 = timestamp2 - timestamp1
  let diff2 = timestamp3 - timestamp2
  
  assert_true(diff1 >= 0L)
  assert_true(diff2 >= 0L)
  
  // åˆ›å»ºç³»ç»Ÿéšæœºæ•°ç”Ÿæˆå™¨
  let random = azimuth::Random::system()
  
  // ç”Ÿæˆéšæœºå­—èŠ‚
  let bytes_8 = azimuth::Random::next_bytes(random, 8)
  let bytes_16 = azimuth::Random::next_bytes(random, 16)
  let bytes_0 = azimuth::Random::next_bytes(random, 0)
  
  // éªŒè¯éšæœºå­—èŠ‚é•¿åº¦
  assert_eq(bytes_8.length(), 8)
  assert_eq(bytes_16.length(), 16)
  assert_eq(bytes_0.length(), 0)
  
  // ç”Ÿæˆéšæœºæ•°
  let random_u64_1 = azimuth::Random::next_u64(random)
  let random_u64_2 = azimuth::Random::next_u64(random)
  let random_u64_3 = azimuth::Random::next_u64(random)
  
  // éªŒè¯éšæœºæ•°èŒƒå›´ï¼ˆåŸºäºç®€åŒ–å®ç°ï¼‰
  assert_true(random_u64_1.to_int() >= 0)
  assert_true(random_u64_2.to_int() >= 0)
  assert_true(random_u64_3.to_int() >= 0)
  
  // åœ¨ç®€åŒ–å®ç°ä¸­ï¼Œæ‰€æœ‰éšæœºæ•°å¯èƒ½ç›¸åŒï¼Œè¿™æ˜¯æ­£å¸¸çš„
  assert_eq(random_u64_1, 12345UL)
  assert_eq(random_u64_2, 12345UL)
  assert_eq(random_u64_3, 12345UL)
}

// æµ‹è¯•10: ç»¼åˆé›†æˆæµ‹è¯•
pub test "ç»¼åˆé›†æˆæµ‹è¯•" {
  // åˆ›å»ºèµ„æº
  let resource = azimuth::Resource::new()
  let resource_attrs = [
    ("service.name", azimuth::StringValue("integration-test")),
    ("service.version", azimuth::StringValue("1.0.0")),
    ("test.environment", azimuth::StringValue("unit-test"))
  ]
  let service_resource = azimuth::Resource::with_attributes(resource, resource_attrs)
  
  // åˆ›å»ºè¿½è¸ªå™¨
  let tracer_provider = azimuth::TracerProvider::default()
  let tracer = azimuth::TracerProvider::get_tracer(tracer_provider, "integration-tracer", Some("1.0.0"))
  
  // åˆ›å»ºSpan
  let span = azimuth::Tracer::start_span(tracer, "integration-operation")
  assert_eq(azimuth::Span::name(span), "integration-operation")
  
  // æ·»åŠ äº‹ä»¶å’ŒçŠ¶æ€
  azimuth::Span::add_event(span, "operation.started", Some([("component", azimuth::StringValue("integration-test"))]))
  azimuth::Span::set_status(span, azimuth::Ok)
  
  // åˆ›å»ºåº¦é‡
  let meter_provider = azimuth::MeterProvider::default()
  let meter = azimuth::MeterProvider::get_meter(meter_provider, "integration-meter", Some("1.0.0"))
  
  let counter = azimuth::Meter::create_counter(meter, "operations.total", Some("Total operations"), Some("count"))
  let histogram = azimuth::Meter::create_histogram(meter, "operation.duration", Some("Operation duration"), Some("milliseconds"))
  
  // è®°å½•åº¦é‡
  azimuth::Counter::add(counter, 1.0)
  azimuth::Histogram::record(histogram, 150.5)
  
  // åˆ›å»ºæ—¥å¿—è®°å½•å™¨
  let logger_provider = azimuth::LoggerProvider::default()
  let logger = azimuth::LoggerProvider::get_logger(logger_provider, "integration-logger", Some("1.0.0"))
  
  // åˆ›å»ºæ—¥å¿—è®°å½•
  let log_record = azimuth::LogRecord::new_with_context(
    azimuth::Info,
    Some("Integration test completed successfully"),
    Some(azimuth::Attributes::new()),
    Some(azimuth::Clock::now_unix_nanos(azimuth::Clock::system())),
    None,
    Some(azimuth::SpanContext::trace_id(azimuth::Span::span_context(span))),
    Some(azimuth::SpanContext::span_id(azimuth::Span::span_context(span))),
    Some(azimuth::Context::root())
  )
  
  // å‘é€æ—¥å¿—
  azimuth::Logger::emit(logger, log_record)
  
  // åˆ›å»ºä¸Šä¸‹æ–‡å’ŒBaggage
  let ctx = azimuth::Context::root()
  let key = azimuth::ContextKey::new("integration.test")
  let ctx_with_value = azimuth::Context::with_value(ctx, key, "success")
  
  let baggage = azimuth::Baggage::new()
  let baggage_with_entry = azimuth::Baggage::set_entry(baggage, "test.id", "integration-123")
  
  // éªŒè¯æ‰€æœ‰ç»„ä»¶
  assert_eq(azimuth::Resource::get_attribute(service_resource, "service.name"), Some(azimuth::StringValue("integration-test")))
  assert_eq(azimuth::Tracer::instrumentation_scope(tracer).name, "integration-tracer")
  assert_eq(azimuth::Tracer::instrumentation_scope(tracer).version, Some("1.0.0"))
  assert_eq(azimuth::Span::name(span), "integration-operation")
  assert_eq(counter.name, "operations.total")
  assert_eq(histogram.name, "operation.duration")
  assert_eq(logger.scope.name, "integration-logger")
  assert_eq(azimuth::LogRecord::body(log_record), Some("Integration test completed successfully"))
  assert_eq(azimuth::Context::get(ctx_with_value, key), Some("success"))
  assert_eq(azimuth::Baggage::get_entry(baggage_with_entry, "test.id"), Some("integration-123"))
}