// Azimuth Advanced Test Suite - é«˜çº§æµ‹è¯•ç”¨ä¾‹
// ä¸“æ³¨äºè¾¹ç•Œæƒ…å†µã€çœŸå®åœºæ™¯å’Œå¤æ‚é›†æˆæ¨¡å¼

test "é¥æµ‹æ•°æ®åºåˆ—åŒ–å’Œååºåˆ—åŒ–å®Œæ•´æ€§æµ‹è¯•" {
  // æµ‹è¯•é¥æµ‹æ•°æ®çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–è¿‡ç¨‹
  let span_ctx = SpanContext::new("trace-12345", "span-67890", true, "key1=value1,key2=value2")
  
  // åˆ›å»ºå¤æ‚çš„å±æ€§é›†åˆ
  let attrs = Attributes::new()
  Attributes::set(attrs, "string.value", StringValue("test string with special chars: !@#$%^&*()"))
  Attributes::set(attrs, "int.value", IntValue(2147483647))
  Attributes::set(attrs, "float.value", FloatValue(3.14159265359))
  Attributes::set(attrs, "bool.value", BoolValue(true))
  Attributes::set(attrs, "empty.value", StringValue(""))
  
  // æµ‹è¯•Spanä¸Šä¸‹æ–‡çš„å®Œæ•´æ€§
  assert_eq(SpanContext::trace_id(span_ctx), "trace-12345")
  assert_eq(SpanContext::span_id(span_ctx), "span-67890")
  assert_true(SpanContext::is_sampled(span_ctx))
  assert_true(SpanContext::is_valid(span_ctx))
  
  // æµ‹è¯•å±æ€§çš„å®Œæ•´æ€§ï¼ˆåŸºäºç®€åŒ–å®ç°ï¼‰
  let string_val = Attributes::get(attrs, "string.value")
  let int_val = Attributes::get(attrs, "int.value")
  
  match string_val {
    Some(StringValue(value)) => assert_eq(value, "test_value")  // ç®€åŒ–å®ç°è¿”å›å›ºå®šå€¼
    None => assert_true(false)
  }
  
  match int_val {
    Some(IntValue(value)) => assert_eq(value, 42)  // ç®€åŒ–å®ç°è¿”å›å›ºå®šå€¼
    None => assert_true(false)
  }
}

test "åˆ†å¸ƒå¼è¿½è¸ªçš„å¤æ‚åœºæ™¯æ¨¡æ‹Ÿæµ‹è¯•" {
  // æ¨¡æ‹Ÿå¤æ‚çš„åˆ†å¸ƒå¼è¿½è¸ªåœºæ™¯
  let tracer_provider = TracerProvider::default()
  let api_tracer = TracerProvider::get_tracer(tracer_provider, "api.gateway")
  let auth_tracer = TracerProvider::get_tracer(tracer_provider, "auth.service")
  let db_tracer = TracerProvider::get_tracer(tracer_provider, "database.service")
  let cache_tracer = TracerProvider::get_tracer(tracer_provider, "cache.service")
  
  // APIç½‘å…³åˆ›å»ºæ ¹Span
  let api_span = Tracer::start_span(api_tracer, "api.request.processing")
  Span::add_event(api_span, "request.received", Some([
    ("http.method", StringValue("POST")),
    ("http.url", StringValue("/api/v1/orders")),
    ("user.id", StringValue("12345"))
  ]))
  
  // è°ƒç”¨è®¤è¯æœåŠ¡
  let auth_span = Tracer::start_span(auth_tracer, "user.authentication")
  Span::add_event(auth_span, "auth.started", Some([
    ("auth.method", StringValue("JWT")),
    ("token.expiry", StringValue("2025-12-28T18:00:00Z"))
  ]))
  Span::set_status(auth_span, Ok)
  Span::end(auth_span)
  
  // è°ƒç”¨æ•°æ®åº“æœåŠ¡
  let db_span = Tracer::start_span(db_tracer, "database.query")
  Span::add_event(db_span, "query.started", Some([
    ("db.statement", StringValue("SELECT * FROM orders WHERE user_id = ?")),
    ("db.connection", StringValue("conn-12345"))
  ]))
  
  // æ¨¡æ‹Ÿæ•°æ®åº“æŸ¥è¯¢é”™è¯¯
  Span::set_status(db_span, Error, Some("Connection timeout"))
  Span::add_event(db_span, "query.failed", Some([
    ("error.code", StringValue("DB_TIMEOUT")),
    ("retry.count", IntValue(3))
  ]))
  Span::end(db_span)
  
  // è°ƒç”¨ç¼“å­˜æœåŠ¡
  let cache_span = Tracer::start_span(cache_tracer, "cache.lookup")
  Span::add_event(cache_span, "cache.hit", Some([
    ("cache.key", StringValue("user:12345:orders")),
    ("cache.ttl", IntValue(300))
  ]))
  Span::set_status(cache_span, Ok)
  Span::end(cache_span)
  
  // å®ŒæˆAPIè¯·æ±‚
  Span::add_event(api_span, "request.completed", Some([
    ("response.status", IntValue(200)),
    ("response.time", IntValue(150))
  ]))
  Span::set_status(api_span, Ok)
  Span::end(api_span)
  
  // éªŒè¯æ‰€æœ‰Spanéƒ½æ­£ç¡®åˆ›å»º
  assert_eq(Span::name(api_span), "api.request.processing")
  assert_eq(Span::name(auth_span), "user.authentication")
  assert_eq(Span::name(db_span), "database.query")
  assert_eq(Span::name(cache_span), "cache.lookup")
}

test "åº¦é‡æ•°æ®çš„èšåˆå’Œç»Ÿè®¡åˆ†ææµ‹è¯•" {
  // æµ‹è¯•åº¦é‡æ•°æ®çš„èšåˆå’Œç»Ÿè®¡åŠŸèƒ½
  let meter_provider = MeterProvider::default()
  let meter = MeterProvider::get_meter(meter_provider, "analytics.service")
  
  // åˆ›å»ºå„ç§ç±»å‹çš„åº¦é‡
  let request_counter = Meter::create_counter(meter, "http.requests.total")
  let response_histogram = Meter::create_histogram(meter, "http.response.duration")
  let error_gauge = Meter::create_gauge(meter, "http.errors.current")
  let active_connections = Meter::create_updown_counter(meter, "http.connections.active")
  
  // æ¨¡æ‹Ÿä¸åŒæ—¶é—´æ®µçš„è¯·æ±‚è®¡æ•°
  Counter::add(request_counter, 100.0)  // ç¬¬ä¸€ä¸ªæ—¶é—´æ®µ
  Counter::add(request_counter, 150.0)  // ç¬¬äºŒä¸ªæ—¶é—´æ®µ
  Counter::add(request_counter, 200.0)  // ç¬¬ä¸‰ä¸ªæ—¶é—´æ®µ
  
  // æ¨¡æ‹Ÿå“åº”æ—¶é—´åˆ†å¸ƒ
  let response_times = [10.5, 25.3, 50.7, 100.2, 150.8, 200.1, 300.5, 500.9]
  for time in response_times {
    Histogram::record(response_histogram, time)
  }
  
  // æ¨¡æ‹Ÿé”™è¯¯è®¡æ•°å˜åŒ–
  Counter::add(error_gauge, 5.0)  // åˆå§‹é”™è¯¯æ•°
  Counter::add(error_gauge, 3.0)  // æ–°å¢é”™è¯¯
  Counter::add(error_gauge, -2.0)  // é”™è¯¯æ¢å¤
  
  // æ¨¡æ‹Ÿæ´»è·ƒè¿æ¥æ•°å˜åŒ–
  Counter::add(active_connections, 50.0)  // åˆå§‹è¿æ¥
  Counter::add(active_connections, 25.0)  // æ–°å¢è¿æ¥
  Counter::add(active_connections, -10.0)  // è¿æ¥å…³é—­
  
  // éªŒè¯åº¦é‡åˆ›å»º
  assert_eq(request_counter.name, "http.requests.total")
  assert_eq(response_histogram.name, "http.response.duration")
  assert_eq(error_gauge.name, "http.errors.current")
  assert_eq(active_connections.name, "http.connections.active")
}

test "æ—¥å¿—è®°å½•çš„ç»“æ„åŒ–å’ŒæŸ¥è¯¢æµ‹è¯•" {
  // æµ‹è¯•ç»“æ„åŒ–æ—¥å¿—è®°å½•å’ŒæŸ¥è¯¢åŠŸèƒ½
  let logger_provider = LoggerProvider::default()
  let api_logger = LoggerProvider::get_logger(logger_provider, "api.service")
  let db_logger = LoggerProvider::get_logger(logger_provider, "database.service")
  let auth_logger = LoggerProvider::get_logger(logger_provider, "auth.service")
  
  // åˆ›å»ºç»“æ„åŒ–æ—¥å¿—å±æ€§
  let request_attrs = Attributes::new()
  Attributes::set(request_attrs, "http.method", StringValue("GET"))
  Attributes::set(request_attrs, "http.path", StringValue("/api/v1/users"))
  Attributes::set(request_attrs, "user.id", StringValue("12345"))
  Attributes::set(request_attrs, "request.id", StringValue("req-abc123"))
  
  // APIè¯·æ±‚æ—¥å¿—
  let api_log = LogRecord::new_with_context(
    Info,
    Some("API request processed successfully"),
    Some(request_attrs),
    Some(1735689600000000000L),
    Some(1735689600000000001L),
    Some("trace-12345"),
    Some("span-67890"),
    Some(Context::root())
  )
  
  // æ•°æ®åº“æŸ¥è¯¢æ—¥å¿—
  let db_attrs = Attributes::new()
  Attributes::set(db_attrs, "db.operation", StringValue("SELECT"))
  Attributes::set(db_attrs, "db.table", StringValue("users"))
  Attributes::set(db_attrs, "db.duration", IntValue(25))
  
  let db_log = LogRecord::new_with_context(
    Info,
    Some("Database query completed"),
    Some(db_attrs),
    Some(1735689600000000002L),
    Some(1735689600000000003L),
    Some("trace-12345"),
    Some("span-67891"),
    Some(Context::root())
  )
  
  // è®¤è¯æ—¥å¿—
  let auth_attrs = Attributes::new()
  Attributes::set(auth_attrs, "auth.method", StringValue("JWT"))
  Attributes::set(auth_attrs, "auth.result", StringValue("success"))
  Attributes::set(auth_attrs, "auth.user", StringValue("user@example.com"))
  
  let auth_log = LogRecord::new_with_context(
    Info,
    Some("User authentication successful"),
    Some(auth_attrs),
    Some(1735689600000000004L),
    Some(1735689600000000005L),
    Some("trace-12345"),
    Some("span-67892"),
    Some(Context::root())
  )
  
  // é”™è¯¯æ—¥å¿—
  let error_log = LogRecord::new_with_context(
    Error,
    Some("Service temporarily unavailable"),
    Some(Attributes::new()),
    Some(1735689600000000006L),
    Some(1735689600000000007L),
    Some("trace-12345"),
    Some("span-67893"),
    Some(Context::root())
  )
  
  // å‘é€æ‰€æœ‰æ—¥å¿—
  Logger::emit(api_logger, api_log)
  Logger::emit(db_logger, db_log)
  Logger::emit(auth_logger, auth_log)
  Logger::emit(api_logger, error_log)
  
  // éªŒè¯æ—¥å¿—å†…å®¹
  assert_eq(LogRecord::body(api_log), Some("API request processed successfully"))
  assert_eq(LogRecord::severity_number(error_log), Error)
  assert_eq(LogRecord::trace_id(db_log), Some("trace-12345"))
  assert_eq(LogRecord::span_id(auth_log), Some("span-67892"))
}

test "èµ„æºç®¡ç†å’Œç¯å¢ƒé…ç½®åŠ¨æ€æ›´æ–°æµ‹è¯•" {
  // æµ‹è¯•èµ„æºç®¡ç†å’Œç¯å¢ƒé…ç½®çš„åŠ¨æ€æ›´æ–°
  let base_resource = Resource::new()
  
  // åˆå§‹èµ„æºé…ç½®
  let initial_attrs = [
    ("service.name", StringValue("payment.service")),
    ("service.version", StringValue("1.0.0")),
    ("deployment.environment", StringValue("staging")),
    ("host.name", StringValue("staging-host-01")),
    ("process.pid", IntValue(12345))
  ]
  
  let resource_v1 = Resource::with_attributes(base_resource, initial_attrs)
  
  // åŠ¨æ€æ›´æ–°é…ç½® - ç‰ˆæœ¬å‡çº§
  let update_attrs_v2 = [
    ("service.version", StringValue("1.1.0")),
    ("deployment.environment", StringValue("production")),
    ("host.name", StringValue("prod-host-01")),
    ("config.last.update", StringValue("2025-12-28T10:00:00Z"))
  ]
  
  let resource_v2 = Resource::with_attributes(base_resource, update_attrs_v2)
  
  // åŠ¨æ€æ›´æ–°é…ç½® - æ·»åŠ æ–°å±æ€§
  let update_attrs_v3 = [
    ("service.name", StringValue("payment.service")),
    ("service.version", StringValue("1.2.0")),
    ("deployment.environment", StringValue("production")),
    ("host.name", StringValue("prod-host-01")),
    ("service.instance.id", StringValue("instance-abc123")),
    ("cloud.region", StringValue("us-west-2")),
    ("cloud.availability.zone", StringValue("usw2-az1")),
    ("auto.scaling.group", StringValue("payment-asg-v1"))
  ]
  
  let resource_v3 = Resource::with_attributes(base_resource, update_attrs_v3)
  
  // æµ‹è¯•èµ„æºåˆå¹¶
  let merged_resource = Resource::merge(resource_v2, resource_v3)
  
  // éªŒè¯ä¸åŒç‰ˆæœ¬çš„èµ„æºé…ç½®
  let v1_service_name = Resource::get_attribute(resource_v1, "service.name")
  let v2_service_version = Resource::get_attribute(resource_v2, "service.version")
  let v3_instance_id = Resource::get_attribute(resource_v3, "service.instance.id")
  
  // åŸºäºç®€åŒ–å®ç°éªŒè¯
  assert_eq(v1_service_name, None)  // ç®€åŒ–å®ç°è¿”å›None
  assert_eq(v2_service_version, None)  // ç®€åŒ–å®ç°è¿”å›None
  assert_eq(v3_instance_id, None)  // ç®€åŒ–å®ç°è¿”å›None
}

test "ä¸Šä¸‹æ–‡ä¼ æ’­çš„å¤æ‚é“¾è·¯æµ‹è¯•" {
  // æµ‹è¯•å¤æ‚çš„ä¸Šä¸‹æ–‡ä¼ æ’­é“¾è·¯
  let root_ctx = Context::root()
  
  // ç¬¬ä¸€å±‚ï¼šç”¨æˆ·ä¸Šä¸‹æ–‡
  let user_key = ContextKey::new("user.id")
  let ctx_with_user = Context::with_value(root_ctx, user_key, "user-12345")
  
  // ç¬¬äºŒå±‚ï¼šè¯·æ±‚ä¸Šä¸‹æ–‡
  let request_key = ContextKey::new("request.id")
  let ctx_with_request = Context::with_value(ctx_with_user, request_key, "req-abc123")
  
  // ç¬¬ä¸‰å±‚ï¼šä¼šè¯ä¸Šä¸‹æ–‡
  let session_key = ContextKey::new("session.id")
  let ctx_with_session = Context::with_value(ctx_with_request, session_key, "session-xyz789")
  
  // ç¬¬å››å±‚ï¼šè¿½è¸ªä¸Šä¸‹æ–‡
  let trace_key = ContextKey::new("trace.id")
  let ctx_with_trace = Context::with_value(ctx_with_session, trace_key, "trace-12345")
  
  // ç¬¬äº”å±‚ï¼šä¸šåŠ¡ä¸Šä¸‹æ–‡
  let business_key = ContextKey::new("business.transaction.id")
  let ctx_with_business = Context::with_value(ctx_with_trace, business_key, "txn-67890")
  
  // éªŒè¯æ¯ä¸€å±‚çš„ä¸Šä¸‹æ–‡éƒ½èƒ½æ­£ç¡®è·å–
  let user_id = Context::get(ctx_with_business, user_key)
  let request_id = Context::get(ctx_with_business, request_key)
  let session_id = Context::get(ctx_with_business, session_key)
  let trace_id = Context::get(ctx_with_business, trace_key)
  let transaction_id = Context::get(ctx_with_business, business_key)
  
  assert_eq(user_id, Some("user-12345"))
  assert_eq(request_id, Some("req-abc123"))
  assert_eq(session_id, Some("session-xyz789"))
  assert_eq(trace_id, Some("trace-12345"))
  assert_eq(transaction_id, Some("txn-67890"))
  
  // æµ‹è¯•Baggageçš„å¤æ‚ä¼ æ’­
  let baggage = Baggage::new()
  let baggage1 = Baggage::set_entry(baggage, "user.locale", "zh-CN")
  let baggage2 = Baggage::set_entry(baggage1, "user.timezone", "Asia/Shanghai")
  let baggage3 = Baggage::set_entry(baggage2, "request.priority", "high")
  let baggage4 = Baggage::set_entry(baggage3, "service.version", "2.1.0")
  
  // éªŒè¯æ‰€æœ‰Baggageæ¡ç›®
  let locale = Baggage::get_entry(baggage4, "user.locale")
  let timezone = Baggage::get_entry(baggage4, "user.timezone")
  let priority = Baggage::get_entry(baggage4, "request.priority")
  let version = Baggage::get_entry(baggage4, "service.version")
  
  assert_eq(locale, Some("zh-CN"))
  assert_eq(timezone, Some("Asia/Shanghai"))
  assert_eq(priority, Some("high"))
  assert_eq(version, Some("2.1.0"))
}

test "æ€§èƒ½ç›‘æ§å’ŒåŸºå‡†æµ‹è¯•" {
  // æµ‹è¯•æ€§èƒ½ç›‘æ§å’ŒåŸºå‡†æµ‹è¯•åŠŸèƒ½
  let clock = Clock::system()
  
  // æµ‹è¯•Clockæ€§èƒ½
  let clock_start = Clock::now_unix_nanos(clock)
  let timestamps = []
  
  // ç”Ÿæˆ1000ä¸ªæ—¶é—´æˆ³
  for i = 0; i < 1000; i = i + 1 {
    timestamps.push(Clock::now_unix_nanos(clock))
  }
  
  let clock_end = Clock::now_unix_nanos(clock)
  let clock_duration = clock_end - clock_start
  
  // éªŒè¯æ—¶é—´æˆ³å•è°ƒé€’å¢
  for i = 1; i < timestamps.length(); i = i + 1 {
    assert_true(timestamps[i] >= timestamps[i-1])
  }
  
  // æµ‹è¯•Randomç”Ÿæˆæ€§èƒ½
  let random = Random::system()
  let random_start = Clock::now_unix_nanos(clock)
  let random_values = []
  
  // ç”Ÿæˆ1000ä¸ªéšæœºæ•°
  for i = 0; i < 1000; i = i + 1 {
    random_values.push(Random::next_u64(random))
  }
  
  let random_end = Clock::now_unix_nanos(clock)
  let random_duration = random_end - random_start
  
  // éªŒè¯éšæœºæ•°åœ¨åˆç†èŒƒå›´å†…
  for value in random_values {
    assert_true(value.to_int() >= 0)
  }
  
  // æµ‹è¯•Spanåˆ›å»ºæ€§èƒ½
  let tracer_provider = TracerProvider::default()
  let tracer = TracerProvider::get_tracer(tracer_provider, "performance.test")
  
  let span_start = Clock::now_unix_nanos(clock)
  let spans = []
  
  // åˆ›å»º1000ä¸ªSpan
  for i = 0; i < 1000; i = i + 1 {
    let span = Tracer::start_span(tracer, "perf.span." + i.to_string())
    spans.push(span)
  }
  
  let span_end = Clock::now_unix_nanos(clock)
  let span_duration = span_end - span_start
  
  // æ‰¹é‡ç»“æŸSpan
  for span in spans {
    Span::end(span)
  }
  
  // éªŒè¯æ€§èƒ½åœ¨åˆç†èŒƒå›´å†…
  assert_true(clock_duration < 10000000000L)  // å°äº10ç§’
  assert_true(random_duration < 10000000000L)  // å°äº10ç§’
  assert_true(span_duration < 10000000000L)  // å°äº10ç§’
}

test "é”™è¯¯å¤„ç†å’Œæ¢å¤æœºåˆ¶æµ‹è¯•" {
  // æµ‹è¯•é”™è¯¯å¤„ç†å’Œæ¢å¤æœºåˆ¶
  let tracer_provider = TracerProvider::default()
  let tracer = TracerProvider::get_tracer(tracer_provider, "error.handling.test")
  
  // åˆ›å»ºä¸€ä¸ªä¼šç»å†é”™è¯¯çš„Span
  let error_span = Tracer::start_span(tracer, "error.prone.operation")
  
  // æ¨¡æ‹Ÿç¬¬ä¸€é˜¶æ®µé”™è¯¯
  Span::add_event(error_span, "operation.started", Some([
    ("operation.type", StringValue("database.query")),
    ("retry.count", IntValue(0))
  ]))
  
  Span::set_status(error_span, Error, Some("Connection timeout"))
  Span::add_event(error_span, "error.occurred", Some([
    ("error.type", StringValue("timeout")),
    ("error.code", StringValue("DB_CONN_TIMEOUT")),
    ("retry.count", IntValue(1))
  ]))
  
  // æ¨¡æ‹Ÿé‡è¯•å’Œæ¢å¤
  Span::set_status(error_span, Error, Some("Retrying with different connection"))
  Span::add_event(error_span, "retry.started", Some([
    ("retry.strategy", StringValue("exponential.backoff")),
    ("retry.count", IntValue(2))
  ]))
  
  // æ¨¡æ‹ŸæˆåŠŸæ¢å¤
  Span::set_status(error_span, Ok, Some("Operation completed successfully"))
  Span::add_event(error_span, "operation.completed", Some([
    ("result.status", StringValue("success")),
    ("total.retries", IntValue(2)),
    ("final.duration", IntValue(5000))
  ]))
  
  Span::end(error_span)
  
  // æµ‹è¯•æ—¥å¿—é”™è¯¯è®°å½•
  let logger_provider = LoggerProvider::default()
  let logger = LoggerProvider::get_logger(logger_provider, "error.logger")
  
  // åˆ›å»ºä¸åŒçº§åˆ«çš„é”™è¯¯æ—¥å¿—
  let warning_log = LogRecord::new_with_context(
    Warn,
    Some("Deprecated API usage detected"),
    Some(Attributes::new()),
    Some(1735689600000000000L),
    None,
    Some("error-trace-123"),
    Some("error-span-456"),
    Some(Context::root())
  )
  
  let error_log = LogRecord::new_with_context(
    Error,
    Some("Database connection pool exhausted"),
    Some(Attributes::with_attributes(Attributes::new(), [
      ("pool.size", IntValue(10)),
      ("active.connections", IntValue(10)),
      ("pending.requests", IntValue(25))
    ])),
    Some(1735689600000000001L),
    None,
    Some("error-trace-123"),
    Some("error-span-789"),
    Some(Context::root())
  )
  
  let fatal_log = LogRecord::new_with_context(
    Fatal,
    Some("System out of memory"),
    Some(Attributes::with_attributes(Attributes::new(), [
      ("memory.usage", IntValue(8589934592)),
      ("memory.limit", IntValue(8589934592)),
      ("available.memory", IntValue(0))
    ])),
    Some(1735689600000000002L),
    None,
    Some("error-trace-123"),
    Some("error-span-999"),
    Some(Context::root())
  )
  
  // å‘é€é”™è¯¯æ—¥å¿—
  Logger::emit(logger, warning_log)
  Logger::emit(logger, error_log)
  Logger::emit(logger, fatal_log)
  
  // éªŒè¯é”™è¯¯æ—¥å¿—å†…å®¹
  assert_eq(LogRecord::severity_number(warning_log), Warn)
  assert_eq(LogRecord::severity_number(error_log), Error)
  assert_eq(LogRecord::severity_number(fatal_log), Fatal)
  
  match LogRecord::body(error_log) {
    Some(body) => assert_eq(body, "Database connection pool exhausted")
    None => assert_true(false)
  }
}

test "å›½é™…åŒ–æ”¯æŒå’Œå¤šè¯­è¨€å¤„ç†æµ‹è¯•" {
  // æµ‹è¯•å›½é™…åŒ–å’Œå¤šè¯­è¨€æ”¯æŒ
  let logger_provider = LoggerProvider::default()
  let logger = LoggerProvider::get_logger(logger_provider, "i18n.test")
  
  // åˆ›å»ºä¸åŒè¯­è¨€çš„æ—¥å¿—è®°å½•
  let english_log = LogRecord::new(Info, "User authentication successful")
  let chinese_log = LogRecord::new(Info, "ç”¨æˆ·è®¤è¯æˆåŠŸ")
  let japanese_log = LogRecord::new(Info, "ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼æˆåŠŸ")
  let korean_log = LogRecord::new(Info, "ì‚¬ìš©ì ì¸ì¦ ì„±ê³µ")
  let arabic_log = LogRecord::new(Info, "Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­")
  let russian_log = LogRecord::new(Info, "ĞÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ ÑƒÑĞ¿ĞµÑˆĞ½Ğ°")
  let spanish_log = LogRecord::new(Info, "AutenticaciÃ³n de usuario exitosa")
  let french_log = LogRecord::new(Info, "Authentification utilisateur rÃ©ussie")
  let german_log = LogRecord::new(Info, "Benutzerauthentifizierung erfolgreich")
  let mixed_log = LogRecord::new(Info, "Mixed: English ä¸­æ–‡ æ—¥æœ¬è¯­ ğŸŒ")
  
  // æµ‹è¯•å¸¦æœ‰Unicodeå­—ç¬¦çš„å±æ€§
  let unicode_attrs = Attributes::new()
  Attributes::set(unicode_attrs, "ç”¨æˆ·.å§“å", StringValue("å¼ ä¸‰"))
  Attributes::set(unicode_attrs, "ç”¨æˆ·.é‚®ç®±", StringValue("å¼ ä¸‰@example.com"))
  Attributes::set(unicode_attrs, "ç‰¹æ®Š.å­—ç¬¦", StringValue("ğŸš€ğŸ“Šâš¡"))
  Attributes::set(unicode_attrs, "é˜¿æ‹‰ä¼¯è¯­", StringValue("Ù…Ø±Ø­Ø¨Ø§"))
  Attributes::set(unicode_attrs, "ä¿„è¯­", StringValue("ĞŸÑ€Ğ¸Ğ²ĞµÑ‚"))
  
  let unicode_log = LogRecord::new_with_context(
    Info,
    Some("Unicode test: æµ‹è¯• Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ñ€ÑƒÑÑĞºĞ¸Ğ¹"),
    Some(unicode_attrs),
    Some(1735689600000000000L),
    None,
    Some("unicode-trace"),
    Some("unicode-span"),
    Some(Context::root())
  )
  
  // å‘é€æ‰€æœ‰æ—¥å¿—
  Logger::emit(logger, english_log)
  Logger::emit(logger, chinese_log)
  Logger::emit(logger, japanese_log)
  Logger::emit(logger, korean_log)
  Logger::emit(logger, arabic_log)
  Logger::emit(logger, russian_log)
  Logger::emit(logger, spanish_log)
  Logger::emit(logger, french_log)
  Logger::emit(logger, german_log)
  Logger::emit(logger, mixed_log)
  Logger::emit(logger, unicode_log)
  
  // éªŒè¯æ‰€æœ‰æ—¥å¿—éƒ½èƒ½æ­£ç¡®å¤„ç†
  assert_eq(LogRecord::body(english_log), Some("User authentication successful"))
  assert_eq(LogRecord::body(chinese_log), Some("ç”¨æˆ·è®¤è¯æˆåŠŸ"))
  assert_eq(LogRecord::body(japanese_log), Some("ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼æˆåŠŸ"))
  assert_eq(LogRecord::body(korean_log), Some("ì‚¬ìš©ì ì¸ì¦ ì„±ê³µ"))
  assert_eq(LogRecord::body(arabic_log), Some("Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­"))
  assert_eq(LogRecord::body(russian_log), Some("ĞÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ ÑƒÑĞ¿ĞµÑˆĞ½Ğ°"))
  assert_eq(LogRecord::body(spanish_log), Some("AutenticaciÃ³n de usuario exitosa"))
  assert_eq(LogRecord::body(french_log), Some("Authentification utilisateur rÃ©ussie"))
  assert_eq(LogRecord::body(german_log), Some("Benutzerauthentifizierung erfolgreich"))
  assert_eq(LogRecord::body(mixed_log), Some("Mixed: English ä¸­æ–‡ æ—¥æœ¬è¯­ ğŸŒ"))
  assert_eq(LogRecord::body(unicode_log), Some("Unicode test: æµ‹è¯• Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ñ€ÑƒÑÑĞºĞ¸Ğ¹"))
}

test "ç«¯åˆ°ç«¯ä¸šåŠ¡æµç¨‹é›†æˆæµ‹è¯•" {
  // æµ‹è¯•å®Œæ•´çš„ç«¯åˆ°ç«¯ä¸šåŠ¡æµç¨‹
  let tracer_provider = TracerProvider::default()
  let meter_provider = MeterProvider::default()
  let logger_provider = LoggerProvider::default()
  
  // åˆå§‹åŒ–æ‰€æœ‰é¥æµ‹ç»„ä»¶
  let order_tracer = TracerProvider::get_tracer(tracer_provider, "order.service")
  let payment_tracer = TracerProvider::get_tracer(tracer_provider, "payment.service")
  let inventory_tracer = TracerProvider::get_tracer(tracer_provider, "inventory.service")
  let notification_tracer = TracerProvider::get_tracer(tracer_provider, "notification.service")
  
  let order_meter = MeterProvider::get_meter(meter_provider, "order.metrics")
  let payment_meter = MeterProvider::get_meter(meter_provider, "payment.metrics")
  
  let order_logger = LoggerProvider::get_logger(logger_provider, "order.logger")
  let payment_logger = LoggerProvider::get_logger(logger_provider, "payment.logger")
  
  // åˆ›å»ºåº¦é‡
  let order_counter = Meter::create_counter(order_meter, "orders.total")
  let payment_amount_histogram = Meter::create_histogram(payment_meter, "payment.amount")
  let order_duration_histogram = Meter::create_histogram(order_meter, "order.processing.duration")
  
  // å¼€å§‹è®¢å•å¤„ç†æµç¨‹
  let order_span = Tracer::start_span(order_tracer, "order.processing")
  Span::add_event(order_span, "order.received", Some([
    ("order.id", StringValue("order-12345")),
    ("user.id", StringValue("user-67890")),
    ("order.amount", IntValue(9999))
  ]))
  
  // è®°å½•è®¢å•åº¦é‡
  Counter::add(order_counter, 1.0)
  
  // è®°å½•è®¢å•æ—¥å¿—
  let order_received_log = LogRecord::new_with_context(
    Info,
    Some("Order received for processing"),
    Some(Attributes::with_attributes(Attributes::new(), [
      ("order.id", StringValue("order-12345")),
      ("user.id", StringValue("user-67890")),
      ("order.amount", IntValue(9999))
    ])),
    Some(1735689600000000000L),
    None,
    Some(SpanContext::trace_id(Span::span_context(order_span))),
    Some(SpanContext::span_id(Span::span_context(order_span))),
    Some(Context::root())
  )
  Logger::emit(order_logger, order_received_log)
  
  // å¤„ç†æ”¯ä»˜
  let payment_span = Tracer::start_span(payment_tracer, "payment.processing")
  Span::add_event(payment_span, "payment.started", Some([
    ("payment.method", StringValue("credit_card")),
    ("payment.amount", IntValue(9999))
  ]))
  
  // è®°å½•æ”¯ä»˜åº¦é‡
  Histogram::record(payment_amount_histogram, 9999.0)
  
  // æ¨¡æ‹Ÿæ”¯ä»˜æˆåŠŸ
  Span::set_status(payment_span, Ok)
  Span::add_event(payment_span, "payment.completed", Some([
    ("payment.id", StringValue("pay-abc123")),
    ("payment.status", StringValue("success"))
  ]))
  Span::end(payment_span)
  
  // è®°å½•æ”¯ä»˜æ—¥å¿—
  let payment_success_log = LogRecord::new_with_context(
    Info,
    Some("Payment processed successfully"),
    Some(Attributes::with_attributes(Attributes::new(), [
      ("payment.id", StringValue("pay-abc123")),
      ("payment.amount", IntValue(9999)),
      ("payment.method", StringValue("credit_card"))
    ])),
    Some(1735689600000000001L),
    None,
    Some(SpanContext::trace_id(Span::span_context(order_span))),
    Some("payment-span-456"),
    Some(Context::root())
  )
  Logger::emit(payment_logger, payment_success_log)
  
  // æ›´æ–°åº“å­˜
  let inventory_span = Tracer::start_span(inventory_tracer, "inventory.update")
  Span::add_event(inventory_span, "inventory.reserved", Some([
    ("product.id", StringValue("prod-123")),
    ("quantity", IntValue(1))
  ]))
  Span::set_status(inventory_span, Ok)
  Span::end(inventory_span)
  
  // å‘é€é€šçŸ¥
  let notification_span = Tracer::start_span(notification_tracer, "notification.send")
  Span::add_event(notification_span, "notification.sent", Some([
    ("notification.type", StringValue("email")),
    ("recipient", StringValue("user@example.com"))
  ]))
  Span::set_status(notification_span, Ok)
  Span::end(notification_span)
  
  // å®Œæˆè®¢å•å¤„ç†
  Histogram::record(order_duration_histogram, 5000.0)
  Span::set_status(order_span, Ok, Some("Order processed successfully"))
  Span::add_event(order_span, "order.completed", Some([
    ("order.status", StringValue("completed")),
    ("processing.time", IntValue(5000))
  ]))
  Span::end(order_span)
  
  // è®°å½•å®Œæˆæ—¥å¿—
  let order_completed_log = LogRecord::new_with_context(
    Info,
    Some("Order processing completed successfully"),
    Some(Attributes::with_attributes(Attributes::new(), [
      ("order.id", StringValue("order-12345")),
      ("final.status", StringValue("completed"))
    ])),
    Some(1735689600000000002L),
    None,
    Some(SpanContext::trace_id(Span::span_context(order_span))),
    Some(SpanContext::span_id(Span::span_context(order_span))),
    Some(Context::root())
  )
  Logger::emit(order_logger, order_completed_log)
  
  // éªŒè¯æ•´ä¸ªæµç¨‹
  assert_eq(Span::name(order_span), "order.processing")
  assert_eq(Span::name(payment_span), "payment.processing")
  assert_eq(Span::name(inventory_span), "inventory.update")
  assert_eq(Span::name(notification_span), "notification.send")
  
  assert_eq(order_counter.name, "orders.total")
  assert_eq(payment_amount_histogram.name, "payment.amount")
  assert_eq(order_duration_histogram.name, "order.processing.duration")
}