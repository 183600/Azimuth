// Azimuth Metrics Gauge Detailed Tests
// This file contains detailed tests for gauge metrics in the Azimuth telemetry system

// Test 1: Basic gauge creation and configuration
pub test "åº¦é‡ä»ªè¡¨è¯¦ç»†æµ‹è¯•ï¼šåŸºæœ¬ä»ªè¡¨åˆ›å»ºå’Œé…ç½®" {
  let meter_provider = azimuth::MeterProvider::default()
  let meter = azimuth::MeterProvider::get_meter(meter_provider, "gauge-test-meter")
  
  // åˆ›å»ºåŸºæœ¬çš„Gaugeä»ªè¡¨
  let cpu_gauge = azimuth::Meter::create_gauge(meter, "cpu.usage", Some("CPU usage percentage"), Some("%"))
  let memory_gauge = azimuth::Meter::create_gauge(meter, "memory.usage", Some("Memory usage in MB"), Some("MB"))
  let disk_gauge = azimuth::Meter::create_gauge(meter, "disk.usage", Some("Disk usage in GB"), Some("GB"))
  
  // éªŒè¯Gaugeå±æ€§
  assert_eq(cpu_gauge.name, "cpu.usage")
  assert_eq(cpu_gauge.description, Some("CPU usage percentage"))
  assert_eq(cpu_gauge.unit, Some("%"))
  
  assert_eq(memory_gauge.name, "memory.usage")
  assert_eq(memory_gauge.description, Some("Memory usage in MB"))
  assert_eq(memory_gauge.unit, Some("MB"))
  
  assert_eq(disk_gauge.name, "disk.usage")
  assert_eq(disk_gauge.description, Some("Disk usage in GB"))
  assert_eq(disk_gauge.unit, Some("GB"))
  
  // æµ‹è¯•Gaugeçš„å‘½åçº¦å®šå’Œè¾¹ç•Œæƒ…å†µ
  let empty_name_gauge = azimuth::Meter::create_gauge(meter, "", Some("Empty name gauge"), None)
  let very_long_name_gauge = azimuth::Meter::create_gauge(meter, "this.is.a.very.long.gauge.name.that.exceeds.normal.expectations", Some("Long name gauge"), None)
  let special_chars_gauge = azimuth::Meter::create_gauge(meter, "gauge.with-special_chars_123", Some("Special chars gauge"), None)
  
  // éªŒè¯è¾¹ç•Œæƒ…å†µ
  assert_eq(empty_name_gauge.name, "")
  assert_eq(very_long_name_gauge.name, "this.is.a.very.long.gauge.name.that.exceeds.normal.expectations")
  assert_eq(special_chars_gauge.name, "gauge.with-special_chars_123")
  
  // æµ‹è¯•Gaugeçš„æè¿°å’Œå•ä½è¾¹ç•Œæƒ…å†µ
  let empty_desc_gauge = azimuth::Meter::create_gauge(meter, "empty.desc", Some(""), Some("unit"))
  let no_desc_gauge = azimuth::Meter::create_gauge(meter, "no.desc", None, Some("unit"))
  let empty_unit_gauge = azimuth::Meter::create_gauge(meter, "empty.unit", Some("description"), Some(""))
  let no_unit_gauge = azimuth::Meter::create_gauge(meter, "no.unit", Some("description"), None)
  
  // éªŒè¯æè¿°å’Œå•ä½è¾¹ç•Œæƒ…å†µ
  assert_eq(empty_desc_gauge.description, Some(""))
  assert_eq(no_desc_gauge.description, None)
  assert_eq(empty_unit_gauge.unit, Some(""))
  assert_eq(no_unit_gauge.unit, None)
}

// Test 2: Gauge value operations
pub test "åº¦é‡ä»ªè¡¨è¯¦ç»†æµ‹è¯•ï¼šä»ªè¡¨å€¼æ“ä½œ" {
  let meter_provider = azimuth::MeterProvider::default()
  let meter = azimuth::MeterProvider::get_meter(meter_provider, "gauge-operations-meter")
  
  // åˆ›å»ºç”¨äºæ“ä½œçš„Gauge
  let temperature_gauge = azimuth::Meter::create_gauge(meter, "temperature", Some("Current temperature"), Some("celsius"))
  let pressure_gauge = azimuth::Meter::create_gauge(meter, "pressure", Some("Current pressure"), Some("pascal"))
  let humidity_gauge = azimuth::Meter::create_gauge(meter, "humidity", Some("Current humidity"), Some("percent"))
  
  // æ³¨æ„ï¼šå½“å‰ç®€åŒ–å®ç°å¯èƒ½ä¸æ”¯æŒGaugeçš„record/setæ–¹æ³•
  // è¿™é‡Œä¸»è¦æµ‹è¯•ç»“æ„åˆ›å»ºå’Œå±æ€§éªŒè¯
  
  // éªŒè¯Gaugeåˆ›å»ºæˆåŠŸ
  assert_eq(temperature_gauge.name, "temperature")
  assert_eq(temperature_gauge.description, Some("Current temperature"))
  assert_eq(temperature_gauge.unit, Some("celsius"))
  
  assert_eq(pressure_gauge.name, "pressure")
  assert_eq(pressure_gauge.description, Some("Current pressure"))
  assert_eq(pressure_gauge.unit, Some("pascal"))
  
  assert_eq(humidity_gauge.name, "humidity")
  assert_eq(humidity_gauge.description, Some("Current humidity"))
  assert_eq(humidity_gauge.unit, Some("percent"))
  
  // æµ‹è¯•Gaugeä½œä¸ºInstrumentçš„è½¬æ¢
  let temp_instrument = azimuth::Histogram::as_instrument(azimuth::Meter::create_histogram(meter, "temp.histogram"))
  assert_eq(azimuth::Instrument::name(temp_instrument), "temp.histogram")
  
  // æµ‹è¯•ä¸åŒç±»å‹çš„Gaugeå€¼
  let integer_gauge = azimuth::Meter::create_gauge(meter, "integer.gauge", Some("Integer gauge"), Some("count"))
  let float_gauge = azimuth::Meter::create_gauge(meter, "float.gauge", Some("Float gauge"), Some("value"))
  let negative_gauge = azimuth::Meter::create_gauge(meter, "negative.gauge", Some("Negative gauge"), Some("value"))
  let zero_gauge = azimuth::Meter::create_gauge(meter, "zero.gauge", Some("Zero gauge"), Some("value"))
  
  // éªŒè¯ä¸åŒç±»å‹Gaugeçš„å±æ€§
  assert_eq(integer_gauge.name, "integer.gauge")
  assert_eq(integer_gauge.description, Some("Integer gauge"))
  assert_eq(integer_gauge.unit, Some("count"))
  
  assert_eq(float_gauge.name, "float.gauge")
  assert_eq(float_gauge.description, Some("Float gauge"))
  assert_eq(float_gauge.unit, Some("value"))
  
  assert_eq(negative_gauge.name, "negative.gauge")
  assert_eq(negative_gauge.description, Some("Negative gauge"))
  assert_eq(negative_gauge.unit, Some("value"))
  
  assert_eq(zero_gauge.name, "zero.gauge")
  assert_eq(zero_gauge.description, Some("Zero gauge"))
  assert_eq(zero_gauge.unit, Some("value"))
}

// Test 3: Gauge performance characteristics
pub test "åº¦é‡ä»ªè¡¨è¯¦ç»†æµ‹è¯•ï¼šä»ªè¡¨æ€§èƒ½ç‰¹å¾" {
  let meter_provider = azimuth::MeterProvider::default()
  let meter = azimuth::MeterProvider::get_meter(meter_provider, "gauge-performance-meter")
  
  // æµ‹è¯•å¤§é‡Gaugeåˆ›å»ºçš„æ€§èƒ½
  let gauge_start_time = azimuth::Clock::now_unix_nanos(azimuth::Clock::system())
  
  let gauges = []
  for i in 0..1000 {
    let gauge = azimuth::Meter::create_gauge(meter, "performance.gauge." + i.to_string(), Some("Performance gauge " + i.to_string()), Some("unit"))
    gauges.push(gauge)
  }
  
  let gauge_end_time = azimuth::Clock::now_unix_nanos(azimuth::Clock::system())
  let gauge_creation_duration = gauge_end_time - gauge_start_time
  
  // éªŒè¯æ€§èƒ½åœ¨åˆç†èŒƒå›´å†…
  assert_true(gauge_creation_duration < 5000000000L)  // å°äº5ç§’
  assert_true(gauges.length() == 1000)
  
  // è®¡ç®—å¹³å‡æ¯ä¸ªGaugeçš„åˆ›å»ºæ—¶é—´
  let avg_gauge_creation_time = gauge_creation_duration.to_double() / 1000.0
  assert_true(avg_gauge_creation_time < 5000000.0)  // æ¯ä¸ªGaugeå°äº5æ¯«ç§’
  
  // æµ‹è¯•Gaugeå±æ€§è®¿é—®çš„æ€§èƒ½
  let access_start_time = azimuth::Clock::now_unix_nanos(azimuth::Clock::system())
  
  for gauge in gauges {
    let name = gauge.name
    let description = gauge.description
    let unit = gauge.unit
    
    // éªŒè¯å±æ€§è®¿é—®
    assert_true(name.length() > 0)
  }
  
  let access_end_time = azimuth::Clock::now_unix_nanos(azimuth::Clock::system())
  let access_duration = access_end_time - access_start_time
  
  // éªŒè¯è®¿é—®æ€§èƒ½åœ¨åˆç†èŒƒå›´å†…
  assert_true(access_duration < 1000000000L)  // å°äº1ç§’
  
  // è®¡ç®—å¹³å‡æ¯ä¸ªGaugeçš„å±æ€§è®¿é—®æ—¶é—´
  let avg_access_time = access_duration.to_double() / 1000.0
  assert_true(avg_access_time < 1000000.0)  // æ¯ä¸ªGaugeå°äº1æ¯«ç§’
}

// Test 4: Gauge with special values and edge cases
pub test "åº¦é‡ä»ªè¡¨è¯¦ç»†æµ‹è¯•ï¼šä»ªè¡¨ç‰¹æ®Šå€¼å’Œè¾¹ç•Œæƒ…å†µ" {
  let meter_provider = azimuth::MeterProvider::default()
  let meter = azimuth::MeterProvider::get_meter(meter_provider, "gauge-edge-cases-meter")
  
  // æµ‹è¯•æå€¼çš„Gauge
  let max_value_gauge = azimuth::Meter::create_gauge(meter, "max.value", Some("Maximum value gauge"), Some("unit"))
  let min_value_gauge = azimuth::Meter::create_gauge(meter, "min.value", Some("Minimum value gauge"), Some("unit"))
  let infinity_gauge = azimuth::Meter::create_gauge(meter, "infinity", Some("Infinity gauge"), Some("unit"))
  let negative_infinity_gauge = azimuth::Meter::create_gauge(meter, "negative.infinity", Some("Negative infinity gauge"), Some("unit"))
  let nan_gauge = azimuth::Meter::create_gauge(meter, "nan", Some("NaN gauge"), Some("unit"))
  
  // éªŒè¯æå€¼Gaugeçš„å±æ€§
  assert_eq(max_value_gauge.name, "max.value")
  assert_eq(max_value_gauge.description, Some("Maximum value gauge"))
  assert_eq(max_value_gauge.unit, Some("unit"))
  
  assert_eq(min_value_gauge.name, "min.value")
  assert_eq(min_value_gauge.description, Some("Minimum value gauge"))
  assert_eq(min_value_gauge.unit, Some("unit"))
  
  assert_eq(infinity_gauge.name, "infinity")
  assert_eq(infinity_gauge.description, Some("Infinity gauge"))
  assert_eq(infinity_gauge.unit, Some("unit"))
  
  assert_eq(negative_infinity_gauge.name, "negative.infinity")
  assert_eq(negative_infinity_gauge.description, Some("Negative infinity gauge"))
  assert_eq(negative_infinity_gauge.unit, Some("unit"))
  
  assert_eq(nan_gauge.name, "nan")
  assert_eq(nan_gauge.description, Some("NaN gauge"))
  assert_eq(nan_gauge.unit, Some("unit"))
  
  // æµ‹è¯•ç‰¹æ®Šå­—ç¬¦çš„Gaugeåç§°å’Œæè¿°
  let unicode_gauge = azimuth::Meter::create_gauge(meter, "æµ‹è¯•ä»ªè¡¨ğŸš€", Some("æµ‹è¯•æè¿°"), Some("å•ä½"))
  let emoji_gauge = azimuth::Meter::create_gauge(meter, "emoji.gaugeğŸ˜€", Some("Emoji gauge ğŸ˜€"), Some("unitğŸ“"))
  let special_chars_gauge = azimuth::Meter::create_gauge(meter, "special.chars!@#$%", Some("Special chars !@#$%"), Some("unit!@"))
  
  // éªŒè¯ç‰¹æ®Šå­—ç¬¦Gaugeçš„å±æ€§
  assert_eq(unicode_gauge.name, "æµ‹è¯•ä»ªè¡¨ğŸš€")
  assert_eq(unicode_gauge.description, Some("æµ‹è¯•æè¿°"))
  assert_eq(unicode_gauge.unit, Some("å•ä½"))
  
  assert_eq(emoji_gauge.name, "emoji.gaugeğŸ˜€")
  assert_eq(emoji_gauge.description, Some("Emoji gauge ğŸ˜€"))
  assert_eq(emoji_gauge.unit, Some("unitğŸ“"))
  
  assert_eq(special_chars_gauge.name, "special.chars!@#$%")
  assert_eq(special_chars_gauge.description, Some("Special chars !@#$%"))
  assert_eq(special_chars_gauge.unit, Some("unit!@"))
  
  // æµ‹è¯•æé•¿åç§°å’Œæè¿°çš„Gauge
  let very_long_name = "this.is.a.very.long.gauge.name.that.exceeds.normal.expectations.and.tests.boundary.conditions"
  let very_long_description = "this.is.a.very.long.gauge.description.that.exceeds.normal.expectations.and.tests.boundary.conditions"
  let very_long_unit = "this.is.a.very.long.unit.name.that.exceeds.normal.expectations"
  
  let long_gauge = azimuth::Meter::create_gauge(meter, very_long_name, Some(very_long_description), Some(very_long_unit))
  
  // éªŒè¯æé•¿åç§°å’Œæè¿°çš„Gauge
  assert_eq(long_gauge.name, very_long_name)
  assert_eq(long_gauge.description, Some(very_long_description))
  assert_eq(long_gauge.unit, Some(very_long_unit))
}

// Test 5: Gauge in different contexts
pub test "åº¦é‡ä»ªè¡¨è¯¦ç»†æµ‹è¯•ï¼šä¸åŒä¸Šä¸‹æ–‡ä¸­çš„ä»ªè¡¨" {
  // æµ‹è¯•ä¸åŒMeterä¸­çš„Gauge
  let meter_provider = azimuth::MeterProvider::default()
  
  let system_meter = azimuth::MeterProvider::get_meter(meter_provider, "system.metrics")
  let application_meter = azimuth::MeterProvider::get_meter(meter_provider, "application.metrics")
  let business_meter = azimuth::MeterProvider::get_meter(meter_provider, "business.metrics")
  
  // åœ¨ä¸åŒMeterä¸­åˆ›å»ºGauge
  let cpu_gauge = azimuth::Meter::create_gauge(system_meter, "cpu.usage", Some("CPU usage"), Some("%"))
  let memory_gauge = azimuth::Meter::create_gauge(system_meter, "memory.usage", Some("Memory usage"), Some("MB"))
  
  let request_rate_gauge = azimuth::Meter::create_gauge(application_meter, "request.rate", Some("Request rate"), Some("req/s"))
  let response_time_gauge = azimuth::Meter::create_gauge(application_meter, "response.time", Some("Response time"), Some("ms"))
  
  let revenue_gauge = azimuth::Meter::create_gauge(business_meter, "revenue", Some("Current revenue"), Some("USD"))
  let user_count_gauge = azimuth::Meter::create_gauge(business_meter, "user.count", Some("Active users"), Some("count"))
  
  // éªŒè¯ä¸åŒä¸Šä¸‹æ–‡ä¸­çš„Gauge
  assert_eq(cpu_gauge.name, "cpu.usage")
  assert_eq(memory_gauge.name, "memory.usage")
  assert_eq(request_rate_gauge.name, "request.rate")
  assert_eq(response_time_gauge.name, "response.time")
  assert_eq(revenue_gauge.name, "revenue")
  assert_eq(user_count_gauge.name, "user.count")
  
  // æµ‹è¯•ç›¸åŒåç§°çš„Gaugeåœ¨ä¸åŒMeterä¸­
  let system_status_gauge = azimuth::Meter::create_gauge(system_meter, "status", Some("System status"), Some("code"))
  let application_status_gauge = azimuth::Meter::create_gauge(application_meter, "status", Some("Application status"), Some("code"))
  let business_status_gauge = azimuth::Meter::create_gauge(business_meter, "status", Some("Business status"), Some("code"))
  
  // éªŒè¯ç›¸åŒåç§°çš„Gaugeåœ¨ä¸åŒMeterä¸­å¯ä»¥å…±å­˜
  assert_eq(system_status_gauge.name, "status")
  assert_eq(application_status_gauge.name, "status")
  assert_eq(business_status_gauge.name, "status")
  
  assert_eq(system_status_gauge.description, Some("System status"))
  assert_eq(application_status_gauge.description, Some("Application status"))
  assert_eq(business_status_gauge.description, Some("Business status"))
}

// Test 6: Gauge with attributes and labels
pub test "åº¦é‡ä»ªè¡¨è¯¦ç»†æµ‹è¯•ï¼šå¸¦å±æ€§å’Œæ ‡ç­¾çš„ä»ªè¡¨" {
  let meter_provider = azimuth::MeterProvider::default()
  let meter = azimuth::MeterProvider::get_meter(meter_provider, "gauge-attributes-meter")
  
  // åˆ›å»ºå¸¦å±æ€§çš„Gaugeï¼ˆé€šè¿‡åç§°ç¼–ç å±æ€§ï¼‰
  let cpu_gauge_system = azimuth::Meter::create_gauge(meter, "cpu.usage{host=\"server1\",environment=\"prod\"}", Some("CPU usage for server1 in prod"), Some("%"))
  let cpu_gauge_staging = azimuth::Meter::create_gauge(meter, "cpu.usage{host=\"server1\",environment=\"staging\"}", Some("CPU usage for server1 in staging"), Some("%"))
  
  let memory_gauge_web = azimuth::Meter::create_gauge(meter, "memory.usage{service=\"web\",region=\"us-west\"}", Some("Memory usage for web service in us-west"), Some("MB"))
  let memory_gauge_api = azimuth::Meter::create_gauge(meter, "memory.usage{service=\"api\",region=\"us-west\"}", Some("Memory usage for api service in us-west"), Some("MB"))
  
  // éªŒè¯å¸¦å±æ€§çš„Gauge
  assert_eq(cpu_gauge_system.name, "cpu.usage{host=\"server1\",environment=\"prod\"}")
  assert_eq(cpu_gauge_staging.name, "cpu.usage{host=\"server1\",environment=\"staging\"}")
  assert_eq(memory_gauge_web.name, "memory.usage{service=\"web\",region=\"us-west\"}")
  assert_eq(memory_gauge_api.name, "memory.usage{service=\"api\",region=\"us-west\"}")
  
  // æµ‹è¯•å¤æ‚å±æ€§ç»„åˆ
  let complex_gauge = azimuth::Meter::create_gauge(
    meter, 
    "request.latency{service=\"api\",endpoint=\"/users\",method=\"GET\",region=\"us-east\",version=\"v2\"}", 
    Some("Request latency for GET /users endpoint"), 
    Some("ms")
  )
  
  // éªŒè¯å¤æ‚å±æ€§ç»„åˆ
  assert_eq(complex_gauge.name, "request.latency{service=\"api\",endpoint=\"/users\",method=\"GET\",region=\"us-east\",version=\"v2\"}")
  assert_eq(complex_gauge.description, Some("Request latency for GET /users endpoint"))
  assert_eq(complex_gauge.unit, Some("ms"))
  
  // æµ‹è¯•ç‰¹æ®Šå­—ç¬¦çš„å±æ€§å€¼
  let special_attr_gauge = azimuth::Meter::create_gauge(
    meter, 
    "test.metric{path=\"/api/v1/users\",query=\"?active=true&limit=10\"}", 
    Some("Test metric with special chars"), 
    Some("unit")
  )
  
  // éªŒè¯ç‰¹æ®Šå­—ç¬¦çš„å±æ€§å€¼
  assert_eq(special_attr_gauge.name, "test.metric{path=\"/api/v1/users\",query=\"?active=true&limit=10\"}")
  assert_eq(special_attr_gauge.description, Some("Test metric with special chars"))
  assert_eq(special_attr_gauge.unit, Some("unit"))
}

// Test 7: Gauge lifecycle management
pub test "åº¦é‡ä»ªè¡¨è¯¦ç»†æµ‹è¯•ï¼šä»ªè¡¨ç”Ÿå‘½å‘¨æœŸç®¡ç†" {
  let meter_provider = azimuth::MeterProvider::default()
  let meter = azimuth::MeterProvider::get_meter(meter_provider, "gauge-lifecycle-meter")
  
  // æµ‹è¯•Gaugeçš„åˆ›å»ºå’Œé”€æ¯
  let gauges = []
  
  // åˆ›å»ºé˜¶æ®µ
  for i in 0..100 {
    let gauge = azimuth::Meter::create_gauge(meter, "lifecycle.gauge." + i.to_string(), Some("Lifecycle gauge " + i.to_string()), Some("unit"))
    gauges.push(gauge)
  }
  
  // éªŒè¯åˆ›å»ºé˜¶æ®µ
  assert_true(gauges.length() == 100)
  
  // éªŒè¯æ‰€æœ‰Gaugeçš„å±æ€§
  for i in 0..gauges.length() {
    let gauge = gauges[i]
    let expected_name = "lifecycle.gauge." + i.to_string()
    let expected_description = Some("Lifecycle gauge " + i.to_string())
    
    assert_eq(gauge.name, expected_name)
    assert_eq(gauge.description, expected_description)
    assert_eq(gauge.unit, Some("unit"))
  }
  
  // æ¨¡æ‹ŸGaugeæ›´æ–°é˜¶æ®µ
  for i in 0..gauges.length() {
    let gauge = gauges[i]
    // åœ¨å®é™…å®ç°ä¸­ï¼Œè¿™é‡Œä¼šæ›´æ–°Gaugeçš„å€¼
    // ç”±äºç®€åŒ–å®ç°ä¸æ”¯æŒï¼Œæˆ‘ä»¬åªéªŒè¯å±æ€§ä»ç„¶æœ‰æ•ˆ
    assert_eq(gauge.name, "lifecycle.gauge." + i.to_string())
  }
  
  // æµ‹è¯•Gaugeçš„ç‰ˆæœ¬æ§åˆ¶ï¼ˆé€šè¿‡åç§°ç¼–ç ç‰ˆæœ¬ï¼‰
  let v1_gauge = azimuth::Meter::create_gauge(meter, "api.requests{version=\"v1\"}", Some("API requests v1"), Some("count"))
  let v2_gauge = azimuth::Meter::create_gauge(meter, "api.requests{version=\"v2\"}", Some("API requests v2"), Some("count"))
  
  // éªŒè¯ç‰ˆæœ¬æ§åˆ¶
  assert_eq(v1_gauge.name, "api.requests{version=\"v1\"}")
  assert_eq(v2_gauge.name, "api.requests{version=\"v2\"}")
  assert_eq(v1_gauge.description, Some("API requests v1"))
  assert_eq(v2_gauge.description, Some("API requests v2"))
}

// Test 8: Gauge integration with other metrics
pub test "åº¦é‡ä»ªè¡¨è¯¦ç»†æµ‹è¯•ï¼šä»ªè¡¨ä¸å…¶ä»–åº¦é‡çš„é›†æˆ" {
  let meter_provider = azimuth::MeterProvider::default()
  let meter = azimuth::MeterProvider::get_meter(meter_provider, "gauge-integration-meter")
  
  // åˆ›å»ºä¸åŒç±»å‹çš„åº¦é‡
  let request_counter = azimuth::Meter::create_counter(meter, "http.requests.total", Some("Total HTTP requests"), Some("count"))
  let response_histogram = azimuth::Meter::create_histogram(meter, "http.response.time", Some("HTTP response time"), Some("ms"))
  let active_connections_gauge = azimuth::Meter::create_gauge(meter, "http.active.connections", Some("Active HTTP connections"), Some("connections"))
  
  // éªŒè¯ä¸åŒç±»å‹åº¦é‡çš„åˆ›å»º
  assert_eq(request_counter.name, "http.requests.total")
  assert_eq(response_histogram.name, "http.response.time")
  assert_eq(active_connections_gauge.name, "http.active.connections")
  
  // æµ‹è¯•ç›¸å…³åº¦é‡çš„å‘½åçº¦å®š
  let cpu_usage_gauge = azimuth::Meter::create_gauge(meter, "system.cpu.usage", Some("CPU usage"), Some("%"))
  let cpu_load_avg_gauge = azimuth::Meter::create_gauge(meter, "system.cpu.load.avg", Some("CPU load average"), Some("load"))
  let memory_usage_gauge = azimuth::Meter::create_gauge(meter, "system.memory.usage", Some("Memory usage"), Some("%"))
  let memory_available_gauge = azimuth::Meter::create_gauge(meter, "system.memory.available", Some("Available memory"), Some("MB"))
  
  // éªŒè¯ç›¸å…³åº¦é‡çš„å‘½åçº¦å®š
  assert_eq(cpu_usage_gauge.name, "system.cpu.usage")
  assert_eq(cpu_load_avg_gauge.name, "system.cpu.load.avg")
  assert_eq(memory_usage_gauge.name, "system.memory.usage")
  assert_eq(memory_available_gauge.name, "system.memory.available")
  
  // æµ‹è¯•ä¸šåŠ¡åº¦é‡çš„ç»„åˆ
  let user_count_gauge = azimuth::Meter::create_gauge(meter, "business.users.active", Some("Active users"), Some("count"))
  let user_sessions_gauge = azimuth::Meter::create_gauge(meter, "business.users.sessions", Some("Active sessions"), Some("count"))
  let revenue_counter = azimuth::Meter::create_counter(meter, "business.revenue.total", Some("Total revenue"), Some("USD"))
  let order_value_histogram = azimuth::Meter::create_histogram(meter, "business.order.value", Some("Order value"), Some("USD"))
  
  // éªŒè¯ä¸šåŠ¡åº¦é‡çš„ç»„åˆ
  assert_eq(user_count_gauge.name, "business.users.active")
  assert_eq(user_sessions_gauge.name, "business.users.sessions")
  assert_eq(revenue_counter.name, "business.revenue.total")
  assert_eq(order_value_histogram.name, "business.order.value")
  
  // æµ‹è¯•Gaugeä½œä¸ºInstrumentçš„è½¬æ¢
  let gauge_instrument = azimuth::Histogram::as_instrument(response_histogram)
  assert_eq(azimuth::Instrument::name(gauge_instrument), "http.response.time")
  assert_eq(azimuth::Instrument::description(gauge_instrument), Some("HTTP response time"))
  assert_eq(azimuth::Instrument::unit(gauge_instrument), Some("ms"))
}