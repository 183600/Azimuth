// é«˜çº§å±æ€§å€¼ç±»å‹è½¬æ¢æµ‹è¯•
// æµ‹è¯•å±æ€§å€¼çš„å¤æ‚è½¬æ¢æ“ä½œå’Œè¾¹ç•Œæ¡ä»¶å¤„ç†

test "å±æ€§å€¼å­—ç¬¦ä¸²åˆ°æ•°å€¼è½¬æ¢è¾¹ç•Œæ¡ä»¶" {
  // æµ‹è¯•å­—ç¬¦ä¸²åˆ°æ•´æ•°çš„è½¬æ¢
  let string_val = StringValue("42")
  let int_val = IntValue(42)
  let float_val = FloatValue(3.14159)
  let bool_val = BoolValue(true)
  
  // æµ‹è¯•æ•°ç»„ç±»å‹çš„å±æ€§å€¼
  let string_array_val = ArrayStringValue(["item1", "item2", "item3"])
  let int_array_val = ArrayIntValue([1, 2, 3, 4, 5])
  
  // éªŒè¯å±æ€§å€¼çš„ç±»å‹è¯†åˆ«
  match string_val {
    StringValue(s) => assert_eq(s, "42")
    _ => assert_true(false, "æœŸæœ›å­—ç¬¦ä¸²å€¼")
  }
  
  match int_val {
    IntValue(i) => assert_eq(i, 42)
    _ => assert_true(false, "æœŸæœ›æ•´æ•°å€¼")
  }
  
  match float_val {
    FloatValue(f) => assert_true(f > 3.14 && f < 3.15)
    _ => assert_true(false, "æœŸæœ›æµ®ç‚¹æ•°å€¼")
  }
  
  match bool_val {
    BoolValue(b) => assert_true(b)
    _ => assert_true(false, "æœŸæœ›å¸ƒå°”å€¼")
  }
  
  // æµ‹è¯•æ•°ç»„å±æ€§å€¼
  match string_array_val {
    ArrayStringValue(arr) => {
      assert_eq(arr.length(), 3)
      assert_eq(arr[0], "item1")
      assert_eq(arr[2], "item3")
    }
    _ => assert_true(false, "æœŸæœ›å­—ç¬¦ä¸²æ•°ç»„å€¼")
  }
  
  match int_array_val {
    ArrayIntValue(arr) => {
      assert_eq(arr.length(), 5)
      assert_eq(arr[0], 1)
      assert_eq(arr[4], 5)
    }
    _ => assert_true(false, "æœŸæœ›æ•´æ•°æ•°ç»„å€¼")
  }
}

test "å±æ€§å€¼ç©ºå€¼å’Œç‰¹æ®Šå€¼å¤„ç†" {
  // æµ‹è¯•ç©ºå­—ç¬¦ä¸²å¤„ç†
  let empty_string = StringValue("")
  match empty_string {
    StringValue(s) => assert_eq(s.length(), 0)
    _ => assert_true(false, "æœŸæœ›ç©ºå­—ç¬¦ä¸²")
  }
  
  // æµ‹è¯•é›¶å€¼å¤„ç†
  let zero_int = IntValue(0)
  let zero_float = FloatValue(0.0)
  
  match zero_int {
    IntValue(i) => assert_eq(i, 0)
    _ => assert_true(false, "æœŸæœ›é›¶æ•´æ•°")
  }
  
  match zero_float {
    FloatValue(f) => assert_true(f == 0.0)
    _ => assert_true(false, "æœŸæœ›é›¶æµ®ç‚¹æ•°")
  }
  
  // æµ‹è¯•è´Ÿå€¼å¤„ç†
  let negative_int = IntValue(-42)
  let negative_float = FloatValue(-3.14159)
  
  match negative_int {
    IntValue(i) => assert_eq(i, -42)
    _ => assert_true(false, "æœŸæœ›è´Ÿæ•´æ•°")
  }
  
  match negative_float {
    FloatValue(f) => assert_true(f < -3.14 && f > -3.15)
    _ => assert_true(false, "æœŸæœ›è´Ÿæµ®ç‚¹æ•°")
  }
  
  // æµ‹è¯•ç©ºæ•°ç»„
  let empty_string_array = ArrayStringValue([])
  let empty_int_array = ArrayIntValue([])
  
  match empty_string_array {
    ArrayStringValue(arr) => assert_eq(arr.length(), 0)
    _ => assert_true(false, "æœŸæœ›ç©ºå­—ç¬¦ä¸²æ•°ç»„")
  }
  
  match empty_int_array {
    ArrayIntValue(arr) => assert_eq(arr.length(), 0)
    _ => assert_true(false, "æœŸæœ›ç©ºæ•´æ•°æ•°ç»„")
  }
}

test "å±æ€§å€¼ç±»å‹è½¬æ¢å…¼å®¹æ€§" {
  // æµ‹è¯•å„ç§å±æ€§å€¼çš„å…¼å®¹æ€§æ“ä½œ
  let attributes = Attributes::new()
  
  // è®¾ç½®ä¸åŒç±»å‹çš„å±æ€§å€¼
  Attributes::set(attributes, "string.key", StringValue("test_value"))
  Attributes::set(attributes, "int.key", IntValue(123))
  Attributes::set(attributes, "float.key", FloatValue(45.67))
  Attributes::set(attributes, "bool.key", BoolValue(false))
  
  // éªŒè¯å±æ€§å€¼çš„è·å–å’Œç±»å‹åŒ¹é…
  let string_result = Attributes::get(attributes, "string.key")
  let int_result = Attributes::get(attributes, "int.key")
  let float_result = Attributes::get(attributes, "float.key")
  let bool_result = Attributes::get(attributes, "bool.key")
  
  match string_result {
    Some(StringValue(s)) => assert_eq(s, "test_value")
    _ => assert_true(false, "æœŸæœ›å­—ç¬¦ä¸²å€¼")
  }
  
  match int_result {
    Some(IntValue(i)) => assert_eq(i, 123)
    _ => assert_true(false, "æœŸæœ›æ•´æ•°å€¼")
  }
  
  match float_result {
    Some(FloatValue(f)) => assert_true(f > 45.6 && f < 45.7)
    _ => assert_true(false, "æœŸæœ›æµ®ç‚¹æ•°å€¼")
  }
  
  match bool_result {
    Some(BoolValue(b)) => assert_false(b)
    _ => assert_true(false, "æœŸæœ›å¸ƒå°”å€¼")
  }
  
  // æµ‹è¯•ä¸å­˜åœ¨çš„é”®
  let missing_result = Attributes::get(attributes, "nonexistent.key")
  assert_eq(missing_result, None)
}

test "å±æ€§å€¼æ•°ç»„æ“ä½œé«˜çº§æµ‹è¯•" {
  // æµ‹è¯•å¤§å‹æ•°ç»„æ“ä½œ
  let large_string_array = ArrayStringValue([
    "item1", "item2", "item3", "item4", "item5",
    "item6", "item7", "item8", "item9", "item10"
  ])
  
  let large_int_array = ArrayIntValue([1, 2, 3, 4, 5, 6, 7, 8, 9, 10])
  
  match large_string_array {
    ArrayStringValue(arr) => {
      assert_eq(arr.length(), 10)
      assert_eq(arr[0], "item1")
      assert_eq(arr[9], "item10")
      assert_eq(arr[4], "item5")
    }
    _ => assert_true(false, "æœŸæœ›å¤§å‹å­—ç¬¦ä¸²æ•°ç»„")
  }
  
  match large_int_array {
    ArrayIntValue(arr) => {
      assert_eq(arr.length(), 10)
      assert_eq(arr[0], 1)
      assert_eq(arr[9], 10)
      assert_eq(arr[4], 5)
    }
    _ => assert_true(false, "æœŸæœ›å¤§å‹æ•´æ•°æ•°ç»„")
  }
  
  // æµ‹è¯•åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„å­—ç¬¦ä¸²æ•°ç»„
  let special_string_array = ArrayStringValue([
    "ç‰¹æ®Šå­—ç¬¦: !@#$%^&*()",
    "Unicode: æµ‹è¯• ğŸš€",
    "æ¢è¡Œç¬¦: \n",
    "åˆ¶è¡¨ç¬¦: \t",
    "å¼•å·: \"'\""
  ])
  
  match special_string_array {
    ArrayStringValue(arr) => {
      assert_eq(arr.length(), 5)
      assert_eq(arr[0], "ç‰¹æ®Šå­—ç¬¦: !@#$%^&*()")
      assert_eq(arr[1], "Unicode: æµ‹è¯• ğŸš€")
      assert_eq(arr[2], "æ¢è¡Œç¬¦: \n")
      assert_eq(arr[3], "åˆ¶è¡¨ç¬¦: \t")
      assert_eq(arr[4], "å¼•å·: \"'\"")
    }
    _ => assert_true(false, "æœŸæœ›ç‰¹æ®Šå­—ç¬¦å­—ç¬¦ä¸²æ•°ç»„")
  }
}

test "å±æ€§å€¼æå€¼å’Œè¾¹ç•Œæ¡ä»¶æµ‹è¯•" {
  // æµ‹è¯•æå¤§æ•´æ•°å€¼
  let max_int = IntValue(2147483647)
  let min_int = IntValue(-2147483648)
  
  match max_int {
    IntValue(i) => assert_eq(i, 2147483647)
    _ => assert_true(false, "æœŸæœ›æœ€å¤§æ•´æ•°å€¼")
  }
  
  match min_int {
    IntValue(i) => assert_eq(i, -2147483648)
    _ => assert_true(false, "æœŸæœ›æœ€å°æ•´æ•°å€¼")
  }
  
  // æµ‹è¯•æå€¼æµ®ç‚¹æ•°
  let very_large_float = FloatValue(1.7976931348623157e+308)
  let very_small_float = FloatValue(2.2250738585072014e-308)
  let infinity_float = FloatValue(1.0 / 0.0) // æ­£æ— ç©·
  let nan_float = FloatValue(0.0 / 0.0) // NaN
  
  match very_large_float {
    FloatValue(f) => assert_true(f > 1.0e+307)
    _ => assert_true(false, "æœŸæœ›æå¤§æµ®ç‚¹æ•°")
  }
  
  match very_small_float {
    FloatValue(f) => assert_true(f > 0.0 && f < 1.0e-307)
    _ => assert_true(false, "æœŸæœ›æå°æµ®ç‚¹æ•°")
  }
  
  match infinity_float {
    FloatValue(f) => assert_true(f > 1.0e+308) // ç®€åŒ–çš„æ— ç©·æ£€æµ‹
    _ => assert_true(false, "æœŸæœ›æ— ç©·å¤§æµ®ç‚¹æ•°")
  }
  
  match nan_float {
    FloatValue(f) => assert_true(f != f) // NaNæ£€æµ‹
    _ => assert_true(false, "æœŸæœ›NaNæµ®ç‚¹æ•°")
  }
  
  // æµ‹è¯•æé•¿å­—ç¬¦ä¸²
  let very_long_string = StringValue("è¿™æ˜¯ä¸€ä¸ªéå¸¸é•¿çš„å­—ç¬¦ä¸²ï¼Œç”¨äºæµ‹è¯•ç³»ç»Ÿå¯¹é•¿å­—ç¬¦ä¸²çš„å¤„ç†èƒ½åŠ›ã€‚" * 10)
  match very_long_string {
    StringValue(s) => assert_true(s.length() > 100)
    _ => assert_true(false, "æœŸæœ›æé•¿å­—ç¬¦ä¸²")
  }
}

test "å±æ€§å€¼ç±»å‹è½¬æ¢é”™è¯¯å¤„ç†" {
  // æµ‹è¯•ç±»å‹è½¬æ¢çš„è¾¹ç•Œæƒ…å†µå’Œé”™è¯¯å¤„ç†
  let attributes = Attributes::new()
  
  // è®¾ç½®ä¸€äº›è¾¹ç•Œå€¼
  Attributes::set(attributes, "boundary.int", IntValue(2147483647))
  Attributes::set(attributes, "boundary.float", FloatValue(3.14159265359))
  Attributes::set(attributes, "boundary.bool", BoolValue(true))
  
  // éªŒè¯è¾¹ç•Œå€¼çš„æ­£ç¡®æ€§
  let boundary_int = Attributes::get(attributes, "boundary.int")
  let boundary_float = Attributes::get(attributes, "boundary.float")
  let boundary_bool = Attributes::get(attributes, "boundary.bool")
  
  match boundary_int {
    Some(IntValue(i)) => assert_eq(i, 2147483647)
    _ => assert_true(false, "æœŸæœ›è¾¹ç•Œæ•´æ•°å€¼")
  }
  
  match boundary_float {
    Some(FloatValue(f)) => assert_true(f > 3.14159 && f < 3.14160)
    _ => assert_true(false, "æœŸæœ›è¾¹ç•Œæµ®ç‚¹æ•°å€¼")
  }
  
  match boundary_bool {
    Some(BoolValue(b)) => assert_true(b)
    _ => assert_true(false, "æœŸæœ›è¾¹ç•Œå¸ƒå°”å€¼")
  }
  
  // æµ‹è¯•ç©ºå±æ€§é›†åˆ
  let empty_attributes = Attributes::new()
  let empty_result = Attributes::get(empty_attributes, "any.key")
  assert_eq(empty_result, None)
}