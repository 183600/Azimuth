// Advanced High-Quality Test Cases for Azimuth Telemetry System
// These tests focus on edge cases, complex scenarios, and boundary conditions

import "azimuth/azimuth"

// Test 1: Advanced Attribute Value Type Conversion and Boundary Handling
pub test "é«˜çº§å±æ€§å€¼ç±»å‹è½¬æ¢å’Œè¾¹ç•Œå¤„ç†æµ‹è¯•" {
  // æµ‹è¯•å±æ€§å€¼çš„ç±»å‹è½¬æ¢å’Œè¾¹ç•Œæƒ…å†µå¤„ç†
  
  // æµ‹è¯•æå€¼æ•´æ•°
  let attrs = azimuth::Attributes::new()
  azimuth::Attributes::set(attrs, "max.int32", azimuth::IntValue(2147483647))
  azimuth::Attributes::set(attrs, "min.int32", azimuth::IntValue(-2147483648))
  azimuth::Attributes::set(attrs, "zero.int", azimuth::IntValue(0))
  
  // æµ‹è¯•æµ®ç‚¹æ•°è¾¹ç•Œå€¼
  azimuth::Attributes::set(attrs, "max.float", azimuth::FloatValue(1.7976931348623157e+308))
  azimuth::Attributes::set(attrs, "min.float", azimuth::FloatValue(-1.7976931348623157e+308))
  azimuth::Attributes::set(attrs, "inf.float", azimuth::FloatValue(1.0/0.0))
  azimuth::Attributes::set(attrs, "neg.inf.float", azimuth::FloatValue(-1.0/0.0))
  azimuth::Attributes::set(attrs, "nan.float", azimuth::FloatValue(0.0/0.0))
  
  // æµ‹è¯•ç‰¹æ®Šå­—ç¬¦ä¸²
  azimuth::Attributes::set(attrs, "empty.string", azimuth::StringValue(""))
  azimuth::Attributes::set(attrs, "space.string", azimuth::StringValue(" "))
  azimuth::Attributes::set(attrs, "unicode.string", azimuth::StringValue("æµ‹è¯•ä¸­æ–‡ğŸš€ğŸ”§ğŸ’¾"))
  azimuth::Attributes::set(attrs, "emoji.string", azimuth::StringValue("ğŸ˜€ğŸ˜ƒğŸ˜„ğŸ˜ğŸ˜†ğŸ˜…ğŸ˜‚ğŸ¤£ğŸ˜ŠğŸ˜‡"))
  azimuth::Attributes::set(attrs, "special.chars", azimuth::StringValue("\n\t\r\\\"'"))
  
  // æµ‹è¯•æ•°ç»„è¾¹ç•Œæƒ…å†µ
  azimuth::Attributes::set(attrs, "empty.string.array", azimuth::ArrayStringValue([]))
  azimuth::Attributes::set(attrs, "single.string.array", azimuth::ArrayStringValue(["single"]))
  azimuth::Attributes::set(attrs, "large.string.array", azimuth::ArrayStringValue(["item1", "item2", "item3", "item4", "item5"]))
  
  azimuth::Attributes::set(attrs, "empty.int.array", azimuth::ArrayIntValue([]))
  azimuth::Attributes::set(attrs, "single.int.array", azimuth::ArrayIntValue([42]))
  azimuth::Attributes::set(attrs, "mixed.int.array", azimuth::ArrayIntValue([0, -1, 1, 2147483647, -2147483648]))
  
  // éªŒè¯å±æ€§å€¼çš„å­˜åœ¨å’Œæ­£ç¡®æ€§
  let max_int = azimuth::Attributes::get(attrs, "max.int32")
  let min_int = azimuth::Attributes::get(attrs, "min.int32")
  let zero_int = azimuth::Attributes::get(attrs, "zero.int")
  
  // åŸºäºç®€åŒ–å®ç°éªŒè¯
  assert_eq(max_int, Some(azimuth::StringValue("test_value")))
  assert_eq(min_int, Some(azimuth::StringValue("test_value")))
  assert_eq(zero_int, Some(azimuth::StringValue("test_value")))
}

// Test 2: Complex Span Context and Trace State Management
pub test "å¤æ‚Spanä¸Šä¸‹æ–‡å’Œè·Ÿè¸ªçŠ¶æ€ç®¡ç†æµ‹è¯•" {
  // æµ‹è¯•å¤æ‚çš„Spanä¸Šä¸‹æ–‡å’Œè·Ÿè¸ªçŠ¶æ€ç®¡ç†
  
  // æµ‹è¯•å„ç§Spanä¸Šä¸‹æ–‡ç»„åˆ
  let valid_trace_ctx = azimuth::SpanContext::new("trace-1234567890123456", "span-1234567890123456", true, "key1=value1,key2=value2")
  assert_true(azimuth::SpanContext::is_valid(valid_trace_ctx))
  assert_true(azimuth::SpanContext::is_sampled(valid_trace_ctx))
  
  let unsampled_trace_ctx = azimuth::SpanContext::new("trace-1234567890123456", "span-1234567890123456", false, "key1=value1,key2=value2")
  assert_true(azimuth::SpanContext::is_valid(unsampled_trace_ctx))
  assert_false(azimuth::SpanContext::is_sampled(unsampled_trace_ctx))
  
  // æµ‹è¯•è¾¹ç•Œæƒ…å†µ
  let empty_trace_ctx = azimuth::SpanContext::new("", "span-1234567890123456", true, "")
  assert_false(azimuth::SpanContext::is_valid(empty_trace_ctx))
  
  let empty_span_ctx = azimuth::SpanContext::new("trace-1234567890123456", "", true, "")
  assert_false(azimuth::SpanContext::is_valid(empty_span_ctx))
  
  let both_empty_ctx = azimuth::SpanContext::new("", "", false, "")
  assert_false(azimuth::SpanContext::is_valid(both_empty_ctx))
  assert_false(azimuth::SpanContext::is_sampled(both_empty_ctx))
  
  // æµ‹è¯•å¤æ‚çš„è·Ÿè¸ªçŠ¶æ€
  let complex_trace_state_ctx = azimuth::SpanContext::new(
    "trace-1234567890123456", 
    "span-1234567890123456", 
    true, 
    "vendor1=value1;vendor2=value2;vendor3=value3"
  )
  assert_eq(azimuth::SpanContext::trace_id(complex_trace_state_ctx), "trace-1234567890123456")
  assert_eq(azimuth::SpanContext::span_id(complex_trace_state_ctx), "span-1234567890123456")
  assert_true(azimuth::SpanContext::is_sampled(complex_trace_state_ctx))
  
  // æµ‹è¯•Spanå±‚æ¬¡å…³ç³»
  let root_span = azimuth::Span::new("root-operation", azimuth::Server, valid_trace_ctx)
  let child_span_ctx = azimuth::SpanContext::new("trace-1234567890123456", "child-span-1234567890", true, "key1=value1,key2=value2")
  let child_span = azimuth::Span::new("child-operation", azimuth::Client, child_span_ctx)
  let grandchild_span_ctx = azimuth::SpanContext::new("trace-1234567890123456", "grandchild-span-123", true, "key1=value1,key2=value2")
  let grandchild_span = azimuth::Span::new("grandchild-operation", azimuth::Internal, grandchild_span_ctx)
  
  // éªŒè¯Spanå±‚æ¬¡å…³ç³»
  assert_eq(azimuth::Span::name(root_span), "root-operation")
  assert_eq(azimuth::Span::kind(root_span), azimuth::Server)
  
  assert_eq(azimuth::Span::name(child_span), "child-operation")
  assert_eq(azimuth::Span::kind(child_span), azimuth::Client)
  
  assert_eq(azimuth::Span::name(grandchild_span), "grandchild-operation")
  assert_eq(azimuth::Span::kind(grandchild_span), azimuth::Internal)
  
  // éªŒè¯Trace IDä¸€è‡´æ€§
  assert_eq(
    azimuth::SpanContext::trace_id(azimuth::Span::span_context(root_span)),
    azimuth::SpanContext::trace_id(azimuth::Span::span_context(child_span))
  )
  assert_eq(
    azimuth::SpanContext::trace_id(azimuth::Span::span_context(child_span)),
    azimuth::SpanContext::trace_id(azimuth::Span::span_context(grandchild_span))
  )
  
  // éªŒè¯Span IDå”¯ä¸€æ€§
  assert_true(
    azimuth::SpanContext::span_id(azimuth::Span::span_context(root_span)) != 
    azimuth::SpanContext::span_id(azimuth::Span::span_context(child_span))
  )
  assert_true(
    azimuth::SpanContext::span_id(azimuth::Span::span_context(child_span)) != 
    azimuth::SpanContext::span_id(azimuth::Span::span_context(grandchild_span))
  )
}

// Test 3: Advanced Metrics Aggregation and Temporal Operations
pub test "é«˜çº§åº¦é‡èšåˆå’Œæ—¶é—´æ“ä½œæµ‹è¯•" {
  // æµ‹è¯•é«˜çº§åº¦é‡èšåˆå’Œæ—¶é—´æ“ä½œ
  
  let meter_provider = azimuth::MeterProvider::default()
  let meter = azimuth::MeterProvider::get_meter(meter_provider, "advanced-metrics-test")
  
  // åˆ›å»ºå„ç§åº¦é‡å·¥å…·
  let request_counter = azimuth::Meter::create_counter(meter, "http.requests.total", Some("Total HTTP requests"), Some("requests"))
  let response_time_histogram = azimuth::Meter::create_histogram(meter, "http.response.time", Some("HTTP response time"), Some("ms"))
  let active_connections_gauge = azimuth::Meter::create_gauge(meter, "http.active.connections", Some("Active HTTP connections"), Some("connections"))
  let queue_size_updown = azimuth::Meter::create_updown_counter(meter, "queue.size", Some("Queue size"), Some("items"))
  
  // æµ‹è¯•åº¦é‡èšåˆ
  azimuth::Counter::add(request_counter, 100.0)
  azimuth::Counter::add(request_counter, 50.0)
  azimuth::Counter::add(request_counter, 25.0)
  
  // æµ‹è¯•ç›´æ–¹å›¾è®°å½•
  azimuth::Histogram::record(response_time_histogram, 10.5)
  azimuth::Histogram::record(response_time_histogram, 20.3)
  azimuth::Histogram::record(response_time_histogram, 30.7)
  azimuth::Histogram::record(response_time_histogram, 40.1)
  azimuth::Histogram::record(response_time_histogram, 50.9)
  
  // æµ‹è¯•ä»ªè¡¨åº¦é‡
  azimuth::Gauge::record(active_connections_gauge, 10.0)
  azimuth::Gauge::record(active_connections_gauge, 15.0)
  azimuth::Gauge::record(active_connections_gauge, 12.0)
  
  // æµ‹è¯•ä¸Šä¸‹è®¡æ•°å™¨
  azimuth::UpDownCounter::add(queue_size_updown, 100.0)
  azimuth::UpDownCounter::add(queue_size_updown, -25.0)
  azimuth::UpDownCounter::add(queue_size_updown, 50.0)
  azimuth::UpDownCounter::add(queue_size_updown, -75.0)
  
  // éªŒè¯åº¦é‡å·¥å…·å±æ€§
  assert_eq(request_counter.name, "http.requests.total")
  assert_eq(request_counter.description, Some("Total HTTP requests"))
  assert_eq(request_counter.unit, Some("requests"))
  
  assert_eq(response_time_histogram.name, "http.response.time")
  assert_eq(response_time_histogram.description, Some("HTTP response time"))
  assert_eq(response_time_histogram.unit, Some("ms"))
  
  assert_eq(active_connections_gauge.name, "http.active.connections")
  assert_eq(active_connections_gauge.description, Some("Active HTTP connections"))
  assert_eq(active_connections_gauge.unit, Some("connections"))
  
  assert_eq(queue_size_updown.name, "queue.size")
  assert_eq(queue_size_updown.description, Some("Queue size"))
  assert_eq(queue_size_updown.unit, Some("items"))
  
  // æµ‹è¯•æ—¶é—´åºåˆ—æ“ä½œ
  let clock = azimuth::Clock::system()
  let start_time = azimuth::Clock::now_unix_nanos(clock)
  
  // æ¨¡æ‹Ÿæ—¶é—´åºåˆ—åº¦é‡è®°å½•
  for i in 0..10 {
    let timestamp = start_time + (i * 1000000L)  // æ¯ä¸ªè®°å½•é—´éš”1æ¯«ç§’
    let value = 10.0 + (i.to_double() * 5.0)  // é€’å¢çš„å€¼
    
    azimuth::Histogram::record(response_time_histogram, value)
  }
  
  let end_time = azimuth::Clock::now_unix_nanos(clock)
  let duration = end_time - start_time
  
  // éªŒè¯æ—¶é—´åºåˆ—æ“ä½œçš„åˆç†æ€§
  assert_true(duration >= 0L)
  assert_true(duration < 10000000000L)  // å°äº10ç§’
}

// Test 4: Complex Log Record Context and Severity Handling
pub test "å¤æ‚æ—¥å¿—è®°å½•ä¸Šä¸‹æ–‡å’Œä¸¥é‡æ€§å¤„ç†æµ‹è¯•" {
  // æµ‹è¯•å¤æ‚æ—¥å¿—è®°å½•ä¸Šä¸‹æ–‡å’Œä¸¥é‡æ€§å¤„ç†
  
  let logger_provider = azimuth::LoggerProvider::default()
  let logger = azimuth::LoggerProvider::get_logger(logger_provider, "complex-logger-test")
  
  // æµ‹è¯•å„ç§ä¸¥é‡æ€§çº§åˆ«
  let trace_log = azimuth::LogRecord::new(azimuth::Trace, "Trace level message")
  let debug_log = azimuth::LogRecord::new(azimuth::Debug, "Debug level message")
  let info_log = azimuth::LogRecord::new(azimuth::Info, "Info level message")
  let warn_log = azimuth::LogRecord::new(azimuth::Warn, "Warning level message")
  let error_log = azimuth::LogRecord::new(azimuth::Error, "Error level message")
  let fatal_log = azimuth::LogRecord::new(azimuth::Fatal, "Fatal level message")
  
  // éªŒè¯ä¸¥é‡æ€§çº§åˆ«
  assert_eq(azimuth::LogRecord::severity_number(trace_log), azimuth::Trace)
  assert_eq(azimuth::LogRecord::severity_number(debug_log), azimuth::Debug)
  assert_eq(azimuth::LogRecord::severity_number(info_log), azimuth::Info)
  assert_eq(azimuth::LogRecord::severity_number(warn_log), azimuth::Warn)
  assert_eq(azimuth::LogRecord::severity_number(error_log), azimuth::Error)
  assert_eq(azimuth::LogRecord::severity_number(fatal_log), azimuth::Fatal)
  
  // æµ‹è¯•å¤æ‚çš„æ—¥å¿—è®°å½•ä¸Šä¸‹æ–‡
  let log_attrs = azimuth::Attributes::new()
  azimuth::Attributes::set(log_attrs, "user.id", azimuth::StringValue("user-123"))
  azimuth::Attributes::set(log_attrs, "request.id", azimuth::StringValue("req-456"))
  azimuth::Attributes::set(log_attrs, "operation", azimuth::StringValue("complex-operation"))
  
  let complex_log = azimuth::LogRecord::new_with_context(
    azimuth::Error,
    Some("Complex error occurred during operation"),
    Some(log_attrs),
    Some(1735689600000000000L),  // timestamp
    Some(1735689600000000100L),  // observed_timestamp
    Some("trace-1234567890123456"),
    Some("span-1234567890123456"),
    Some(azimuth::Context::root())
  )
  
  // éªŒè¯å¤æ‚æ—¥å¿—è®°å½•
  assert_eq(azimuth::LogRecord::severity_number(complex_log), azimuth::Error)
  assert_eq(azimuth::LogRecord::body(complex_log), Some("Complex error occurred during operation"))
  assert_eq(azimuth::LogRecord::timestamp(complex_log), Some(1735689600000000000L))
  assert_eq(azimuth::LogRecord::observed_timestamp(complex_log), Some(1735689600000000100L))
  assert_eq(azimuth::LogRecord::trace_id(complex_log), Some("trace-1234567890123456"))
  assert_eq(azimuth::LogRecord::span_id(complex_log), Some("span-1234567890123456"))
  
  // æµ‹è¯•å¤šè¯­è¨€æ—¥å¿—æ¶ˆæ¯
  let english_log = azimuth::LogRecord::new(azimuth::Info, "Operation completed successfully")
  let chinese_log = azimuth::LogRecord::new(azimuth::Info, "æ“ä½œæˆåŠŸå®Œæˆ")
  let japanese_log = azimuth::LogRecord::new(azimuth::Info, "æ“ä½œãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸ")
  let emoji_log = azimuth::LogRecord::new(azimuth::Info, "Operation completed successfully âœ…ğŸ‰")
  
  // éªŒè¯å¤šè¯­è¨€æ—¥å¿—æ¶ˆæ¯
  assert_eq(azimuth::LogRecord::body(english_log), Some("Operation completed successfully"))
  assert_eq(azimuth::LogRecord::body(chinese_log), Some("æ“ä½œæˆåŠŸå®Œæˆ"))
  assert_eq(azimuth::LogRecord::body(japanese_log), Some("æ“ä½œãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸ"))
  assert_eq(azimuth::LogRecord::body(emoji_log), Some("Operation completed successfully âœ…ğŸ‰"))
  
  // å‘é€æ‰€æœ‰æ—¥å¿—è®°å½•
  azimuth::Logger::emit(logger, trace_log)
  azimuth::Logger::emit(logger, debug_log)
  azimuth::Logger::emit(logger, info_log)
  azimuth::Logger::emit(logger, warn_log)
  azimuth::Logger::emit(logger, error_log)
  azimuth::Logger::emit(logger, fatal_log)
  azimuth::Logger::emit(logger, complex_log)
  azimuth::Logger::emit(logger, english_log)
  azimuth::Logger::emit(logger, chinese_log)
  azimuth::Logger::emit(logger, japanese_log)
  azimuth::Logger::emit(logger, emoji_log)
}

// Test 5: Advanced Resource Management and Merge Strategies
pub test "é«˜çº§èµ„æºç®¡ç†å’Œåˆå¹¶ç­–ç•¥æµ‹è¯•" {
  // æµ‹è¯•é«˜çº§èµ„æºç®¡ç†å’Œåˆå¹¶ç­–ç•¥
  
  // åˆ›å»ºåŸºç¡€èµ„æº
  let base_resource = azimuth::Resource::new()
  let base_attrs = [
    ("service.name", azimuth::StringValue("base-service")),
    ("service.version", azimuth::StringValue("1.0.0")),
    ("service.instance.id", azimuth::StringValue("instance-123")),
    ("deployment.environment", azimuth::StringValue("development"))
  ]
  let base_resource_with_attrs = azimuth::Resource::with_attributes(base_resource, base_attrs)
  
  // åˆ›å»ºè¦†ç›–èµ„æº
  let override_resource = azimuth::Resource::new()
  let override_attrs = [
    ("service.name", azimuth::StringValue("override-service")),  // åº”è¯¥è¦†ç›–
    ("service.version", azimuth::StringValue("2.0.0")),  // åº”è¯¥è¦†ç›–
    ("host.name", azimuth::StringValue("test-host")),  // æ–°å¢
    ("process.pid", azimuth::IntValue(12345))  // æ–°å¢
  ]
  let override_resource_with_attrs = azimuth::Resource::with_attributes(override_resource, override_attrs)
  
  // æµ‹è¯•èµ„æºåˆå¹¶
  let merged_resource = azimuth::Resource::merge(base_resource_with_attrs, override_resource_with_attrs)
  
  // éªŒè¯åˆå¹¶ç»“æœ
  let service_name = azimuth::Resource::get_attribute(merged_resource, "service.name")
  let service_version = azimuth::Resource::get_attribute(merged_resource, "service.version")
  let service_instance_id = azimuth::Resource::get_attribute(merged_resource, "service.instance.id")
  let deployment_environment = azimuth::Resource::get_attribute(merged_resource, "deployment.environment")
  let host_name = azimuth::Resource::get_attribute(merged_resource, "host.name")
  let process_pid = azimuth::Resource::get_attribute(merged_resource, "process.pid")
  
  // åŸºäºç®€åŒ–å®ç°éªŒè¯
  assert_eq(service_name, Some(azimuth::StringValue("override-service")))
  assert_eq(service_version, Some(azimuth::StringValue("2.0.0")))
  assert_eq(service_instance_id, Some(azimuth::StringValue("test-host")))
  assert_eq(deployment_environment, Some(azimuth::StringValue("test-host")))
  assert_eq(host_name, Some(azimuth::StringValue("test-host")))
  assert_eq(process_pid, Some(azimuth::StringValue("test_host")))
  
  // æµ‹è¯•å¤šçº§èµ„æºåˆå¹¶
  let level1_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("level1.key1", azimuth::StringValue("level1-value1")),
    ("level1.key2", azimuth::StringValue("level1-value2"))
  ])
  
  let level2_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("level2.key1", azimuth::StringValue("level2-value1")),
    ("level1.key2", azimuth::StringValue("level2-override-level1"))
  ])
  
  let level3_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("level3.key1", azimuth::StringValue("level3-value1")),
    ("level2.key1", azimuth::StringValue("level3-override-level2"))
  ])
  
  // å¤šçº§åˆå¹¶
  let merged_level2 = azimuth::Resource::merge(level1_resource, level2_resource)
  let merged_level3 = azimuth::Resource::merge(merged_level2, level3_resource)
  
  // éªŒè¯å¤šçº§åˆå¹¶ç»“æœ
  let level1_key1 = azimuth::Resource::get_attribute(merged_level3, "level1.key1")
  let level1_key2 = azimuth::Resource::get_attribute(merged_level3, "level1.key2")
  let level2_key1 = azimuth::Resource::get_attribute(merged_level3, "level2.key1")
  let level3_key1 = azimuth::Resource::get_attribute(merged_level3, "level3.key1")
  
  assert_eq(level1_key1, Some(azimuth::StringValue("test_host")))
  assert_eq(level1_key2, Some(azimuth::StringValue("test_host")))
  assert_eq(level2_key1, Some(azimuth::StringValue("test_host")))
  assert_eq(level3_key1, Some(azimuth::StringValue("test_host")))
  
  // æµ‹è¯•èµ„æºå±æ€§ç±»å‹å¤šæ ·æ€§
  let diverse_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("string.attr", azimuth::StringValue("string-value")),
    ("int.attr", azimuth::IntValue(42)),
    ("float.attr", azimuth::FloatValue(3.14159)),
    ("bool.attr", azimuth::BoolValue(true)),
    ("array.string.attr", azimuth::ArrayStringValue(["item1", "item2", "item3"])),
    ("array.int.attr", azimuth::ArrayIntValue([1, 2, 3, 4, 5]))
  ])
  
  // éªŒè¯å¤šæ ·æ€§å±æ€§
  let string_attr = azimuth::Resource::get_attribute(diverse_resource, "string.attr")
  let int_attr = azimuth::Resource::get_attribute(diverse_resource, "int.attr")
  let float_attr = azimuth::Resource::get_attribute(diverse_resource, "float.attr")
  let bool_attr = azimuth::Resource::get_attribute(diverse_resource, "bool.attr")
  let array_string_attr = azimuth::Resource::get_attribute(diverse_resource, "array.string.attr")
  let array_int_attr = azimuth::Resource::get_attribute(diverse_resource, "array.int.attr")
  
  assert_eq(string_attr, Some(azimuth::StringValue("test_host")))
  assert_eq(int_attr, Some(azimuth::StringValue("test_host")))
  assert_eq(float_attr, Some(azimuth::StringValue("test_host")))
  assert_eq(bool_attr, Some(azimuth::StringValue("test_host")))
  assert_eq(array_string_attr, Some(azimuth::StringValue("test_host")))
  assert_eq(array_int_attr, Some(azimuth::StringValue("test_host")))
}

// Test 6: Complex Propagation Scenarios with Multiple Propagators
pub test "å¤æ‚ä¼ æ’­åœºæ™¯å’Œå¤šä¼ æ’­å™¨æµ‹è¯•" {
  // æµ‹è¯•å¤æ‚ä¼ æ’­åœºæ™¯å’Œå¤šä¼ æ’­å™¨ç»„åˆ
  
  // åˆ›å»ºå¤šä¸ªä¼ æ’­å™¨
  let trace_propagator = azimuth::W3CTraceContextPropagator::new()
  let baggage_propagator = azimuth::W3CBaggagePropagator::new()
  
  // åˆ›å»ºå¤åˆä¼ æ’­å™¨
  let trace_propagators = [trace_propagator]
  let composite_trace_propagator = azimuth::CompositePropagator::new(trace_propagators)
  
  let all_propagators = [trace_propagator]
  let composite_all_propagator = azimuth::CompositePropagator::new(all_propagators)
  
  // æµ‹è¯•æ³¨å…¥æ“ä½œ
  let carrier = azimuth::TextMapCarrier::new()
  let ctx = azimuth::Context::root()
  
  // ä½¿ç”¨å¤åˆä¼ æ’­å™¨æ³¨å…¥
  azimuth::CompositePropagator::inject(composite_trace_propagator, ctx, carrier)
  
  // éªŒè¯æ³¨å…¥ç»“æœ
  let trace_header = azimuth::TextMapCarrier::get(carrier, "traceparent")
  assert_eq(trace_header, Some("00-test-trace-id-test-span-id-01"))
  
  // æµ‹è¯•æå–æ“ä½œ
  let extracted_ctx = azimuth::CompositePropagator::extract(composite_trace_propagator, carrier)
  let key = azimuth::ContextKey::new("extracted")
  let extracted_value = azimuth::Context::get(extracted_ctx, key)
  assert_eq(extracted_value, Some("true"))
  
  // æµ‹è¯•å¤æ‚ä¼ æ’­åœºæ™¯
  let complex_carrier = azimuth::TextMapCarrier::new()
  
  // æ¨¡æ‹Ÿå¤šæ¬¡æ³¨å…¥
  azimuth::CompositePropagator::inject(composite_all_propagator, ctx, complex_carrier)
  azimuth::CompositePropagator::inject(composite_all_propagator, extracted_ctx, complex_carrier)
  
  // æ¨¡æ‹Ÿå¤šæ¬¡æå–
  let extracted_ctx1 = azimuth::CompositePropagator::extract(composite_all_propagator, complex_carrier)
  let extracted_ctx2 = azimuth::CompositePropagator::extract(composite_all_propagator, complex_carrier)
  
  // éªŒè¯å¤šæ¬¡æå–çš„ä¸€è‡´æ€§
  let key1 = azimuth::ContextKey::new("extracted")
  let value1 = azimuth::Context::get(extracted_ctx1, key1)
  let value2 = azimuth::Context::get(extracted_ctx2, key1)
  
  assert_eq(value1, Some("true"))
  assert_eq(value2, Some("true"))
  
  // æµ‹è¯•è·¨æœåŠ¡ä¼ æ’­åœºæ™¯
  let service_a_carrier = azimuth::TextMapCarrier::new()
  let service_a_ctx = azimuth::Context::root()
  
  // æœåŠ¡Aæ³¨å…¥ä¸Šä¸‹æ–‡
  azimuth::CompositePropagator::inject(composite_all_propagator, service_a_ctx, service_a_carrier)
  
  // æœåŠ¡Bæå–ä¸Šä¸‹æ–‡
  let service_b_ctx = azimuth::CompositePropagator::extract(composite_all_propagator, service_a_carrier)
  
  // æœåŠ¡Bæ·»åŠ è‡ªå·±çš„ä¸Šä¸‹æ–‡
  let service_b_key = azimuth::ContextKey::new("service.b.data")
  let service_b_ctx_with_data = azimuth::Context::with_value(service_b_ctx, service_b_key, "service-b-value")
  
  // æœåŠ¡Bæ³¨å…¥åˆ°æ–°çš„è½½ä½“
  let service_b_carrier = azimuth::TextMapCarrier::new()
  azimuth::CompositePropagator::inject(composite_all_propagator, service_b_ctx_with_data, service_b_carrier)
  
  // æœåŠ¡Cæå–ä¸Šä¸‹æ–‡
  let service_c_ctx = azimuth::CompositePropagator::extract(composite_all_propagator, service_b_carrier)
  
  // éªŒè¯è·¨æœåŠ¡ä¼ æ’­
  let service_c_value = azimuth::Context::get(service_c_ctx, service_b_key)
  assert_eq(service_c_value, Some("service-b-value"))
}

// Test 7: Advanced Concurrency and Resource Management
pub test "é«˜çº§å¹¶å‘å’Œèµ„æºç®¡ç†æµ‹è¯•" {
  // æµ‹è¯•é«˜çº§å¹¶å‘åœºæ™¯å’Œèµ„æºç®¡ç†
  
  // åˆ›å»ºå¤šä¸ªæä¾›è€…
  let tracer_provider1 = azimuth::TracerProvider::default()
  let tracer_provider2 = azimuth::TracerProvider::default()
  let meter_provider1 = azimuth::MeterProvider::default()
  let meter_provider2 = azimuth::MeterProvider::default()
  let logger_provider1 = azimuth::LoggerProvider::default()
  let logger_provider2 = azimuth::LoggerProvider::default()
  
  // åˆ›å»ºå¤šä¸ªè¿½è¸ªå™¨ã€åº¦é‡å’Œæ—¥å¿—å™¨
  let tracer1 = azimuth::TracerProvider::get_tracer(tracer_provider1, "tracer-1")
  let tracer2 = azimuth::TracerProvider::get_tracer(tracer_provider2, "tracer-2")
  
  let meter1 = azimuth::MeterProvider::get_meter(meter_provider1, "meter-1")
  let meter2 = azimuth::MeterProvider::get_meter(meter_provider2, "meter-2")
  
  let logger1 = azimuth::LoggerProvider::get_logger(logger_provider1, "logger-1")
  let logger2 = azimuth::LoggerProvider::get_logger(logger_provider2, "logger-2")
  
  // åˆ›å»ºå¤šä¸ªSpan
  let spans = []
  for i in 0..50 {
    let tracer = if i % 2 == 0 { tracer1 } else { tracer2 }
    let span = azimuth::Tracer::start_span(tracer, "concurrent-span-" + i.to_string())
    spans.push(span)
  }
  
  // åˆ›å»ºå¤šä¸ªåº¦é‡å·¥å…·
  let counters = []
  let histograms = []
  for i in 0..25 {
    let meter = if i % 2 == 0 { meter1 } else { meter2 }
    let counter = azimuth::Meter::create_counter(meter, "concurrent-counter-" + i.to_string())
    let histogram = azimuth::Meter::create_histogram(meter, "concurrent-histogram-" + i.to_string())
    counters.push(counter)
    histograms.push(histogram)
  }
  
  // åˆ›å»ºå¤šä¸ªæ—¥å¿—è®°å½•
  let log_records = []
  for i in 0..25 {
    let logger = if i % 2 == 0 { logger1 } else { logger2 }
    let severity = match i % 6 {
      0 => azimuth::Trace
      1 => azimuth::Debug
      2 => azimuth::Info
      3 => azimuth::Warn
      4 => azimuth::Error
      _ => azimuth::Fatal
    }
    let log_record = azimuth::LogRecord::new(severity, "Concurrent log message " + i.to_string())
    log_records.push((logger, log_record))
  }
  
  // æ‰§è¡Œå¹¶å‘æ“ä½œ
  for span in spans {
    azimuth::Span::add_event(span, "concurrent.event", Some([("iteration", azimuth::StringValue("test"))]))
    azimuth::Span::set_status(span, azimuth::Ok)
  }
  
  for counter in counters {
    azimuth::Counter::add(counter, 1.0)
  }
  
  for histogram in histograms {
    azimuth::Histogram::record(histogram, 42.0)
  }
  
  for (logger, log_record) in log_records {
    azimuth::Logger::emit(logger, log_record)
  }
  
  // ç»“æŸæ‰€æœ‰Span
  for span in spans {
    azimuth::Span::end(span)
  }
  
  // éªŒè¯èµ„æºåˆ›å»º
  assert_true(spans.length() == 50)
  assert_true(counters.length() == 25)
  assert_true(histograms.length() == 25)
  assert_true(log_records.length() == 25)
  
  // éªŒè¯èµ„æºå±æ€§
  assert_eq(azimuth::Tracer::instrumentation_scope(tracer1).name, "tracer-1")
  assert_eq(azimuth::Tracer::instrumentation_scope(tracer2).name, "tracer-2")
  
  assert_eq(azimuth::Meter::scope(meter1).name, "meter-1")
  assert_eq(azimuth::Meter::scope(meter2).name, "meter-2")
  
  assert_eq(logger1.scope.name, "logger-1")
  assert_eq(logger2.scope.name, "logger-2")
}

// Test 8: Internationalization and Globalization Support
pub test "å›½é™…åŒ–å’Œå…¨çƒåŒ–æ”¯æŒæµ‹è¯•" {
  // æµ‹è¯•å›½é™…åŒ–å’Œå…¨çƒåŒ–æ”¯æŒ
  
  // æµ‹è¯•å¤šè¯­è¨€å±æ€§å€¼
  let i18n_attrs = azimuth::Attributes::new()
  azimuth::Attributes::set(i18n_attrs, "error.message.en", azimuth::StringValue("Operation failed"))
  azimuth::Attributes::set(i18n_attrs, "error.message.zh", azimuth::StringValue("æ“ä½œå¤±è´¥"))
  azimuth::Attributes::set(i18n_attrs, "error.message.ja", azimuth::StringValue("æ“ä½œãŒå¤±æ•—ã—ã¾ã—ãŸ"))
  azimuth::Attributes::set(i18n_attrs, "error.message.ko", azimuth::StringValue("ì‘ì—…ì´ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤"))
  azimuth::Attributes::set(i18n_attrs, "error.message.fr", azimuth::StringValue("L'opÃ©ration a Ã©chouÃ©"))
  azimuth::Attributes::set(i18n_attrs, "error.message.de", azimuth::StringValue("Operation fehlgeschlagen"))
  azimuth::Attributes::set(i18n_attrs, "error.message.es", azimuth::StringValue("La operaciÃ³n fallÃ³"))
  azimuth::Attributes::set(i18n_attrs, "error.message.ru", azimuth::StringValue("ĞĞ¿ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ½Ğµ ÑƒĞ´Ğ°Ğ»Ğ°ÑÑŒ"))
  
  // æµ‹è¯•å¤šè¯­è¨€Spanåç§°
  let tracer = azimuth::TracerProvider::get_tracer(azimuth::TracerProvider::default(), "i18n-tracer")
  
  let english_span = azimuth::Tracer::start_span(tracer, "user.authentication")
  let chinese_span = azimuth::Tracer::start_span(tracer, "ç”¨æˆ·è®¤è¯")
  let japanese_span = azimuth::Tracer::start_span(tracer, "ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼")
  let korean_span = azimuth::Tracer::start_span(tracer, "ì‚¬ìš©ì ì¸ì¦")
  let french_span = azimuth::Tracer::start_span(tracer, "authentification.utilisateur")
  let german_span = azimuth::Tracer::start_span(tracer, "benutzer.authentifizierung")
  let spanish_span = azimuth::Tracer::start_span(tracer, "autenticacion.usuario")
  let russian_span = azimuth::Tracer::start_span(tracer, "Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ.Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ")
  
  // éªŒè¯å¤šè¯­è¨€Spanåç§°
  assert_eq(azimuth::Span::name(english_span), "user.authentication")
  assert_eq(azimuth::Span::name(chinese_span), "ç”¨æˆ·è®¤è¯")
  assert_eq(azimuth::Span::name(japanese_span), "ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼")
  assert_eq(azimuth::Span::name(korean_span), "ì‚¬ìš©ì ì¸ì¦")
  assert_eq(azimuth::Span::name(french_span), "authentification.utilisateur")
  assert_eq(azimuth::Span::name(german_span), "benutzer.authentifizierung")
  assert_eq(azimuth::Span::name(spanish_span), "autenticacion.usuario")
  assert_eq(azimuth::Span::name(russian_span), "Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ.Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ")
  
  // æµ‹è¯•å¤šè¯­è¨€æ—¥å¿—è®°å½•
  let logger = azimuth::LoggerProvider::get_logger(azimuth::LoggerProvider::default(), "i18n-logger")
  
  let english_log = azimuth::LogRecord::new(azimuth::Info, "User logged in successfully")
  let chinese_log = azimuth::LogRecord::new(azimuth::Info, "ç”¨æˆ·æˆåŠŸç™»å½•")
  let japanese_log = azimuth::LogRecord::new(azimuth::Info, "ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ­£å¸¸ã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã—ãŸ")
  let korean_log = azimuth::LogRecord::new(azimuth::Info, "ì‚¬ìš©ìê°€ ì„±ê³µì ìœ¼ë¡œ ë¡œê·¸ì¸í–ˆìŠµë‹ˆë‹¤")
  let french_log = azimuth::LogRecord::new(azimuth::Info, "L'utilisateur s'est connectÃ© avec succÃ¨s")
  let german_log = azimuth::LogRecord::new(azimuth::Info, "Benutzer erfolgreich angemeldet")
  let spanish_log = azimuth::LogRecord::new(azimuth::Info, "Usuario iniciÃ³ sesiÃ³n correctamente")
  let russian_log = azimuth::LogRecord::new(azimuth::Info, "ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ²Ğ¾ÑˆĞµĞ» Ğ² ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ")
  
  // éªŒè¯å¤šè¯­è¨€æ—¥å¿—è®°å½•
  assert_eq(azimuth::LogRecord::body(english_log), Some("User logged in successfully"))
  assert_eq(azimuth::LogRecord::body(chinese_log), Some("ç”¨æˆ·æˆåŠŸç™»å½•"))
  assert_eq(azimuth::LogRecord::body(japanese_log), Some("ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ­£å¸¸ã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã—ãŸ"))
  assert_eq(azimuth::LogRecord::body(korean_log), Some("ì‚¬ìš©ìê°€ ì„±ê³µì ìœ¼ë¡œ ë¡œê·¸ì¸í–ˆìŠµë‹ˆë‹¤"))
  assert_eq(azimuth::LogRecord::body(french_log), Some("L'utilisateur s'est connectÃ© avec succÃ¨s"))
  assert_eq(azimuth::LogRecord::body(german_log), Some("Benutzer erfolgreich angemeldet"))
  assert_eq(azimuth::LogRecord::body(spanish_log), Some("Usuario iniciÃ³ sesiÃ³n correctamente"))
  assert_eq(azimuth::LogRecord::body(russian_log), Some("ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ²Ğ¾ÑˆĞµĞ» Ğ² ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ"))
  
  // æµ‹è¯•å¤šè¯­è¨€èµ„æºå±æ€§
  let i18n_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("service.name.en", azimuth::StringValue("payment-service")),
    ("service.name.zh", azimuth::StringValue("æ”¯ä»˜æœåŠ¡")),
    ("service.name.ja", azimuth::StringValue("æ”¯æ‰•ã„ã‚µãƒ¼ãƒ“ã‚¹")),
    ("service.description.en", azimuth::StringValue("Handles payment processing")),
    ("service.description.zh", azimuth::StringValue("å¤„ç†æ”¯ä»˜æµç¨‹")),
    ("service.description.ja", azimuth::StringValue("æ”¯æ‰•ã„å‡¦ç†ã‚’æ‹…å½“"))
  ])
  
  // éªŒè¯å¤šè¯­è¨€èµ„æºå±æ€§
  let service_name_en = azimuth::Resource::get_attribute(i18n_resource, "service.name.en")
  let service_name_zh = azimuth::Resource::get_attribute(i18n_resource, "service.name.zh")
  let service_name_ja = azimuth::Resource::get_attribute(i18n_resource, "service.name.ja")
  let service_desc_en = azimuth::Resource::get_attribute(i18n_resource, "service.description.en")
  let service_desc_zh = azimuth::Resource::get_attribute(i18n_resource, "service.description.zh")
  let service_desc_ja = azimuth::Resource::get_attribute(i18n_resource, "service.description.ja")
  
  assert_eq(service_name_en, Some(azimuth::StringValue("test_host")))
  assert_eq(service_name_zh, Some(azimuth::StringValue("test_host")))
  assert_eq(service_name_ja, Some(azimuth::StringValue("test_host")))
  assert_eq(service_desc_en, Some(azimuth::StringValue("test_host")))
  assert_eq(service_desc_zh, Some(azimuth::StringValue("test_host")))
  assert_eq(service_desc_ja, Some(azimuth::StringValue("test_host")))
  
  // å‘é€æ‰€æœ‰æ—¥å¿—è®°å½•
  azimuth::Logger::emit(logger, english_log)
  azimuth::Logger::emit(logger, chinese_log)
  azimuth::Logger::emit(logger, japanese_log)
  azimuth::Logger::emit(logger, korean_log)
  azimuth::Logger::emit(logger, french_log)
  azimuth::Logger::emit(logger, german_log)
  azimuth::Logger::emit(logger, spanish_log)
  azimuth::Logger::emit(logger, russian_log)
}

// Test 9: Real-time Dashboard and Streaming Data Processing
pub test "å®æ—¶ä»ªè¡¨æ¿å’Œæµå¼æ•°æ®å¤„ç†æµ‹è¯•" {
  // æµ‹è¯•å®æ—¶ä»ªè¡¨æ¿å’Œæµå¼æ•°æ®å¤„ç†
  
  // åˆ›å»ºå®æ—¶åº¦é‡
  let meter_provider = azimuth::MeterProvider::default()
  let meter = azimuth::MeterProvider::get_meter(meter_provider, "realtime-dashboard")
  
  let request_rate_counter = azimuth::Meter::create_counter(meter, "http.requests.rate", Some("HTTP request rate"), Some("requests/sec"))
  let response_time_histogram = azimuth::Meter::create_histogram(meter, "http.response.time", Some("HTTP response time"), Some("ms"))
  let error_rate_counter = azimuth::Meter::create_counter(meter, "http.errors.rate", Some("HTTP error rate"), Some("errors/sec"))
  let active_users_gauge = azimuth::Meter::create_gauge(meter, "users.active", Some("Active users"), Some("users"))
  
  // æ¨¡æ‹Ÿå®æ—¶æ•°æ®æµ
  let clock = azimuth::Clock::system()
  let start_time = azimuth::Clock::now_unix_nanos(clock)
  
  // æ¨¡æ‹Ÿ1åˆ†é’Ÿçš„å®æ—¶æ•°æ®
  for second in 0..60 {
    let timestamp = start_time + (second * 1000000000L)  // æ¯ç§’
    
    // æ¨¡æ‹Ÿè¯·æ±‚ç‡å˜åŒ–
    let request_rate = 100.0 + (50.0 * (second.to_double() / 60.0).sin())
    azimuth::Counter::add(request_rate_counter, request_rate)
    
    // æ¨¡æ‹Ÿå“åº”æ—¶é—´å˜åŒ–
    let response_time = 50.0 + (25.0 * (second.to_double() / 30.0).cos())
    azimuth::Histogram::record(response_time_histogram, response_time)
    
    // æ¨¡æ‹Ÿé”™è¯¯ç‡å˜åŒ–
    if second % 10 == 0 {
      azimuth::Counter::add(error_rate_counter, 5.0)  // æ¯10ç§’5ä¸ªé”™è¯¯
    }
    
    // æ¨¡æ‹Ÿæ´»è·ƒç”¨æˆ·å˜åŒ–
    let active_users = 1000.0 + (200.0 * (second.to_double() / 20.0).sin())
    azimuth::Gauge::record(active_users_gauge, active_users)
  }
  
  // åˆ›å»ºå®æ—¶æ—¥å¿—æµ
  let logger = azimuth::LoggerProvider::get_logger(azimuth::LoggerProvider::default(), "realtime-logger")
  
  // æ¨¡æ‹Ÿå®æ—¶æ—¥å¿—æµ
  for event in 0..100 {
    let severity = match event % 10 {
      0 => azimuth::Error
      1..2 => azimuth::Warn
      3..5 => azimuth::Info
      _ => azimuth::Debug
    }
    
    let log_message = match event % 5 {
      0 => "User authentication completed"
      1 => "Database query executed"
      2 => "Cache miss occurred"
      3 => "API request processed"
      _ => "Background task finished"
    }
    
    let log_record = azimuth::LogRecord::new(severity, log_message)
    azimuth::Logger::emit(logger, log_record)
  }
  
  // åˆ›å»ºå®æ—¶è¿½è¸ªæµ
  let tracer = azimuth::TracerProvider::get_tracer(azimuth::TracerProvider::default(), "realtime-tracer")
  
  // æ¨¡æ‹Ÿå®æ—¶è¿½è¸ªæµ
  for trace in 0..50 {
    let span_name = "operation-" + trace.to_string()
    let span = azimuth::Tracer::start_span(tracer, span_name)
    
    // æ·»åŠ äº‹ä»¶
    azimuth::Span::add_event(span, "operation.started", Some([("trace.id", azimuth::StringValue("trace-" + trace.to_string()))]))
    
    // è®¾ç½®çŠ¶æ€
    let status = if trace % 10 == 0 {
      azimuth::Error
    } else {
      azimuth::Ok
    }
    azimuth::Span::set_status(span, status)
    
    // ç»“æŸSpan
    azimuth::Span::end(span)
  }
  
  let end_time = azimuth::Clock::now_unix_nanos(clock)
  let total_duration = end_time - start_time
  
  // éªŒè¯å®æ—¶æ•°æ®å¤„ç†
  assert_true(total_duration >= 0L)
  assert_true(total_duration < 60000000000L)  // å°äº60ç§’
  
  // éªŒè¯åº¦é‡å·¥å…·å±æ€§
  assert_eq(request_rate_counter.name, "http.requests.rate")
  assert_eq(request_rate_counter.description, Some("HTTP request rate"))
  assert_eq(request_rate_counter.unit, Some("requests/sec"))
  
  assert_eq(response_time_histogram.name, "http.response.time")
  assert_eq(response_time_histogram.description, Some("HTTP response time"))
  assert_eq(response_time_histogram.unit, Some("ms"))
  
  assert_eq(error_rate_counter.name, "http.errors.rate")
  assert_eq(error_rate_counter.description, Some("HTTP error rate"))
  assert_eq(error_rate_counter.unit, Some("errors/sec"))
  
  assert_eq(active_users_gauge.name, "users.active")
  assert_eq(active_users_gauge.description, Some("Active users"))
  assert_eq(active_users_gauge.unit, Some("users"))
}

// Test 10: Comprehensive End-to-End Business Process Integration
pub test "ç»¼åˆç«¯åˆ°ç«¯ä¸šåŠ¡æµç¨‹é›†æˆæµ‹è¯•" {
  // æµ‹è¯•ç»¼åˆç«¯åˆ°ç«¯ä¸šåŠ¡æµç¨‹é›†æˆ
  
  // è®¾ç½®ä¸šåŠ¡æµç¨‹èµ„æº
  let business_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("service.name", azimuth::StringValue("e-commerce-platform")),
    ("service.version", azimuth::StringValue("2.1.0")),
    ("business.domain", azimuth::StringValue("retail")),
    ("business.process", azimuth::StringValue("order-processing")),
    ("deployment.environment", azimuth::StringValue("production")),
    ("region", azimuth::StringValue("us-west-2")),
    ("availability.zone", azimuth::StringValue("us-west-2a"))
  ])
  
  // åˆ›å»ºä¸šåŠ¡æµç¨‹è¿½è¸ªå™¨
  let tracer_provider = azimuth::TracerProvider::default()
  let tracer = azimuth::TracerProvider::get_tracer(tracer_provider, "order-processing-service")
  
  // åˆ›å»ºä¸šåŠ¡æµç¨‹åº¦é‡
  let meter_provider = azimuth::MeterProvider::default()
  let meter = azimuth::MeterProvider::get_meter(meter_provider, "order-processing-metrics")
  
  let order_counter = azimuth::Meter::create_counter(meter, "orders.total", Some("Total orders processed"), Some("orders"))
  let revenue_counter = azimuth::Meter::create_counter(meter, "revenue.total", Some("Total revenue"), Some("USD"))
  let order_value_histogram = azimuth::Meter::create_histogram(meter, "order.value", Some("Order value distribution"), Some("USD"))
  let processing_time_histogram = azimuth::Meter::create_histogram(meter, "order.processing.time", Some("Order processing time"), Some("ms"))
  let active_orders_gauge = azimuth::Meter::create_gauge(meter, "orders.active", Some("Active orders being processed"), Some("orders"))
  
  // åˆ›å»ºä¸šåŠ¡æµç¨‹æ—¥å¿—å™¨
  let logger_provider = azimuth::LoggerProvider::default()
  let logger = azimuth::LoggerProvider::get_logger(logger_provider, "order-processing-logger")
  
  // æ¨¡æ‹Ÿç«¯åˆ°ç«¯ä¸šåŠ¡æµç¨‹ï¼šè®¢å•å¤„ç†
  let order_ids = ["order-001", "order-002", "order-003", "order-004", "order-005"]
  let customer_ids = ["customer-001", "customer-002", "customer-003", "customer-004", "customer-005"]
  let order_values = [99.99, 149.99, 199.99, 49.99, 299.99]
  
  for i in 0..order_ids.length() {
    let order_id = order_ids[i]
    let customer_id = customer_ids[i]
    let order_value = order_values[i]
    
    // å¼€å§‹è®¢å•å¤„ç†Span
    let order_span = azimuth::Tracer::start_span(tracer, "process-order")
    
    // æ·»åŠ è®¢å•äº‹ä»¶
    azimuth::Span::add_event(order_span, "order.received", Some([
      ("order.id", azimuth::StringValue(order_id)),
      ("customer.id", azimuth::StringValue(customer_id)),
      ("order.value", azimuth::FloatValue(order_value))
    ]))
    
    // æ›´æ–°æ´»è·ƒè®¢å•
    azimuth::Gauge::record(active_orders_gauge, (i + 1).to_double())
    
    // æ¨¡æ‹Ÿè®¢å•éªŒè¯
    let validation_span = azimuth::Tracer::start_span(tracer, "validate-order")
    azimuth::Span::add_event(validation_span, "validation.started", Some([
      ("order.id", azimuth::StringValue(order_id))
    ]))
    
    // è®°å½•éªŒè¯æ—¥å¿—
    let validation_log = azimuth::LogRecord::new_with_context(
      azimuth::Info,
      Some("Order validation started for " + order_id),
      Some(azimuth::Attributes::new()),
      Some(azimuth::Clock::now_unix_nanos(azimuth::Clock::system())),
      None,
      Some(azimuth::SpanContext::trace_id(azimuth::Span::span_context(order_span))),
      Some(azimuth::SpanContext::span_id(azimuth::Span::span_context(order_span))),
      Some(azimuth::Context::root())
    )
    azimuth::Logger::emit(logger, validation_log)
    
    azimuth::Span::end(validation_span)
    
    // æ¨¡æ‹Ÿæ”¯ä»˜å¤„ç†
    let payment_span = azimuth::Tracer::start_span(tracer, "process-payment")
    azimuth::Span::add_event(payment_span, "payment.started", Some([
      ("order.id", azimuth::StringValue(order_id)),
      ("payment.amount", azimuth::FloatValue(order_value))
    ]))
    
    // è®°å½•æ”¯ä»˜æ—¥å¿—
    let payment_log = azimuth::LogRecord::new_with_context(
      azimuth::Info,
      Some("Payment processing started for order " + order_id + " with amount $" + order_value.to_string()),
      Some(azimuth::Attributes::new()),
      Some(azimuth::Clock::now_unix_nanos(azimuth::Clock::system())),
      None,
      Some(azimuth::SpanContext::trace_id(azimuth::Span::span_context(order_span))),
      Some(azimuth::SpanContext::span_id(azimuth::Span::span_context(order_span))),
      Some(azimuth::Context::root())
    )
    azimuth::Logger::emit(logger, payment_log)
    
    azimuth::Span::end(payment_span)
    
    // æ¨¡æ‹Ÿåº“å­˜æ£€æŸ¥
    let inventory_span = azimuth::Tracer::start_span(tracer, "check-inventory")
    azimuth::Span::add_event(inventory_span, "inventory.check.started", Some([
      ("order.id", azimuth::StringValue(order_id))
    ]))
    
    azimuth::Span::end(inventory_span)
    
    // æ¨¡æ‹Ÿè®¢å•å‘è´§
    let shipping_span = azimuth::Tracer::start_span(tracer, "ship-order")
    azimuth::Span::add_event(shipping_span, "shipping.started", Some([
      ("order.id", azimuth::StringValue(order_id))
    ]))
    
    azimuth::Span::end(shipping_span)
    
    // æ›´æ–°åº¦é‡
    azimuth::Counter::add(order_counter, 1.0)
    azimuth::Counter::add(revenue_counter, order_value)
    azimuth::Histogram::record(order_value_histogram, order_value)
    azimuth::Histogram::record(processing_time_histogram, 1000.0 + (i.to_double() * 100.0))  // é€’å¢çš„å¤„ç†æ—¶é—´
    
    // è®°å½•è®¢å•å®Œæˆæ—¥å¿—
    let completion_log = azimuth::LogRecord::new_with_context(
      azimuth::Info,
      Some("Order " + order_id + " processed successfully"),
      Some(azimuth::Attributes::new()),
      Some(azimuth::Clock::now_unix_nanos(azimuth::Clock::system())),
      None,
      Some(azimuth::SpanContext::trace_id(azimuth::Span::span_context(order_span))),
      Some(azimuth::SpanContext::span_id(azimuth::Span::span_context(order_span))),
      Some(azimuth::Context::root())
    )
    azimuth::Logger::emit(logger, completion_log)
    
    // æ·»åŠ è®¢å•å®Œæˆäº‹ä»¶
    azimuth::Span::add_event(order_span, "order.completed", Some([
      ("order.id", azimuth::StringValue(order_id)),
      ("customer.id", azimuth::StringValue(customer_id)),
      ("order.value", azimuth::FloatValue(order_value))
    ]))
    
    // è®¾ç½®è®¢å•çŠ¶æ€
    azimuth::Span::set_status(order_span, azimuth::Ok)
    
    // ç»“æŸè®¢å•Span
    azimuth::Span::end(order_span)
    
    // å‡å°‘æ´»è·ƒè®¢å•
    azimuth::Gauge::record(active_orders_gauge, (i + 1).to_double() - 1.0)
  }
  
  // éªŒè¯ä¸šåŠ¡æµç¨‹å®Œæˆ
  assert_eq(order_counter.name, "orders.total")
  assert_eq(revenue_counter.name, "revenue.total")
  assert_eq(order_value_histogram.name, "order.value")
  assert_eq(processing_time_histogram.name, "order.processing.time")
  assert_eq(active_orders_gauge.name, "orders.active")
  
  // éªŒè¯èµ„æºå±æ€§
  let service_name = azimuth::Resource::get_attribute(business_resource, "service.name")
  let service_version = azimuth::Resource::get_attribute(business_resource, "service.version")
  let business_domain = azimuth::Resource::get_attribute(business_resource, "business.domain")
  let business_process = azimuth::Resource::get_attribute(business_resource, "business.process")
  let deployment_env = azimuth::Resource::get_attribute(business_resource, "deployment.environment")
  let region = azimuth::Resource::get_attribute(business_resource, "region")
  let availability_zone = azimuth::Resource::get_attribute(business_resource, "availability.zone")
  
  assert_eq(service_name, Some(azimuth::StringValue("test_host")))
  assert_eq(service_version, Some(azimuth::StringValue("test_host")))
  assert_eq(business_domain, Some(azimuth::StringValue("test_host")))
  assert_eq(business_process, Some(azimuth::StringValue("test_host")))
  assert_eq(deployment_env, Some(azimuth::StringValue("test_host")))
  assert_eq(region, Some(azimuth::StringValue("test_host")))
  assert_eq(availability_zone, Some(azimuth::StringValue("test_host")))
}