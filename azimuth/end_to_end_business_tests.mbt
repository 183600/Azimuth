// ç«¯åˆ°ç«¯ä¸šåŠ¡åœºæ™¯å’Œå†…å­˜ç®¡ç†æµ‹è¯•ç”¨ä¾‹
// æµ‹è¯•çœŸå®ä¸šåŠ¡åœºæ™¯ä¸‹çš„é¥æµ‹ç³»ç»Ÿè¡Œä¸ºå’Œå†…å­˜ç®¡ç†

test "ç”µå•†è®¢å•å¤„ç†å®Œæ•´æµç¨‹é¥æµ‹æµ‹è¯•" {
  // æ¨¡æ‹Ÿå®Œæ•´çš„ç”µå•†è®¢å•å¤„ç†æµç¨‹
  let tracer_provider = TracerProvider::default()
  let meter_provider = MeterProvider::default()
  let logger_provider = LoggerProvider::default()
  
  // åˆ›å»ºå„ä¸ªæœåŠ¡çš„tracerå’Œmeter
  let order_service_tracer = TracerProvider::get_tracer(tracer_provider, "order-service")
  let payment_service_tracer = TracerProvider::get_tracer(tracer_provider, "payment-service")
  let inventory_service_tracer = TracerProvider::get_tracer(tracer_provider, "inventory-service")
  let shipping_service_tracer = TracerProvider::get_tracer(tracer_provider, "shipping-service")
  
  let order_meter = MeterProvider::get_meter(meter_provider, "order-metrics")
  let payment_meter = MeterProvider::get_meter(meter_provider, "payment-metrics")
  let inventory_meter = MeterProvider::get_meter(meter_provider, "inventory-metrics")
  
  let order_logger = LoggerProvider::get_logger(logger_provider, "order-logger")
  
  // åˆ›å»ºä¸šåŠ¡æŒ‡æ ‡
  let order_counter = Meter::create_counter(order_meter, "orders.total")
  let payment_amount_histogram = Meter::create_histogram(payment_meter, "payment.amount")
  let inventory_counter = Meter::create_counter(inventory_meter, "inventory.reservations")
  
  // 1. è®¢å•åˆ›å»ºé˜¶æ®µ
  let order_span = Tracer::start_span(order_service_tracer, "create-order")
  let order_context = Context::with_value(Context::root(), ContextKey::new("order.id"), "ORDER-12345")
  
  // æ·»åŠ è®¢å•å±æ€§
  Span::add_event(order_span, "order.created")
  
  // è®°å½•è®¢å•æŒ‡æ ‡
  Counter::add(order_counter, 1.0)
  
  // è®°å½•è®¢å•æ—¥å¿—
  let order_log = LogRecord::new(Info, "Order ORDER-12345 created for user USER-67890")
  Logger::emit(order_logger, order_log)
  
  // 2. æ”¯ä»˜å¤„ç†é˜¶æ®µ
  let payment_span = Tracer::start_span(payment_service_tracer, "process-payment")
  Span::add_event(payment_span, "payment.started")
  
  // è®°å½•æ”¯ä»˜æŒ‡æ ‡
  Histogram::record(payment_amount_histogram, 299.99)
  
  // æ¨¡æ‹Ÿæ”¯ä»˜å¤„ç†
  Span::add_event(payment_span, "payment.completed")
  
  Span::end(payment_span)
  
  // 3. åº“å­˜é¢„ç•™é˜¶æ®µ
  let inventory_span = Tracer::start_span(inventory_service_tracer, "reserve-inventory")
  Span::add_event(inventory_span, "inventory.reservation.started")
  
  // è®°å½•åº“å­˜æŒ‡æ ‡
  Counter::add(inventory_counter, 1.0)
  
  Span::add_event(inventory_span, "inventory.reserved")
  
  Span::end(inventory_span)
  
  // 4. ç‰©æµé…é€é˜¶æ®µ
  let shipping_span = Tracer::start_span(shipping_service_tracer, "schedule-shipping")
  Span::add_event(shipping_span, "shipping.scheduled")
  
  Span::end(shipping_span)
  
  // 5. å®Œæˆè®¢å•
  Span::add_event(order_span, "order.completed")
  
  Span::end(order_span)
  
  // éªŒè¯æ‰€æœ‰spanéƒ½æ­£ç¡®åˆ›å»ºå’Œç»“æŸ
  assert_true(true) // å¦‚æœæµç¨‹å®Œæˆåˆ™æµ‹è¯•é€šè¿‡
}

test "å¾®æœåŠ¡æ¶æ„ä¸‹å¯è§‚æµ‹æ€§æ•°æ®ä¸€è‡´æ€§æµ‹è¯•" {
  // æµ‹è¯•å¾®æœåŠ¡æ¶æ„ä¸­å¯è§‚æµ‹æ€§æ•°æ®çš„ä¸€è‡´æ€§
  let tracer_provider = TracerProvider::default()
  let meter_provider = MeterProvider::default()
  
  // æ¨¡æ‹ŸAPI Gateway
  let gateway_tracer = TracerProvider::get_tracer(tracer_provider, "api-gateway")
  let gateway_span = Tracer::start_span(gateway_tracer, "api-request")
  
  // åˆ›å»ºç»Ÿä¸€çš„trace context
  let trace_id = "0af7651916cd43dd8448eb211c80319c"
  let span_id = "b7ad6b7169203331"
  let span_context = SpanContext::new(trace_id, span_id, true, "")
  
  // è®¾ç½®ä¼ æ’­ä¸Šä¸‹æ–‡
  let propagation_context = Context::with_value(Context::root(), ContextKey::new("trace.id"), trace_id)
  
  // æ¨¡æ‹Ÿå¤šä¸ªå¾®æœåŠ¡çš„è°ƒç”¨é“¾
  let services = ["user-service", "product-service", "order-service", "payment-service"]
  let service_spans = []
  
  for service in services {
    let service_tracer = TracerProvider::get_tracer(tracer_provider, service)
    let service_span = Tracer::start_span(service_tracer, service + ".operation")
    
    // æ·»åŠ ç»Ÿä¸€çš„traceæ ‡è¯†
    Span::add_event(service_span, "service.called", Some([
      ("service.name", StringValue(service)),
      ("trace.id", StringValue(trace_id)),
      ("parent.span.id", StringValue(span_id))
    ]))
    
    service_spans.push(service_span)
  }
  
  // éªŒè¯æ‰€æœ‰æœåŠ¡éƒ½ä½¿ç”¨ç›¸åŒçš„trace ID
  for span in service_spans {
    let span_ctx = Span::span_context(span)
    assert_eq(SpanContext::trace_id(span_ctx), trace_id)
  }
  
  // ç»“æŸæ‰€æœ‰span
  for span in service_spans {
    Span::end(span)
  }
  Span::end(gateway_span)
  
  assert_true(true) // å¦‚æœæ•°æ®ä¸€è‡´æ€§éªŒè¯é€šè¿‡åˆ™æµ‹è¯•é€šè¿‡
}

test "å†…å­˜æ³„æ¼é˜²æŠ¤å’Œèµ„æºç®¡ç†æµ‹è¯•" {
  // æµ‹è¯•é•¿æ—¶é—´è¿è¡Œä¸‹çš„å†…å­˜ç®¡ç†å’Œèµ„æºæ¸…ç†
  let tracer_provider = TracerProvider::default()
  let meter_provider = MeterProvider::default()
  let logger_provider = LoggerProvider::default()
  
  // åˆ›å»ºå¤§é‡å¯¹è±¡å¹¶æµ‹è¯•èµ„æºæ¸…ç†
  for batch = 0; batch < 10; batch = batch + 1 {
    let spans = []
    let metrics = []
    let log_records = []
    
    // åˆ›å»ºå¤§é‡span
    for i = 0; i < 100; i = i + 1 {
      let tracer = TracerProvider::get_tracer(tracer_provider, "batch-" + batch.to_string())
      let span = Tracer::start_span(tracer, "span-" + i.to_string())
      Span::add_event(span, "test.event", Some([("batch", IntValue(batch)), ("index", IntValue(i))]))
      spans.push(span)
    }
    
    // åˆ›å»ºå¤§é‡metrics
    for i = 0; i < 50; i = i + 1 {
      let meter = MeterProvider::get_meter(meter_provider, "batch-meter-" + i.to_string())
      let counter = Meter::create_counter(meter, "counter-" + i.to_string())
      Counter::add(counter, i.to_double())
      metrics.push(counter)
    }
    
    // åˆ›å»ºå¤§é‡æ—¥å¿—è®°å½•
    for i = 0; i < 50; i = i + 1 {
      let logger = LoggerProvider::get_logger(logger_provider, "batch-logger-" + i.to_string())
      let log_record = LogRecord::new(Info, "Batch " + batch.to_string() + " log " + i.to_string())
      log_records.push(log_record)
      Logger::emit(logger, log_record)
    }
    
    // ç»“æŸæ‰€æœ‰spanï¼ˆæ¨¡æ‹Ÿèµ„æºæ¸…ç†ï¼‰
    for span in spans {
      Span::end(span)
    }
    
    // éªŒè¯èµ„æºå¯ä»¥æ­£å¸¸é‡Šæ”¾ï¼ˆåœ¨ç®€åŒ–å®ç°ä¸­ä¸»è¦éªŒè¯ä¸å´©æºƒï¼‰
    assert_true(spans.length() == 100)
    assert_true(metrics.length() == 50)
    assert_true(log_records.length() == 50)
  }
  
  assert_true(true) // å¦‚æœå†…å­˜ç®¡ç†æ­£å¸¸åˆ™æµ‹è¯•é€šè¿‡
}

test "å¤šè¯­è¨€å›½é™…åŒ–æ”¯æŒæµ‹è¯•" {
  // æµ‹è¯•å¤šè¯­è¨€ç¯å¢ƒä¸‹çš„é¥æµ‹ç³»ç»Ÿæ”¯æŒ
  let tracer_provider = TracerProvider::default()
  let logger_provider = LoggerProvider::default()
  
  // æµ‹è¯•ä¸åŒè¯­è¨€çš„é”™è¯¯æ¶ˆæ¯å’Œæ—¥å¿—
  let languages = ["zh-CN", "en-US", "ja-JP", "fr-FR", "de-DE"]
  let error_messages = [
    ("zh-CN", "è®¢å•å¤„ç†å¤±è´¥"),
    ("en-US", "Order processing failed"),
    ("ja-JP", "æ³¨æ–‡å‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ"),
    ("fr-FR", "Ã‰chec du traitement de la commande"),
    ("de-DE", "Bestellverarbeitung fehlgeschlagen")
  ]
  
  for (lang, message) in error_messages {
    let tracer = TracerProvider::get_tracer(tracer_provider, "i18n-service")
    let span = Tracer::start_span(tracer, "localized-operation")
    
    // æ·»åŠ æœ¬åœ°åŒ–å±æ€§
    Span::add_event(span, "error.occurred", Some([
      ("language", StringValue(lang)),
      ("error.message", StringValue(message)),
      ("error.code", StringValue("ORDER_FAILED"))
    ]))
    
    // åˆ›å»ºæœ¬åœ°åŒ–æ—¥å¿—è®°å½•
    let logger = LoggerProvider::get_logger(logger_provider, "i18n-logger")
    let localized_log = LogRecord::new_with_context(
      Error,
      Some(message),
      Some(Attributes::new()),
      Some(Clock::now_unix_nanos(Clock::system())),
      None,
      None,
      None,
      Some(Context::with_value(Context::root(), ContextKey::new("locale"), lang))
    )
    
    Logger::emit(logger, localized_log)
    Span::end(span)
  }
  
  // æµ‹è¯•Unicodeå’Œç‰¹æ®Šå­—ç¬¦æ”¯æŒ
  let special_chars_tracer = TracerProvider::get_tracer(tracer_provider, "unicode-test")
  let unicode_span = Tracer::start_span(special_chars_tracer, "unicode-operation-ğŸš€")
  
  Span::add_event(unicode_span, "unicode.test", Some([
    ("emoji", StringValue("ğŸ‰ğŸš€ğŸ“Š")),
    ("chinese", StringValue("æµ‹è¯•ä¸­æ–‡å­—ç¬¦")),
    ("arabic", StringValue("Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©")),
    ("russian", StringValue("Ğ¢ĞµÑÑ‚ Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¾Ğ¼ ÑĞ·Ñ‹ĞºĞµ")),
    ("math.symbols", StringValue("âˆ‘âˆâˆ«âˆ†âˆ‡âˆ‚"))
  ]))
  
  Span::end(unicode_span)
  
  assert_true(true) // å¦‚æœå¤šè¯­è¨€æ”¯æŒæ­£å¸¸åˆ™æµ‹è¯•é€šè¿‡
}

test "å¹³å°å…¼å®¹æ€§å’Œç¯å¢ƒé€‚é…æµ‹è¯•" {
  // æµ‹è¯•ä¸åŒå¹³å°å’Œç¯å¢ƒä¸‹çš„é€‚é…èƒ½åŠ›
  let tracer_provider = TracerProvider::default()
  let meter_provider = MeterProvider::default()
  
  // æ¨¡æ‹Ÿä¸åŒçš„è¿è¡Œç¯å¢ƒ
  let environments = [
    ("development", "localhost", "dev"),
    ("staging", "staging.example.com", "stage"),
    ("production", "api.example.com", "prod"),
    ("testing", "test.example.com", "test")
  ]
  
  for (env, host, env_short) in environments {
    let tracer = TracerProvider::get_tracer(tracer_provider, env + "-service")
    let span = Tracer::start_span(tracer, env + ".operation")
    
    // æ·»åŠ ç¯å¢ƒç‰¹å®šçš„å±æ€§
    Span::add_event(span, "environment.info", Some([
      ("environment", StringValue(env)),
      ("host", StringValue(host)),
      ("deployment", StringValue(env_short)),
      ("platform", StringValue("wasm-gc")),
      ("version", StringValue("1.0.0"))
    ]))
    
    // åˆ›å»ºç¯å¢ƒç‰¹å®šçš„æŒ‡æ ‡
    let meter = MeterProvider::get_meter(meter_provider, env + "-metrics")
    let env_counter = Meter::create_counter(meter, env + ".requests", Some("Requests in " + env), Some("requests"))
    Counter::add(env_counter, 1.0)
    
    Span::end(span)
  }
  
  // æµ‹è¯•ä¸åŒå¹³å°ç‰¹å®šçš„åŠŸèƒ½
  let clock = Clock::system()
  let timestamp = Clock::now_unix_nanos(clock)
  assert_true(timestamp > 0L)
  
  let random = Random::system()
  let random_bytes = Random::next_bytes(random, 16)
  assert_eq(random_bytes.length(), 16)
  
  let random_u64 = Random::next_u64(random)
  assert_true(random_u64 > 0UL)
  
  assert_true(true) // å¦‚æœå¹³å°å…¼å®¹æ€§æ­£å¸¸åˆ™æµ‹è¯•é€šè¿‡
}

test "é«˜å¯ç”¨æ€§å’Œå®¹é”™æœºåˆ¶æµ‹è¯•" {
  // æµ‹è¯•ç³»ç»Ÿåœ¨å„ç§æ•…éšœæƒ…å†µä¸‹çš„å®¹é”™èƒ½åŠ›
  let tracer_provider = TracerProvider::default()
  let logger_provider = LoggerProvider::default()
  
  // æ¨¡æ‹Ÿç½‘ç»œæ•…éšœæƒ…å†µ
  let fault_tolerant_tracer = TracerProvider::get_tracer(tracer_provider, "fault-tolerant-service")
  let main_span = Tracer::start_span(fault_tolerant_tracer, "fault-tolerant-operation")
  
  // æ¨¡æ‹Ÿéƒ¨åˆ†åŠŸèƒ½å¤±è´¥çš„æƒ…å†µ
  Span::add_event(main_span, "operation.started", Some([
    ("operation.id", StringValue("OP-12345")),
    ("retry.count", IntValue(0))
  ]))
  
  // æ¨¡æ‹Ÿé‡è¯•æœºåˆ¶
  for retry = 0; retry < 3; retry = retry + 1 {
    Span::add_event(main_span, "retry.attempt", Some([
      ("retry.count", IntValue(retry)),
      ("attempt.timestamp", StringValue((Clock::now_unix_nanos(Clock::system()) + retry * 1000L).to_string()))
    ]))
  }
  
  // æ¨¡æ‹Ÿé™çº§å¤„ç†
  Span::add_event(main_span, "fallback.activated", Some([
    ("fallback.reason", StringValue("service.unavailable")),
    ("fallback.strategy", StringValue("cache.fallback"))
  ]))
  
  // æ¨¡æ‹Ÿæ¢å¤
  Span::add_event(main_span, "service.recovered", Some([
    ("recovery.time", StringValue(Clock::now_unix_nanos(Clock::system()).to_string())),
    ("total.duration", IntValue(5000))
  ]))
  
  Span::set_status(main_span, Ok)
  Span::end(main_span)
  
  // æµ‹è¯•æ—¥å¿—è®°å½•åœ¨æ•…éšœæƒ…å†µä¸‹çš„è¡¨ç°
  let fault_logger = LoggerProvider::get_logger(logger_provider, "fault-logger")
  
  // è®°å½•ä¸åŒçº§åˆ«çš„æ•…éšœæ—¥å¿—
  let warn_log = LogRecord::new(Warn, "Service degradation detected")
  Logger::emit(fault_logger, warn_log)
  
  let error_log = LogRecord::new(Error, "Service temporarily unavailable")
  Logger::emit(fault_logger, error_log)
  
  let recovery_log = LogRecord::new(Info, "Service recovered successfully")
  Logger::emit(fault_logger, recovery_log)
  
  assert_true(true) // å¦‚æœå®¹é”™æœºåˆ¶æ­£å¸¸åˆ™æµ‹è¯•é€šè¿‡
}

test "æ•°æ®å®Œæ•´æ€§éªŒè¯å’Œå®¡è®¡æµ‹è¯•" {
  // æµ‹è¯•é¥æµ‹æ•°æ®çš„å®Œæ•´æ€§å’Œå®¡è®¡èƒ½åŠ›
  let tracer_provider = TracerProvider::default()
  let meter_provider = MeterProvider::default()
  let logger_provider = LoggerProvider::default()
  
  // åˆ›å»ºå®¡è®¡è¿½è¸ª
  let audit_tracer = TracerProvider::get_tracer(tracer_provider, "audit-service")
  let audit_span = Tracer::start_span(audit_tracer, "data-audit")
  
  // æ·»åŠ å®¡è®¡ç›¸å…³çš„äº‹ä»¶å’Œå±æ€§
  Span::add_event(audit_span, "audit.started", Some([
    ("audit.id", StringValue("AUDIT-12345")),
    ("audit.type", StringValue("data.integrity")),
    ("auditor", StringValue("system")),
    ("timestamp", StringValue(Clock::now_unix_nanos(Clock::system()).to_string()))
  ]))
  
  // æ¨¡æ‹Ÿæ•°æ®å®Œæ•´æ€§æ£€æŸ¥
  let integrity_checks = [
    ("trace.data.completeness", true),
    ("metrics.data.accuracy", true),
    ("log.data.consistency", false),
    ("span.timeline.validity", true),
    ("attribute.format.correctness", true)
  ]
  
  for (check_name, result) in integrity_checks {
    Span::add_event(audit_span, "integrity.check", Some([
      ("check.name", StringValue(check_name)),
      ("check.result", BoolValue(result)),
      ("check.timestamp", StringValue(Clock::now_unix_nanos(Clock::system()).to_string()))
    ]))
  }
  
  // è®°å½•å®¡è®¡ç»“æœ
  Span::add_event(audit_span, "audit.completed", Some([
    ("total.checks", IntValue(integrity_checks.length())),
    ("passed.checks", IntValue(4)),
    ("failed.checks", IntValue(1)),
    ("audit.status", StringValue("completed_with_issues"))
  ]))
  
  Span::end(audit_span)
  
  // åˆ›å»ºå®¡è®¡æ—¥å¿—
  let audit_logger = LoggerProvider::get_logger(logger_provider, "audit-logger")
  let audit_log = LogRecord::new_with_context(
    Info,
    Some("Data integrity audit completed"),
    Some(Attributes::new()),
    Some(Clock::now_unix_nanos(Clock::system())),
    None,
    Some("audit-trace-123"),
    Some("audit-span-456"),
    Some(Context::with_value(Context::root(), ContextKey::new("audit.id"), "AUDIT-12345"))
  )
  
  Logger::emit(audit_logger, audit_log)
  
  assert_true(true) // å¦‚æœå®¡è®¡åŠŸèƒ½æ­£å¸¸åˆ™æµ‹è¯•é€šè¿‡
}

test "å®æ—¶ç›‘æ§å’Œå‘Šè­¦ç³»ç»Ÿæµ‹è¯•" {
  // æµ‹è¯•å®æ—¶ç›‘æ§å’Œå‘Šè­¦åŠŸèƒ½
  let tracer_provider = TracerProvider::default()
  let meter_provider = MeterProvider::default()
  
  // åˆ›å»ºç›‘æ§ç›¸å…³çš„æŒ‡æ ‡
  let monitor_meter = MeterProvider::get_meter(meter_provider, "monitoring-metrics")
  let request_rate_counter = Meter::create_counter(monitor_meter, "requests.rate", Some("Request rate"), Some("requests/sec"))
  let response_time_histogram = Meter::create_histogram(monitor_meter, "response.time", Some("Response times"), Some("ms"))
  let error_rate_gauge = Gauge::{ name: "error.rate", description: Some("Error rate"), unit: Some("percentage") }
  
  // æ¨¡æ‹Ÿå®æ—¶ç›‘æ§æ•°æ®æ”¶é›†
  for i = 0; i < 100; i = i + 1 {
    // è®°å½•è¯·æ±‚ç‡
    Counter::add(request_rate_counter, 1.0)
    
    // è®°å½•å“åº”æ—¶é—´ï¼ˆæ¨¡æ‹Ÿä¸åŒèŒƒå›´çš„å“åº”æ—¶é—´ï¼‰
    let response_time = (i % 200).to_double() // 0-199ms
    Histogram::record(response_time_histogram, response_time)
    
    // æ¨¡æ‹Ÿé”™è¯¯ç‡å˜åŒ–
    if i % 10 == 0 {
      // æ¯10ä¸ªè¯·æ±‚ä¸­æœ‰1ä¸ªé”™è¯¯
      // åœ¨å®é™…å®ç°ä¸­ä¼šæ›´æ–°gaugeå€¼
    }
  }
  
  // åˆ›å»ºç›‘æ§å‘Šè­¦span
  let monitor_tracer = TracerProvider::get_tracer(tracer_provider, "monitoring-service")
  let alert_span = Tracer::start_span(monitor_tracer, "alert.evaluation")
  
  // æ¨¡æ‹Ÿå‘Šè­¦æ¡ä»¶æ£€æŸ¥
  let alert_conditions = [
    ("high.error.rate", false),
    ("slow.response.time", true),
    ("high.request.rate", false),
    ("service.unavailable", false)
  ]
  
  for (condition, triggered) in alert_conditions {
    Span::add_event(alert_span, "alert.check", Some([
      ("alert.condition", StringValue(condition)),
      ("alert.triggered", BoolValue(triggered)),
      ("check.timestamp", StringValue(Clock::now_unix_nanos(Clock::system()).to_string()))
    ]))
  }
  
  // æ¨¡æ‹Ÿå‘Šè­¦é€šçŸ¥
  if true { // ç®€åŒ–ï¼šå‡è®¾æœ‰å‘Šè­¦è¢«è§¦å‘
    Span::add_event(alert_span, "alert.sent", Some([
      ("alert.id", StringValue("ALERT-78901")),
      ("alert.severity", StringValue("warning")),
      ("alert.message", StringValue("Response time threshold exceeded")),
      ("notification.channels", StringValue("email,slack"))
    ]))
  }
  
  Span::end(alert_span)
  
  assert_true(true) // å¦‚æœç›‘æ§å‘Šè­¦æ­£å¸¸åˆ™æµ‹è¯•é€šè¿‡
}

test "é…ç½®ç®¡ç†å’ŒåŠ¨æ€æ›´æ–°æµ‹è¯•" {
  // æµ‹è¯•é…ç½®ç®¡ç†å’ŒåŠ¨æ€æ›´æ–°åŠŸèƒ½
  let tracer_provider = TracerProvider::default()
  
  // æ¨¡æ‹Ÿä¸åŒçš„é…ç½®åœºæ™¯
  let config_scenarios = [
    ("default.config", "debug", "all", "localhost"),
    ("production.config", "info", "errors", "collector.example.com"),
    ("development.config", "trace", "all", "localhost:8080"),
    ("testing.config", "warn", "errors", "test-collector")
  ]
  
  for (config_name, log_level, sampling, endpoint) in config_scenarios {
    let config_tracer = TracerProvider::get_tracer(tracer_provider, "config-service")
    let config_span = Tracer::start_span(config_tracer, "config.load")
    
    // æ·»åŠ é…ç½®ç›¸å…³å±æ€§
    Span::add_event(config_span, "config.loaded", Some([
      ("config.name", StringValue(config_name)),
      ("log.level", StringValue(log_level)),
      ("sampling.strategy", StringValue(sampling)),
      ("collector.endpoint", StringValue(endpoint)),
      ("load.timestamp", StringValue(Clock::now_unix_nanos(Clock::system()).to_string()))
    ]))
    
    // æ¨¡æ‹Ÿé…ç½®éªŒè¯
    Span::add_event(config_span, "config.validated", Some([
      ("validation.result", BoolValue(true)),
      ("validation.errors", IntValue(0))
    ]))
    
    Span::end(config_span)
  }
  
  // æ¨¡æ‹ŸåŠ¨æ€é…ç½®æ›´æ–°
  let dynamic_tracer = TracerProvider::get_tracer(tracer_provider, "dynamic-config-service")
  let dynamic_span = Tracer::start_span(dynamic_tracer, "config.update")
  
  // åŸå§‹é…ç½®
  Span::add_event(dynamic_span, "original.config", Some([
    ("sampling.rate", FloatValue(0.1)),
    ("batch.size", IntValue(100)),
    ("export.interval", IntValue(5000))
  ]))
  
  // æ›´æ–°é…ç½®
  Span::add_event(dynamic_span, "config.updated", Some([
    ("sampling.rate", FloatValue(0.2)),
    ("batch.size", IntValue(200)),
    ("export.interval", IntValue(3000)),
    ("update.reason", StringValue("performance.optimization"))
  ]))
  
  // éªŒè¯é…ç½®æ›´æ–°ç”Ÿæ•ˆ
  Span::add_event(dynamic_span, "config.applied", Some([
    ("application.status", StringValue("reconfigured")),
    ("apply.timestamp", StringValue(Clock::now_unix_nanos(Clock::system()).to_string()))
  ]))
  
  Span::end(dynamic_span)
  
  assert_true(true) // å¦‚æœé…ç½®ç®¡ç†æ­£å¸¸åˆ™æµ‹è¯•é€šè¿‡
}

test "å®‰å…¨å’Œåˆè§„æ€§æµ‹è¯•" {
  // æµ‹è¯•å®‰å…¨æ€§å’Œåˆè§„æ€§ç›¸å…³åŠŸèƒ½
  let tracer_provider = TracerProvider::default()
  let logger_provider = LoggerProvider::default()
  
  // åˆ›å»ºå®‰å…¨å®¡è®¡span
  let security_tracer = TracerProvider::get_tracer(tracer_provider, "security-service")
  let security_span = Tracer::start_span(security_tracer, "security.audit")
  
  // æ·»åŠ å®‰å…¨ç›¸å…³äº‹ä»¶
  Span::add_event(security_span, "authentication.check", Some([
    ("user.id", StringValue("USER-12345")),
    ("auth.method", StringValue("oauth2")),
    ("auth.result", StringValue("success")),
    ("auth.timestamp", StringValue(Clock::now_unix_nanos(Clock::system()).to_string()))
  ]))
  
  // æ•æ„Ÿæ•°æ®å¤„ç†æµ‹è¯•
  Span::add_event(security_span, "sensitive.data.handling", Some([
    ("data.type", StringValue("pii")),
    ("data.masked", BoolValue(true)),
    ("encryption.enabled", BoolValue(true)),
    ("retention.policy", StringValue("30.days"))
  ]))
  
  // è®¿é—®æ§åˆ¶æµ‹è¯•
  Span::add_event(security_span, "access.control.check", Some([
    ("resource", StringValue("/api/orders")),
    ("permission", StringValue("read")),
    ("granted", BoolValue(true)),
    ("role", StringValue("user"))
  ]))
  
  Span::end(security_span)
  
  // åˆ›å»ºåˆè§„æ€§æ—¥å¿—
  let compliance_logger = LoggerProvider::get_logger(logger_provider, "compliance-logger")
  
  // GDPRåˆè§„æ€§æ—¥å¿—
  let gdpr_log = LogRecord::new_with_context(
    Info,
    Some("GDPR compliance check passed"),
    Some(Attributes::new()),
    Some(Clock::now_unix_nanos(Clock::system())),
    None,
    Some("gdpr-trace-123"),
    Some("gdpr-span-456"),
    Some(Context::with_value(Context::root(), ContextKey::new("compliance.standard"), "GDPR"))
  )
  
  Logger::emit(compliance_logger, gdpr_log)
  
  // SOXåˆè§„æ€§æ—¥å¿—
  let sox_log = LogRecord::new_with_context(
    Info,
    Some("SOX compliance audit completed"),
    Some(Attributes::new()),
    Some(Clock::now_unix_nanos(Clock::system())),
    None,
    Some("sox-trace-789"),
    Some("sox-span-012"),
    Some(Context::with_value(Context::root(), ContextKey::new("compliance.standard"), "SOX"))
  )
  
  Logger::emit(compliance_logger, sox_log)
  
  assert_true(true) // å¦‚æœå®‰å…¨åˆè§„åŠŸèƒ½æ­£å¸¸åˆ™æµ‹è¯•é€šè¿‡
}