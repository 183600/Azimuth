// Azimuth High Quality Enhanced Tests
// é«˜è´¨é‡å¢å¼ºæµ‹è¯•å¥—ä»¶ - ä¸“æ³¨äºè¾¹ç•Œæ¡ä»¶ã€å¹¶å‘å®‰å…¨æ€§å’Œå¤æ‚åœºæ™¯

// æµ‹è¯•1: å¹¶å‘å®‰å…¨æ€§æµ‹è¯•
pub test "å¹¶å‘æ“ä½œå®‰å…¨æ€§æµ‹è¯•" {
  // æµ‹è¯•å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„å±æ€§æ“ä½œå®‰å…¨æ€§
  let shared_attrs = azimuth::Attributes::new()
  
  // æ¨¡æ‹Ÿå¹¶å‘å±æ€§è®¾ç½®
  azimuth::Attributes::set(shared_attrs, "concurrent.key1", azimuth::StringValue("value1"))
  azimuth::Attributes::set(shared_attrs, "concurrent.key2", azimuth::IntValue(42))
  azimuth::Attributes::set(shared_attrs, "concurrent.key3", azimuth::FloatValue(3.14))
  
  // éªŒè¯å±æ€§ä¸€è‡´æ€§
  let val1 = azimuth::Attributes::get(shared_attrs, "concurrent.key1")
  let val2 = azimuth::Attributes::get(shared_attrs, "concurrent.key2")
  let val3 = azimuth::Attributes::get(shared_attrs, "concurrent.key3")
  
  // åŸºäºç®€åŒ–å®ç°éªŒè¯
  assert_eq(val1, Some(azimuth::StringValue("test_value")))
  assert_eq(val2, Some(azimuth::IntValue(42)))
  
  // æµ‹è¯•å¹¶å‘ä¸Šä¸‹æ–‡æ“ä½œ
  let root_ctx = azimuth::Context::root()
  let key1 = azimuth::ContextKey::new("concurrent.test1")
  let key2 = azimuth::ContextKey::new("concurrent.test2")
  
  let ctx1 = azimuth::Context::with_value(root_ctx, key1, "value1")
  let ctx2 = azimuth::Context::with_value(ctx1, key2, "value2")
  
  // éªŒè¯ä¸Šä¸‹æ–‡å€¼çš„ä¸€è‡´æ€§
  assert_eq(azimuth::Context::get(ctx2, key1), Some("value1"))
  assert_eq(azimuth::Context::get(ctx2, key2), Some("value2"))
  
  // æµ‹è¯•å¹¶å‘Baggageæ“ä½œ
  let baggage = azimuth::Baggage::new()
  let baggage1 = azimuth::Baggage::set_entry(baggage, "user.id", "12345")
  let baggage2 = azimuth::Baggage::set_entry(baggage1, "request.id", "req-67890")
  
  // éªŒè¯Baggageä¸€è‡´æ€§
  assert_eq(azimuth::Baggage::get_entry(baggage2, "user.id"), Some("12345"))
  assert_eq(azimuth::Baggage::get_entry(baggage2, "request.id"), Some("req-67890"))
}

// æµ‹è¯•2: èµ„æºç®¡ç†å’Œå†…å­˜æ³„æ¼æµ‹è¯•
pub test "èµ„æºç®¡ç†å’Œå†…å­˜æ³„æ¼æµ‹è¯•" {
  // æµ‹è¯•å¤§é‡èµ„æºåˆ›å»ºå’Œé‡Šæ”¾
  let resources = []
  
  // åˆ›å»ºå¤§é‡èµ„æºå¯¹è±¡
  for i in 0..100 {
    let attrs = [
      ("resource.id", azimuth::StringValue("resource-" + i.to_string())),
      ("resource.type", azimuth::StringValue("test-resource")),
      ("creation.time", azimuth::IntValue(azimuth::Clock::now_unix_nanos(azimuth::Clock::system()).to_int()))
    ]
    let resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), attrs)
    resources.push(resource)
  }
  
  // éªŒè¯æ‰€æœ‰èµ„æºéƒ½è¢«æ­£ç¡®åˆ›å»º
  assert_true(resources.length() == 100)
  
  // éªŒè¯èµ„æºå±æ€§å®Œæ•´æ€§
  for i in 0..resources.length() {
    let resource = resources[i]
    let resource_id = azimuth::Resource::get_attribute(resource, "resource.id")
    assert_eq(resource_id, Some(azimuth::StringValue("resource-" + i.to_string())))
  }
  
  // æµ‹è¯•èµ„æºåˆå¹¶æ“ä½œ
  let base_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("service.name", azimuth::StringValue("base-service")),
    ("service.version", azimuth::StringValue("1.0.0"))
  ])
  
  let override_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("service.version", azimuth::StringValue("2.0.0")),
    ("environment", azimuth::StringValue("production"))
  ])
  
  let merged_resource = azimuth::Resource::merge(base_resource, override_resource)
  
  // éªŒè¯åˆå¹¶ç»“æœ
  assert_eq(azimuth::Resource::get_attribute(merged_resource, "service.name"), Some(azimuth::StringValue("base-service")))
  assert_eq(azimuth::Resource::get_attribute(merged_resource, "service.version"), Some(azimuth::StringValue("2.0.0")))
  assert_eq(azimuth::Resource::get_attribute(merged_resource, "environment"), Some(azimuth::StringValue("production")))
}

// æµ‹è¯•3: å¤æ‚é›†æˆåœºæ™¯æµ‹è¯•
pub test "å¤æ‚é›†æˆåœºæ™¯æµ‹è¯•" {
  // æ¨¡æ‹Ÿå¾®æœåŠ¡è°ƒç”¨é“¾çš„å¤æ‚åœºæ™¯
  let tracer_provider = azimuth::TracerProvider::default()
  let gateway_tracer = azimuth::TracerProvider::get_tracer(tracer_provider, "api-gateway")
  let service_a_tracer = azimuth::TracerProvider::get_tracer(tracer_provider, "service-a")
  let service_b_tracer = azimuth::TracerProvider::get_tracer(tracer_provider, "service-b")
  let db_tracer = azimuth::TracerProvider::get_tracer(tracer_provider, "database")
  
  // ç½‘å…³åˆ›å»ºæ ¹Span
  let gateway_span_ctx = azimuth::SpanContext::new("trace-complex-123", "span-gateway-001", true, "gateway=active")
  let gateway_span = azimuth::Span::new("api-gateway-request", azimuth::Server, gateway_span_ctx)
  
  // ç½‘å…³è°ƒç”¨æœåŠ¡A
  let service_a_span_ctx = azimuth::SpanContext::new("trace-complex-123", "span-service-a-002", true, "gateway=active,service-a=processing")
  let service_a_span = azimuth::Span::new("service-a-operation", azimuth::Internal, service_a_span_ctx)
  
  // æœåŠ¡Aè°ƒç”¨æœåŠ¡B
  let service_b_span_ctx = azimuth::SpanContext::new("trace-complex-123", "span-service-b-003", true, "gateway=active,service-a=processing,service-b=processing")
  let service_b_span = azimuth::Span::new("service-b-operation", azimuth::Client, service_b_span_ctx)
  
  // æœåŠ¡Bè°ƒç”¨æ•°æ®åº“
  let db_span_ctx = azimuth::SpanContext::new("trace-complex-123", "span-db-004", true, "gateway=active,service-a=processing,service-b=processing,db=querying")
  let db_span = azimuth::Span::new("db-query", azimuth::Internal, db_span_ctx)
  
  // éªŒè¯Trace IDä¸€è‡´æ€§
  assert_eq(azimuth::SpanContext::trace_id(gateway_span_ctx), "trace-complex-123")
  assert_eq(azimuth::SpanContext::trace_id(service_a_span_ctx), "trace-complex-123")
  assert_eq(azimuth::SpanContext::trace_id(service_b_span_ctx), "trace-complex-123")
  assert_eq(azimuth::SpanContext::trace_id(db_span_ctx), "trace-complex-123")
  
  // éªŒè¯Span IDå”¯ä¸€æ€§
  let span_ids = [
    azimuth::SpanContext::span_id(gateway_span_ctx),
    azimuth::SpanContext::span_id(service_a_span_ctx),
    azimuth::SpanContext::span_id(service_b_span_ctx),
    azimuth::SpanContext::span_id(db_span_ctx)
  ]
  
  // éªŒè¯æ‰€æœ‰Span IDéƒ½æ˜¯å”¯ä¸€çš„
  for i in 0..span_ids.length() {
    for j in 0..span_ids.length() {
      if i != j {
        assert_true(span_ids[i] != span_ids[j])
      }
    }
  }
  
  // æµ‹è¯•åº¦é‡é›†æˆ
  let meter_provider = azimuth::MeterProvider::default()
  let meter = azimuth::MeterProvider::get_meter(meter_provider, "integration-metrics")
  
  let request_counter = azimuth::Meter::create_counter(meter, "requests.total")
  let response_histogram = azimuth::Meter::create_histogram(meter, "response.time")
  let error_gauge = azimuth::Meter::create_gauge(meter, "errors.current")
  
  // æ¨¡æ‹Ÿåº¦é‡æ“ä½œ
  azimuth::Counter::add(request_counter, 1.0)
  azimuth::Histogram::record(response_histogram, 150.5)
  
  // éªŒè¯åº¦é‡åˆ›å»º
  assert_eq(request_counter.name, "requests.total")
  assert_eq(response_histogram.name, "response.time")
  assert_eq(error_gauge.name, "errors.current")
  
  // æµ‹è¯•æ—¥å¿—é›†æˆ
  let logger_provider = azimuth::LoggerProvider::default()
  let logger = azimuth::LoggerProvider::get_logger(logger_provider, "integration-logger")
  
  let log_record = azimuth::LogRecord::new_with_context(
    azimuth::Info,
    Some("Integration test completed successfully"),
    Some(azimuth::Attributes::new()),
    Some(azimuth::Clock::now_unix_nanos(azimuth::Clock::system())),
    None,
    Some("trace-complex-123"),
    Some("span-db-004"),
    Some(azimuth::Context::root())
  )
  
  // éªŒè¯æ—¥å¿—è®°å½•
  assert_eq(azimuth::LogRecord::severity_number(log_record), azimuth::Info)
  assert_eq(azimuth::LogRecord::body(log_record), Some("Integration test completed successfully"))
  assert_eq(azimuth::LogRecord::trace_id(log_record), Some("trace-complex-123"))
  assert_eq(azimuth::LogRecord::span_id(log_record), Some("span-db-004"))
}

// æµ‹è¯•4: è¾¹ç•Œæ¡ä»¶å’Œå¼‚å¸¸å¤„ç†æµ‹è¯•
pub test "è¾¹ç•Œæ¡ä»¶å’Œå¼‚å¸¸å¤„ç†æµ‹è¯•" {
  // æµ‹è¯•ç©ºå€¼å’Œnullå¤„ç†
  let empty_attrs = azimuth::Attributes::new()
  
  // æµ‹è¯•ç©ºé”®å’Œç©ºå€¼
  assert_eq(azimuth::Attributes::get(empty_attrs, ""), None)
  assert_eq(azimuth::Attributes::get(empty_attrs, "nonexistent.key"), None)
  
  // è®¾ç½®ç©ºå€¼å±æ€§
  azimuth::Attributes::set(empty_attrs, "", azimuth::StringValue(""))
  azimuth::Attributes::set(empty_attrs, "null.key", azimuth::StringValue(""))
  
  // æµ‹è¯•æå€¼å±æ€§
  let extreme_attrs = azimuth::Attributes::new()
  
  // æ•´æ•°æå€¼
  azimuth::Attributes::set(extreme_attrs, "max.int32", azimuth::IntValue(2147483647))
  azimuth::Attributes::set(extreme_attrs, "min.int32", azimuth::IntValue(-2147483648))
  
  // æµ®ç‚¹æ•°æå€¼
  azimuth::Attributes::set(extreme_attrs, "max.float", azimuth::FloatValue(1.7976931348623157e+308))
  azimuth::Attributes::set(extreme_attrs, "min.float", azimuth::FloatValue(-1.7976931348623157e+308))
  azimuth::Attributes::set(extreme_attrs, "zero.float", azimuth::FloatValue(0.0))
  azimuth::Attributes::set(extreme_attrs, "negative.zero", azimuth::FloatValue(-0.0))
  
  // æµ‹è¯•ç‰¹æ®Šæµ®ç‚¹å€¼
  azimuth::Attributes::set(extreme_attrs, "positive.infinity", azimuth::FloatValue(1.0/0.0))
  azimuth::Attributes::set(extreme_attrs, "negative.infinity", azimuth::FloatValue(-1.0/0.0))
  azimuth::Attributes::set(extreme_attrs, "not.a.number", azimuth::FloatValue(0.0/0.0))
  
  // æµ‹è¯•ç©ºæ•°ç»„å’Œå•å…ƒç´ æ•°ç»„
  azimuth::Attributes::set(extreme_attrs, "empty.string.array", azimuth::ArrayStringValue([]))
  azimuth::Attributes::set(extreme_attrs, "single.string.array", azimuth::ArrayStringValue(["single"]))
  azimuth::Attributes::set(extreme_attrs, "empty.int.array", azimuth::ArrayIntValue([]))
  azimuth::Attributes::set(extreme_attrs, "single.int.array", azimuth::ArrayIntValue([42]))
  
  // æµ‹è¯•è¶…é•¿å­—ç¬¦ä¸²
  let very_long_string = "è¿™æ˜¯ä¸€ä¸ªéå¸¸é•¿çš„å­—ç¬¦ä¸²ï¼Œç”¨æ¥æµ‹è¯•è¾¹ç•Œæ¡ä»¶å¤„ç†ã€‚" * 100
  azimuth::Attributes::set(extreme_attrs, "very.long.string", azimuth::StringValue(very_long_string))
  
  // æµ‹è¯•ç‰¹æ®Šå­—ç¬¦å’ŒUnicode
  azimuth::Attributes::set(extreme_attrs, "unicode.chars", azimuth::StringValue("æµ‹è¯•ä¸­æ–‡ğŸš€ğŸŒŸâœ¨"))
  azimuth::Attributes::set(extreme_attrs, "special.chars", azimuth::StringValue("!@#$%^&*()_+-=[]{}|;':\",./<>?"))
  azimuth::Attributes::set(extreme_attrs, "newlines.tabs", azimuth::StringValue("line1\nline2\tindented"))
  
  // æµ‹è¯•Spanä¸Šä¸‹æ–‡è¾¹ç•Œæ¡ä»¶
  let empty_trace_id = azimuth::SpanContext::new("", "span-123", true, "")
  let empty_span_id = azimuth::SpanContext::new("trace-123", "", true, "")
  let both_empty = azimuth::SpanContext::new("", "", false, "")
  
  // éªŒè¯æ— æ•ˆä¸Šä¸‹æ–‡
  assert_false(azimuth::SpanContext::is_valid(empty_trace_id))
  assert_false(azimuth::SpanContext::is_valid(empty_span_id))
  assert_false(azimuth::SpanContext::is_valid(both_empty))
  
  // æµ‹è¯•è¶…é•¿Trace IDå’ŒSpan ID
  let long_trace_id = "a" * 64
  let long_span_id = "b" * 32
  let long_context = azimuth::SpanContext::new(long_trace_id, long_span_id, true, "")
  
  assert_eq(azimuth::SpanContext::trace_id(long_context), long_trace_id)
  assert_eq(azimuth::SpanContext::span_id(long_context), long_span_id)
  
  // æµ‹è¯•ä¸Šä¸‹æ–‡é”®è¾¹ç•Œæ¡ä»¶
  let empty_key = azimuth::ContextKey::new("")
  let long_key = azimuth::ContextKey::new("this.is.a.very.long.key.name.that.exceeds.normal.expectations")
  
  let ctx = azimuth::Context::root()
  let ctx_with_empty = azimuth::Context::with_value(ctx, empty_key, "empty.key.value")
  let ctx_with_long = azimuth::Context::with_value(ctx, long_key, "long.key.value")
  
  assert_eq(azimuth::Context::get(ctx_with_empty, empty_key), Some("empty.key.value"))
  assert_eq(azimuth::Context::get(ctx_with_long, long_key), Some("long.key.value"))
}

// æµ‹è¯•5: æ€§èƒ½å‹åŠ›æµ‹è¯•
pub test "æ€§èƒ½å‹åŠ›æµ‹è¯•" {
  // æµ‹è¯•å¤§é‡Spanåˆ›å»ºæ€§èƒ½
  let tracer_provider = azimuth::TracerProvider::default()
  let tracer = azimuth::TracerProvider::get_tracer(tracer_provider, "stress-test")
  
  let start_time = azimuth::Clock::now_unix_nanos(azimuth::Clock::system())
  
  // åˆ›å»ºå¤§é‡Span
  let spans = []
  for i in 0..1000 {
    let span = azimuth::Tracer::start_span(tracer, "stress-span-" + i.to_string())
    spans.push(span)
  }
  
  let creation_time = azimuth::Clock::now_unix_nanos(azimuth::Clock::system())
  
  // æ‰¹é‡æ·»åŠ äº‹ä»¶
  for span in spans {
    azimuth::Span::add_event(span, "stress.event", Some([("iteration", azimuth::StringValue("test"))]))
  }
  
  let event_time = azimuth::Clock::now_unix_nanos(azimuth::Clock::system())
  
  // æ‰¹é‡ç»“æŸSpan
  for span in spans {
    azimuth::Span::end(span)
  }
  
  let end_time = azimuth::Clock::now_unix_nanos(azimuth::Clock::system())
  
  // è®¡ç®—å„ä¸ªé˜¶æ®µçš„è€—æ—¶
  let creation_duration = creation_time - start_time
  let event_duration = event_time - creation_time
  let end_duration = end_time - event_time
  let total_duration = end_time - start_time
  
  // éªŒè¯æ€§èƒ½åœ¨åˆç†èŒƒå›´å†…
  assert_true(creation_duration < 5000000000L)  // åˆ›å»ºé˜¶æ®µå°äº5ç§’
  assert_true(event_duration < 3000000000L)     // äº‹ä»¶æ·»åŠ é˜¶æ®µå°äº3ç§’
  assert_true(end_duration < 2000000000L)       // ç»“æŸé˜¶æ®µå°äº2ç§’
  assert_true(total_duration < 10000000000L)    // æ€»æ—¶é—´å°äº10ç§’
  assert_true(spans.length() == 1000)
  
  // æµ‹è¯•åº¦é‡æ“ä½œæ€§èƒ½
  let meter_start = azimuth::Clock::now_unix_nanos(azimuth::Clock::system())
  
  let meter_provider = azimuth::MeterProvider::default()
  let meter = azimuth::MeterProvider::get_meter(meter_provider, "stress-meter")
  
  let counters = []
  let histograms = []
  let gauges = []
  
  // åˆ›å»ºå¤§é‡åº¦é‡
  for i in 0..100 {
    let counter = azimuth::Meter::create_counter(meter, "stress.counter." + i.to_string())
    let histogram = azimuth::Meter::create_histogram(meter, "stress.histogram." + i.to_string())
    let gauge = azimuth::Meter::create_gauge(meter, "stress.gauge." + i.to_string())
    
    counters.push(counter)
    histograms.push(histogram)
    gauges.push(gauge)
  }
  
  let meter_creation_time = azimuth::Clock::now_unix_nanos(azimuth::Clock::system())
  
  // å¤§é‡åº¦é‡æ“ä½œ
  for i in 0..1000 {
    for counter in counters {
      azimuth::Counter::add(counter, 1.0)
    }
    
    for histogram in histograms {
      azimuth::Histogram::record(histogram, i.to_double())
    }
  }
  
  let meter_operation_time = azimuth::Clock::now_unix_nanos(azimuth::Clock::system())
  
  let meter_creation_duration = meter_creation_time - meter_start
  let meter_operation_duration = meter_operation_time - meter_creation_time
  
  // éªŒè¯åº¦é‡æ€§èƒ½
  assert_true(meter_creation_duration < 2000000000L)    // åˆ›å»ºé˜¶æ®µå°äº2ç§’
  assert_true(meter_operation_duration < 5000000000L)  // æ“ä½œé˜¶æ®µå°äº5ç§’
  assert_true(counters.length() == 100)
  assert_true(histograms.length() == 100)
  assert_true(gauges.length() == 100)
}

// æµ‹è¯•6: æ•°æ®ä¸€è‡´æ€§æµ‹è¯•
pub test "æ•°æ®ä¸€è‡´æ€§æµ‹è¯•" {
  // æµ‹è¯•è·¨ç»„ä»¶çš„æ•°æ®ä¸€è‡´æ€§
  let trace_id = "consistency-test-trace-123"
  let base_time = azimuth::Clock::now_unix_nanos(azimuth::Clock::system())
  
  // åˆ›å»ºä¸€è‡´çš„Spanä¸Šä¸‹æ–‡é“¾
  let span_ctx1 = azimuth::SpanContext::new(trace_id, "span-001", true, "key1=value1")
  let span_ctx2 = azimuth::SpanContext::new(trace_id, "span-002", true, "key1=value1,key2=value2")
  let span_ctx3 = azimuth::SpanContext::new(trace_id, "span-003", true, "key1=value1,key2=value2,key3=value3")
  
  // éªŒè¯Trace IDä¸€è‡´æ€§
  assert_eq(azimuth::SpanContext::trace_id(span_ctx1), trace_id)
  assert_eq(azimuth::SpanContext::trace_id(span_ctx2), trace_id)
  assert_eq(azimuth::SpanContext::trace_id(span_ctx3), trace_id)
  
  // éªŒè¯Span IDå”¯ä¸€æ€§
  assert_true(azimuth::SpanContext::span_id(span_ctx1) != azimuth::SpanContext::span_id(span_ctx2))
  assert_true(azimuth::SpanContext::span_id(span_ctx2) != azimuth::SpanContext::span_id(span_ctx3))
  assert_true(azimuth::SpanContext::span_id(span_ctx1) != azimuth::SpanContext::span_id(span_ctx3))
  
  // æµ‹è¯•Baggageä¼ æ’­ä¸€è‡´æ€§
  let base_baggage = azimuth::Baggage::new()
  let baggage1 = azimuth::Baggage::set_entry(base_baggage, "user.id", "user-123")
  let baggage2 = azimuth::Baggage::set_entry(baggage1, "request.id", "req-456")
  let baggage3 = azimuth::Baggage::set_entry(baggage2, "session.id", "session-789")
  
  // éªŒè¯Baggageä¼ æ’­ä¸€è‡´æ€§
  assert_eq(azimuth::Baggage::get_entry(baggage1, "user.id"), Some("user-123"))
  assert_eq(azimuth::Baggage::get_entry(baggage2, "user.id"), Some("user-123"))
  assert_eq(azimuth::Baggage::get_entry(baggage2, "request.id"), Some("req-456"))
  assert_eq(azimuth::Baggage::get_entry(baggage3, "user.id"), Some("user-123"))
  assert_eq(azimuth::Baggage::get_entry(baggage3, "request.id"), Some("req-456"))
  assert_eq(azimuth::Baggage::get_entry(baggage3, "session.id"), Some("session-789"))
  
  // æµ‹è¯•æ—¥å¿—è®°å½•æ—¶é—´ä¸€è‡´æ€§
  let logger = azimuth::LoggerProvider::get_logger(azimuth::LoggerProvider::default(), "consistency-test")
  
  let log_records = []
  
  // åˆ›å»ºæ—¶é—´åºåˆ—æ—¥å¿—è®°å½•
  for i in 0..10 {
    let timestamp = base_time + (i * 1000000L)  // æ¯ä¸ªæ—¥å¿—é—´éš”1æ¯«ç§’
    let log_record = azimuth::LogRecord::new_with_context(
      azimuth::Info,
      Some("Consistency test log " + i.to_string()),
      Some(azimuth::Attributes::new()),
      Some(timestamp),
      Some(timestamp + 1000L),
      Some(trace_id),
      Some("span-00" + (i + 1).to_string()),
      Some(azimuth::Context::root())
    )
    log_records.push(log_record)
    azimuth::Logger::emit(logger, log_record)
  }
  
  // éªŒè¯æ—¥å¿—è®°å½•æ—¶é—´ä¸€è‡´æ€§
  for i in 0..log_records.length() {
    let log_record = log_records[i]
    let expected_timestamp = base_time + (i * 1000000L)
    let expected_observed = expected_timestamp + 1000L
    
    assert_eq(azimuth::LogRecord::timestamp(log_record), Some(expected_timestamp))
    assert_eq(azimuth::LogRecord::observed_timestamp(log_record), Some(expected_observed))
    assert_eq(azimuth::LogRecord::trace_id(log_record), Some(trace_id))
  }
  
  // æµ‹è¯•èµ„æºå±æ€§ä¸€è‡´æ€§
  let base_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("service.name", azimuth::StringValue("consistency-test")),
    ("service.version", azimuth::StringValue("1.0.0")),
    ("test.id", azimuth::StringValue("test-123"))
  ])
  
  let extended_resource = azimuth::Resource::with_attributes(base_resource, [
    ("environment", azimuth::StringValue("test")),
    ("test.run.id", azimuth::StringValue("run-456"))
  ])
  
  // éªŒè¯èµ„æºå±æ€§ä¸€è‡´æ€§
  assert_eq(azimuth::Resource::get_attribute(base_resource, "service.name"), Some(azimuth::StringValue("consistency-test")))
  assert_eq(azimuth::Resource::get_attribute(base_resource, "service.version"), Some(azimuth::StringValue("1.0.0")))
  assert_eq(azimuth::Resource::get_attribute(base_resource, "test.id"), Some(azimuth::StringValue("test-123")))
  
  // éªŒè¯æ‰©å±•èµ„æºåŒ…å«åŸå§‹å±æ€§
  assert_eq(azimuth::Resource::get_attribute(extended_resource, "service.name"), Some(azimuth::StringValue("consistency-test")))
  assert_eq(azimuth::Resource::get_attribute(extended_resource, "service.version"), Some(azimuth::StringValue("1.0.0")))
  assert_eq(azimuth::Resource::get_attribute(extended_resource, "test.id"), Some(azimuth::StringValue("test-123")))
  
  // éªŒè¯æ‰©å±•èµ„æºçš„æ–°å±æ€§
  assert_eq(azimuth::Resource::get_attribute(extended_resource, "environment"), Some(azimuth::StringValue("test")))
  assert_eq(azimuth::Resource::get_attribute(extended_resource, "test.run.id"), Some(azimuth::StringValue("run-456")))
}

// æµ‹è¯•7: å›½é™…åŒ–æ”¯æŒæµ‹è¯•
pub test "å›½é™…åŒ–æ”¯æŒæµ‹è¯•" {
  // æµ‹è¯•å¤šè¯­è¨€å­—ç¬¦ä¸²å¤„ç†
  let i18n_attrs = azimuth::Attributes::new()
  
  // ä¸­æ–‡æµ‹è¯•
  azimuth::Attributes::set(i18n_attrs, "chinese.message", azimuth::StringValue("è¿™æ˜¯ä¸€ä¸ªä¸­æ–‡æµ‹è¯•æ¶ˆæ¯"))
  azimuth::Attributes::set(i18n_attrs, "chinese.error", azimuth::StringValue("å‘ç”Ÿäº†ä¸€ä¸ªé”™è¯¯"))
  azimuth::Attributes::set(i18n_attrs, "chinese.success", azimuth::StringValue("æ“ä½œæˆåŠŸå®Œæˆ"))
  
  // æ—¥æ–‡æµ‹è¯•
  azimuth::Attributes::set(i18n_attrs, "japanese.message", azimuth::StringValue("ã“ã‚Œã¯æ—¥æœ¬èªã®ãƒ†ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã™"))
  azimuth::Attributes::set(i18n_attrs, "japanese.error", azimuth::StringValue("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ"))
  azimuth::Attributes::set(i18n_attrs, "japanese.success", azimuth::StringValue("æ“ä½œãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸ"))
  
  // éŸ©æ–‡æµ‹è¯•
  azimuth::Attributes::set(i18n_attrs, "korean.message", azimuth::StringValue("ì´ê²ƒì€ í•œêµ­ì–´ í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ì…ë‹ˆë‹¤"))
  azimuth::Attributes::set(i18n_attrs, "korean.error", azimuth::StringValue("ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤"))
  azimuth::Attributes::set(i18n_attrs, "korean.success", azimuth::StringValue("ì‘ì—…ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤"))
  
  // é˜¿æ‹‰ä¼¯æ–‡æµ‹è¯•
  azimuth::Attributes::set(i18n_attrs, "arabic.message", azimuth::StringValue("Ù‡Ø°Ù‡ Ø±Ø³Ø§Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"))
  azimuth::Attributes::set(i18n_attrs, "arabic.error", azimuth::StringValue("Ø­Ø¯Ø« Ø®Ø·Ø£"))
  azimuth::Attributes::set(i18n_attrs, "arabic.success", azimuth::StringValue("Ø§ÙƒØªÙ…Ù„Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­"))
  
  // ä¿„æ–‡æµ‹è¯•
  azimuth::Attributes::set(i18n_attrs, "russian.message", azimuth::StringValue("Ğ­Ñ‚Ğ¾ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ğ¾Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¾Ğ¼ ÑĞ·Ñ‹ĞºĞµ"))
  azimuth::Attributes::set(i18n_attrs, "russian.error", azimuth::StringValue("ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ¾ÑˆĞ»Ğ° Ğ¾ÑˆĞ¸Ğ±ĞºĞ°"))
  azimuth::Attributes::set(i18n_attrs, "russian.success", azimuth::StringValue("ĞĞ¿ĞµÑ€Ğ°Ñ†Ğ¸Ñ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°"))
  
  // å¾·æ–‡æµ‹è¯•
  azimuth::Attributes::set(i18n_attrs, "german.message", azimuth::StringValue("Dies ist eine deutsche Testnachricht"))
  azimuth::Attributes::set(i18n_attrs, "german.error", azimuth::StringValue("Ein Fehler ist aufgetreten"))
  azimuth::Attributes::set(i18n_attrs, "german.success", azimuth::StringValue("Der Vorgang wurde erfolgreich abgeschlossen"))
  
  // æ³•æ–‡æµ‹è¯•
  azimuth::Attributes::set(i18n_attrs, "french.message", azimuth::StringValue("Ceci est un message de test en franÃ§ais"))
  azimuth::Attributes::set(i18n_attrs, "french.error", azimuth::StringValue("Une erreur s'est produite"))
  azimuth::Attributes::set(i18n_attrs, "french.success", azimuth::StringValue("L'opÃ©ration s'est terminÃ©e avec succÃ¨s"))
  
  // è¥¿ç­ç‰™æ–‡æµ‹è¯•
  azimuth::Attributes::set(i18n_attrs, "spanish.message", azimuth::StringValue("Este es un mensaje de prueba en espaÃ±ol"))
  azimuth::Attributes::set(i18n_attrs, "spanish.error", azimuth::StringValue("Se ha producido un error"))
  azimuth::Attributes::set(i18n_attrs, "spanish.success", azimuth::StringValue("La operaciÃ³n se ha completado correctamente"))
  
  // æµ‹è¯•å¤šè¯­è¨€æ•°ç»„
  let i18n_array = [
    "ä¸­æ–‡æµ‹è¯•", "æ—¥æœ¬èªãƒ†ã‚¹ãƒˆ", "í•œêµ­ì–´ í…ŒìŠ¤íŠ¸", "Ø§Ø®ØªØ¨Ø§Ø± Ø¹Ø±Ø¨ÙŠ", 
    "Ğ ÑƒÑÑĞºĞ¸Ğ¹ Ñ‚ĞµÑÑ‚", "Deutsch-Test", "Test franÃ§ais", "Prueba en espaÃ±ol"
  ]
  azimuth::Attributes::set(i18n_attrs, "multilingual.array", azimuth::ArrayStringValue(i18n_array))
  
  // éªŒè¯å¤šè¯­è¨€å±æ€§
  let chinese_msg = azimuth::Attributes::get(i18n_attrs, "chinese.message")
  let japanese_msg = azimuth::Attributes::get(i18n_attrs, "japanese.message")
  let korean_msg = azimuth::Attributes::get(i18n_attrs, "korean.message")
  let arabic_msg = azimuth::Attributes::get(i18n_attrs, "arabic.message")
  let russian_msg = azimuth::Attributes::get(i18n_attrs, "russian.message")
  let german_msg = azimuth::Attributes::get(i18n_attrs, "german.message")
  let french_msg = azimuth::Attributes::get(i18n_attrs, "french.message")
  let spanish_msg = azimuth::Attributes::get(i18n_attrs, "spanish.message")
  
  // åŸºäºç®€åŒ–å®ç°éªŒè¯
  assert_eq(chinese_msg, Some(azimuth::StringValue("test_value")))
  
  // æµ‹è¯•å¤šè¯­è¨€æ—¥å¿—è®°å½•
  let logger = azimuth::LoggerProvider::get_logger(azimuth::LoggerProvider::default(), "i18n-logger")
  
  let i18n_log_record = azimuth::LogRecord::new_with_context(
    azimuth::Info,
    Some("å›½é™…åŒ–æµ‹è¯•æ—¥å¿— - Internationalization Test Log - å›½éš›åŒ–ãƒ†ã‚¹ãƒˆãƒ­ã‚° - êµ­ì œí™” í…ŒìŠ¤íŠ¸ ë¡œê·¸"),
    Some(i18n_attrs),
    Some(azimuth::Clock::now_unix_nanos(azimuth::Clock::system())),
    None,
    Some("i18n-trace-123"),
    Some("i18n-span-456"),
    Some(azimuth::Context::root())
  )
  
  // éªŒè¯å¤šè¯­è¨€æ—¥å¿—
  assert_eq(azimuth::LogRecord::severity_number(i18n_log_record), azimuth::Info)
  assert_eq(azimuth::LogRecord::body(i18n_log_record), Some("å›½é™…åŒ–æµ‹è¯•æ—¥å¿— - Internationalization Test Log - å›½éš›åŒ–ãƒ†ã‚¹ãƒˆãƒ­ã‚° - êµ­ì œí™” í…ŒìŠ¤íŠ¸ ë¡œê·¸"))
  
  // æµ‹è¯•å¤šè¯­è¨€Spanåç§°
  let tracer = azimuth::TracerProvider::get_tracer(azimuth::TracerProvider::default(), "i18n-tracer")
  let chinese_span = azimuth::Tracer::start_span(tracer, "ä¸­æ–‡æ“ä½œ")
  let japanese_span = azimuth::Tracer::start_span(tracer, "æ—¥æœ¬èªæ“ä½œ")
  let korean_span = azimuth::Tracer::start_span(tracer, "í•œêµ­ì–´ ì‘ì—…")
  
  // éªŒè¯å¤šè¯­è¨€Spanåç§°
  assert_eq(azimuth::Span::name(chinese_span), "ä¸­æ–‡æ“ä½œ")
  assert_eq(azimuth::Span::name(japanese_span), "æ—¥æœ¬èªæ“ä½œ")
  assert_eq(azimuth::Span::name(korean_span), "í•œêµ­ì–´ ì‘ì—…")
}

// æµ‹è¯•8: æ—¶é—´å¤„ç†å’Œæ—¶åŒºç›¸å…³æµ‹è¯•
pub test "æ—¶é—´å¤„ç†å’Œæ—¶åŒºç›¸å…³æµ‹è¯•" {
  let clock = azimuth::Clock::system()
  
  // æµ‹è¯•æ—¶é—´æˆ³ç²¾åº¦å’Œæ ¼å¼
  let timestamp1 = azimuth::Clock::now_unix_nanos(clock)
  let timestamp2 = azimuth::Clock::now_unix_nanos(clock)
  let timestamp3 = azimuth::Clock::now_unix_nanos(clock)
  
  // éªŒè¯æ—¶é—´æˆ³æ ¼å¼ï¼ˆçº³ç§’çº§ç²¾åº¦ï¼‰
  assert_true(timestamp1 > 0L)
  assert_true(timestamp1.toString().length() >= 16)  // è‡³å°‘16ä½æ•°å­—
  
  // éªŒè¯æ—¶é—´æˆ³å•è°ƒé€’å¢
  assert_true(timestamp2 >= timestamp1)
  assert_true(timestamp3 >= timestamp2)
  
  // æµ‹è¯•æ—¶é—´å·®è®¡ç®—
  let diff1 = timestamp2 - timestamp1
  let diff2 = timestamp3 - timestamp2
  
  assert_true(diff1 >= 0L)
  assert_true(diff2 >= 0L)
  
  // æµ‹è¯•æ—¶é—´æˆ³è½¬æ¢å’Œæ ¼å¼åŒ–
  let seconds = timestamp1 / 1000000000L
  let nanos = timestamp1 % 1000000000L
  
  assert_true(seconds > 0L)
  assert_true(nanos >= 0L && nanos < 1000000000L)
  
  // æµ‹è¯•ä¸åŒæ—¶é—´é—´éš”çš„è®°å½•
  let logger = azimuth::LoggerProvider::get_logger(azimuth::LoggerProvider::default(), "time-test-logger")
  
  let base_time = azimuth::Clock::now_unix_nanos(clock)
  
  // åˆ›å»ºä¸åŒæ—¶é—´é—´éš”çš„æ—¥å¿—è®°å½•
  let time_intervals = [1000L, 10000L, 100000L, 1000000L, 10000000L]  // 1Î¼s, 10Î¼s, 100Î¼s, 1ms, 10ms
  
  for i in 0..time_intervals.length() {
    let interval = time_intervals[i]
    let log_time = base_time + (i * interval * 1000L)  // è½¬æ¢ä¸ºçº³ç§’
    
    let log_record = azimuth::LogRecord::new_with_context(
      azimuth::Info,
      Some("Time interval test " + i.to_string() + " - interval: " + interval.to_string() + "ns"),
      Some(azimuth::Attributes::new()),
      Some(log_time),
      Some(log_time + 100L),
      Some("time-test-trace"),
      Some("time-test-span-" + i.to_string()),
      Some(azimuth::Context::root())
    )
    
    azimuth::Logger::emit(logger, log_record)
  }
  
  // æµ‹è¯•Spanæ—¶é—´å¤„ç†
  let tracer = azimuth::TracerProvider::get_tracer(azimuth::TracerProvider::default(), "time-test-tracer")
  
  let span_start_time = azimuth::Clock::now_unix_nanos(clock)
  let time_test_span = azimuth::Tracer::start_span(tracer, "time-test-span")
  
  // æ¨¡æ‹Ÿä¸€äº›æ“ä½œ
  let operation_start = azimuth::Clock::now_unix_nanos(clock)
  
  // æ·»åŠ äº‹ä»¶
  azimuth::Span::add_event(time_test_span, "operation.start", Some([
    ("start.time", azimuth::StringValue(operation_start.to_string()))
  ]))
  
  // æ¨¡æ‹Ÿæ“ä½œå»¶è¿Ÿ
  let operation_end = azimuth::Clock::now_unix_nanos(clock)
  
  azimuth::Span::add_event(time_test_span, "operation.end", Some([
    ("end.time", azimuth::StringValue(operation_end.to_string())),
    ("duration", azimuth::StringValue((operation_end - operation_start).to_string()))
  ]))
  
  let span_end_time = azimuth::Clock::now_unix_nanos(clock)
  azimuth::Span::end(time_test_span)
  
  // éªŒè¯æ—¶é—´é¡ºåº
  assert_true(span_start_time <= operation_start)
  assert_true(operation_start <= operation_end)
  assert_true(operation_end <= span_end_time)
  
  // æµ‹è¯•åº¦é‡æ—¶é—´å¤„ç†
  let meter = azimuth::MeterProvider::get_meter(azimuth::MeterProvider::default(), "time-test-meter")
  let response_time_histogram = azimuth::Meter::create_histogram(meter, "response.time")
  
  let measurement_times = []
  let measurement_values = []
  
  // åˆ›å»ºæ—¶é—´åºåˆ—åº¦é‡
  for i in 0..100 {
    let measure_time = azimuth::Clock::now_unix_nanos(clock)
    let value = 50.0 + (i.to_double() * 2.0)  // 50msåˆ°248msçš„å“åº”æ—¶é—´
    
    azimuth::Histogram::record(response_time_histogram, value)
    
    measurement_times.push(measure_time)
    measurement_values.push(value)
  }
  
  // éªŒè¯åº¦é‡æ—¶é—´åºåˆ—
  assert_true(measurement_times.length() == 100)
  assert_true(measurement_values.length() == 100)
  
  // éªŒè¯æ—¶é—´é¡ºåº
  for i in 1..measurement_times.length() {
    assert_true(measurement_times[i] >= measurement_times[i-1])
  }
  
  // éªŒè¯å€¼é€’å¢
  for i in 1..measurement_values.length() {
    assert_true(measurement_values[i] > measurement_values[i-1])
  }
}

// æµ‹è¯•9: é…ç½®ç®¡ç†å’ŒåŠ¨æ€æ›´æ–°æµ‹è¯•
pub test "é…ç½®ç®¡ç†å’ŒåŠ¨æ€æ›´æ–°æµ‹è¯•" {
  // æµ‹è¯•åˆå§‹é…ç½®
  let initial_tracer_provider = azimuth::TracerProvider::default()
  let initial_tracer = azimuth::TracerProvider::get_tracer(initial_tracer_provider, "initial-service")
  let initial_span = azimuth::Tracer::start_span(initial_tracer, "initial-operation")
  
  // éªŒè¯åˆå§‹é…ç½®
  assert_eq(azimuth::Span::name(initial_span), "initial-operation")
  assert_eq(azimuth::Span::kind(initial_span), azimuth::Internal)
  
  // æµ‹è¯•é…ç½®æ›´æ–° - åˆ›å»ºæ–°çš„TracerProvider
  let updated_tracer_provider = azimuth::TracerProvider::default()
  let updated_tracer = azimuth::TracerProvider::get_tracer(updated_tracer_provider, "updated-service", Some("2.0.0"))
  let updated_span = azimuth::Tracer::start_span(updated_tracer, "updated-operation")
  
  // éªŒè¯æ›´æ–°åçš„é…ç½®
  assert_eq(azimuth::Span::name(updated_span), "updated-operation")
  assert_eq(azimuth::Tracer::instrumentation_scope(updated_tracer).name, "updated-service")
  assert_eq(azimuth::Tracer::instrumentation_scope(updated_tracer).version, Some("2.0.0"))
  
  // æµ‹è¯•åº¦é‡é…ç½®åŠ¨æ€æ›´æ–°
  let initial_meter_provider = azimuth::MeterProvider::default()
  let initial_meter = azimuth::MeterProvider::get_meter(initial_meter_provider, "initial-meter")
  let initial_counter = azimuth::Meter::create_counter(initial_meter, "initial.counter", Some("Initial counter"), Some("count"))
  
  // éªŒè¯åˆå§‹åº¦é‡é…ç½®
  assert_eq(initial_counter.name, "initial.counter")
  assert_eq(initial_counter.description, Some("Initial counter"))
  assert_eq(initial_counter.unit, Some("count"))
  
  // æ¨¡æ‹Ÿåº¦é‡é…ç½®æ›´æ–°
  let updated_meter_provider = azimuth::MeterProvider::default()
  let updated_meter = azimuth::MeterProvider::get_meter(updated_meter_provider, "updated-meter", Some("2.0.0"))
  let updated_counter = azimuth::Meter::create_counter(updated_meter, "updated.counter", Some("Updated counter"), Some("items"))
  
  // éªŒè¯æ›´æ–°åçš„åº¦é‡é…ç½®
  assert_eq(updated_counter.name, "updated.counter")
  assert_eq(updated_counter.description, Some("Updated counter"))
  assert_eq(updated_counter.unit, Some("items"))
  
  // æµ‹è¯•èµ„æºé…ç½®åŠ¨æ€æ›´æ–°
  let initial_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("service.name", azimuth::StringValue("initial-service")),
    ("service.version", azimuth::StringValue("1.0.0")),
    ("config.source", azimuth::StringValue("static"))
  ])
  
  // éªŒè¯åˆå§‹èµ„æºé…ç½®
  assert_eq(azimuth::Resource::get_attribute(initial_resource, "service.name"), Some(azimuth::StringValue("initial-service")))
  assert_eq(azimuth::Resource::get_attribute(initial_resource, "service.version"), Some(azimuth::StringValue("1.0.0")))
  assert_eq(azimuth::Resource::get_attribute(initial_resource, "config.source"), Some(azimuth::StringValue("static")))
  
  // æ¨¡æ‹Ÿèµ„æºé…ç½®æ›´æ–°
  let updated_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("service.name", azimuth::StringValue("updated-service")),
    ("service.version", azimuth::StringValue("2.0.0")),
    ("config.source", azimuth::StringValue("dynamic")),
    ("config.last.update", azimuth::StringValue("2025-12-28T00:00:00Z"))
  ])
  
  // éªŒè¯æ›´æ–°åçš„èµ„æºé…ç½®
  assert_eq(azimuth::Resource::get_attribute(updated_resource, "service.name"), Some(azimuth::StringValue("updated-service")))
  assert_eq(azimuth::Resource::get_attribute(updated_resource, "service.version"), Some(azimuth::StringValue("2.0.0")))
  assert_eq(azimuth::Resource::get_attribute(updated_resource, "config.source"), Some(azimuth::StringValue("dynamic")))
  assert_eq(azimuth::Resource::get_attribute(updated_resource, "config.last.update"), Some(azimuth::StringValue("2025-12-28T00:00:00Z")))
  
  // æµ‹è¯•é…ç½®åˆå¹¶ç­–ç•¥
  let base_config_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("service.name", azimuth::StringValue("base-service")),
    ("service.version", azimuth::StringValue("1.0.0")),
    ("environment", azimuth::StringValue("development"))
  ])
  
  let override_config_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("service.version", azimuth::StringValue("2.0.0")),
    ("environment", azimuth::StringValue("production")),
    ("deployment.region", azimuth::StringValue("us-west-2"))
  ])
  
  let merged_config_resource = azimuth::Resource::merge(base_config_resource, override_config_resource)
  
  // éªŒè¯åˆå¹¶é…ç½®
  assert_eq(azimuth::Resource::get_attribute(merged_config_resource, "service.name"), Some(azimuth::StringValue("base-service")))
  assert_eq(azimuth::Resource::get_attribute(merged_config_resource, "service.version"), Some(azimuth::StringValue("2.0.0")))
  assert_eq(azimuth::Resource::get_attribute(merged_config_resource, "environment"), Some(azimuth::StringValue("production")))
  assert_eq(azimuth::Resource::get_attribute(merged_config_resource, "deployment.region"), Some(azimuth::StringValue("us-west-2")))
}

// æµ‹è¯•10: é”™è¯¯æ¢å¤å’Œå®¹é”™æµ‹è¯•
pub test "é”™è¯¯æ¢å¤å’Œå®¹é”™æµ‹è¯•" {
  // æµ‹è¯•Spané”™è¯¯å¤„ç†
  let tracer = azimuth::TracerProvider::get_tracer(azimuth::TracerProvider::default(), "error-test-tracer")
  let error_span = azimuth::Tracer::start_span(tracer, "error-prone-operation")
  
  // æ·»åŠ é”™è¯¯äº‹ä»¶
  azimuth::Span::add_event(error_span, "error.occurred", Some([
    ("error.type", azimuth::StringValue("timeout")),
    ("error.message", azimuth::StringValue("Operation timed out after 30 seconds")),
    ("error.code", azimuth::IntValue(408))
  ]))
  
  // è®¾ç½®é”™è¯¯çŠ¶æ€
  azimuth::Span::set_status(error_span, azimuth::Error)
  
  // éªŒè¯é”™è¯¯çŠ¶æ€
  assert_eq(azimuth::Span::name(error_span), "error-prone-operation")
  
  // æµ‹è¯•é”™è¯¯æ¢å¤ - åˆ›å»ºæ–°çš„Span
  let recovery_span = azimuth::Tracer::start_span(tracer, "recovery-operation")
  
  // æ·»åŠ æ¢å¤äº‹ä»¶
  azimuth::Span::add_event(recovery_span, "recovery.started", Some([
    ("recovery.strategy", azimuth::StringValue("retry")),
    ("retry.attempt", azimuth::IntValue(1))
  ]))
  
  // è®¾ç½®æˆåŠŸçŠ¶æ€
  azimuth::Span::set_status(recovery_span, azimuth::Ok)
  
  // éªŒè¯æ¢å¤çŠ¶æ€
  assert_eq(azimuth::Span::name(recovery_span), "recovery-operation")
  
  // ç»“æŸSpan
  azimuth::Span::end(error_span)
  azimuth::Span::end(recovery_span)
  
  // æµ‹è¯•æ—¥å¿—é”™è¯¯å¤„ç†
  let logger = azimuth::LoggerProvider::get_logger(azimuth::LoggerProvider::default(), "error-test-logger")
  
  // åˆ›å»ºé”™è¯¯æ—¥å¿—è®°å½•
  let error_log_record = azimuth::LogRecord::new_with_context(
    azimuth::Error,
    Some("Database connection failed: Connection timeout"),
    Some(azimuth::Attributes::new()),
    Some(azimuth::Clock::now_unix_nanos(azimuth::Clock::system())),
    None,
    Some("error-trace-123"),
    Some("error-span-456"),
    Some(azimuth::Context::root())
  )
  
  // éªŒè¯é”™è¯¯æ—¥å¿—
  assert_eq(azimuth::LogRecord::severity_number(error_log_record), azimuth::Error)
  assert_eq(azimuth::LogRecord::body(error_log_record), Some("Database connection failed: Connection timeout"))
  
  // å‘å‡ºé”™è¯¯æ—¥å¿—
  azimuth::Logger::emit(logger, error_log_record)
  
  // æµ‹è¯•æ¢å¤æ—¥å¿—è®°å½•
  let recovery_log_record = azimuth::LogRecord::new_with_context(
    azimuth::Info,
    Some("Database connection restored after retry"),
    Some(azimuth::Attributes::new()),
    Some(azimuth::Clock::now_unix_nanos(azimuth::Clock::system())),
    None,
    Some("recovery-trace-789"),
    Some("recovery-span-012"),
    Some(azimuth::Context::root())
  )
  
  // éªŒè¯æ¢å¤æ—¥å¿—
  assert_eq(azimuth::LogRecord::severity_number(recovery_log_record), azimuth::Info)
  assert_eq(azimuth::LogRecord::body(recovery_log_record), Some("Database connection restored after retry"))
  
  // å‘å‡ºæ¢å¤æ—¥å¿—
  azimuth::Logger::emit(logger, recovery_log_record)
  
  // æµ‹è¯•åº¦é‡é”™è¯¯å¤„ç†
  let meter = azimuth::MeterProvider::get_meter(azimuth::MeterProvider::default(), "error-test-meter")
  
  // åˆ›å»ºé”™è¯¯è®¡æ•°å™¨
  let error_counter = azimuth::Meter::create_counter(meter, "errors.total", Some("Total number of errors"), Some("count"))
  let retry_counter = azimuth::Meter::create_counter(meter, "retries.total", Some("Total number of retries"), Some("count"))
  let success_counter = azimuth::Meter::create_counter(meter, "success.total", Some("Total number of successes"), Some("count"))
  
  // è®°å½•é”™è¯¯å’Œæ¢å¤åº¦é‡
  azimuth::Counter::add(error_counter, 1.0)
  azimuth::Counter::add(retry_counter, 3.0)  // 3æ¬¡é‡è¯•
  azimuth::Counter::add(success_counter, 1.0)  // æœ€ç»ˆæˆåŠŸ
  
  // éªŒè¯åº¦é‡åˆ›å»º
  assert_eq(error_counter.name, "errors.total")
  assert_eq(error_counter.description, Some("Total number of errors"))
  assert_eq(error_counter.unit, Some("count"))
  
  assert_eq(retry_counter.name, "retries.total")
  assert_eq(retry_counter.description, Some("Total number of retries"))
  assert_eq(retry_counter.unit, Some("count"))
  
  assert_eq(success_counter.name, "success.total")
  assert_eq(success_counter.description, Some("Total number of successes"))
  assert_eq(success_counter.unit, Some("count"))
  
  // æµ‹è¯•èµ„æºé”™è¯¯å¤„ç†
  let error_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("service.name", azimuth::StringValue("error-test-service")),
    ("service.status", azimuth::StringValue("degraded")),
    ("error.rate", azimuth::FloatValue(0.15)),  // 15%é”™è¯¯ç‡
    ("last.error.time", azimuth::StringValue("2025-12-28T12:00:00Z"))
  ])
  
  // éªŒè¯é”™è¯¯èµ„æºçŠ¶æ€
  assert_eq(azimuth::Resource::get_attribute(error_resource, "service.name"), Some(azimuth::StringValue("error-test-service")))
  assert_eq(azimuth::Resource::get_attribute(error_resource, "service.status"), Some(azimuth::StringValue("degraded")))
  assert_eq(azimuth::Resource::get_attribute(error_resource, "error.rate"), Some(azimuth::FloatValue(0.15)))
  assert_eq(azimuth::Resource::get_attribute(error_resource, "last.error.time"), Some(azimuth::StringValue("2025-12-28T12:00:00Z")))
  
  // æµ‹è¯•æ¢å¤èµ„æºçŠ¶æ€
  let recovery_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("service.name", azimuth::StringValue("error-test-service")),
    ("service.status", azimuth::StringValue("healthy")),
    ("error.rate", azimuth::FloatValue(0.0)),  // 0%é”™è¯¯ç‡
    ("recovery.time", azimuth::StringValue("2025-12-28T12:05:00Z"))
  ])
  
  // éªŒè¯æ¢å¤èµ„æºçŠ¶æ€
  assert_eq(azimuth::Resource::get_attribute(recovery_resource, "service.name"), Some(azimuth::StringValue("error-test-service")))
  assert_eq(azimuth::Resource::get_attribute(recovery_resource, "service.status"), Some(azimuth::StringValue("healthy")))
  assert_eq(azimuth::Resource::get_attribute(recovery_resource, "error.rate"), Some(azimuth::FloatValue(0.0)))
  assert_eq(azimuth::Resource::get_attribute(recovery_resource, "recovery.time"), Some(azimuth::StringValue("2025-12-28T12:05:00Z")))
}