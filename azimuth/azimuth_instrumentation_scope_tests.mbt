// Azimuth InstrumentationScope Test Suite
// This file contains test cases for instrumentation scope functionality

// Test 1: Basic instrumentation scope creation
test "basic instrumentation scope creation" {
  // Test scope creation with different configurations
  let basic_scope = InstrumentationScope::{ name: "basic-scope", version: None, schema_url: None }
  let versioned_scope = InstrumentationScope::{ name: "versioned-scope", version: Some("1.0.0"), schema_url: None }
  let full_scope = InstrumentationScope::{ 
    name: "full-scope", 
    version: Some("2.1.0"), 
    schema_url: Some("https://example.com/schema/v1") 
  }
  let empty_name_scope = InstrumentationScope::{ name: "", version: None, schema_url: None }
  let empty_version_scope = InstrumentationScope::{ name: "empty-version", version: Some(""), schema_url: None }
  let empty_schema_scope = InstrumentationScope::{ name: "empty-schema", version: None, schema_url: Some("") }
  
  // Verify scope properties
  assert_eq(basic_scope.name, "basic-scope")
  assert_eq(basic_scope.version, None)
  assert_eq(basic_scope.schema_url, None)
  
  assert_eq(versioned_scope.name, "versioned-scope")
  assert_eq(versioned_scope.version, Some("1.0.0"))
  assert_eq(versioned_scope.schema_url, None)
  
  assert_eq(full_scope.name, "full-scope")
  assert_eq(full_scope.version, Some("2.1.0"))
  assert_eq(full_scope.schema_url, Some("https://example.com/schema/v1"))
  
  assert_eq(empty_name_scope.name, "")
  assert_eq(empty_name_scope.version, None)
  assert_eq(empty_name_scope.schema_url, None)
  
  assert_eq(empty_version_scope.name, "empty-version")
  assert_eq(empty_version_scope.version, Some(""))
  assert_eq(empty_version_scope.schema_url, None)
  
  assert_eq(empty_schema_scope.name, "empty-schema")
  assert_eq(empty_schema_scope.version, None)
  assert_eq(empty_schema_scope.schema_url, Some(""))
}

// Test 2: Instrumentation scope in tracer
test "instrumentation scope in tracer" {
  // Test tracer provider with different scopes
  let provider = TracerProvider::default()
  
  let tracer1 = TracerProvider::get_tracer(provider, "tracer1")
  let tracer2 = TracerProvider::get_tracer(provider, "tracer2", Some("1.0.0"))
  let tracer3 = TracerProvider::get_tracer(provider, "tracer3", Some("2.0.0"))
  
  // Get scopes from tracers
  let scope1 = Tracer::instrumentation_scope(tracer1)
  let scope2 = Tracer::instrumentation_scope(tracer2)
  let scope3 = Tracer::instrumentation_scope(tracer3)
  
  // Verify scope properties
  assert_eq(scope1.name, "tracer1")
  assert_eq(scope1.version, None)
  assert_eq(scope1.schema_url, None)
  
  assert_eq(scope2.name, "tracer2")
  assert_eq(scope2.version, Some("1.0.0"))
  assert_eq(scope2.schema_url, None)
  
  assert_eq(scope3.name, "tracer3")
  assert_eq(scope3.version, Some("2.0.0"))
  assert_eq(scope3.schema_url, None)
  
  // Test that scopes are properly associated with tracers
  let span1 = Tracer::start_span(tracer1, "operation1")
  let span2 = Tracer::start_span(tracer2, "operation2")
  let span3 = Tracer::start_span(tracer3, "operation3")
  
  assert_eq(Span::name(span1), "operation1")
  assert_eq(Span::name(span2), "operation2")
  assert_eq(Span::name(span3), "operation3")
}

// Test 3: Instrumentation scope in meter
test "instrumentation scope in meter" {
  // Test meter provider with different scopes
  let provider = MeterProvider::default()
  
  let meter1 = MeterProvider::get_meter(provider, "meter1")
  let meter2 = MeterProvider::get_meter(provider, "meter2")
  let meter3 = MeterProvider::get_meter(provider, "meter3")
  
  // Verify meter scopes
  assert_eq(meter1.scope.name, "meter1")
  assert_eq(meter1.scope.version, None)
  assert_eq(meter1.scope.schema_url, None)
  
  assert_eq(meter2.scope.name, "meter2")
  assert_eq(meter2.scope.version, None)
  assert_eq(meter2.scope.schema_url, None)
  
  assert_eq(meter3.scope.name, "meter3")
  assert_eq(meter3.scope.version, None)
  assert_eq(meter3.scope.schema_url, None)
  
  // Create instruments with different scopes
  let counter1 = Meter::create_counter(meter1, "counter1")
  let histogram1 = Meter::create_histogram(meter1, "histogram1")
  let counter2 = Meter::create_counter(meter2, "counter2")
  let gauge3 = Meter::create_gauge(meter3, "gauge3")
  
  // Verify instrument names
  assert_eq(counter1.name, "counter1")
  assert_eq(histogram1.name, "histogram1")
  assert_eq(counter2.name, "counter2")
  assert_eq(gauge3.name, "gauge3")
}

// Test 4: Instrumentation scope in logger
test "instrumentation scope in logger" {
  // Test logger provider with different scopes
  let provider = LoggerProvider::default()
  
  let logger1 = LoggerProvider::get_logger(provider, "logger1")
  let logger2 = LoggerProvider::get_logger(provider, "logger2")
  let logger3 = LoggerProvider::get_logger(provider, "logger3")
  
  // Verify logger scopes
  assert_eq(logger1.scope.name, "logger1")
  assert_eq(logger1.scope.version, None)
  assert_eq(logger1.scope.schema_url, None)
  
  assert_eq(logger2.scope.name, "logger2")
  assert_eq(logger2.scope.version, None)
  assert_eq(logger2.scope.schema_url, None)
  
  assert_eq(logger3.scope.name, "logger3")
  assert_eq(logger3.scope.version, None)
  assert_eq(logger3.scope.schema_url, None)
  
  // Create log records with different loggers
  let record1 = LogRecord::new(Info, "Log from logger1")
  let record2 = LogRecord::new(Warn, "Log from logger2")
  let record3 = LogRecord::new(Error, "Log from logger3")
  
  // Emit records with different loggers
  Logger::emit(logger1, record1)
  Logger::emit(logger2, record2)
  Logger::emit(logger3, record3)
  
  // Verify log record properties
  assert_eq(LogRecord::body(record1), Some("Log from logger1"))
  assert_eq(LogRecord::body(record2), Some("Log from logger2"))
  assert_eq(LogRecord::body(record3), Some("Log from logger3"))
}

// Test 5: Instrumentation scope edge cases
test "instrumentation scope edge cases" {
  // Test scope with special characters
  let special_scope = InstrumentationScope::{ 
    name: "scope.with-special_chars_123!@#", 
    version: Some("v1.0.0-beta"), 
    schema_url: Some("https://example.com/path-with-special-chars.html") 
  }
  
  assert_eq(special_scope.name, "scope.with-special_chars_123!@#")
  assert_eq(special_scope.version, Some("v1.0.0-beta"))
  assert_eq(special_scope.schema_url, Some("https://example.com/path-with-special-chars.html"))
  
  // Test scope with Unicode characters
  let unicode_scope = InstrumentationScope::{ 
    name: "scope.ÊµãËØï.üöÄ", 
    version: Some("ÁâàÊú¨.1.0"), 
    schema_url: Some("https://‰æãÂ≠ê.com/Ê®°Âºè") 
  }
  
  assert_eq(unicode_scope.name, "scope.ÊµãËØï.üöÄ")
  assert_eq(unicode_scope.version, Some("ÁâàÊú¨.1.0"))
  assert_eq(unicode_scope.schema_url, Some("https://‰æãÂ≠ê.com/Ê®°Âºè"))
  
  // Test scope with very long values
  let long_name = "this.is.a.very.long.scope.name.that.exceeds.normal.limits.and.tests.boundary.conditions"
  let long_version = "this.is.a.very.long.version.string.that.contains.many.characters.and.tests.boundary.conditions"
  let long_schema = "https://this.is.a.very.long.schema.url.that.contains.many.characters.and.tests.boundary.conditions/example/path"
  
  let long_scope = InstrumentationScope::{ 
    name: long_name, 
    version: Some(long_version), 
    schema_url: Some(long_schema) 
  }
  
  assert_eq(long_scope.name, long_name)
  assert_eq(long_scope.version, Some(long_version))
  assert_eq(long_scope.schema_url, Some(long_schema))
  
  // Test scope with empty values
  let empty_scope = InstrumentationScope::{ 
    name: "", 
    version: Some(""), 
    schema_url: Some("") 
  }
  
  assert_eq(empty_scope.name, "")
  assert_eq(empty_scope.version, Some(""))
  assert_eq(empty_scope.schema_url, Some(""))
}

// Test 6: Instrumentation scope with version patterns
test "instrumentation scope with version patterns" {
  // Test different version patterns
  let semver_scope = InstrumentationScope::{ 
    name: "semver-scope", 
    version: Some("1.2.3"), 
    schema_url: None 
  }
  
  let prerelease_scope = InstrumentationScope::{ 
    name: "prerelease-scope", 
    version: Some("1.2.3-alpha.1"), 
    schema_url: None 
  }
  
  let build_scope = InstrumentationScope::{ 
    name: "build-scope", 
    version: Some("1.2.3+build.123"), 
    schema_url: None 
  }
  
  let complex_version_scope = InstrumentationScope::{ 
    name: "complex-version-scope", 
    version: Some("1.2.3-alpha.1+build.123"), 
    schema_url: None 
  }
  
  let date_version_scope = InstrumentationScope::{ 
    name: "date-version-scope", 
    version: Some("2025.01.01"), 
    schema_url: None 
  }
  
  let custom_version_scope = InstrumentationScope::{ 
    name: "custom-version-scope", 
    version: Some("v2.1.0-beta"), 
    schema_url: None 
  }
  
  // Verify all version patterns
  assert_eq(semver_scope.version, Some("1.2.3"))
  assert_eq(prerelease_scope.version, Some("1.2.3-alpha.1"))
  assert_eq(build_scope.version, Some("1.2.3+build.123"))
  assert_eq(complex_version_scope.version, Some("1.2.3-alpha.1+build.123"))
  assert_eq(date_version_scope.version, Some("2025.01.01"))
  assert_eq(custom_version_scope.version, Some("v2.1.0-beta"))
  
  // Test with tracers
  let provider = TracerProvider::default()
  
  let semver_tracer = TracerProvider::get_tracer(provider, "semver-tracer", Some("1.2.3"))
  let prerelease_tracer = TracerProvider::get_tracer(provider, "prerelease-tracer", Some("1.2.3-alpha.1"))
  let build_tracer = TracerProvider::get_tracer(provider, "build-tracer", Some("1.2.3+build.123"))
  
  let semver_tracer_scope = Tracer::instrumentation_scope(semver_tracer)
  let prerelease_tracer_scope = Tracer::instrumentation_scope(prerelease_tracer)
  let build_tracer_scope = Tracer::instrumentation_scope(build_tracer)
  
  assert_eq(semver_tracer_scope.version, Some("1.2.3"))
  assert_eq(prerelease_tracer_scope.version, Some("1.2.3-alpha.1"))
  assert_eq(build_tracer_scope.version, Some("1.2.3+build.123"))
}

// Test 7: Instrumentation scope with schema URLs
test "instrumentation scope with schema URLs" {
  // Test different schema URL patterns
  let http_schema_scope = InstrumentationScope::{ 
    name: "http-schema-scope", 
    version: None, 
    schema_url: Some("http://example.com/schema/v1") 
  }
  
  let https_schema_scope = InstrumentationScope::{ 
    name: "https-schema-scope", 
    version: None, 
    schema_url: Some("https://example.com/schema/v1") 
  }
  
  let complex_url_scope = InstrumentationScope::{ 
    name: "complex-url-scope", 
    version: None, 
    schema_url: Some("https://example.com:8080/path/to/schema?query=value#fragment") 
  }
  
  let ip_url_scope = InstrumentationScope::{ 
    name: "ip-url-scope", 
    version: None, 
    schema_url: Some("https://192.168.1.1/schema/v1") 
  }
  
  let localhost_schema_scope = InstrumentationScope::{ 
    name: "localhost-schema-scope", 
    version: None, 
    schema_url: Some("http://localhost:3000/schema/v1") 
  }
  
  // Verify all schema URLs
  assert_eq(http_schema_scope.schema_url, Some("http://example.com/schema/v1"))
  assert_eq(https_schema_scope.schema_url, Some("https://example.com/schema/v1"))
  assert_eq(complex_url_scope.schema_url, Some("https://example.com:8080/path/to/schema?query=value#fragment"))
  assert_eq(ip_url_scope.schema_url, Some("https://192.168.1.1/schema/v1"))
  assert_eq(localhost_schema_scope.schema_url, Some("http://localhost:3000/schema/v1"))
  
  // Test with meters
  let provider = MeterProvider::default()
  
  let http_meter = MeterProvider::get_meter(provider, "http-meter")
  let https_meter = MeterProvider::get_meter(provider, "https-meter")
  
  // Manually create scopes with schema URLs for testing
  let http_scope = InstrumentationScope::{ 
    name: "http-meter", 
    version: None, 
    schema_url: Some("http://example.com/schema/v1") 
  }
  
  let https_scope = InstrumentationScope::{ 
    name: "https-meter", 
    version: None, 
    schema_url: Some("https://example.com/schema/v1") 
  }
  
  // Verify scope properties
  assert_eq(http_scope.name, "http-meter")
  assert_eq(http_scope.schema_url, Some("http://example.com/schema/v1"))
  
  assert_eq(https_scope.name, "https-meter")
  assert_eq(https_scope.schema_url, Some("https://example.com/schema/v1"))
}

// Test 8: Instrumentation scope consistency across providers
test "instrumentation scope consistency across providers" {
  // Test that the same scope name creates consistent scopes
  let tracer_provider = TracerProvider::default()
  let meter_provider = MeterProvider::default()
  let logger_provider = LoggerProvider::default()
  
  let scope_name = "consistency-test-scope"
  let version = Some("1.0.0")
  let schema_url = Some("https://example.com/schema/v1")
  
  // Create instruments with the same scope
  let tracer = TracerProvider::get_tracer(tracer_provider, scope_name, version)
  let meter = MeterProvider::get_meter(meter_provider, scope_name)
  let logger = LoggerProvider::get_logger(logger_provider, scope_name)
  
  // Get scopes from each instrument
  let tracer_scope = Tracer::instrumentation_scope(tracer)
  let meter_scope = meter.scope
  let logger_scope = logger.scope
  
  // Verify scope names are consistent
  assert_eq(tracer_scope.name, scope_name)
  assert_eq(meter_scope.name, scope_name)
  assert_eq(logger_scope.name, scope_name)
  
  // Verify tracer has version
  assert_eq(tracer_scope.version, version)
  
  // Verify meter and logger don't have version in simplified implementation
  assert_eq(meter_scope.version, None)
  assert_eq(logger_scope.version, None)
  
  // Verify all scopes don't have schema URL in simplified implementation
  assert_eq(tracer_scope.schema_url, None)
  assert_eq(meter_scope.schema_url, None)
  assert_eq(logger_scope.schema_url, None)
  
  // Create spans, metrics, and logs with the instruments
  let span = Tracer::start_span(tracer, "consistency-test-span")
  let counter = Meter::create_counter(meter, "consistency-test-counter")
  let record = LogRecord::new(Info, "Consistency test log")
  
  // Verify all instruments work correctly
  assert_eq(Span::name(span), "consistency-test-span")
  assert_eq(counter.name, "consistency-test-counter")
  assert_eq(LogRecord::body(record), Some("Consistency test log"))
  
  // Perform operations
  Span::set_status(span, Ok, Some("Consistency test completed"))
  Counter::add(counter, 1.0)
  Logger::emit(logger, record)
}