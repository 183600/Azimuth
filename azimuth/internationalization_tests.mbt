// Internationalization Support Tests
// éªŒè¯é¥æµ‹ç³»ç»Ÿçš„å›½é™…åŒ–æ”¯æŒèƒ½åŠ›

test "unicode attribute handling" {
  // æµ‹è¯•Unicodeå±æ€§å¤„ç†
  let attributes = azimuth::Attributes::new()
  
  // è®¾ç½®å„ç§è¯­è¨€çš„Unicodeå±æ€§
  azimuth::Attributes::set(attributes, "chinese.name", azimuth::StringValue("å¼ ä¸‰"))
  azimuth::Attributes::set(attributes, "japanese.name", azimuth::StringValue("ç”°ä¸­å¤ªéƒ"))
  azimuth::Attributes::set(attributes, "korean.name", azimuth::StringValue("ê¹€ì² ìˆ˜"))
  azimuth::Attributes::set(attributes, "arabic.name", azimuth::StringValue("Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯"))
  azimuth::Attributes::set(attributes, "russian.name", azimuth::StringValue("Ğ˜Ğ²Ğ°Ğ½ ĞŸĞµÑ‚Ñ€Ğ¾Ğ²"))
  azimuth::Attributes::set(attributes, "hebrew.name", azimuth::StringValue("×“×•×“ ×›×”×Ÿ"))
  azimuth::Attributes::set(attributes, "thai.name", azimuth::StringValue("à¸ªà¸¡à¸Šà¸²à¸¢ à¹ƒà¸ˆà¸”à¸µ"))
  
  // æµ‹è¯•è¡¨æƒ…ç¬¦å·
  azimuth::Attributes::set(attributes, "emoji.test", azimuth::StringValue("ğŸ˜€ğŸ‰ğŸ”¥ğŸš€ğŸ’¯"))
  
  // æµ‹è¯•ç‰¹æ®ŠUnicodeå­—ç¬¦
  azimuth::Attributes::set(attributes, "special.chars", azimuth::StringValue("â„¢Â®Â©â‚¬Â£Â¥Â§Â¶â€ â€¡â€¢â€¦â€°â€¹â€º""''â€“â€”"))
  
  // éªŒè¯å±æ€§æ­£ç¡®å­˜å‚¨å’Œæ£€ç´¢
  let chinese_name = azimuth::Attributes::get(attributes, "chinese.name")
  let japanese_name = azimuth::Attributes::get(attributes, "japanese.name")
  let korean_name = azimuth::Attributes::get(attributes, "korean.name")
  let arabic_name = azimuth::Attributes::get(attributes, "arabic.name")
  let russian_name = azimuth::Attributes::get(attributes, "russian.name")
  let hebrew_name = azimuth::Attributes::get(attributes, "hebrew.name")
  let thai_name = azimuth::Attributes::get(attributes, "thai.name")
  let emoji_test = azimuth::Attributes::get(attributes, "emoji.test")
  let special_chars = azimuth::Attributes::get(attributes, "special.chars")
  
  assert_eq(chinese_name, Some(azimuth::StringValue("å¼ ä¸‰")))
  assert_eq(japanese_name, Some(azimuth::StringValue("ç”°ä¸­å¤ªéƒ")))
  assert_eq(korean_name, Some(azimuth::StringValue("ê¹€ì² ìˆ˜")))
  assert_eq(arabic_name, Some(azimuth::StringValue("Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯")))
  assert_eq(russian_name, Some(azimuth::StringValue("Ğ˜Ğ²Ğ°Ğ½ ĞŸĞµÑ‚Ñ€Ğ¾Ğ²")))
  assert_eq(hebrew_name, Some(azimuth::StringValue("×“×•×“ ×›×”×Ÿ")))
  assert_eq(thai_name, Some(azimuth::StringValue("à¸ªà¸¡à¸Šà¸²à¸¢ à¹ƒà¸ˆà¸”à¸µ")))
  assert_eq(emoji_test, Some(azimuth::StringValue("ğŸ˜€ğŸ‰ğŸ”¥ğŸš€ğŸ’¯")))
  assert_eq(special_chars, Some(azimuth::StringValue("â„¢Â®Â©â‚¬Â£Â¥Â§Â¶â€ â€¡â€¢â€¦â€°â€¹â€º""''â€“â€”")))
}

test "localized log messages" {
  // æµ‹è¯•æœ¬åœ°åŒ–æ—¥å¿—æ¶ˆæ¯
  let provider = azimuth::LoggerProvider::default()
  let logger = azimuth::LoggerProvider::get_logger(provider, "internationalization-test-logger")
  
  // åˆ›å»ºä¸åŒè¯­è¨€çš„æ—¥å¿—è®°å½•
  let chinese_log = azimuth::Logger::create_log_record(logger)
  azimuth::LogRecord::set_body(chinese_log, "ç”¨æˆ·ç™»å½•æˆåŠŸï¼Œç”¨æˆ·ID: 12345")
  azimuth::LogRecord::set_severity(chinese_log, azimuth::INFO)
  azimuth::LogRecord::set_attribute(chinese_log, "locale", azimuth::StringValue("zh-CN"))
  
  let japanese_log = azimuth::Logger::create_log_record(logger)
  azimuth::LogRecord::set_body(japanese_log, "ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ID: 12345")
  azimuth::LogRecord::set_severity(japanese_log, azimuth::INFO)
  azimuth::LogRecord::set_attribute(japanese_log, "locale", azimuth::StringValue("ja-JP"))
  
  let korean_log = azimuth::Logger::create_log_record(logger)
  azimuth::LogRecord::set_body(korean_log, "ì‚¬ìš©ì ë¡œê·¸ì¸ ì„±ê³µ, ì‚¬ìš©ì ID: 12345")
  azimuth::LogRecord::set_severity(korean_log, azimuth::INFO)
  azimuth::LogRecord::set_attribute(korean_log, "locale", azimuth::StringValue("ko-KR"))
  
  let english_log = azimuth::Logger::create_log_record(logger)
  azimuth::LogRecord::set_body(english_log, "User login successful, user ID: 12345")
  azimuth::LogRecord::set_severity(english_log, azimuth::INFO)
  azimuth::LogRecord::set_attribute(english_log, "locale", azimuth::StringValue("en-US"))
  
  // éªŒè¯æœ¬åœ°åŒ–æ¶ˆæ¯æ­£ç¡®å­˜å‚¨
  assert_eq(azimuth::LogRecord::body(chinese_log), "ç”¨æˆ·ç™»å½•æˆåŠŸï¼Œç”¨æˆ·ID: 12345")
  assert_eq(azimuth::LogRecord::body(japanese_log), "ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ID: 12345")
  assert_eq(azimuth::LogRecord::body(korean_log), "ì‚¬ìš©ì ë¡œê·¸ì¸ ì„±ê³µ, ì‚¬ìš©ì ID: 12345")
  assert_eq(azimuth::LogRecord::body(english_log), "User login successful, user ID: 12345")
  
  // éªŒè¯localeå±æ€§
  let chinese_locale = azimuth::LogRecord::get_attribute(chinese_log, "locale")
  let japanese_locale = azimuth::LogRecord::get_attribute(japanese_log, "locale")
  let korean_locale = azimuth::LogRecord::get_attribute(korean_log, "locale")
  let english_locale = azimuth::LogRecord::get_attribute(english_log, "locale")
  
  assert_eq(chinese_locale, Some(azimuth::StringValue("zh-CN")))
  assert_eq(japanese_locale, Some(azimuth::StringValue("ja-JP")))
  assert_eq(korean_locale, Some(azimuth::StringValue("ko-KR")))
  assert_eq(english_locale, Some(azimuth::StringValue("en-US")))
}

test "localized span names and descriptions" {
  // æµ‹è¯•æœ¬åœ°åŒ–spanåç§°å’Œæè¿°
  let span_ctx = azimuth::SpanContext::new("i18n-trace", "i18n-span", true, "")
  
  // åˆ›å»ºä¸åŒè¯­è¨€çš„span
  let chinese_span = azimuth::Span::new("ç”¨æˆ·è®¤è¯", azimuth::Server, span_ctx)
  azimuth::Span::set_attribute(chinese_span, "span.description", azimuth::StringValue("éªŒè¯ç”¨æˆ·èº«ä»½å’Œæƒé™"))
  azimuth::Span::set_attribute(chinese_span, "locale", azimuth::StringValue("zh-CN"))
  
  let japanese_span = azimuth::Span::new("ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼", azimuth::Server, span_ctx)
  azimuth::Span::set_attribute(japanese_span, "span.description", azimuth::StringValue("ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®èº«å…ƒã¨æ¨©é™ã‚’æ¤œè¨¼"))
  azimuth::Span::set_attribute(japanese_span, "locale", azimuth::StringValue("ja-JP"))
  
  let spanish_span = azimuth::Span::new("AutenticaciÃ³n de usuario", azimuth::Server, span_ctx)
  azimuth::Span::set_attribute(spanish_span, "span.description", azimuth::StringValue("Verificar identidad y permisos del usuario"))
  azimuth::Span::set_attribute(spanish_span, "locale", azimuth::StringValue("es-ES"))
  
  // éªŒè¯æœ¬åœ°åŒ–spanåç§°å’Œæè¿°
  assert_eq(azimuth::Span::name(chinese_span), "ç”¨æˆ·è®¤è¯")
  assert_eq(azimuth::Span::name(japanese_span), "ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼")
  assert_eq(azimuth::Span::name(spanish_span), "AutenticaciÃ³n de usuario")
  
  let chinese_desc = azimuth::Span::get_attribute(chinese_span, "span.description")
  let japanese_desc = azimuth::Span::get_attribute(japanese_span, "span.description")
  let spanish_desc = azimuth::Span::get_attribute(spanish_span, "span.description")
  
  assert_eq(chinese_desc, Some(azimuth::StringValue("éªŒè¯ç”¨æˆ·èº«ä»½å’Œæƒé™")))
  assert_eq(japanese_desc, Some(azimuth::StringValue("ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®èº«å…ƒã¨æ¨©é™ã‚’æ¤œè¨¼")))
  assert_eq(spanish_desc, Some(azimuth::StringValue("Verificar identidad y permisos del usuario")))
}

test "right-to-left text handling" {
  // æµ‹è¯•ä»å³åˆ°å·¦çš„æ–‡æœ¬å¤„ç†
  let attributes = azimuth::Attributes::new()
  
  // é˜¿æ‹‰ä¼¯è¯­ï¼ˆä»å³åˆ°å·¦ï¼‰
  azimuth::Attributes::set(attributes, "arabic.message", azimuth::StringValue("Ù…Ø±Ø­Ø¨Ø§ Ø¨Ø§Ù„Ø¹Ø§Ù„Ù…"))
  azimuth::Attributes::set(attributes, "hebrew.message", azimuth::StringValue("×©×œ×•× ×¢×•×œ×"))
  
  // æ··åˆæ–¹å‘æ–‡æœ¬
  azimuth::Attributes::set(attributes, "mixed.direction", azimuth::StringValue("Hello Ù…Ø±Ø­Ø¨Ø§ World"))
  
  // éªŒè¯RTLæ–‡æœ¬æ­£ç¡®å­˜å‚¨
  let arabic_message = azimuth::Attributes::get(attributes, "arabic.message")
  let hebrew_message = azimuth::Attributes::get(attributes, "hebrew.message")
  let mixed_direction = azimuth::Attributes::get(attributes, "mixed.direction")
  
  assert_eq(arabic_message, Some(azimuth::StringValue("Ù…Ø±Ø­Ø¨Ø§ Ø¨Ø§Ù„Ø¹Ø§Ù„Ù…")))
  assert_eq(hebrew_message, Some(azimuth::StringValue("×©×œ×•× ×¢×•×œ×")))
  assert_eq(mixed_direction, Some(azimuth::StringValue("Hello Ù…Ø±Ø­Ø¨Ø§ World")))
  
  // æµ‹è¯•RTLæ–‡æœ¬åœ¨æ—¥å¿—ä¸­çš„å¤„ç†
  let provider = azimuth::LoggerProvider::default()
  let logger = azimuth::LoggerProvider::get_logger(provider, "rtl-test-logger")
  
  let rtl_log = azimuth::Logger::create_log_record(logger)
  azimuth::LogRecord::set_body(rtl_log, "Ø®Ø·Ø£: ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª")
  azimuth::LogRecord::set_severity(rtl_log, azimuth::ERROR)
  azimuth::LogRecord::set_attribute(rtl_log, "text.direction", azimuth::StringValue("rtl"))
  
  assert_eq(azimuth::LogRecord::body(rtl_log), "Ø®Ø·Ø£: ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª")
}

test "locale-specific formatting" {
  // æµ‹è¯•ç‰¹å®šåŒºåŸŸè®¾ç½®çš„æ ¼å¼åŒ–
  let attributes = azimuth::Attributes::new()
  
  // æ—¥æœŸå’Œæ—¶é—´æ ¼å¼
  azimuth::Attributes::set(attributes, "date.us", azimuth::StringValue("12/31/2023"))
  azimuth::Attributes::set(attributes, "date.eu", azimuth::StringValue("31/12/2023"))
  azimuth::Attributes::set(attributes, "date.iso", azimuth::StringValue("2023-12-31"))
  
  // æ•°å­—æ ¼å¼
  azimuth::Attributes::set(attributes, "number.us", azimuth::StringValue("1,234.56"))
  azimuth::Attributes::set(attributes, "number.eu", azimuth::StringValue("1.234,56"))
  azimuth::Attributes::set(attributes, "number.in", azimuth::StringValue("1,23,456.78"))
  
  // è´§å¸æ ¼å¼
  azimuth::Attributes::set(attributes, "currency.us", azimuth::StringValue("$1,234.56"))
  azimuth::Attributes::set(attributes, "currency.eu", azimuth::StringValue("â‚¬1.234,56"))
  azimuth::Attributes::set(attributes, "currency.jp", azimuth::StringValue("Â¥1,235"))
  
  // éªŒè¯æ ¼å¼åŒ–æ•°æ®æ­£ç¡®å­˜å‚¨
  let date_us = azimuth::Attributes::get(attributes, "date.us")
  let date_eu = azimuth::Attributes::get(attributes, "date.eu")
  let date_iso = azimuth::Attributes::get(attributes, "date.iso")
  
  let number_us = azimuth::Attributes::get(attributes, "number.us")
  let number_eu = azimuth::Attributes::get(attributes, "number.eu")
  let number_in = azimuth::Attributes::get(attributes, "number.in")
  
  let currency_us = azimuth::Attributes::get(attributes, "currency.us")
  let currency_eu = azimuth::Attributes::get(attributes, "currency.eu")
  let currency_jp = azimuth::Attributes::get(attributes, "currency.jp")
  
  assert_eq(date_us, Some(azimuth::StringValue("12/31/2023")))
  assert_eq(date_eu, Some(azimuth::StringValue("31/12/2023")))
  assert_eq(date_iso, Some(azimuth::StringValue("2023-12-31")))
  
  assert_eq(number_us, Some(azimuth::StringValue("1,234.56")))
  assert_eq(number_eu, Some(azimuth::StringValue("1.234,56")))
  assert_eq(number_in, Some(azimuth::StringValue("1,23,456.78")))
  
  assert_eq(currency_us, Some(azimuth::StringValue("$1,234.56")))
  assert_eq(currency_eu, Some(azimuth::StringValue("â‚¬1.234,56")))
  assert_eq(currency_jp, Some(azimuth::StringValue("Â¥1,235")))
}

test "internationalization in context propagation" {
  // æµ‹è¯•å›½é™…åŒ–åœ¨ä¸Šä¸‹æ–‡ä¼ æ’­ä¸­çš„å¤„ç†
  let baggage = azimuth::Baggage::new()
  
  // è®¾ç½®å¤šè¯­è¨€baggageæ¡ç›®
  azimuth::Baggage::set_entry(baggage, "user.name.zh", "å¼ ä¸‰")
  azimuth::Baggage::set_entry(baggage, "user.name.ja", "ç”°ä¸­å¤ªéƒ")
  azimuth::Baggage::set_entry(baggage, "user.name.en", "John Doe")
  azimuth::Baggage::set_entry(baggage, "error.message.ar", "ÙØ´Ù„ ÙÙŠ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©")
  azimuth::Baggage::set_entry(baggage, "error.message.es", "Fallo en la autenticaciÃ³n")
  
  // åˆ›å»ºä¼ æ’­è½½ä½“
  let carrier = azimuth::TextMapCarrier::new()
  let baggage_propagator = azimuth::W3CBaggagePropagator::new()
  
  // æ³¨å…¥å¤šè¯­è¨€baggage
  azimuth::W3CBaggagePropagator::inject(baggage_propagator, baggage, carrier)
  
  // æå–baggage
  let extracted_baggage = azimuth::W3CBaggagePropagator::extract(baggage_propagator, carrier)
  
  // éªŒè¯å¤šè¯­è¨€baggageæ¡ç›®æ­£ç¡®ä¼ æ’­
  let user_name_zh = azimuth::Baggage::get_entry(extracted_baggage, "user.name.zh")
  let user_name_ja = azimuth::Baggage::get_entry(extracted_baggage, "user.name.ja")
  let user_name_en = azimuth::Baggage::get_entry(extracted_baggage, "user.name.en")
  let error_message_ar = azimuth::Baggage::get_entry(extracted_baggage, "error.message.ar")
  let error_message_es = azimuth::Baggage::get_entry(extracted_baggage, "error.message.es")
  
  assert_eq(user_name_zh, Some("å¼ ä¸‰"))
  assert_eq(user_name_ja, Some("ç”°ä¸­å¤ªéƒ"))
  assert_eq(user_name_en, Some("John Doe"))
  assert_eq(error_message_ar, Some("ÙØ´Ù„ ÙÙŠ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©"))
  assert_eq(error_message_es, Some("Fallo en la autenticaciÃ³n"))
}