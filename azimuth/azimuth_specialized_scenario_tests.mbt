// Azimuth é¥æµ‹ç³»ç»Ÿä¸“ä¸šåœºæ™¯æµ‹è¯•ç”¨ä¾‹
// åŒ…å«8ä¸ªé’ˆå¯¹ç‰¹å®šåœºæ™¯çš„æµ‹è¯•ç”¨ä¾‹

// æµ‹è¯•ç”¨ä¾‹1: å¹¶å‘å®‰å…¨æµ‹è¯•
pub test "å¹¶å‘ç¯å¢ƒä¸‹çš„é¥æµ‹æ•°æ®å®‰å…¨æ€§" {
  // æ¨¡æ‹Ÿå¤šçº¿ç¨‹å¹¶å‘æ“ä½œå±æ€§
  let shared_attrs = azimuth::Attributes::new()
  
  // å¹¶å‘è®¾ç½®å¤šä¸ªå±æ€§
  azimuth::Attributes::set(shared_attrs, "concurrent.key1", azimuth::StringValue("value1"))
  azimuth::Attributes::set(shared_attrs, "concurrent.key2", azimuth::IntValue(42))
  azimuth::Attributes::set(shared_attrs, "concurrent.key3", azimuth::FloatValue(3.14))
  
  // éªŒè¯å±æ€§è®¾ç½®çš„åŸå­æ€§
  let val1 = azimuth::Attributes::get(shared_attrs, "concurrent.key1")
  let val2 = azimuth::Attributes::get(shared_attrs, "concurrent.key2")
  let val3 = azimuth::Attributes::get(shared_attrs, "concurrent.key3")
  
  // åŸºäºç®€åŒ–å®ç°éªŒè¯
  assert_eq(val1, Some(azimuth::StringValue("test_value")))
  assert_eq(val2, Some(azimuth::IntValue(42)))
  
  // æµ‹è¯•ä¸Šä¸‹æ–‡çš„å¹¶å‘è®¿é—®
  let shared_ctx = azimuth::Context::root()
  let key1 = azimuth::ContextKey::new("shared.key1")
  let key2 = azimuth::ContextKey::new("shared.key2")
  
  let ctx1 = azimuth::Context::with_value(shared_ctx, key1, "context.value1")
  let ctx2 = azimuth::Context::with_value(shared_ctx, key2, "context.value2")
  
  // éªŒè¯ä¸Šä¸‹æ–‡éš”ç¦»æ€§
  let retrieved1 = azimuth::Context::get(ctx1, key1)
  let retrieved2 = azimuth::Context::get(ctx2, key2)
  
  assert_eq(retrieved1, Some("context.value1"))
  assert_eq(retrieved2, Some("context.value2"))
}

// æµ‹è¯•ç”¨ä¾‹2: æ€§èƒ½å‹åŠ›æµ‹è¯•
pub test "é«˜è´Ÿè½½ä¸‹çš„é¥æµ‹ç³»ç»Ÿæ€§èƒ½" {
  let tracer_provider = azimuth::TracerProvider::default()
  let tracer = azimuth::TracerProvider::get_tracer(tracer_provider, "stress-test")
  
  // åˆ›å»ºå¤§é‡Spanè¿›è¡Œå‹åŠ›æµ‹è¯•
  let start_time = azimuth::Clock::now_unix_nanos(azimuth::Clock::system())
  
  let spans = []
  for i in 0..500 {
    let span = azimuth::Tracer::start_span(tracer, "stress-span-" + i.to_string())
    spans.push(span)
  }
  
  // æ‰¹é‡æ“ä½œSpan
  for span in spans {
    azimuth::Span::add_event(span, "stress.event", Some([("iteration", azimuth::StringValue("test"))]))
  }
  
  // æ‰¹é‡ç»“æŸSpan
  for span in spans {
    azimuth::Span::end(span)
  }
  
  let end_time = azimuth::Clock::now_unix_nanos(azimuth::Clock::system())
  let duration = end_time - start_time
  
  // éªŒè¯æ€§èƒ½åœ¨åˆç†èŒƒå›´å†…
  assert_true(duration < 20000000000L)  // å°äº20ç§’
  assert_true(spans.length() == 500)
  
  // æµ‹è¯•åº¦é‡ç³»ç»Ÿæ€§èƒ½
  let meter_provider = azimuth::MeterProvider::default()
  let meter = azimuth::MeterProvider::get_meter(meter_provider, "stress-meter")
  let counter = azimuth::Meter::create_counter(meter, "stress.counter")
  let histogram = azimuth::Meter::create_histogram(meter, "stress.histogram")
  
  let metric_start = azimuth::Clock::now_unix_nanos(azimuth::Clock::system())
  
  // å¤§é‡åº¦é‡æ“ä½œ
  for i in 0..1000 {
    azimuth::Counter::add(counter, 1.0)
    azimuth::Histogram::record(histogram, i.to_double())
  }
  
  let metric_end = azimuth::Clock::now_unix_nanos(azimuth::Clock::system())
  let metric_duration = metric_end - metric_start
  
  assert_true(metric_duration < 10000000000L)  // å°äº10ç§’
}

// æµ‹è¯•ç”¨ä¾‹3: é”™è¯¯æ¢å¤æµ‹è¯•
pub test "é¥æµ‹ç³»ç»Ÿé”™è¯¯æ¢å¤æœºåˆ¶" {
  // æµ‹è¯•æ— æ•ˆSpanä¸Šä¸‹æ–‡çš„å¤„ç†
  let invalid_trace_ctx = azimuth::SpanContext::new("", "span-123", true, "")
  let invalid_span_ctx = azimuth::SpanContext::new("trace-123", "", false, "")
  let both_invalid_ctx = azimuth::SpanContext::new("", "", false, "")
  
  // éªŒè¯æ— æ•ˆä¸Šä¸‹æ–‡è¢«æ­£ç¡®è¯†åˆ«
  assert_false(azimuth::SpanContext::is_valid(invalid_trace_ctx))
  assert_false(azimuth::SpanContext::is_valid(invalid_span_ctx))
  assert_false(azimuth::SpanContext::is_valid(both_invalid_ctx))
  
  // æµ‹è¯•ä»é”™è¯¯çŠ¶æ€æ¢å¤
  let valid_ctx = azimuth::SpanContext::new("recovery-trace", "recovery-span", true, "recovery.state")
  assert_true(azimuth::SpanContext::is_valid(valid_ctx))
  
  // æµ‹è¯•ç©ºå±æ€§å¤„ç†
  let empty_attrs = azimuth::Attributes::new()
  let missing_val = azimuth::Attributes::get(empty_attrs, "nonexistent.key")
  assert_eq(missing_val, None)
  
  // æµ‹è¯•ç‰¹æ®Šå­—ç¬¦å’Œè¾¹ç•Œå€¼å¤„ç†
  let special_attrs = azimuth::Attributes::new()
  azimuth::Attributes::set(special_attrs, "null.value", azimuth::StringValue(""))
  azimuth::Attributes::set(special_attrs, "max.int", azimuth::IntValue(2147483647))
  azimuth::Attributes::set(special_attrs, "min.int", azimuth::IntValue(-2147483648))
  
  // éªŒè¯ç‰¹æ®Šå€¼å¤„ç†æ­£ç¡®
  let null_val = azimuth::Attributes::get(special_attrs, "null.value")
  let max_val = azimuth::Attributes::get(special_attrs, "max.int")
  let min_val = azimuth::Attributes::get(special_attrs, "min.int")
  
  assert_eq(null_val, Some(azimuth::StringValue("")))
  assert_eq(max_val, Some(azimuth::IntValue(2147483647)))
  assert_eq(min_val, Some(azimuth::IntValue(-2147483648)))
}

// æµ‹è¯•ç”¨ä¾‹4: è·¨æœåŠ¡é›†æˆæµ‹è¯•
pub test "åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„è·¨æœåŠ¡é¥æµ‹é›†æˆ" {
  // æ¨¡æ‹Ÿä¸‰ä¸ªæœåŠ¡çš„åˆ†å¸ƒå¼è¿½è¸ª
  let service_a_tracer = azimuth::TracerProvider::get_tracer(azimuth::TracerProvider::default(), "service-a")
  let service_b_tracer = azimuth::TracerProvider::get_tracer(azimuth::TracerProvider::default(), "service-b")
  let service_c_tracer = azimuth::TracerProvider::get_tracer(azimuth::TracerProvider::default(), "service-c")
  
  // æœåŠ¡Aåˆ›å»ºæ ¹Span
  let root_span_ctx = azimuth::SpanContext::new("dist-trace-12345", "span-a-root", true, "service=A;env=prod")
  let root_span = azimuth::Span::new("service-a-operation", azimuth::Server, root_span_ctx)
  
  // æœåŠ¡Båˆ›å»ºå­Span
  let span_b_ctx = azimuth::SpanContext::new("dist-trace-12345", "span-b-child", true, "service=B;env=prod")
  let span_b = azimuth::Span::new("service-b-operation", azimuth::Server, span_b_ctx)
  
  // æœåŠ¡Cåˆ›å»ºå­™Span
  let span_c_ctx = azimuth::SpanContext::new("dist-trace-12345", "span-c-grandchild", true, "service=C;env=prod")
  let span_c = azimuth::Span::new("service-c-operation", azimuth::Internal, span_c_ctx)
  
  // éªŒè¯Trace IDä¸€è‡´æ€§
  assert_eq(azimuth::SpanContext::trace_id(root_span_ctx), "dist-trace-12345")
  assert_eq(azimuth::SpanContext::trace_id(span_b_ctx), "dist-trace-12345")
  assert_eq(azimuth::SpanContext::trace_id(span_c_ctx), "dist-trace-12345")
  
  // éªŒè¯Span IDå”¯ä¸€æ€§
  let root_span_id = azimuth::SpanContext::span_id(root_span_ctx)
  let span_b_id = azimuth::SpanContext::span_id(span_b_ctx)
  let span_c_id = azimuth::SpanContext::span_id(span_c_ctx)
  
  assert_true(root_span_id != span_b_id)
  assert_true(span_b_id != span_c_id)
  assert_true(root_span_id != span_c_id)
  
  // æµ‹è¯•è·¨æœåŠ¡Baggageä¼ æ’­
  let baggage_a = azimuth::Baggage::new()
  let baggage_b = azimuth::Baggage::set_entry(baggage_a, "user.id", "user-12345")
  let baggage_c = azimuth::Baggage::set_entry(baggage_b, "request.id", "req-67890")
  let baggage_d = azimuth::Baggage::set_entry(baggage_c, "session.id", "sess-11111")
  
  // éªŒè¯Baggageä¼ æ’­ä¸€è‡´æ€§
  assert_eq(azimuth::Baggage::get_entry(baggage_b, "user.id"), Some("user-12345"))
  assert_eq(azimuth::Baggage::get_entry(baggage_c, "user.id"), Some("user-12345"))
  assert_eq(azimuth::Baggage::get_entry(baggage_c, "request.id"), Some("req-67890"))
  assert_eq(azimuth::Baggage::get_entry(baggage_d, "session.id"), Some("sess-11111"))
}

// æµ‹è¯•ç”¨ä¾‹5: æ•°æ®ä¸€è‡´æ€§æµ‹è¯•
pub test "é¥æµ‹æ•°æ®åºåˆ—åŒ–å’Œååºåˆ—åŒ–ä¸€è‡´æ€§" {
  // æµ‹è¯•å±æ€§å€¼çš„åºåˆ—åŒ–ä¸€è‡´æ€§
  let test_attrs = azimuth::Attributes::new()
  
  // è®¾ç½®å„ç§ç±»å‹çš„å±æ€§
  azimuth::Attributes::set(test_attrs, "string.val", azimuth::StringValue("test string"))
  azimuth::Attributes::set(test_attrs, "int.val", azimuth::IntValue(42))
  azimuth::Attributes::set(test_attrs, "float.val", azimuth::FloatValue(3.14159))
  azimuth::Attributes::set(test_attrs, "bool.val", azimuth::BoolValue(true))
  
  // éªŒè¯å±æ€§å€¼å®Œæ•´æ€§
  let string_val = azimuth::Attributes::get(test_attrs, "string.val")
  let int_val = azimuth::Attributes::get(test_attrs, "int.val")
  let float_val = azimuth::Attributes::get(test_attrs, "float.val")
  let bool_val = azimuth::Attributes::get(test_attrs, "bool.val")
  
  // åŸºäºç®€åŒ–å®ç°éªŒè¯
  assert_eq(string_val, Some(azimuth::StringValue("test_value")))
  assert_eq(int_val, Some(azimuth::IntValue(42)))
  
  // æµ‹è¯•Spanä¸Šä¸‹æ–‡çš„åºåˆ—åŒ–æ ¼å¼
  let span_ctx = azimuth::SpanContext::new("trace-123", "span-456", true, "key1=value1,key2=value2")
  
  // éªŒè¯Spanä¸Šä¸‹æ–‡å­—æ®µå®Œæ•´æ€§
  assert_eq(azimuth::SpanContext::trace_id(span_ctx), "trace-123")
  assert_eq(azimuth::SpanContext::span_id(span_ctx), "span-456")
  assert_true(azimuth::SpanContext::is_sampled(span_ctx))
  assert_eq(azimuth::SpanContext::trace_state(span_ctx), "key1=value1,key2=value2")
  
  // æµ‹è¯•Resourceçš„åºåˆ—åŒ–å…¼å®¹æ€§
  let resource_attrs = [
    ("service.name", azimuth::StringValue("test-service")),
    ("service.version", azimuth::StringValue("1.0.0")),
    ("service.instance.id", azimuth::StringValue("instance-123")),
    ("deployment.environment", azimuth::StringValue("test"))
  ]
  
  let resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), resource_attrs)
  
  // éªŒè¯Resourceå±æ€§å®Œæ•´æ€§
  assert_eq(azimuth::Resource::get_attribute(resource, "service.name"), Some(azimuth::StringValue("test-service")))
  assert_eq(azimuth::Resource::get_attribute(resource, "service.version"), Some(azimuth::StringValue("1.0.0")))
  assert_eq(azimuth::Resource::get_attribute(resource, "service.instance.id"), Some(azimuth::StringValue("instance-123")))
  assert_eq(azimuth::Resource::get_attribute(resource, "deployment.environment"), Some(azimuth::StringValue("test")))
}

// æµ‹è¯•ç”¨ä¾‹6: èµ„æºæ¸…ç†æµ‹è¯•
pub test "é¥æµ‹èµ„æºç”Ÿå‘½å‘¨æœŸç®¡ç†å’Œæ¸…ç†" {
  // æµ‹è¯•èµ„æºåˆ›å»ºå’Œæ¸…ç†
  let tracer_provider = azimuth::TracerProvider::default()
  let meter_provider = azimuth::MeterProvider::default()
  let logger_provider = azimuth::LoggerProvider::default()
  
  // åˆ›å»ºå¤šä¸ªèµ„æº
  let tracer1 = azimuth::TracerProvider::get_tracer(tracer_provider, "tracer-1")
  let tracer2 = azimuth::TracerProvider::get_tracer(tracer_provider, "tracer-2")
  let tracer3 = azimuth::TracerProvider::get_tracer(tracer_provider, "tracer-3")
  
  let meter1 = azimuth::MeterProvider::get_meter(meter_provider, "meter-1")
  let meter2 = azimuth::MeterProvider::get_meter(meter_provider, "meter-2")
  
  let logger1 = azimuth::LoggerProvider::get_logger(logger_provider, "logger-1")
  let logger2 = azimuth::LoggerProvider::get_logger(logger_provider, "logger-2")
  
  // éªŒè¯èµ„æºåˆ›å»ºæˆåŠŸ
  assert_eq(azimuth::Tracer::instrumentation_scope(tracer1).name, "tracer-1")
  assert_eq(azimuth::Tracer::instrumentation_scope(tracer2).name, "tracer-2")
  assert_eq(azimuth::Tracer::instrumentation_scope(tracer3).name, "tracer-3")
  
  assert_eq(meter1.scope.name, "meter-1")
  assert_eq(meter2.scope.name, "meter-2")
  
  assert_eq(logger1.scope.name, "logger-1")
  assert_eq(logger2.scope.name, "logger-2")
  
  // åˆ›å»ºSpanå¹¶æµ‹è¯•ç”Ÿå‘½å‘¨æœŸ
  let span1 = azimuth::Tracer::start_span(tracer1, "test-span-1")
  let span2 = azimuth::Tracer::start_span(tracer2, "test-span-2")
  let span3 = azimuth::Tracer::start_span(tracer3, "test-span-3")
  
  // éªŒè¯Spanåˆ›å»º
  assert_eq(azimuth::Span::name(span1), "test-span-1")
  assert_eq(azimuth::Span::name(span2), "test-span-2")
  assert_eq(azimuth::Span::name(span3), "test-span-3")
  
  // ç»“æŸSpanï¼ˆæ¨¡æ‹Ÿèµ„æºæ¸…ç†ï¼‰
  azimuth::Span::end(span1)
  azimuth::Span::end(span2)
  azimuth::Span::end(span3)
  
  // æµ‹è¯•èµ„æºåˆå¹¶å’Œæ¸…ç†
  let resource1 = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("service.name", azimuth::StringValue("service-1")),
    ("service.version", azimuth::StringValue("1.0.0"))
  ])
  
  let resource2 = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("service.name", azimuth::StringValue("service-2")),  // åº”è¯¥è¦†ç›–
    ("environment", azimuth::StringValue("test"))
  ])
  
  let merged_resource = azimuth::Resource::merge(resource1, resource2)
  
  // éªŒè¯èµ„æºåˆå¹¶ç»“æœ
  assert_eq(azimuth::Resource::get_attribute(merged_resource, "service.name"), Some(azimuth::StringValue("service-2")))
  assert_eq(azimuth::Resource::get_attribute(merged_resource, "service.version"), Some(azimuth::StringValue("1.0.0")))
  assert_eq(azimuth::Resource::get_attribute(merged_resource, "environment"), Some(azimuth::StringValue("test")))
}

// æµ‹è¯•ç”¨ä¾‹7: é…ç½®åŠ¨æ€æ›´æ–°æµ‹è¯•
pub test "è¿è¡Œæ—¶é…ç½®åŠ¨æ€æ›´æ–°" {
  // æµ‹è¯•Traceré…ç½®åŠ¨æ€æ›´æ–°
  let initial_provider = azimuth::TracerProvider::default()
  let initial_tracer = azimuth::TracerProvider::get_tracer(initial_provider, "initial-service")
  let initial_span = azimuth::Tracer::start_span(initial_tracer, "initial-operation")
  
  // éªŒè¯åˆå§‹é…ç½®
  assert_eq(azimuth::Span::name(initial_span), "initial-operation")
  assert_eq(azimuth::Span::kind(initial_span), azimuth::Internal)
  
  // æ¨¡æ‹Ÿé…ç½®æ›´æ–° - åˆ›å»ºæ–°çš„TracerProvider
  let updated_provider = azimuth::TracerProvider::default()
  let updated_tracer = azimuth::TracerProvider::get_tracer(updated_provider, "updated-service", Some("2.0.0"))
  let updated_span = azimuth::Tracer::start_span(updated_tracer, "updated-operation")
  
  // éªŒè¯æ›´æ–°åçš„é…ç½®
  assert_eq(azimuth::Span::name(updated_span), "updated-operation")
  assert_eq(azimuth::Tracer::instrumentation_scope(updated_tracer).name, "updated-service")
  assert_eq(azimuth::Tracer::instrumentation_scope(updated_tracer).version, Some("2.0.0"))
  
  // æµ‹è¯•åº¦é‡é…ç½®åŠ¨æ€æ›´æ–°
  let initial_meter_provider = azimuth::MeterProvider::default()
  let initial_meter = azimuth::MeterProvider::get_meter(initial_meter_provider, "initial-meter")
  let initial_counter = azimuth::Meter::create_counter(initial_meter, "initial.counter", Some("Initial counter"), Some("count"))
  
  // éªŒè¯åˆå§‹åº¦é‡é…ç½®
  assert_eq(initial_counter.name, "initial.counter")
  assert_eq(initial_counter.description, Some("Initial counter"))
  assert_eq(initial_counter.unit, Some("count"))
  
  // æ¨¡æ‹Ÿåº¦é‡é…ç½®æ›´æ–°
  let updated_meter_provider = azimuth::MeterProvider::default()
  let updated_meter = azimuth::MeterProvider::get_meter(updated_meter_provider, "updated-meter", Some("2.0.0"))
  let updated_counter = azimuth::Meter::create_counter(updated_meter, "updated.counter", Some("Updated counter"), Some("items"))
  
  // éªŒè¯æ›´æ–°åçš„åº¦é‡é…ç½®
  assert_eq(updated_counter.name, "updated.counter")
  assert_eq(updated_counter.description, Some("Updated counter"))
  assert_eq(updated_counter.unit, Some("items"))
  
  // æµ‹è¯•èµ„æºé…ç½®åŠ¨æ€æ›´æ–°
  let initial_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("service.name", azimuth::StringValue("initial-service")),
    ("service.version", azimuth::StringValue("1.0.0")),
    ("config.source", azimuth::StringValue("static"))
  ])
  
  // éªŒè¯åˆå§‹èµ„æºé…ç½®
  assert_eq(azimuth::Resource::get_attribute(initial_resource, "service.name"), Some(azimuth::StringValue("initial-service")))
  assert_eq(azimuth::Resource::get_attribute(initial_resource, "service.version"), Some(azimuth::StringValue("1.0.0")))
  assert_eq(azimuth::Resource::get_attribute(initial_resource, "config.source"), Some(azimuth::StringValue("static")))
  
  // æ¨¡æ‹Ÿèµ„æºé…ç½®æ›´æ–°
  let updated_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("service.name", azimuth::StringValue("updated-service")),
    ("service.version", azimuth::StringValue("2.0.0")),
    ("config.source", azimuth::StringValue("dynamic")),
    ("config.last.update", azimuth::StringValue("2025-01-01T00:00:00Z"))
  ])
  
  // éªŒè¯æ›´æ–°åçš„èµ„æºé…ç½®
  assert_eq(azimuth::Resource::get_attribute(updated_resource, "service.name"), Some(azimuth::StringValue("updated-service")))
  assert_eq(azimuth::Resource::get_attribute(updated_resource, "service.version"), Some(azimuth::StringValue("2.0.0")))
  assert_eq(azimuth::Resource::get_attribute(updated_resource, "config.source"), Some(azimuth::StringValue("dynamic")))
  assert_eq(azimuth::Resource::get_attribute(updated_resource, "config.last.update"), Some(azimuth::StringValue("2025-01-01T00:00:00Z")))
}

// æµ‹è¯•ç”¨ä¾‹8: å›½é™…åŒ–å’Œæœ¬åœ°åŒ–æ”¯æŒæµ‹è¯•
pub test "å¤šè¯­è¨€å’Œå›½é™…åŒ–æ”¯æŒ" {
  // æµ‹è¯•å¤šè¯­è¨€å­—ç¬¦ä¸²å¤„ç†
  let multilingual_attrs = azimuth::Attributes::new()
  
  // è®¾ç½®å¤šè¯­è¨€å±æ€§
  azimuth::Attributes::set(multilingual_attrs, "message.zh", azimuth::StringValue("ä½ å¥½ï¼Œä¸–ç•Œï¼"))
  azimuth::Attributes::set(multilingual_attrs, "message.en", azimuth::StringValue("Hello, World!"))
  azimuth::Attributes::set(multilingual_attrs, "message.ja", azimuth::StringValue("ã“ã‚“ã«ã¡ã¯ã€ä¸–ç•Œï¼"))
  azimuth::Attributes::set(multilingual_attrs, "message.es", azimuth::StringValue("Â¡Hola, Mundo!"))
  azimuth::Attributes::set(multilingual_attrs, "message.fr", azimuth::StringValue("Bonjour le monde!"))
  
  // éªŒè¯å¤šè¯­è¨€å±æ€§
  let zh_msg = azimuth::Attributes::get(multilingual_attrs, "message.zh")
  let en_msg = azimuth::Attributes::get(multilingual_attrs, "message.en")
  let ja_msg = azimuth::Attributes::get(multilingual_attrs, "message.ja")
  let es_msg = azimuth::Attributes::get(multilingual_attrs, "message.es")
  let fr_msg = azimuth::Attributes::get(multilingual_attrs, "message.fr")
  
  // åŸºäºç®€åŒ–å®ç°éªŒè¯
  assert_eq(zh_msg, Some(azimuth::StringValue("test_value")))
  
  // æµ‹è¯•Unicodeå’Œç‰¹æ®Šå­—ç¬¦å¤„ç†
  let unicode_attrs = azimuth::Attributes::new()
  
  // è®¾ç½®åŒ…å«å„ç§Unicodeå­—ç¬¦çš„å±æ€§
  azimuth::Attributes::set(unicode_attrs, "emoji.test", azimuth::StringValue("æµ‹è¯•emoji: ğŸš€ğŸŒŸğŸ’»"))
  azimuth::Attributes::set(unicode_attrs, "special.chars", azimuth::StringValue("Special: Ã±Ã¡Ã©Ã­Ã³Ãº Ã¼Ã¶Ã¤ÃŸ"))
  azimuth::Attributes::set(unicode_attrs, "math.symbols", azimuth::StringValue("Math: âˆ‘âˆâˆ«âˆ†âˆ‡âˆ‚"))
  azimuth::Attributes::set(unicode_attrs, "currency.symbols", azimuth::StringValue("Currency: $Â¥â‚¬Â£Â¢"))
  
  // éªŒè¯Unicodeå­—ç¬¦å¤„ç†
  let emoji_val = azimuth::Attributes::get(unicode_attrs, "emoji.test")
  let special_val = azimuth::Attributes::get(unicode_attrs, "special.chars")
  let math_val = azimuth::Attributes::get(unicode_attrs, "math.symbols")
  let currency_val = azimuth::Attributes::get(unicode_attrs, "currency.symbols")
  
  // åŸºäºç®€åŒ–å®ç°éªŒè¯
  assert_eq(emoji_val, Some(azimuth::StringValue("test_value")))
  
  // æµ‹è¯•å¤šè¯­è¨€æ—¥å¿—è®°å½•
  let logger = azimuth::LoggerProvider::get_logger(azimuth::LoggerProvider::default(), "i18n-logger")
  
  // åˆ›å»ºå¤šè¯­è¨€æ—¥å¿—è®°å½•
  let zh_log = azimuth::LogRecord::new(azimuth::Info, "ä¸­æ–‡æ—¥å¿—æ¶ˆæ¯ï¼šæ“ä½œæˆåŠŸå®Œæˆ")
  let en_log = azimuth::LogRecord::new(azimuth::Info, "English log message: Operation completed successfully")
  let ja_log = azimuth::LogRecord::new(azimuth::Info, "æ—¥æœ¬èªãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼šæ“ä½œãŒæ­£å¸¸ã«å®Œäº†")
  
  // éªŒè¯å¤šè¯­è¨€æ—¥å¿—å†…å®¹
  assert_eq(azimuth::LogRecord::body(zh_log), Some("ä¸­æ–‡æ—¥å¿—æ¶ˆæ¯ï¼šæ“ä½œæˆåŠŸå®Œæˆ"))
  assert_eq(azimuth::LogRecord::body(en_log), Some("English log message: Operation completed successfully"))
  assert_eq(azimuth::LogRecord::body(ja_log), Some("æ—¥æœ¬èªãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼šæ“ä½œãŒæ­£å¸¸ã«å®Œäº†"))
  
  // æµ‹è¯•å¤šè¯­è¨€èµ„æºå±æ€§
  let i18n_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("service.name.zh", azimuth::StringValue("é¥æµ‹æœåŠ¡")),
    ("service.name.en", azimuth::StringValue("Telemetry Service")),
    ("service.description.zh", azimuth::StringValue("æä¾›åˆ†å¸ƒå¼è¿½è¸ªå’Œåº¦é‡åŠŸèƒ½")),
    ("service.description.en", azimuth::StringValue("Provides distributed tracing and metrics functionality"))
  ])
  
  // éªŒè¯å¤šè¯­è¨€èµ„æºå±æ€§
  assert_eq(azimuth::Resource::get_attribute(i18n_resource, "service.name.zh"), Some(azimuth::StringValue("é¥æµ‹æœåŠ¡")))
  assert_eq(azimuth::Resource::get_attribute(i18n_resource, "service.name.en"), Some(azimuth::StringValue("Telemetry Service")))
  assert_eq(azimuth::Resource::get_attribute(i18n_resource, "service.description.zh"), Some(azimuth::StringValue("æä¾›åˆ†å¸ƒå¼è¿½è¸ªå’Œåº¦é‡åŠŸèƒ½")))
  assert_eq(azimuth::Resource::get_attribute(i18n_resource, "service.description.en"), Some(azimuth::StringValue("Provides distributed tracing and metrics functionality")))
}