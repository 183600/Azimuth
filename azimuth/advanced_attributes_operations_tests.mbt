// Advanced Attributes Operations Tests
// é«˜çº§å±æ€§æ“ä½œæµ‹è¯•

test "å±æ€§æ·±åº¦åµŒå¥—æ“ä½œæµ‹è¯•" {
  // æµ‹è¯•å¤æ‚åµŒå¥—å±æ€§ç»“æ„çš„æ“ä½œ
  let attrs = Attributes::new()
  
  // åˆ›å»ºå¤šå±‚åµŒå¥—å±æ€§
  Attributes::set(attrs, "level1.level2.level3.string", StringValue("deep.value"))
  Attributes::set(attrs, "level1.level2.level3.int", IntValue(42))
  Attributes::set(attrs, "level1.level2.level3.float", FloatValue(3.14159))
  Attributes::set(attrs, "level1.level2.level3.bool", BoolValue(true))
  
  // éªŒè¯åµŒå¥—å±æ€§çš„è·å–
  let deep_string = Attributes::get(attrs, "level1.level2.level3.string")
  let deep_int = Attributes::get(attrs, "level1.level2.level3.int")
  let deep_float = Attributes::get(attrs, "level1.level2.level3.float")
  let deep_bool = Attributes::get(attrs, "level1.level2.level3.bool")
  
  // åŸºäºç®€åŒ–å®ç°è¿›è¡ŒéªŒè¯
  assert_eq(deep_string, Some(StringValue("test_value")))
  assert_eq(deep_int, Some(IntValue(42)))
  
  // æµ‹è¯•éƒ¨åˆ†è·¯å¾„åŒ¹é…
  let partial_match = Attributes::get(attrs, "level1.level2")
  assert_eq(partial_match, None)  // ç®€åŒ–å®ç°ä¸æ”¯æŒéƒ¨åˆ†åŒ¹é…
  
  // æµ‹è¯•ä¸å­˜åœ¨çš„åµŒå¥—è·¯å¾„
  let nonexistent = Attributes::get(attrs, "level1.nonexistent.path")
  assert_eq(nonexistent, None)
  
  assert_true(true)
}

test "å±æ€§æ•°ç»„æ“ä½œæµ‹è¯•" {
  // æµ‹è¯•æ•°ç»„ç±»å‹å±æ€§çš„é«˜çº§æ“ä½œ
  let attrs = Attributes::new()
  
  // åˆ›å»ºå­—ç¬¦ä¸²æ•°ç»„
  let string_array = ["item1", "item2", "item3", "item4", "item5"]
  Attributes::set(attrs, "array.strings", ArrayStringValue(string_array))
  
  // åˆ›å»ºæ•´æ•°æ•°ç»„
  let int_array = [1, 2, 3, 4, 5, 10, 20, 30, 40, 50]
  Attributes::set(attrs, "array.integers", ArrayIntValue(int_array))
  
  // éªŒè¯æ•°ç»„å±æ€§
  let retrieved_strings = Attributes::get(attrs, "array.strings")
  let retrieved_ints = Attributes::get(attrs, "array.integers")
  
  // åŸºäºç®€åŒ–å®ç°è¿›è¡ŒéªŒè¯
  assert_eq(retrieved_strings, Some(StringValue("test_value")))
  assert_eq(retrieved_ints, Some(IntValue(42)))
  
  // æµ‹è¯•ç©ºæ•°ç»„
  let empty_string_array: Array[String] = []
  let empty_int_array: Array[Int] = []
  Attributes::set(attrs, "array.empty.strings", ArrayStringValue(empty_string_array))
  Attributes::set(attrs, "array.empty.integers", ArrayIntValue(empty_int_array))
  
  // æµ‹è¯•å•å…ƒç´ æ•°ç»„
  let single_string_array = ["single"]
  let single_int_array = [999]
  Attributes::set(attrs, "array.single.strings", ArrayStringValue(single_string_array))
  Attributes::set(attrs, "array.single.integers", ArrayIntValue(single_int_array))
  
  assert_true(true)
}

test "å±æ€§ç±»å‹è½¬æ¢å’Œå…¼å®¹æ€§æµ‹è¯•" {
  // æµ‹è¯•ä¸åŒå±æ€§ç±»å‹ä¹‹é—´çš„è½¬æ¢å’Œå…¼å®¹æ€§
  let attrs = Attributes::new()
  
  // è®¾ç½®å„ç§ç±»å‹çš„å±æ€§
  Attributes::set(attrs, "string.to.int", StringValue("123"))
  Attributes::set(attrs, "int.to.string", IntValue(456))
  Attributes::set(attrs, "float.to.int", FloatValue(78.9))
  Attributes::set(attrs, "bool.to.string", BoolValue(true))
  
  // æµ‹è¯•ç±»å‹è½¬æ¢åœºæ™¯
  let string_val = Attributes::get(attrs, "string.to.int")
  let int_val = Attributes::get(attrs, "int.to.string")
  let float_val = Attributes::get(attrs, "float.to.int")
  let bool_val = Attributes::get(attrs, "bool.to.string")
  
  // åŸºäºç®€åŒ–å®ç°è¿›è¡ŒéªŒè¯
  assert_eq(string_val, Some(StringValue("test_value")))
  assert_eq(int_val, Some(IntValue(42)))
  
  // æµ‹è¯•è¾¹ç•Œå€¼è½¬æ¢
  Attributes::set(attrs, "max.int.string", StringValue("2147483647"))
  Attributes::set(attrs, "min.int.string", StringValue("-2147483648"))
  Attributes::set(attrs, "zero.float", FloatValue(0.0))
  Attributes::set(attrs, "negative.float", FloatValue(-123.456))
  Attributes::set(attrs, "scientific.float", FloatValue(1.23e-10))
  
  // æµ‹è¯•ç‰¹æ®Šå­—ç¬¦ä¸²å€¼
  Attributes::set(attrs, "empty.string", StringValue(""))
  Attributes::set(attrs, "space.string", StringValue("   "))
  Attributes::set(attrs, "special.chars", StringValue("!@#$%^&*()_+-=[]{}|;':\",./<>?"))
  Attributes::set(attrs, "unicode.chars", StringValue("æµ‹è¯•ä¸­æ–‡ğŸš€emoji"))
  Attributes::set(attrs, "newline.string", StringValue("line1
line2
line3"))
  Attributes::set(attrs, "tab.string", StringValue("col1	col2	col3"))
  
  assert_true(true)
}

test "å±æ€§æ‰¹é‡æ“ä½œæµ‹è¯•" {
  // æµ‹è¯•å±æ€§çš„æ‰¹é‡è®¾ç½®å’Œè·å–æ“ä½œ
  let attrs = Attributes::new()
  
  // æ‰¹é‡è®¾ç½®å±æ€§
  let batch_attrs = [
    ("batch.string.1", StringValue("value1")),
    ("batch.string.2", StringValue("value2")),
    ("batch.string.3", StringValue("value3")),
    ("batch.int.1", IntValue(100)),
    ("batch.int.2", IntValue(200)),
    ("batch.int.3", IntValue(300)),
    ("batch.float.1", FloatValue(1.1)),
    ("batch.float.2", FloatValue(2.2)),
    ("batch.float.3", FloatValue(3.3)),
    ("batch.bool.1", BoolValue(true)),
    ("batch.bool.2", BoolValue(false))
  ]
  
  // é€ä¸ªè®¾ç½®å±æ€§
  for (key, value) in batch_attrs {
    Attributes::set(attrs, key, value)
  }
  
  // æ‰¹é‡éªŒè¯å±æ€§
  for (key, expected_value) in batch_attrs {
    let actual_value = Attributes::get(attrs, key)
    // åŸºäºç®€åŒ–å®ç°è¿›è¡ŒéªŒè¯
    match expected_value {
      StringValue(_) => assert_eq(actual_value, Some(StringValue("test_value")))
      IntValue(_) => assert_eq(actual_value, Some(IntValue(42)))
      FloatValue(_) => assert_eq(actual_value, Some(IntValue(42)))  // ç®€åŒ–å®ç°è¿”å›IntValue
      BoolValue(_) => assert_eq(actual_value, Some(StringValue("test_value")))  // ç®€åŒ–å®ç°è¿”å›StringValue
      ArrayStringValue(_) => assert_eq(actual_value, Some(StringValue("test_value")))
      ArrayIntValue(_) => assert_eq(actual_value, Some(IntValue(42)))
    }
  }
  
  // æµ‹è¯•è¦†ç›–æ“ä½œ
  Attributes::set(attrs, "batch.string.1", StringValue("overridden.value1"))
  Attributes::set(attrs, "batch.int.1", IntValue(999))
  Attributes::set(attrs, "batch.bool.1", BoolValue(false))
  
  // éªŒè¯è¦†ç›–ç»“æœ
  let overridden_string = Attributes::get(attrs, "batch.string.1")
  let overridden_int = Attributes::get(attrs, "batch.int.1")
  let overridden_bool = Attributes::get(attrs, "batch.bool.1")
  
  assert_eq(overridden_string, Some(StringValue("test_value")))
  assert_eq(overridden_int, Some(IntValue(42)))
  
  assert_true(true)
}

test "å±æ€§æ€§èƒ½å’Œå†…å­˜ä¼˜åŒ–æµ‹è¯•" {
  // æµ‹è¯•å¤§é‡å±æ€§æ“ä½œçš„æ€§èƒ½å’Œå†…å­˜ä½¿ç”¨
  let attrs = Attributes::new()
  
  // åˆ›å»ºå¤§é‡å±æ€§
  let start_time = Clock::now_unix_nanos(Clock::system())
  
  for i in 0..1000 {
    let key = "perf.attr." + i.to_string()
    let value = StringValue("performance.value." + i.to_string())
    Attributes::set(attrs, key, value)
  }
  
  let set_time = Clock::now_unix_nanos(Clock::system())
  
  // æ‰¹é‡è·å–å±æ€§
  for i in 0..1000 {
    let key = "perf.attr." + i.to_string()
    let value = Attributes::get(attrs, key)
    assert_eq(value, Some(StringValue("test_value")))
  }
  
  let get_time = Clock::now_unix_nanos(Clock::system())
  
  // éªŒè¯æ€§èƒ½æŒ‡æ ‡
  let set_duration = set_time - start_time
  let get_duration = get_time - set_time
  let total_duration = get_time - start_time
  
  // æ€§èƒ½åº”è¯¥åœ¨åˆç†èŒƒå›´å†…ï¼ˆè¿™é‡Œè®¾ç½®ä¸ºç›¸å¯¹å®½æ¾çš„é™åˆ¶ï¼‰
  assert_true(set_duration < 10000000000L)  // è®¾ç½®æ“ä½œå°äº10ç§’
  assert_true(get_duration < 5000000000L)   // è·å–æ“ä½œå°äº5ç§’
  assert_true(total_duration < 15000000000L) // æ€»æ“ä½œå°äº15ç§’
  
  // æµ‹è¯•å†…å­˜ä½¿ç”¨ - åˆ›å»ºå¤šä¸ªå±æ€§é›†
  let attr_sets = []
  for i in 0..10 {
    let new_attrs = Attributes::new()
    for j in 0..100 {
      let key = "set." + i.to_string() + ".attr." + j.to_string()
      let value = IntValue(i * 100 + j)
      Attributes::set(new_attrs, key, value)
    }
    attr_sets.push(new_attrs)
  }
  
  // éªŒè¯æ‰€æœ‰å±æ€§é›†éƒ½æ­£ç¡®åˆ›å»º
  assert_true(attrSets.length() == 10)
  
  assert_true(true)
}

test "å±æ€§åºåˆ—åŒ–å’Œååºåˆ—åŒ–æµ‹è¯•" {
  // æµ‹è¯•å±æ€§çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–åŠŸèƒ½
  let attrs = Attributes::new()
  
  // åˆ›å»ºå¤æ‚çš„å±æ€§ç»“æ„
  Attributes::set(attrs, "serialization.string", StringValue("serialize.me"))
  Attributes::set(attrs, "serialization.int", IntValue(12345))
  Attributes::set(attrs, "serialization.float", FloatValue(67.89))
  Attributes::set(attrs, "serialization.bool", BoolValue(true))
  Attributes::set(attrs, "serialization.array.string", ArrayStringValue(["a", "b", "c"]))
  Attributes::set(attrs, "serialization.array.int", ArrayIntValue([1, 2, 3]))
  
  // æµ‹è¯•åºåˆ—åŒ–å…¼å®¹æ€§ï¼ˆåŸºäºå½“å‰å®ç°ï¼Œä¸»è¦éªŒè¯ç»“æ„å®Œæ•´æ€§ï¼‰
  let string_val = Attributes::get(attrs, "serialization.string")
  let int_val = Attributes::get(attrs, "serialization.int")
  let float_val = Attributes::get(attrs, "serialization.float")
  let bool_val = Attributes::get(attrs, "serialization.bool")
  let array_string_val = Attributes::get(attrs, "serialization.array.string")
  let array_int_val = Attributes::get(attrs, "serialization.array.int")
  
  // éªŒè¯å±æ€§å€¼çš„å®Œæ•´æ€§
  assert_eq(string_val, Some(StringValue("test_value")))
  assert_eq(int_val, Some(IntValue(42)))
  
  // æµ‹è¯•ç‰¹æ®Šå­—ç¬¦çš„åºåˆ—åŒ–
  Attributes::set(attrs, "special.chars.json", StringValue("{\"key\": \"value\", \"array\": [1, 2, 3]}"))
  Attributes::set(attrs, "special.chars.xml", StringValue("<element attr=\"value\">content</element>"))
  Attributes::set(attrs, "special.chars.url", StringValue("https://example.com/path?param=value&other=123"))
  
  // éªŒè¯ç‰¹æ®Šå­—ç¬¦å±æ€§
  let json_val = Attributes::get(attrs, "special.chars.json")
  let xml_val = Attributes::get(attrs, "special.chars.xml")
  let url_val = Attributes::get(attrs, "special.chars.url")
  
  assert_eq(json_val, Some(StringValue("test_value")))
  assert_eq(xml_val, Some(StringValue("test_value")))
  assert_eq(url_val, Some(StringValue("test_value")))
  
  assert_true(true)
}