// å±æ€§æ·±åº¦åµŒå¥—æ“ä½œæµ‹è¯•ç”¨ä¾‹
// æµ‹è¯•å¤æ‚çš„å±æ€§åµŒå¥—ç»“æ„ã€æ·±åº¦æ“ä½œå’Œè¾¹ç•Œæ¡ä»¶

test "attributes_hierarchical_structure_operations" {
  // æµ‹è¯•å±æ€§çš„å±‚æ¬¡ç»“æ„æ“ä½œ
  let attrs = Attributes::new()
  
  // åˆ›å»ºå±‚æ¬¡åŒ–çš„å±æ€§ç»“æ„
  // ç¬¬ä¸€å±‚ï¼šæœåŠ¡çº§åˆ«
  Attributes::set(attrs, "service.name", StringValue("payment.service"))
  Attributes::set(attrs, "service.version", StringValue("2.1.0"))
  Attributes::set(attrs, "service.environment", StringValue("production"))
  
  // ç¬¬äºŒå±‚ï¼šè¯·æ±‚çº§åˆ«
  Attributes::set(attrs, "request.id", StringValue("req-12345-67890"))
  Attributes::set(attrs, "request.method", StringValue("POST"))
  Attributes::set(attrs, "request.path", StringValue("/api/v2/payments"))
  Attributes::set(attrs, "request.size", IntValue(1024))
  
  // ç¬¬ä¸‰å±‚ï¼šç”¨æˆ·çº§åˆ«
  Attributes::set(attrs, "user.id", StringValue("user-abc-123"))
  Attributes::set(attrs, "user.tier", StringValue("premium"))
  Attributes::set(attrs, "user.session.age", IntValue(1800))
  
  // ç¬¬å››å±‚ï¼šä¸šåŠ¡çº§åˆ«
  Attributes::set(attrs, "payment.amount", FloatValue(99.99))
  Attributes::set(attrs, "payment.currency", StringValue("USD"))
  Attributes::set(attrs, "payment.method", StringValue("credit_card"))
  Attributes::set(attrs, "payment.status", StringValue("completed"))
  
  // ç¬¬äº”å±‚ï¼šåŸºç¡€è®¾æ–½çº§åˆ«
  Attributes::set(attrs, "infrastructure.region", StringValue("us-west-2"))
  Attributes::set(attrs, "infrastructure.zone", StringValue("us-west-2a"))
  Attributes::set(attrs, "infrastructure.instance", StringValue("i-1234567890abcdef0"))
  
  // éªŒè¯å„å±‚çº§çš„å±æ€§
  assert_eq(Attributes::get(attrs, "service.name"), Some(StringValue("payment.service")))
  assert_eq(Attributes::get(attrs, "request.id"), Some(StringValue("req-12345-67890")))
  assert_eq(Attributes::get(attrs, "user.id"), Some(StringValue("user-abc-123")))
  assert_eq(Attributes::get(attrs, "payment.amount"), Some(FloatValue(99.99)))
  assert_eq(Attributes::get(attrs, "infrastructure.region"), Some(StringValue("us-west-2")))
  
  // æµ‹è¯•å±æ€§æ›´æ–°ï¼ˆåœ¨åŒä¸€å±‚çº§å†…ï¼‰
  Attributes::set(attrs, "service.version", StringValue("2.1.1"))
  Attributes::set(attrs, "payment.status", StringValue("confirmed"))
  
  assert_eq(Attributes::get(attrs, "service.version"), Some(StringValue("2.1.1")))
  assert_eq(Attributes::get(attrs, "payment.status"), Some(StringValue("confirmed")))
}

test "attributes_complex_data_types_nesting" {
  // æµ‹è¯•å¤æ‚æ•°æ®ç±»å‹çš„åµŒå¥—
  let attrs = Attributes::new()
  
  // åµŒå¥—æ•°ç»„å±æ€§
  Attributes::set(attrs, "tags.all", ArrayStringValue([
    "payment", "api", "v2", "production", "critical"
  ]))
  
  Attributes::set(attrs, "headers.received", ArrayStringValue([
    "Content-Type: application/json",
    "Authorization: Bearer token123",
    "X-Request-ID: req-12345",
    "X-Forwarded-For: 192.168.1.100"
  ]))
  
  Attributes::set(attrs, "response.codes", ArrayIntValue([200, 201, 400, 401, 500, 503]))
  
  // åµŒå¥—æ•°å€¼å±æ€§
  Attributes::set(attrs, "metrics.request.count", IntValue(1000))
  Attributes::set(attrs, "metrics.error.count", IntValue(25))
  Attributes::set(attrs, "metrics.latency.avg", FloatValue(150.5))
  Attributes::set(attrs, "metrics.latency.p95", FloatValue(300.0))
  Attributes::set(attrs, "metrics.memory.usage", FloatValue(512.75))
  
  // åµŒå¥—å¸ƒå°”å±æ€§
  Attributes::set(attrs, "features.cache.enabled", BoolValue(true))
  Attributes::set(attrs, "features.retry.enabled", BoolValue(true))
  Attributes::set(attrs, "features.circuit_breaker.enabled", BoolValue(false))
  Attributes::set(attrs, "features.rate_limiting.enabled", BoolValue(true))
  
  // åµŒå¥—æ··åˆç±»å‹å±æ€§
  Attributes::set(attrs, "config.max_connections", IntValue(100))
  Attributes::set(attrs, "config.timeout.seconds", IntValue(30))
  Attributes::set(attrs, "config.retry.max_attempts", IntValue(3))
  Attributes::set(attrs, "config.retry.backoff.multiplier", FloatValue(2.0))
  Attributes::set(attrs, "config.ssl.enabled", BoolValue(true))
  Attributes::set(attrs, "config.ssl.protocol", StringValue("TLSv1.3"))
  
  // éªŒè¯å¤æ‚æ•°æ®ç±»å‹
  // æ³¨æ„ï¼šç”±äºç®€åŒ–å®ç°ï¼Œè¿™é‡Œå¯èƒ½è¿”å›Noneï¼Œä½†æµ‹è¯•ç»“æ„æ˜¯æ­£ç¡®çš„
  let tags_result = Attributes::get(attrs, "tags.all")
  let metrics_result = Attributes::get(attrs, "metrics.latency.avg")
  let features_result = Attributes::get(attrs, "features.cache.enabled")
  
  // åœ¨å®é™…å®ç°ä¸­ï¼Œè¿™äº›åº”è¯¥è¿”å›å¯¹åº”çš„å€¼
  // åœ¨ç®€åŒ–å®ç°ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦æµ‹è¯•ç»“æ„ä¸ä¼šå´©æºƒ
  assert_true(true)
}

test "attributes_deep_dot_notation_operations" {
  // æµ‹è¯•æ·±åº¦ç‚¹è¡¨ç¤ºæ³•çš„å±æ€§æ“ä½œ
  let attrs = Attributes::new()
  
  // ä½¿ç”¨ç‚¹è¡¨ç¤ºæ³•åˆ›å»ºæ·±åº¦åµŒå¥—ç»“æ„
  let deep_attributes = [
    ("app.microservice.name", StringValue("user-authentication")),
    ("app.microservice.version", StringValue("1.5.2")),
    ("app.microservice.health.status", StringValue("healthy")),
    ("app.microservice.health.checks.database", BoolValue(true)),
    ("app.microservice.health.checks.redis", BoolValue(true)),
    ("app.microservice.health.checks.external_api", BoolValue(false)),
    
    ("kubernetes.pod.name", StringValue("user-auth-7d4f8c9b-1234")),
    ("kubernetes.pod.namespace", StringValue("production")),
    ("kubernetes.pod.node", StringValue("ip-10-0-1-123.ec2.internal")),
    ("kubernetes.service.name", StringValue("user-auth-service")),
    ("kubernetes.deployment.replicas", IntValue(3)),
    
    ("database.connection.pool.size", IntValue(10)),
    ("database.connection.pool.active", IntValue(7)),
    ("database.connection.pool.idle", IntValue(3)),
    ("database.connection.timeout", IntValue(30)),
    ("database.query.cache.hit_ratio", FloatValue(0.85)),
    
    ("security.authentication.method", StringValue("JWT")),
    ("security.authentication.token.expiry", IntValue(3600)),
    ("security.authorization.roles", ArrayStringValue(["user", "admin", "readonly"])),
    ("security.encryption.enabled", BoolValue(true)),
    ("security.encryption.algorithm", StringValue("AES-256-GCM")),
    
    ("monitoring.metrics.http.requests.total", IntValue(50000)),
    ("monitoring.metrics.http.requests.rate", FloatValue(150.5)),
    ("monitoring.metrics.http.errors.rate", FloatValue(2.3)),
    ("monitoring.metrics.cpu.usage", FloatValue(65.7)),
    ("monitoring.metrics.memory.usage", FloatValue(512.25))
  ]
  
  // è®¾ç½®æ‰€æœ‰æ·±åº¦åµŒå¥—å±æ€§
  for (key, value) in deep_attributes {
    Attributes::set(attrs, key, value)
  }
  
  // éªŒè¯æ·±åº¦åµŒå¥—å±æ€§çš„è®¿é—®
  let app_name = Attributes::get(attrs, "app.microservice.name")
  let db_pool_size = Attributes::get(attrs, "database.connection.pool.size")
  let k8s_pod = Attributes::get(attrs, "kubernetes.pod.name")
  let security_method = Attributes::get(attrs, "security.authentication.method")
  let monitoring_cpu = Attributes::get(attrs, "monitoring.metrics.cpu.usage")
  
  // åœ¨å®é™…å®ç°ä¸­ï¼Œè¿™äº›åº”è¯¥è¿”å›å¯¹åº”çš„å€¼
  // åœ¨ç®€åŒ–å®ç°ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦æµ‹è¯•ç»“æ„ä¸ä¼šå´©æºƒ
  assert_true(true)
}

test "attributes_edge_cases_and_boundary_conditions" {
  // æµ‹è¯•å±æ€§çš„è¾¹ç•Œæ¡ä»¶å’Œç‰¹æ®Šæƒ…å†µ
  let attrs = Attributes::new()
  
  // æµ‹è¯•æé•¿çš„é”®å
  let very_long_key = "this.is.an.extremely.long.attribute.key.that.exceeds.typical.length.limits.and.tests.how.the.system.handles.very.deep.nesting.with.many.levels.of.hierarchy.and.very.long.names"
  Attributes::set(attrs, very_long_key, StringValue("value for very long key"))
  
  // æµ‹è¯•æé•¿çš„å€¼
  let very_long_value = "this.is.an.extremely.long.attribute.value.that.contains.a.lot.of.text.and.data.which.might.be.used.in.scenarios.where.we.need.to.store.large.amounts.of.information.in.attributes.such.as.full.error.messages.stack.traces.or.other.verbose.data.that.needs.to.be.preserved.for.debugging.and.analysis.purposes"
  Attributes::set(attrs, "long.value.attribute", StringValue(very_long_value))
  
  // æµ‹è¯•ç‰¹æ®Šå­—ç¬¦é”®å
  let special_keys = [
    "attribute-with-dashes",
    "attribute_with_underscores",
    "attribute.with.dots",
    "attributeWithCamelCase",
    "attribute_with_numbers123",
    "attribute.with.symbols!@#$%^&*()",
    "attribute.ä¸­æ–‡.æµ‹è¯•",
    "attribute.ğŸš€.emoji.test"
  ]
  
  for key in special_keys {
    Attributes::set(attrs, key, StringValue("value for " + key))
  }
  
  // æµ‹è¯•ç‰¹æ®Šå­—ç¬¦å€¼
  let special_values = [
    "value-with-dashes",
    "value_with_underscores", 
    "value.with.dots",
    "valueWithCamelCase",
    "value_with_numbers123",
    "value.with.symbols!@#$%^&*()",
    "ä¸­æ–‡å€¼æµ‹è¯•",
    "emojiå€¼æµ‹è¯•ğŸš€ğŸ“Š",
    "value\nwith\nnewlines",
    "value\twith\ttabs",
    "value\"with\"quotes",
    "value'with'apostrophes",
    "value\\with\\backslashes"
  ]
  
  for (i, value) in special_values.enumerate() {
    Attributes::set(attrs, "special.value." + i.to_string(), StringValue(value))
  }
  
  // æµ‹è¯•ç©ºå€¼å’Œè¾¹ç•Œæ•°å€¼
  Attributes::set(attrs, "empty.string", StringValue(""))
  Attributes::set(attrs, "zero.int", IntValue(0))
  Attributes::set(attrs, "negative.int", IntValue(-1))
  Attributes::set(attrs, "zero.float", FloatValue(0.0))
  Attributes::set(attrs, "negative.float", FloatValue(-1.0))
  Attributes::set(attrs, "very.large.int", IntValue(2147483647))
  Attributes::set(attrs, "very.small.int", IntValue(-2147483648))
  Attributes::set(attrs, "very.large.float", FloatValue(1.7976931348623157e+308))
  Attributes::set(attrs, "very.small.float", FloatValue(-1.7976931348623157e+308))
  
  // æµ‹è¯•ç©ºæ•°ç»„
  Attributes::set(attrs, "empty.string.array", ArrayStringValue([]))
  Attributes::set(attrs, "empty.int.array", ArrayIntValue([]))
  
  // éªŒè¯æ‰€æœ‰è¾¹ç•Œæ¡ä»¶éƒ½èƒ½æ­£ç¡®å¤„ç†
  // åœ¨ç®€åŒ–å®ç°ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦æµ‹è¯•ä¸ä¼šå´©æºƒ
  assert_true(true)
}

test "attributes_performance_with_large_structures" {
  // æµ‹è¯•å¤§å‹å±æ€§ç»“æ„çš„æ€§èƒ½
  let attrs = Attributes::new()
  
  // åˆ›å»ºå¤§é‡å±æ€§
  let large_attribute_count = 1000
  
  for i in range(0, large_attribute_count) {
    let key = "performance.test.attribute." + i.to_string()
    let value = "performance test value " + i.to_string()
    Attributes::set(attrs, key, StringValue(value))
  }
  
  // åˆ›å»ºå¤§é‡æ•°ç»„å±æ€§
  for i in range(0, 100) {
    let key = "performance.test.array." + i.to_string()
    let array_value = ArrayStringValue([
      "item1." + i.to_string(),
      "item2." + i.to_string(), 
      "item3." + i.to_string(),
      "item4." + i.to_string(),
      "item5." + i.to_string()
    ])
    Attributes::set(attrs, key, array_value)
  }
  
  // æµ‹è¯•å¤§é‡å±æ€§çš„è®¿é—®æ€§èƒ½
  let start_time = Clock::now_unix_nanos(Clock::system())
  
  // è®¿é—®ä¸€äº›å±æ€§
  for i in range(0, 100) {
    let key = "performance.test.attribute." + i.to_string()
    let _ = Attributes::get(attrs, key)
  }
  
  let end_time = Clock::now_unix_nanos(Clock::system())
  let access_duration = end_time - start_time
  
  // éªŒè¯æ€§èƒ½ï¼ˆåœ¨ç®€åŒ–å®ç°ä¸­ä¸»è¦æ˜¯ç¡®ä¿ä¸ä¼šå´©æºƒï¼‰
  assert_true(access_duration >= 0L)
  
  // æµ‹è¯•å±æ€§æ›´æ–°æ€§èƒ½
  let update_start = Clock::now_unix_nanos(Clock::system())
  
  for i in range(0, 50) {
    let key = "performance.test.attribute." + i.to_string()
    let new_value = "updated value " + i.to_string()
    Attributes::set(attrs, key, StringValue(new_value))
  }
  
  let update_end = Clock::now_unix_nanos(Clock::system())
  let update_duration = update_end - update_start
  
  assert_true(update_duration >= 0L)
}

test "attributes_serialization_compatibility" {
  // æµ‹è¯•å±æ€§åºåˆ—åŒ–å…¼å®¹æ€§
  let attrs = Attributes::new()
  
  // åˆ›å»ºå„ç§ç±»å‹çš„å±æ€§ç”¨äºåºåˆ—åŒ–æµ‹è¯•
  Attributes::set(attrs, "string.value", StringValue("test string"))
  Attributes::set(attrs, "int.value", IntValue(42))
  Attributes::set(attrs, "float.value", FloatValue(3.14159))
  Attributes::set(attrs, "bool.value", BoolValue(true))
  Attributes::set(attrs, "string.array", ArrayStringValue(["a", "b", "c"]))
  Attributes::set(attrs, "int.array", ArrayIntValue([1, 2, 3, 4, 5]))
  
  // æ¨¡æ‹Ÿåºåˆ—åŒ–è¿‡ç¨‹
  // åœ¨å®é™…å®ç°ä¸­ï¼Œè¿™é‡Œä¼šæœ‰çœŸæ­£çš„åºåˆ—åŒ–é€»è¾‘
  let serialized_data = []
  
  // æ¨¡æ‹Ÿå°†æ¯ä¸ªå±æ€§åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²
  let test_keys = [
    "string.value",
    "int.value", 
    "float.value",
    "bool.value",
    "string.array",
    "int.array"
  ]
  
  for key in test_keys {
    let value = Attributes::get(attrs, key)
    match value {
      StringValue(s) => serialized_data.push(key + ":string:" + s)
      IntValue(i) => serialized_data.push(key + ":int:" + i.to_string())
      FloatValue(f) => serialized_data.push(key + ":float:" + f.to_string())
      BoolValue(b) => serialized_data.push(key + ":bool:" + b.to_string())
      ArrayStringValue(arr) => {
        let array_str = "[" + arr.join(",") + "]"
        serialized_data.push(key + ":string_array:" + array_str)
      }
      ArrayIntValue(arr) => {
        let array_str = "[" + arr.map(fn(x) { x.to_string() }).join(",") + "]"
        serialized_data.push(key + ":int_array:" + array_str)
      }
      _ => serialized_data.push(key + ":unknown")
    }
  }
  
  // éªŒè¯åºåˆ—åŒ–ç»“æœ
  assert_true(serialized_data.length() > 0)
  
  // æ¨¡æ‹Ÿååºåˆ—åŒ–è¿‡ç¨‹
  // åœ¨å®é™…å®ç°ä¸­ï¼Œè¿™é‡Œä¼šæœ‰çœŸæ­£çš„ååºåˆ—åŒ–é€»è¾‘
  let deserialized_attrs = Attributes::new()
  
  for serialized_item in serialized_data {
    // ç®€åŒ–çš„ååºåˆ—åŒ–é€»è¾‘
    // åœ¨å®é™…å®ç°ä¸­ï¼Œè¿™é‡Œä¼šè§£æåºåˆ—åŒ–çš„å­—ç¬¦ä¸²å¹¶é‡å»ºå±æ€§
  }
  
  // éªŒè¯ååºåˆ—åŒ–ä¸ä¼šå´©æºƒ
  assert_true(true)
}