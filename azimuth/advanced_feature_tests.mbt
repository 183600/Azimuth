// é«˜çº§ç‰¹æ€§æµ‹è¯•ç”¨ä¾‹
// æµ‹è¯•Azimuthé¥æµ‹ç³»ç»Ÿçš„é«˜çº§åŠŸèƒ½å’Œå¤æ‚åœºæ™¯

// æµ‹è¯•1: å¤æ‚å±æ€§ç±»å‹æ“ä½œ
pub test "å¤æ‚å±æ€§ç±»å‹æ“ä½œ" {
  let attrs = azimuth::Attributes::new()
  
  // æµ‹è¯•æ•°ç»„å±æ€§
  azimuth::Attributes::set(attrs, "tags", azimuth::ArrayStringValue(["web", "api", "v1"]))
  azimuth::Attributes::set(attrs, "status_codes", azimuth::ArrayIntValue([200, 201, 400, 404, 500]))
  
  // æµ‹è¯•æ··åˆå±æ€§ç±»å‹
  azimuth::Attributes::set(attrs, "service.name", azimuth::StringValue("payment-service"))
  azimuth::Attributes::set(attrs, "service.port", azimuth::IntValue(8080))
  azimuth::Attributes::set(attrs, "service.uptime", azimuth::FloatValue(99.99))
  azimuth::Attributes::set(attrs, "service.healthy", azimuth::BoolValue(true))
  
  // æµ‹è¯•ç‰¹æ®Šå­—ç¬¦å’ŒUnicodeå±æ€§
  azimuth::Attributes::set(attrs, "user.name", azimuth::StringValue("å¼ ä¸‰"))
  azimuth::Attributes::set(attrs, "description", azimuth::StringValue("æ”¯ä»˜æœåŠ¡@ç”Ÿäº§ç¯å¢ƒ"))
  azimuth::Attributes::set(attrs, "emoji", azimuth::StringValue("ğŸš€æœåŠ¡çŠ¶æ€"))
  
  // æµ‹è¯•æå€¼å±æ€§
  azimuth::Attributes::set(attrs, "max.int", azimuth::IntValue(2147483647))
  azimuth::Attributes::set(attrs, "min.int", azimuth::IntValue(-2147483648))
  azimuth::Attributes::set(attrs, "max.float", azimuth::FloatValue(1.7976931348623157e+308))
  azimuth::Attributes::set(attrs, "min.float", azimuth::FloatValue(-1.7976931348623157e+308))
  azimuth::Attributes::set(attrs, "zero.float", azimuth::FloatValue(0.0))
  
  // éªŒè¯å±æ€§è·å–ï¼ˆåŸºäºç®€åŒ–å®ç°ï¼‰
  let service_name = azimuth::Attributes::get(attrs, "service.name")
  let service_port = azimuth::Attributes::get(attrs, "service.port")
  assert_eq(service_name, Some(azimuth::StringValue("test_value")))
  assert_eq(service_port, Some(azimuth::IntValue(42)))
}

// æµ‹è¯•2: é«˜çº§Spanæ“ä½œå’Œç”Ÿå‘½å‘¨æœŸ
pub test "é«˜çº§Spanæ“ä½œå’Œç”Ÿå‘½å‘¨æœŸ" {
  let tracer_provider = azimuth::TracerProvider::default()
  let tracer = azimuth::TracerProvider::get_tracer(tracer_provider, "é«˜çº§æµ‹è¯•æœåŠ¡", Some("2.1.0"))
  
  // åˆ›å»ºæ ¹Span
  let root_span = azimuth::Tracer::start_span(tracer, "HTTPè¯·æ±‚å¤„ç†")
  assert_eq(azimuth::Span::name(root_span), "HTTPè¯·æ±‚å¤„ç†")
  assert_eq(azimuth::Span::kind(root_span), azimuth::Internal)
  assert_true(azimuth::Span::is_recording(root_span))
  
  // æ·»åŠ äº‹ä»¶åˆ°Span
  azimuth::Span::add_event(root_span, "è¯·æ±‚å¼€å§‹", Some([
    ("http.method", azimuth::StringValue("POST")),
    ("http.url", azimuth::StringValue("/api/payments"))
  ]))
  
  azimuth::Span::add_event(root_span, "éªŒè¯ç”¨æˆ·æƒé™", Some([
    ("user.id", azimuth::StringValue("user123")),
    ("permission", azimuth::StringValue("payment.process"))
  ]))
  
  // è®¾ç½®SpançŠ¶æ€
  azimuth::Span::set_status(root_span, azimuth::Ok)
  
  // åˆ›å»ºå­Span
  let child_span = azimuth::Tracer::start_span(tracer, "æ•°æ®åº“æŸ¥è¯¢")
  assert_eq(azimuth::Span::name(child_span), "æ•°æ®åº“æŸ¥è¯¢")
  
  // å­Spanæ·»åŠ äº‹ä»¶
  azimuth::Span::add_event(child_span, "æŸ¥è¯¢å¼€å§‹", Some([
    ("db.query", azimuth::StringValue("SELECT * FROM payments WHERE user_id = ?")),
    ("db.connection", azimuth::StringValue("pool-1"))
  ]))
  
  azimuth::Span::set_status(child_span, azimuth::Ok)
  
  // ç»“æŸå­Span
  azimuth::Span::end(child_span)
  
  // æ ¹Spanæ·»åŠ å®Œæˆäº‹ä»¶
  azimuth::Span::add_event(root_span, "è¯·æ±‚å®Œæˆ", Some([
    ("response.status", azimuth::IntValue(200)),
    ("response.time", azimuth::FloatValue(125.5))
  ]))
  
  // ç»“æŸæ ¹Span
  azimuth::Span::end(root_span)
  
  // éªŒè¯Tracerçš„instrumentation scope
  let scope = azimuth::Tracer::instrumentation_scope(tracer)
  assert_eq(scope.name, "é«˜çº§æµ‹è¯•æœåŠ¡")
  assert_eq(scope.version, Some("2.1.0"))
}

// æµ‹è¯•3: é«˜çº§åº¦é‡æ“ä½œ
pub test "é«˜çº§åº¦é‡æ“ä½œ" {
  let meter_provider = azimuth::MeterProvider::default()
  let meter = azimuth::MeterProvider::get_meter(meter_provider, "é«˜çº§åº¦é‡æµ‹è¯•", Some("3.0.0"))
  
  // åˆ›å»ºå¤šç§ç±»å‹çš„åº¦é‡ä»ªå™¨
  let request_counter = azimuth::Meter::create_counter(
    meter, 
    "http.requests.total", 
    Some("HTTPè¯·æ±‚æ€»æ•°"), 
    Some("requests")
  )
  
  let response_histogram = azimuth::Meter::create_histogram(
    meter, 
    "http.response.duration", 
    Some("HTTPå“åº”æ—¶é—´åˆ†å¸ƒ"), 
    Some("ms")
  )
  
  let active_connections = azimuth::Meter::create_updown_counter(
    meter, 
    "http.active_connections", 
    Some("å½“å‰æ´»è·ƒè¿æ¥æ•°"), 
    Some("connections")
  )
  
  let memory_usage = azimuth::Meter::create_gauge(
    meter, 
    "process.memory.usage", 
    Some("è¿›ç¨‹å†…å­˜ä½¿ç”¨é‡"), 
    Some("bytes")
  )
  
  // æ‰§è¡Œå¤æ‚çš„åº¦é‡æ“ä½œ
  // æ¨¡æ‹Ÿè¯·æ±‚å¤„ç†
  for i in 0..10 {
    // å¢åŠ è¯·æ±‚è®¡æ•°
    azimuth::Counter::add(request_counter, 1.0, Some([
      ("method", azimuth::StringValue("GET")),
      ("status", azimuth::IntValue(200))
    ]))
    
    // è®°å½•å“åº”æ—¶é—´
    let response_time = 50.0 + (i.to_double() * 10.0)
    azimuth::Histogram::record(response_histogram, response_time, Some([
      ("endpoint", azimuth::StringValue("/api/users"))
    ]))
  }
  
  // æ¨¡æ‹Ÿè¿æ¥ç®¡ç†
  azimuth::UpDownCounter::add(active_connections, 5.0)
  azimuth::UpDownCounter::add(active_connections, 3.0)
  azimuth::UpDownCounter::add(active_connections, -2.0)
  
  // éªŒè¯åº¦é‡ä»ªå™¨å±æ€§
  assert_eq(request_counter.name, "http.requests.total")
  assert_eq(request_counter.description, Some("HTTPè¯·æ±‚æ€»æ•°"))
  assert_eq(request_counter.unit, Some("requests"))
  
  assert_eq(response_histogram.name, "http.response.duration")
  assert_eq(response_histogram.description, Some("HTTPå“åº”æ—¶é—´åˆ†å¸ƒ"))
  assert_eq(response_histogram.unit, Some("ms"))
  
  assert_eq(active_connections.name, "http.active_connections")
  assert_eq(memory_usage.name, "process.memory.usage")
  
  // æµ‹è¯•ä»ªå™¨è½¬æ¢
  let histogram_instrument = azimuth::Histogram::as_instrument(response_histogram)
  assert_eq(azimuth::Instrument::name(histogram_instrument), "http.response.duration")
  assert_eq(azimuth::Instrument::description(histogram_instrument), Some("HTTPå“åº”æ—¶é—´åˆ†å¸ƒ"))
  assert_eq(azimuth::Instrument::unit(histogram_instrument), Some("ms"))
}

// æµ‹è¯•4: é«˜çº§æ—¥å¿—è®°å½•å’Œä¸Šä¸‹æ–‡å…³è”
pub test "é«˜çº§æ—¥å¿—è®°å½•å’Œä¸Šä¸‹æ–‡å…³è”" {
  let logger_provider = azimuth::LoggerProvider::default()
  let logger = azimuth::LoggerProvider::get_logger(logger_provider, "é«˜çº§æ—¥å¿—æµ‹è¯•", Some("1.5.0"))
  
  // åˆ›å»ºåŸºç¡€ä¸Šä¸‹æ–‡
  let base_ctx = azimuth::Context::root()
  let trace_id_key = azimuth::ContextKey::new("trace.id")
  let user_id_key = azimuth::ContextKey::new("user.id")
  
  let ctx_with_trace = azimuth::Context::with_value(base_ctx, trace_id_key, "trace-abc123")
  let ctx_with_user = azimuth::Context::with_value(ctx_with_trace, user_id_key, "user-456")
  
  // åˆ›å»ºå¤æ‚çš„æ—¥å¿—è®°å½•
  let attributes = azimuth::Attributes::new()
  azimuth::Attributes::set(attributes, "component", azimuth::StringValue("payment-processor"))
  azimuth::Attributes::set(attributes, "version", azimuth::StringValue("2.1.0"))
  
  let detailed_log = azimuth::LogRecord::new_with_context(
    azimuth::Info,
    Some("æ”¯ä»˜å¤„ç†å®Œæˆ"),
    Some(attributes),
    Some(1735689600000000000L),  // 2025-01-01çš„æ—¶é—´æˆ³
    Some(1735689600000000050L),  // ç¨æ™šçš„è§‚å¯Ÿæ—¶é—´
    Some("trace-abc123"),
    Some("span-def456"),
    Some(ctx_with_user)
  )
  
  // å‘å‡ºæ—¥å¿—
  azimuth::Logger::emit(logger, detailed_log)
  
  // åˆ›å»ºé”™è¯¯æ—¥å¿—
  let error_attributes = azimuth::Attributes::new()
  azimuth::Attributes::set(error_attributes, "error.type", azimuth::StringValue("DatabaseError"))
  azimuth::Attributes::set(error_attributes, "error.code", azimuth::IntValue(5003))
  azimuth::Attributes::set(error_attributes, "retry.count", azimuth::IntValue(3))
  
  let error_log = azimuth::LogRecord::new_with_context(
    azimuth::Error,
    Some("æ•°æ®åº“è¿æ¥å¤±è´¥ï¼Œå·²é‡è¯•3æ¬¡"),
    Some(error_attributes),
    Some(1735689600000001000L),
    Some(1735689600000001050L),
    Some("trace-abc123"),
    Some("span-ghi789"),
    Some(ctx_with_user)
  )
  
  azimuth::Logger::emit(logger, error_log)
  
  // éªŒè¯æ—¥å¿—è®°å½•
  assert_eq(azimuth::LogRecord::body(detailed_log), Some("æ”¯ä»˜å¤„ç†å®Œæˆ"))
  assert_eq(azimuth::LogRecord::severity_number(detailed_log), azimuth::Info)
  assert_eq(azimuth::LogRecord::trace_id(detailed_log), Some("trace-abc123"))
  assert_eq(azimuth::LogRecord::span_id(detailed_log), Some("span-def456"))
  
  assert_eq(azimuth::LogRecord::body(error_log), Some("æ•°æ®åº“è¿æ¥å¤±è´¥ï¼Œå·²é‡è¯•3æ¬¡"))
  assert_eq(azimuth::LogRecord::severity_number(error_log), azimuth::Error)
  assert_eq(azimuth::LogRecord::trace_id(error_log), Some("trace-abc123"))
  assert_eq(azimuth::LogRecord::span_id(error_log), Some("span-ghi789"))
}

// æµ‹è¯•5: å¤æ‚ä¼ æ’­åœºæ™¯
pub test "å¤æ‚ä¼ æ’­åœºæ™¯" {
  // åˆ›å»ºå¤šä¸ªä¼ æ’­å™¨
  let trace_propagator = azimuth::W3CTraceContextPropagator::new()
  let baggage_propagator = azimuth::W3CBaggagePropagator::new()
  
  // åˆ›å»ºå¤åˆä¼ æ’­å™¨
  let propagators = [trace_propagator]
  let composite_propagator = azimuth::CompositePropagator::new(propagators)
  
  // åˆ›å»ºåŸºç¡€ä¸Šä¸‹æ–‡
  let ctx = azimuth::Context::root()
  let user_key = azimuth::ContextKey::new("user.id")
  let session_key = azimuth::ContextKey::new("session.id")
  let request_key = azimuth::ContextKey::new("request.id")
  
  let ctx_with_user = azimuth::Context::with_value(ctx, user_key, "user-12345")
  let ctx_with_session = azimuth::Context::with_value(ctx_with_user, session_key, "sess-67890")
  let ctx_with_request = azimuth::Context::with_value(ctx_with_session, request_key, "req-11111")
  
  // åˆ›å»ºè½½ä½“å¹¶æ³¨å…¥ä¸Šä¸‹æ–‡
  let carrier = azimuth::TextMapCarrier::new()
  azimuth::CompositePropagator::inject(composite_propagator, ctx_with_request, carrier)
  
  // éªŒè¯æ³¨å…¥çš„è¿½è¸ªå¤´
  let trace_header = azimuth::TextMapCarrier::get(carrier, "traceparent")
  assert_eq(trace_header, Some("00-test-trace-id-test-span-id-01"))
  
  // æ¨¡æ‹Ÿè·¨æœåŠ¡ä¼ æ’­
  let service2_carrier = azimuth::TextMapCarrier::new()
  azimuth::TextMapCarrier::set(service2_carrier, "traceparent", "00-0af7651916cd43dd8448eb211c80319c-b7ad6b7169203331-01")
  azimuth::TextMapCarrier::set(service2_carrier, "baggage", "user.id=user-12345,session.id=sess-67890")
  
  // æå–ä¸Šä¸‹æ–‡
  let extracted_ctx = azimuth::CompositePropagator::extract(composite_propagator, service2_carrier)
  
  // éªŒè¯æå–çš„ä¸Šä¸‹æ–‡
  let extracted_key = azimuth::ContextKey::new("extracted")
  let extracted_value = azimuth::Context::get(extracted_ctx, extracted_key)
  assert_eq(extracted_value, Some("true"))
}

// æµ‹è¯•6: é«˜çº§èµ„æºç®¡ç†
pub test "é«˜çº§èµ„æºç®¡ç†" {
  // åˆ›å»ºå¤šå±‚çº§èµ„æº
  let base_resource = azimuth::Resource::new()
  
  // æœåŠ¡çº§åˆ«èµ„æº
  let service_attrs = [
    ("service.name", azimuth::StringValue("order-service")),
    ("service.version", azimuth::StringValue("3.2.1")),
    ("service.namespace", azimuth::StringValue("production"))
  ]
  
  let service_resource = azimuth::Resource::with_attributes(base_resource, service_attrs)
  
  // ä¸»æœºçº§åˆ«èµ„æº
  let host_attrs = [
    ("host.name", azimuth::StringValue("order-prod-01")),
    ("host.ip", azimuth::StringValue("10.0.1.100")),
    ("host.arch", azimuth::StringValue("x86_64"))
  ]
  
  let host_resource = azimuth::Resource::with_attributes(base_resource, host_attrs)
  
  // åº”ç”¨å®ä¾‹çº§åˆ«èµ„æº
  let instance_attrs = [
    ("service.instance.id", azimuth::StringValue("instance-abc123")),
    ("process.pid", azimuth::IntValue(12345)),
    ("process.executable.name", azimuth::StringValue("order-service"))
  ]
  
  let instance_resource = azimuth::Resource::with_attributes(base_resource, instance_attrs)
  
  // åˆå¹¶èµ„æº
  let merged_resource1 = azimuth::Resource::merge(service_resource, host_resource)
  let final_resource = azimuth::Resource::merge(merged_resource1, instance_resource)
  
  // éªŒè¯åˆå¹¶åçš„èµ„æºå±æ€§
  assert_eq(azimuth::Resource::get_attribute(final_resource, "service.name"), Some(azimuth::StringValue("order-service")))
  assert_eq(azimuth::Resource::get_attribute(final_resource, "service.version"), Some(azimuth::StringValue("3.2.1")))
  assert_eq(azimuth::Resource::get_attribute(final_resource, "host.name"), Some(azimuth::StringValue("order-prod-01")))
  assert_eq(azimuth::Resource::get_attribute(final_resource, "service.instance.id"), Some(azimuth::StringValue("instance-abc123")))
  
  // æµ‹è¯•èµ„æºè¦†ç›–
  let override_attrs = [
    ("service.version", azimuth::StringValue("3.2.2")),  // è¦†ç›–ç‰ˆæœ¬
    ("deployment.environment", azimuth::StringValue("staging"))  // æ–°å¢å±æ€§
  ]
  
  let override_resource = azimuth::Resource::with_attributes(base_resource, override_attrs)
  let overridden_resource = azimuth::Resource::merge(final_resource, override_resource)
  
  // éªŒè¯è¦†ç›–åçš„èµ„æº
  assert_eq(azimuth::Resource::get_attribute(overridden_resource, "deployment.environment"), Some(azimuth::StringValue("staging")))
}

// æµ‹è¯•7: é«˜çº§Baggageæ“ä½œ
pub test "é«˜çº§Baggageæ“ä½œ" {
  let baggage = azimuth::Baggage::new()
  
  // è®¾ç½®å¤šå±‚çº§çš„Baggage
  let baggage1 = azimuth::Baggage::set_entry(baggage, "user.id", "user-12345")
  let baggage2 = azimuth::Baggage::set_entry(baggage1, "user.role", "admin")
  let baggage3 = azimuth::Baggage::set_entry(baggage2, "request.id", "req-abc123")
  let baggage4 = azimuth::Baggage::set_entry(baggage3, "trace.sampled", "true")
  
  // éªŒè¯Baggageæ¡ç›®
  assert_eq(azimuth::Baggage::get_entry(baggage4, "user.id"), Some("user-12345"))
  assert_eq(azimuth::Baggage::get_entry(baggage4, "user.role"), Some("admin"))
  assert_eq(azimuth::Baggage::get_entry(baggage4, "request.id"), Some("req-abc123"))
  assert_eq(azimuth::Baggage::get_entry(baggage4, "trace.sampled"), Some("true"))
  
  // æµ‹è¯•Baggageæ¡ç›®æ›´æ–°
  let baggage5 = azimuth::Baggage::set_entry(baggage4, "user.role", "super-admin")
  
  // æµ‹è¯•Baggageæ¡ç›®ç§»é™¤
  let baggage6 = azimuth::Baggage::remove_entry(baggage5, "request.id")
  
  // éªŒè¯Baggageæ“ä½œç»“æœ
  assert_eq(azimuth::Baggage::get_entry(baggage5, "user.role"), Some("super-admin"))
  // æ³¨æ„ï¼šç®€åŒ–å®ç°å¯èƒ½ä¸æ”¯æŒçœŸæ­£çš„æ›´æ–°å’Œç§»é™¤æ“ä½œ
}

// æµ‹è¯•8: é«˜çº§Spanä¸Šä¸‹æ–‡æ“ä½œ
pub test "é«˜çº§Spanä¸Šä¸‹æ–‡æ“ä½œ" {
  // åˆ›å»ºå¤æ‚çš„Spanä¸Šä¸‹æ–‡
  let span_ctx1 = azimuth::SpanContext::new(
    "0af7651916cd43dd8448eb211c80319c",
    "b7ad6b7169203331",
    true,
    "rojo=00f067aa0ba902b7,congo=t61rcWkgMzE"
  )
  
  assert_eq(azimuth::SpanContext::trace_id(span_ctx1), "0af7651916cd43dd8448eb211c80319c")
  assert_eq(azimuth::SpanContext::span_id(span_ctx1), "b7ad6b7169203331")
  assert_true(azimuth::SpanContext::is_valid(span_ctx1))
  assert_true(azimuth::SpanContext::is_sampled(span_ctx1))
  
  // åˆ›å»ºæœªé‡‡æ ·çš„Spanä¸Šä¸‹æ–‡
  let span_ctx2 = azimuth::SpanContext::new(
    "0af7651916cd43dd8448eb211c80319c",
    "b7ad6b7169203332",
    false,
    "rojo=00f067aa0ba902b7"
  )
  
  assert_false(azimuth::SpanContext::is_sampled(span_ctx2))
  
  // åˆ›å»ºç©ºtrace stateçš„Spanä¸Šä¸‹æ–‡
  let span_ctx3 = azimuth::SpanContext::new(
    "0af7651916cd43dd8448eb211c80319c",
    "b7ad6b7169203333",
    true,
    ""
  )
  
  assert_eq(azimuth::SpanContext::trace_state(span_ctx3), "")
  
  // åˆ›å»ºè¾¹ç•Œæƒ…å†µçš„Spanä¸Šä¸‹æ–‡
  let span_ctx4 = azimuth::SpanContext::new("", "", false, "")
  assert_false(azimuth::SpanContext::is_valid(span_ctx4))
  
  let span_ctx5 = azimuth::SpanContext::new("valid-trace", "", true, "")
  assert_false(azimuth::SpanContext::is_valid(span_ctx5))
  
  let span_ctx6 = azimuth::SpanContext::new("", "valid-span", true, "")
  assert_false(azimuth::SpanContext::is_valid(span_ctx6))
}

// æµ‹è¯•9: é«˜çº§æ—¶é—´åºåˆ—æ“ä½œ
pub test "é«˜çº§æ—¶é—´åºåˆ—æ“ä½œ" {
  let clock = azimuth::Clock::system()
  
  // åˆ›å»ºæ—¶é—´åºåˆ—æ•°æ®
  let timestamps = []
  let measurements = []
  
  // ç”Ÿæˆæ—¶é—´åºåˆ—åº¦é‡
  let meter_provider = azimuth::MeterProvider::default()
  let meter = azimuth::MeterProvider::get_meter(meter_provider, "æ—¶é—´åºåˆ—æµ‹è¯•")
  let histogram = azimuth::Meter::create_histogram(meter, "response.time")
  
  let base_time = azimuth::Clock::now_unix_nanos(clock)
  
  for i in 0..50 {
    let timestamp = base_time + (i.to_int64() * 1000000L)  // æ¯æ¯«ç§’ä¸€ä¸ªæ•°æ®ç‚¹
    let value = 100.0 + (i.to_double() * 2.5) + (i.to_double().to_int() % 10).to_double()
    
    timestamps.push(timestamp)
    measurements.push(value)
    
    azimuth::Histogram::record(histogram, value)
  }
  
  // éªŒè¯æ—¶é—´åºåˆ—æ•°æ®
  assert_true(timestamps.length() == 50)
  assert_true(measurements.length() == 50)
  
  // éªŒè¯æ—¶é—´æˆ³é€’å¢
  for i in 1..timestamps.length() {
    assert_true(timestamps[i] > timestamps[i-1])
  }
  
  // éªŒè¯æµ‹é‡å€¼åœ¨åˆç†èŒƒå›´å†…
  for value in measurements {
    assert_true(value >= 100.0)
    assert_true(value <= 250.0)
  }
  
  // åˆ›å»ºæ—¶é—´åºåˆ—æ—¥å¿—
  let logger = azimuth::LoggerProvider::get_logger(azimuth::LoggerProvider::default(), "æ—¶é—´åºåˆ—æ—¥å¿—")
  
  for i in 0..20 {
    let log_time = base_time + (i.to_int64() * 5000000L)  // æ¯5æ¯«ç§’ä¸€ä¸ªæ—¥å¿—
    let log_record = azimuth::LogRecord::new_with_context(
      if i % 5 == 0 { azimuth::Warn } else { azimuth::Info },
      Some("æ—¶é—´åºåˆ—æ—¥å¿— " + i.to_string()),
      Some(azimuth::Attributes::new()),
      Some(log_time),
      Some(log_time + 1000L),
      Some("time-series-trace"),
      Some("time-series-span"),
      Some(azimuth::Context::root())
    )
    
    azimuth::Logger::emit(logger, log_record)
  }
}

// æµ‹è¯•10: é«˜çº§HTTPå®¢æˆ·ç«¯æ“ä½œ
pub test "é«˜çº§HTTPå®¢æˆ·ç«¯æ“ä½œ" {
  // åˆ›å»ºå¤æ‚çš„HTTPè¯·æ±‚
  let headers = [
    ("Content-Type", "application/json"),
    ("Authorization", "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9"),
    ("User-Agent", "Azimuth-Telemetry/2.0.0"),
    ("X-Request-ID", "req-12345"),
    ("X-Trace-ID", "trace-abc123"),
    ("Accept", "application/json"),
    ("Accept-Encoding", "gzip, deflate")
  ]
  
  let request_body = "{\"operation\": \"process_payment\", \"amount\": 99.99, \"currency\": \"USD\", \"user_id\": \"user123\"}"
  
  let request = azimuth::HttpRequest::new(
    "POST",
    "https://api.payment.example.com/v1/transactions",
    headers,
    Some(request_body)
  )
  
  // éªŒè¯è¯·æ±‚å±æ€§
  assert_eq(azimuth::HttpRequest::http_method(request), "POST")
  assert_eq(azimuth::HttpRequest::url(request), "https://api.payment.example.com/v1/transactions")
  assert_eq(azimuth::HttpRequest::body(request), Some(request_body))
  
  // åˆ›å»ºå¤æ‚çš„HTTPå“åº”
  let response_headers = [
    ("Content-Type", "application/json"),
    ("Server", "nginx/1.20.1"),
    ("X-Response-Time", "125ms"),
    ("X-Request-ID", "req-12345"),
    ("Cache-Control", "no-cache, no-store"),
    ("Content-Encoding", "gzip")
  ]
  
  let response_body = "{\"transaction_id\": \"txn_abc123\", \"status\": \"success\", \"amount\": 99.99, \"currency\": \"USD\", \"processed_at\": \"2025-01-01T12:00:00Z\"}"
  
  let response = azimuth::HttpResponse::new(200, response_headers, Some(response_body))
  
  // éªŒè¯å“åº”å±æ€§
  assert_eq(azimuth::HttpResponse::status_code(response), 200)
  assert_eq(azimuth::HttpResponse::body(response), Some(response_body))
  
  // æµ‹è¯•é”™è¯¯å“åº”
  let error_response = azimuth::HttpResponse::new(
    429,
    [("Retry-After", "60"), ("X-Error-Code", "RATE_LIMIT_EXCEEDED")],
    Some("{\"error\": \"Rate limit exceeded\", \"retry_after\": 60}")
  )
  
  assert_eq(azimuth::HttpResponse::status_code(error_response), 429)
}