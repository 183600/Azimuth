// Azimuth ä¸“é¡¹MoonBitæµ‹è¯•ç”¨ä¾‹
// åŒ…å«10ä¸ªé’ˆå¯¹æ ¸å¿ƒåŠŸèƒ½çš„æ·±åº¦æµ‹è¯•

// æµ‹è¯•ç”¨ä¾‹1: å±æ€§å€¼ç±»å‹è½¬æ¢è¾¹ç•Œæµ‹è¯•
test "å±æ€§å€¼ç±»å‹è½¬æ¢è¾¹ç•Œæµ‹è¯•" {
  // æµ‹è¯•å­—ç¬¦ä¸²åˆ°æ•´æ•°çš„è¾¹ç•Œè½¬æ¢
  let str_val = StringValue("2147483647") // Intæœ€å¤§å€¼
  let int_val = AttributeValue::to_int(str_val)
  match int_val {
    Some(v) => assert_eq(v, 2147483647)
    None => assert_true(false)
  }
  
  // æµ‹è¯•æµ®ç‚¹æ•°ç²¾åº¦è¾¹ç•Œ
  let float_val = FloatValue(1.7976931348623157e+308) // Doubleæœ€å¤§å€¼
  let converted_str = AttributeValue::to_string(float_val)
  match converted_str {
    Some(s) => assert_true(s.contains("1.797693"))
    None => assert_true(false)
  }
  
  // æµ‹è¯•å¸ƒå°”å€¼åœ¨ä¸åŒè¡¨ç¤ºæ–¹å¼ä¸‹çš„è½¬æ¢
  let bool_true = BoolValue(true)
  let bool_false = BoolValue(false)
  
  assert_eq(AttributeValue::to_string(bool_true), Some("true"))
  assert_eq(AttributeValue::to_string(bool_false), Some("false"))
  
  // æµ‹è¯•æ•°ç»„ç±»å‹è½¬æ¢
  let string_array = ArrayStringValue(["item1", "item2", "item3"])
  let array_length = AttributeValue::array_length(string_array)
  assert_eq(array_length, 3)
  
  // æµ‹è¯•ç©ºæ•°ç»„å¤„ç†
  let empty_array = ArrayIntValue([])
  assert_eq(AttributeValue::array_length(empty_array), 0)
}

// æµ‹è¯•ç”¨ä¾‹2: ä¸Šä¸‹æ–‡ä¼ æ’­æ·±åº¦åµŒå¥—æµ‹è¯•
test "ä¸Šä¸‹æ–‡ä¼ æ’­æ·±åº¦åµŒå¥—æµ‹è¯•" {
  // åˆ›å»ºæ ¹ä¸Šä¸‹æ–‡
  let root_context = Context::create()
  Context::set(root_context, "service.name", "root-service")
  Context::set(root_context, "trace.id", "abc123")
  
  // åˆ›å»º5å±‚åµŒå¥—çš„å­ä¸Šä¸‹æ–‡
  let context1 = Context::create_child(root_context)
  Context::set(context1, "layer", "1")
  
  let context2 = Context::create_child(context1)
  Context::set(context2, "layer", "2")
  
  let context3 = Context::create_child(context2)
  Context::set(context3, "layer", "3")
  
  let context4 = Context::create_child(context3)
  Context::set(context4, "layer", "4")
  
  let context5 = Context::create_child(context4)
  Context::set(context5, "layer", "5")
  
  // éªŒè¯æœ€æ·±å±‚ä¸Šä¸‹æ–‡ä»èƒ½è®¿é—®æ ¹ä¸Šä¸‹æ–‡ä¿¡æ¯
  let root_service = Context::get(context5, "service.name")
  let trace_id = Context::get(context5, "trace.id")
  let current_layer = Context::get(context5, "layer")
  
  match root_service {
    Some(v) => assert_eq(v, "root-service")
    None => assert_true(false)
  }
  
  match trace_id {
    Some(v) => assert_eq(v, "abc123")
    None => assert_true(false)
  }
  
  match current_layer {
    Some(v) => assert_eq(v, "5")
    None => assert_true(false)
  }
  
  // éªŒè¯ä¸Šä¸‹æ–‡é“¾çš„å®Œæ•´æ€§
  let context_chain = Context::get_chain(context5)
  assert_eq(context_chain.length(), 6) // æ ¹ä¸Šä¸‹æ–‡ + 5å±‚å­ä¸Šä¸‹æ–‡
}

// æµ‹è¯•ç”¨ä¾‹3: èµ„æºå±æ€§åˆå¹¶ç­–ç•¥æµ‹è¯•
test "èµ„æºå±æ€§åˆå¹¶ç­–ç•¥æµ‹è¯•" {
  // åˆ›å»ºåŸºç¡€èµ„æº
  let base_attributes = Attributes::create()
  Attributes::set(base_attributes, "service.name", StringValue("azimuth-core"))
  Attributes::set(base_attributes, "service.version", StringValue("1.0.0"))
  Attributes::set(base_attributes, "environment", StringValue("production"))
  
  let base_resource = Resource::create(base_attributes)
  
  // åˆ›å»ºè¦†ç›–èµ„æº
  let override_attributes = Attributes::create()
  Attributes::set(override_attributes, "service.version", StringValue("2.0.0")) // è¦†ç›–ç‰ˆæœ¬
  Attributes::set(override_attributes, "region", StringValue("us-west-2")) // æ–°å¢å±æ€§
  Attributes::set(override_attributes, "instance.id", StringValue("i-1234567890")) // æ–°å¢å±æ€§
  
  let override_resource = Resource::create(override_attributes)
  
  // æ‰§è¡Œåˆå¹¶ç­–ç•¥
  let merged_resource = Resource::merge(base_resource, override_resource)
  let merged_attributes = Resource::attributes(merged_resource)
  
  // éªŒè¯åˆå¹¶ç»“æœ
  let service_name = Attributes::get(merged_attributes, "service.name")
  let service_version = Attributes::get(merged_attributes, "service.version")
  let environment = Attributes::get(merged_attributes, "environment")
  let region = Attributes::get(merged_attributes, "region")
  let instance_id = Attributes::get(merged_attributes, "instance.id")
  
  // éªŒè¯åŸæœ‰å±æ€§ä¿æŒä¸å˜
  match service_name {
    Some(StringValue(v)) => assert_eq(v, "azimuth-core")
    _ => assert_true(false)
  }
  
  match environment {
    Some(StringValue(v)) => assert_eq(v, "production")
    _ => assert_true(false)
  }
  
  // éªŒè¯è¢«è¦†ç›–çš„å±æ€§
  match service_version {
    Some(StringValue(v)) => assert_eq(v, "2.0.0")
    _ => assert_true(false)
  }
  
  // éªŒè¯æ–°å¢çš„å±æ€§
  match region {
    Some(StringValue(v)) => assert_eq(v, "us-west-2")
    _ => assert_true(false)
  }
  
  match instance_id {
    Some(StringValue(v)) => assert_eq(v, "i-1234567890")
    _ => assert_true(false)
  }
}

// æµ‹è¯•ç”¨ä¾‹4: è·¨æœåŠ¡è¿½è¸ªä¸€è‡´æ€§æµ‹è¯•
test "è·¨æœåŠ¡è¿½è¸ªä¸€è‡´æ€§æµ‹è¯•" {
  // æ¨¡æ‹ŸæœåŠ¡Açš„è¿½è¸ª
  let service_a_tracer = Tracer::create("service-a")
  let span_a = Tracer::start_span(service_a_tracer, "api.request")
  let context_a = Span::context(span_a)
  
  Span::set_attribute(span_a, "http.method", StringValue("GET"))
  Span::set_attribute(span_a, "http.url", StringValue("/api/users"))
  Span::set_attribute(span_a, "service.name", StringValue("user-service"))
  
  // åˆ›å»ºä¼ æ’­è½½ä½“
  let carrier = TextMapCarrier::create()
  ContextPropagator::inject(context_a, carrier)
  
  // æ¨¡æ‹ŸæœåŠ¡Bæ¥æ”¶å¹¶æå–ä¸Šä¸‹æ–‡
  let service_b_tracer = Tracer::create("service-b")
  let extracted_context = ContextPropagator::extract(carrier)
  let span_b = Tracer::start_span_with_context(service_b_tracer, "database.query", extracted_context)
  
  Span::set_attribute(span_b, "db.statement", StringValue("SELECT * FROM users"))
  Span::set_attribute(span_b, "db.type", StringValue("postgresql"))
  Span::set_attribute(span_b, "service.name", StringValue("database-service"))
  
  // éªŒè¯è¿½è¸ªIDä¸€è‡´æ€§
  let trace_id_a = SpanContext::trace_id(Context::span_context(context_a))
  let trace_id_b = SpanContext::trace_id(Context::span_context(extracted_context))
  
  assert_eq(trace_id_a, trace_id_b)
  
  // éªŒè¯çˆ¶å­å…³ç³»
  let parent_span_id = SpanContext::span_id(Context::span_context(context_a))
  let current_span_id = SpanContext::span_id(Span::context(span_b))
  
  assert_true(parent_span_id != current_span_id) // ç¡®ä¿ä¸æ˜¯åŒä¸€ä¸ªspan
  
  // å®Œæˆspan
  Span::end(span_b)
  Span::end(span_a)
}

// æµ‹è¯•ç”¨ä¾‹5: é«˜å¹¶å‘åœºæ™¯ä¸‹çš„é¥æµ‹æ•°æ®å®Œæ•´æ€§æµ‹è¯•
test "é«˜å¹¶å‘åœºæ™¯ä¸‹çš„é¥æµ‹æ•°æ®å®Œæ•´æ€§æµ‹è¯•" {
  let meter_provider = MeterProvider::create()
  let meter = MeterProvider::get_meter(meter_provider, "concurrency.test")
  
  // åˆ›å»ºå¤šä¸ªå¹¶å‘æŒ‡æ ‡
  let counters = Array::new()
  for i = 0; i < 10; i = i + 1 {
    let counter_name = "concurrent.counter." + i.to_string()
    let counter = Meter::create_counter(meter, counter_name)
    Array::push(counters, counter)
  }
  
  // å¹¶å‘å¢åŠ è®¡æ•°å™¨
  for i = 0; i < counters.length(); i = i + 1 {
    let counter = Array::get(counters, i) |> Option::get_or_panic()
    // æ¯ä¸ªè®¡æ•°å™¨å¢åŠ ä¸åŒçš„å€¼
    Counter::add(counter, (i + 1).to_double())
  }
  
  // éªŒè¯æ•°æ®å®Œæ•´æ€§
  for i = 0; i < counters.length(); i = i + 1 {
    let counter = Array::get(counters, i) |> Option::get_or_panic()
    let expected_value = (i + 1).to_double()
    let actual_value = Counter::value(counter)
    assert_eq(actual_value, expected_value)
  }
  
  // åˆ›å»ºç›´æ–¹å›¾å¹¶è®°å½•å¹¶å‘æ•°æ®
  let histogram = Meter::create_histogram(meter, "concurrent.histogram")
  for i = 0; i < 100; i = i + 1 {
    Histogram::record(histogram, i.to_double() / 10.0)
  }
  
  // éªŒè¯ç›´æ–¹å›¾ç»Ÿè®¡æ•°æ®
  let histogram_data = Histogram::get_data(histogram)
  assert_eq(histogram_data.count, 100)
  assert_true(histogram_data.sum > 0.0)
}

// æµ‹è¯•ç”¨ä¾‹6: æ—¶é—´åºåˆ—æ•°æ®èšåˆæµ‹è¯•
test "æ—¶é—´åºåˆ—æ•°æ®èšåˆæµ‹è¯•" {
  let time_series_provider = TimeSeriesProvider::create()
  let time_series = TimeSeriesProvider::get_series(time_series_provider, "test.metric")
  
  // æ·»åŠ æ—¶é—´åºåˆ—æ•°æ®ç‚¹
  let base_timestamp = Timestamp::now()
  
  // æ·»åŠ 10ä¸ªæ•°æ®ç‚¹ï¼Œæ¯ç§’ä¸€ä¸ª
  for i = 0; i < 10; i = i + 1 {
    let timestamp = Timestamp::add_seconds(base_timestamp, i)
    let value = i.to_double() * 2.5
    TimeSeries::add_point(time_series, timestamp, value)
  }
  
  // æµ‹è¯•æ—¶é—´èŒƒå›´æŸ¥è¯¢
  let start_time = Timestamp::add_seconds(base_timestamp, 2)
  let end_time = Timestamp::add_seconds(base_timestamp, 7)
  let points_in_range = TimeSeries::get_points_in_range(time_series, start_time, end_time)
  
  assert_eq(points_in_range.length(), 6) // åº”è¯¥åŒ…å«ç¬¬2åˆ°ç¬¬7ç§’çš„æ•°æ®ç‚¹
  
  // æµ‹è¯•èšåˆå‡½æ•°
  let avg_value = TimeSeries::average(time_series, start_time, end_time)
  let max_value = TimeSeries::maximum(time_series, start_time, end_time)
  let min_value = TimeSeries::minimum(time_series, start_time, end_time)
  let sum_value = TimeSeries::sum(time_series, start_time, end_time)
  
  assert_true(avg_value > 5.0 && avg_value < 10.0)
  assert_eq(max_value, 17.5) // ç¬¬7ç§’çš„å€¼
  assert_eq(min_value, 5.0) // ç¬¬2ç§’çš„å€¼
  assert_eq(sum_value, 67.5) // 5.0 + 7.5 + 10.0 + 12.5 + 15.0 + 17.5
  
  // æµ‹è¯•é™é‡‡æ ·
  let downsampled = TimeSeries::downsample(time_series, Duration::seconds(3), Aggregation::Average)
  assert_eq(downsampled.length(), 4) // 10ä¸ªç‚¹æŒ‰3ç§’é—´éš”é™é‡‡æ ·ï¼Œåº”è¯¥å¾—åˆ°4ä¸ªç‚¹
}

// æµ‹è¯•ç”¨ä¾‹7: é¥æµ‹é…ç½®åŠ¨æ€æ›´æ–°æµ‹è¯•
test "é¥æµ‹é…ç½®åŠ¨æ€æ›´æ–°æµ‹è¯•" {
  let config_manager = ConfigurationManager::create()
  
  // è®¾ç½®åˆå§‹é…ç½®
  let initial_config = TelemetryConfig::create()
  TelemetryConfig::set_sampling_rate(initial_config, 0.1) // 10%é‡‡æ ·ç‡
  TelemetryConfig::set_max_spans(initial_config, 100)
  TelemetryConfig::set_batch_size(initial_config, 50)
  
  ConfigurationManager::update(config_manager, initial_config)
  
  // éªŒè¯åˆå§‹é…ç½®
  let current_config = ConfigurationManager::get_current(config_manager)
  assert_eq(TelemetryConfig::sampling_rate(current_config), 0.1)
  assert_eq(TelemetryConfig::max_spans(current_config), 100)
  assert_eq(TelemetryConfig::batch_size(current_config), 50)
  
  // åŠ¨æ€æ›´æ–°é…ç½®
  let updated_config = TelemetryConfig::create()
  TelemetryConfig::set_sampling_rate(updated_config, 0.5) // 50%é‡‡æ ·ç‡
  TelemetryConfig::set_max_spans(updated_config, 200)
  TelemetryConfig::set_batch_size(updated_config, 100)
  
  ConfigurationManager::update(config_manager, updated_config)
  
  // éªŒè¯é…ç½®å·²æ›´æ–°
  let new_current_config = ConfigurationManager::get_current(config_manager)
  assert_eq(TelemetryConfig::sampling_rate(new_current_config), 0.5)
  assert_eq(TelemetryConfig::max_spans(new_current_config), 200)
  assert_eq(TelemetryConfig::batch_size(new_current_config), 100)
  
  // éªŒè¯é…ç½®å˜æ›´é€šçŸ¥
  let notification_received = ref false
  let listener = fn(config) {
    if TelemetryConfig::sampling_rate(config) == 0.5 {
      notification_received := true
    }
  }
  
  ConfigurationManager::add_listener(config_manager, listener)
  
  // å†æ¬¡æ›´æ–°é…ç½®
  let another_config = TelemetryConfig::create()
  TelemetryConfig::set_sampling_rate(another_config, 0.8)
  ConfigurationManager::update(config_manager, another_config)
  
  assert_true(notification_received)
}

// æµ‹è¯•ç”¨ä¾‹8: è¾¹ç•Œæ¡ä»¶é”™è¯¯å¤„ç†æµ‹è¯•
test "è¾¹ç•Œæ¡ä»¶é”™è¯¯å¤„ç†æµ‹è¯•" {
  // æµ‹è¯•ç©ºå­—ç¬¦ä¸²å¤„ç†
  let empty_string = StringValue("")
  let empty_result = AttributeValue::to_int(empty_string)
  assert_eq(empty_result, None)
  
  // æµ‹è¯•æå¤§æ•°å€¼å¤„ç†
  let very_large_number = StringValue("999999999999999999999999")
  let large_result = AttributeValue::to_int(very_large_number)
  assert_eq(large_result, None) // è¶…å‡ºIntèŒƒå›´åº”è¿”å›None
  
  // æµ‹è¯•æ— æ•ˆæµ®ç‚¹æ•°è½¬æ¢
  let invalid_float = StringValue("not.a.number")
  let float_result = AttributeValue::to_float(invalid_float)
  assert_eq(float_result, None)
  
  // æµ‹è¯•ä¸Šä¸‹æ–‡é”®é•¿åº¦è¾¹ç•Œ
  let very_long_key = "k".repeat(10000) // è¶…é•¿é”®å
  let context = Context::create()
  
  // åº”è¯¥èƒ½å¤„ç†è¶…é•¿é”®åè€Œä¸å´©æºƒ
  Context::set(context, very_long_key, "value")
  let retrieved_value = Context::get(context, very_long_key)
  
  match retrieved_value {
    Some(v) => assert_eq(v, "value")
    None => assert_true(false) // å³ä½¿é”®åå¾ˆé•¿ï¼Œä¹Ÿåº”è¯¥èƒ½æ­£å¸¸å­˜å‚¨å’Œæ£€ç´¢
  }
  
  // æµ‹è¯•èµ„æºå±æ€§æ•°é‡è¾¹ç•Œ
  let attributes = Attributes::create()
  for i = 0; i < 1000; i = i + 1 {
    let key = "attr." + i.to_string()
    Attributes::set(attributes, key, StringValue("value." + i.to_string()))
  }
  
  // éªŒè¯å¤§é‡å±æ€§ä¸ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜æˆ–å´©æºƒ
  let attribute_count = Attributes::size(attributes)
  assert_eq(attribute_count, 1000)
}

// æµ‹è¯•ç”¨ä¾‹9: å†…å­˜ç®¡ç†å’Œèµ„æºæ¸…ç†æµ‹è¯•
test "å†…å­˜ç®¡ç†å’Œèµ„æºæ¸…ç†æµ‹è¯•" {
  // æµ‹è¯•å¤§é‡spançš„åˆ›å»ºå’Œé”€æ¯
  let tracer_provider = TracerProvider::create()
  let tracer = TracerProvider::get_tracer(tracer_provider, "memory.test")
  
  let spans = Array::new()
  
  // åˆ›å»ºå¤§é‡span
  for i = 0; i < 1000; i = i + 1 {
    let span_name = "span." + i.to_string()
    let span = Tracer::start_span(tracer, span_name)
    Array::push(spans, span)
  }
  
  // éªŒè¯æ‰€æœ‰spanéƒ½å·²åˆ›å»º
  assert_eq(spans.length(), 1000)
  
  // é”€æ¯æ‰€æœ‰span
  for i = 0; i < spans.length(); i = i + 1 {
    let span = Array::get(spans, i) |> Option::get_or_panic()
    Span::end(span)
  }
  
  // æ¸…ç©ºæ•°ç»„å¼•ç”¨
  Array::clear(spans)
  
  // éªŒè¯å†…å­˜å·²é‡Šæ”¾ï¼ˆé€šè¿‡æ£€æŸ¥æ´»è·ƒspanæ•°é‡ï¼‰
  let active_spans = TracerProvider::get_active_span_count(tracer_provider)
  assert_eq(active_spans, 0)
  
  // æµ‹è¯•æŒ‡æ ‡çš„å†…å­˜ç®¡ç†
  let meter_provider = MeterProvider::create()
  let meter = MeterProvider::get_meter(meter_provider, "memory.metric.test")
  
  let metrics = Array::new()
  
  // åˆ›å»ºå¤§é‡æŒ‡æ ‡
  for i = 0; i < 500; i = i + 1 {
    let counter_name = "counter." + i.to_string()
    let counter = Meter::create_counter(meter, counter_name)
    Counter::add(counter, i.to_double())
    Array::push(metrics, counter)
  }
  
  // æ¸…ç†æŒ‡æ ‡å¼•ç”¨
  Array::clear(metrics)
  
  // éªŒè¯æŒ‡æ ‡èµ„æºå·²æ¸…ç†
  let metric_count = MeterProvider::get_metric_count(meter_provider)
  assert_true(metric_count <= 500) // å…è®¸ä¸€äº›å»¶è¿Ÿæ¸…ç†
}

// æµ‹è¯•ç”¨ä¾‹10: å›½é™…åŒ–å’Œæœ¬åœ°åŒ–æ”¯æŒæµ‹è¯•
test "å›½é™…åŒ–å’Œæœ¬åœ°åŒ–æ”¯æŒæµ‹è¯•" {
  // æµ‹è¯•å¤šè¯­è¨€å±æ€§å€¼
  let attributes = Attributes::create()
  
  // æ·»åŠ ä¸­æ–‡å±æ€§
  Attributes::set(attributes, "service.name.zh", StringValue("æ–¹ä½è§’é¥æµ‹ç³»ç»Ÿ"))
  Attributes::set(attributes, "service.description.zh", StringValue("ä¸€ä¸ªé«˜æ€§èƒ½çš„é¥æµ‹æ•°æ®æ”¶é›†å’Œåˆ†æç³»ç»Ÿ"))
  
  // æ·»åŠ è‹±æ–‡å±æ€§
  Attributes::set(attributes, "service.name.en", StringValue("Azimuth Telemetry System"))
  Attributes::set(attributes, "service.description.en", StringValue("A high-performance telemetry data collection and analysis system"))
  
  // æ·»åŠ æ—¥æ–‡å±æ€§
  Attributes::set(attributes, "service.name.ja", StringValue("ã‚¢ã‚¸ãƒã‚¹ãƒ»ãƒ†ãƒ¬ãƒ¡ãƒˆãƒªãƒ¼ãƒ»ã‚·ã‚¹ãƒ†ãƒ "))
  
  // æµ‹è¯•æœ¬åœ°åŒ–æ£€ç´¢
  let zh_name = Attributes::get_localized(attributes, "service.name", "zh")
  let en_name = Attributes::get_localized(attributes, "service.name", "en")
  let ja_name = Attributes::get_localized(attributes, "service.name", "ja")
  
  match zh_name {
    Some(StringValue(v)) => assert_eq(v, "æ–¹ä½è§’é¥æµ‹ç³»ç»Ÿ")
    _ => assert_true(false)
  }
  
  match en_name {
    Some(StringValue(v)) => assert_eq(v, "Azimuth Telemetry System")
    _ => assert_true(false)
  }
  
  match ja_name {
    Some(StringValue(v)) => assert_eq(v, "ã‚¢ã‚¸ãƒã‚¹ãƒ»ãƒ†ãƒ¬ãƒ¡ãƒˆãƒªãƒ¼ãƒ»ã‚·ã‚¹ãƒ†ãƒ ")
    _ => assert_true(false)
  }
  
  // æµ‹è¯•å›é€€æœºåˆ¶ï¼ˆå½“è¯·æ±‚çš„è¯­è¨€ä¸å­˜åœ¨æ—¶å›é€€åˆ°è‹±æ–‡ï¼‰
  let fr_name = Attributes::get_localized(attributes, "service.name", "fr")
  match fr_name {
    Some(StringValue(v)) => assert_eq(v, "Azimuth Telemetry System") // å›é€€åˆ°è‹±æ–‡
    _ => assert_true(false)
  }
  
  // æµ‹è¯•Unicodeæ–‡æœ¬å¤„ç†
  let unicode_text = "æµ‹è¯•Unicode: ğŸš€ telemetry ğŸŒŸ with Ã©mojis and Ã± special chars"
  let unicode_attr = StringValue(unicode_text)
  let processed_text = AttributeValue::normalize_unicode(unicode_attr)
  
  match processed_text {
    StringValue(v) => assert_true(v.contains("ğŸš€") && v.contains("ğŸŒŸ"))
    _ => assert_true(false)
  }
  
  // æµ‹è¯•ä¸åŒåœ°åŒºçš„æ•°å­—æ ¼å¼
  let number_value = FloatValue(1234.56)
  let formatted_us = AttributeValue::format_localized(number_value, "en-US")
  let formatted_fr = AttributeValue::format_localized(number_value, "fr-FR")
  
  match formatted_us {
    Some(v) => assert_true(v.contains("1,234.56"))
    None => assert_true(false)
  }
  
  match formatted_fr {
    Some(v) => assert_true(v.contains("1 234,56")) // æ³•è¯­ä½¿ç”¨ç©ºæ ¼å’Œé€—å·
    None => assert_true(false)
  }
}