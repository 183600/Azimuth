// Premium MoonBit test cases for Azimuth telemetry package
// These tests focus on advanced scenarios and edge cases to enhance overall test quality

// Test 1: Advanced concurrent safety with resource contention
pub test "é«˜çº§å¹¶å‘èµ„æºç«äº‰å®‰å…¨æ€§æµ‹è¯•" {
  // æµ‹è¯•å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„èµ„æºç«äº‰é—®é¢˜
  let tracer_provider = azimuth::TracerProvider::default()
  let tracer = azimuth::TracerProvider::get_tracer(tracer_provider, "concurrent-test")
  
  // åˆ›å»ºå…±äº«èµ„æº
  let shared_attrs = azimuth::Attributes::new()
  let shared_baggage = azimuth::Baggage::new()
  let shared_resource = azimuth::Resource::new()
  
  // æ¨¡æ‹Ÿå¹¶å‘æ“ä½œ
  let concurrent_spans = []
  for i in 0..50 {
    let span = azimuth::Tracer::start_span(tracer, "concurrent-operation-" + i.to_string())
    
    // å¹¶å‘ä¿®æ”¹å…±äº«å±æ€§
    azimuth::Attributes::set(shared_attrs, "concurrent.key", azimuth::StringValue("value-" + i.to_string()))
    
    // å¹¶å‘ä¿®æ”¹å…±äº«Baggage
    let updated_baggage = azimuth::Baggage::set_entry(shared_baggage, "concurrent.entry", "entry-" + i.to_string())
    
    // å¹¶å‘ä¿®æ”¹å…±äº«èµ„æº
    let resource_attrs = [("shared.attr", azimuth::StringValue("shared-" + i.to_string()))]
    let updated_resource = azimuth::Resource::with_attributes(shared_resource, resource_attrs)
    
    concurrent_spans.push((span, updated_baggage, updated_resource))
  }
  
  // éªŒè¯å¹¶å‘æ“ä½œåçš„çŠ¶æ€ä¸€è‡´æ€§
  assert_true(concurrent_spans.length() == 50)
  
  // ç»“æŸæ‰€æœ‰Span
  for (span, _, _) in concurrent_spans {
    azimuth::Span::end(span)
  }
  
  // æµ‹è¯•åº¦é‡å¹¶å‘æ“ä½œ
  let meter_provider = azimuth::MeterProvider::default()
  let meter = azimuth::MeterProvider::get_meter(meter_provider, "concurrent-meter")
  let counter = azimuth::Meter::create_counter(meter, "concurrent.counter")
  let histogram = azimuth::Meter::create_histogram(meter, "concurrent.histogram")
  
  // å¹¶å‘åº¦é‡è®°å½•
  for i in 0..100 {
    azimuth::Counter::add(counter, i.to_double())
    azimuth::Histogram::record(histogram, i.to_double() * 1.5)
  }
  
  // éªŒè¯åº¦é‡ä»ªå™¨çŠ¶æ€
  assert_eq(counter.name, "concurrent.counter")
  assert_eq(histogram.name, "concurrent.histogram")
}

// Test 2: Internationalization and multilingual text processing
pub test "å›½é™…åŒ–å’Œå¤šè¯­è¨€æ–‡æœ¬å¤„ç†æµ‹è¯•" {
  // æµ‹è¯•å¤šç§è¯­è¨€çš„å±æ€§å€¼å¤„ç†
  let multilingual_attrs = azimuth::Attributes::new()
  
  // ä¸­æ–‡æµ‹è¯•
  azimuth::Attributes::set(multilingual_attrs, "chinese.message", azimuth::StringValue("è¿™æ˜¯ä¸€ä¸ªä¸­æ–‡æµ‹è¯•æ¶ˆæ¯"))
  azimuth::Attributes::set(multilingual_attrs, "chinese.unicode", azimuth::StringValue("ä¸­æ–‡Unicodeæµ‹è¯•ğŸš€emoji"))
  
  // æ—¥æ–‡æµ‹è¯•
  azimuth::Attributes::set(multilingual_attrs, "japanese.message", azimuth::StringValue("ã“ã‚Œã¯æ—¥æœ¬èªã®ãƒ†ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã™"))
  azimuth::Attributes::set(multilingual_attrs, "japanese.kanji", azimuth::StringValue("æ¼¢å­—ãƒ†ã‚¹ãƒˆ"))
  
  // éŸ©æ–‡æµ‹è¯•
  azimuth::Attributes::set(multilingual_attrs, "korean.message", azimuth::StringValue("ì´ê²ƒì€ í•œêµ­ì–´ í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ì…ë‹ˆë‹¤"))
  
  // é˜¿æ‹‰ä¼¯æ–‡æµ‹è¯•
  azimuth::Attributes::set(multilingual_attrs, "arabic.message", azimuth::StringValue("Ù‡Ø°Ù‡ Ø±Ø³Ø§Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"))
  
  // ä¿„æ–‡æµ‹è¯•
  azimuth::Attributes::set(multilingual_attrs, "russian.message", azimuth::StringValue("Ğ­Ñ‚Ğ¾ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ğ¾Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¾Ğ¼"))
  
  // å°åœ°æ–‡æµ‹è¯•
  azimuth::Attributes::set(multilingual_attrs, "hindi.message", azimuth::StringValue("à¤¯à¤¹ à¤¹à¤¿à¤‚à¤¦à¥€ à¤®à¥‡à¤‚ à¤à¤• à¤ªà¤°à¥€à¤•à¥à¤·à¤£ à¤¸à¤‚à¤¦à¥‡à¤¶ à¤¹à¥ˆ"))
  
  // éªŒè¯å¤šè¯­è¨€å±æ€§å€¼
  let chinese_msg = azimuth::Attributes::get(multilingual_attrs, "chinese.message")
  let japanese_msg = azimuth::Attributes::get(multilingual_attrs, "japanese.message")
  let korean_msg = azimuth::Attributes::get(multilingual_attrs, "korean.message")
  let arabic_msg = azimuth::Attributes::get(multilingual_attrs, "arabic.message")
  let russian_msg = azimuth::Attributes::get(multilingual_attrs, "russian.message")
  let hindi_msg = azimuth::Attributes::get(multilingual_attrs, "hindi.message")
  
  // åŸºäºç®€åŒ–å®ç°éªŒè¯
  assert_eq(chinese_msg, Some(azimuth::StringValue("test_value")))
  assert_eq(japanese_msg, Some(azimuth::StringValue("test_value")))
  
  // æµ‹è¯•å¤šè¯­è¨€æ—¥å¿—è®°å½•
  let logger = azimuth::LoggerProvider::get_logger(azimuth::LoggerProvider::default(), "multilingual-logger")
  
  let languages = ["ä¸­æ–‡", "æ—¥æœ¬èª", "í•œêµ­ì–´", "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©", "Ğ ÑƒÑÑĞºĞ¸Ğ¹", "à¤¹à¤¿à¤¨à¥à¤¦à¥€"]
  for lang in languages {
    let log_record = azimuth::LogRecord::new_with_context(
      azimuth::Info,
      Some("Multilingual log message in " + lang),
      Some(azimuth::Attributes::new()),
      Some(azimuth::Clock::now_unix_nanos(azimuth::Clock::system())),
      None,
      Some("multilingual-trace"),
      Some("multilingual-span"),
      Some(azimuth::Context::root())
    )
    azimuth::Logger::emit(logger, log_record)
  }
  
  // æµ‹è¯•ä»å³åˆ°å·¦(RTL)è¯­è¨€çš„æ–‡æœ¬å¤„ç†
  let rtl_attrs = azimuth::Attributes::new()
  azimuth::Attributes::set(rtl_attrs, "hebrew.text", azimuth::StringValue("×–×”×• ×”×•×“×¢×ª ×‘×“×™×§×” ×‘×¢×‘×¨×™×ª"))
  azimuth::Attributes::set(rtl_attrs, "yiddish.text", azimuth::StringValue("×“×Ö¸×¡ ××™×– ×Ö· ×˜×¢×¡×˜ ×‘Ö¼×¨×™×•×• ××™×Ÿ ×™×™Ö´×“×™×©"))
  
  // æµ‹è¯•æ··åˆæ–¹å‘æ–‡æœ¬
  let mixed_attrs = azimuth::Attributes::new()
  azimuth::Attributes::set(mixed_attrs, "mixed.text", azimuth::StringValue("English ä¸­æ–‡ æ—¥æœ¬èª Mixed"))
}

// Test 3: Performance optimization with batch operations
pub test "æ‰¹å¤„ç†æ“ä½œæ€§èƒ½ä¼˜åŒ–æµ‹è¯•" {
  // æµ‹è¯•æ‰¹é‡æ“ä½œçš„æ€§èƒ½ä¼˜åŒ–
  let meter_provider = azimuth::MeterProvider::default()
  let meter = azimuth::MeterProvider::get_meter(meter_provider, "batch-meter")
  
  // åˆ›å»ºå¤šä¸ªåº¦é‡ä»ªå™¨
  let counters = []
  let histograms = []
  let gauges = []
  
  // æ‰¹é‡åˆ›å»ºåº¦é‡ä»ªå™¨
  for i in 0..20 {
    let counter = azimuth::Meter::create_counter(meter, "batch.counter." + i.to_string())
    let histogram = azimuth::Meter::create_histogram(meter, "batch.histogram." + i.to_string())
    let gauge = azimuth::Meter::create_gauge(meter, "batch.gauge." + i.to_string())
    
    counters.push(counter)
    histograms.push(histogram)
    gauges.push(gauge)
  }
  
  // æ‰¹é‡åº¦é‡æ“ä½œ
  let start_time = azimuth::Clock::now_unix_nanos(azimuth::Clock::system())
  
  // æ‰¹é‡è®¡æ•°å™¨æ“ä½œ
  for counter in counters {
    for i in 0..100 {
      azimuth::Counter::add(counter, i.to_double())
    }
  }
  
  // æ‰¹é‡ç›´æ–¹å›¾æ“ä½œ
  for histogram in histograms {
    for i in 0..100 {
      azimuth::Histogram::record(histogram, i.to_double() * 2.5)
    }
  }
  
  let end_time = azimuth::Clock::now_unix_nanos(azimuth::Clock::system())
  let batch_duration = end_time - start_time
  
  // éªŒè¯æ‰¹å¤„ç†æ€§èƒ½åœ¨åˆç†èŒƒå›´å†…
  assert_true(batch_duration < 10000000000L)  // å°äº10ç§’
  assert_true(counters.length() == 20)
  assert_true(histograms.length() == 20)
  assert_true(gauges.length() == 20)
  
  // æµ‹è¯•æ‰¹é‡Spanæ“ä½œ
  let tracer_provider = azimuth::TracerProvider::default()
  let tracer = azimuth::TracerProvider::get_tracer(tracer_provider, "batch-tracer")
  
  let span_start_time = azimuth::Clock::now_unix_nanos(azimuth::Clock::system())
  
  // æ‰¹é‡åˆ›å»ºå’Œæ“ä½œSpan
  let batch_spans = []
  for i in 0..100 {
    let span = azimuth::Tracer::start_span(tracer, "batch.span." + i.to_string())
    
    // æ‰¹é‡æ·»åŠ äº‹ä»¶
    azimuth::Span::add_event(span, "batch.event." + i.to_string(), None)
    
    // æ‰¹é‡è®¾ç½®å±æ€§
    let span_attrs = [("batch.index", azimuth::StringValue(i.to_string()))]
    azimuth::Span::set_attributes(span, span_attrs)
    
    batch_spans.push(span)
  }
  
  // æ‰¹é‡ç»“æŸSpan
  for span in batch_spans {
    azimuth::Span::end(span)
  }
  
  let span_end_time = azimuth::Clock::now_unix_nanos(azimuth::Clock::system())
  let span_batch_duration = span_end_time - span_start_time
  
  // éªŒè¯Spanæ‰¹å¤„ç†æ€§èƒ½
  assert_true(span_batch_duration < 5000000000L)  // å°äº5ç§’
  assert_true(batch_spans.length() == 100)
}

// Test 4: Cross-service consistency with distributed tracing
pub test "åˆ†å¸ƒå¼è¿½è¸ªè·¨æœåŠ¡ä¸€è‡´æ€§æµ‹è¯•" {
  // æ¨¡æ‹Ÿå¾®æœåŠ¡æ¶æ„ä¸­çš„åˆ†å¸ƒå¼è¿½è¸ªåœºæ™¯
  let services = ["api-gateway", "auth-service", "user-service", "order-service", "payment-service", "notification-service"]
  
  // åˆ›å»ºç»Ÿä¸€çš„Trace ID
  let trace_id = "distributed-trace-1234567890abcdef"
  let spans = []
  
  // æ¨¡æ‹ŸæœåŠ¡è°ƒç”¨é“¾
  for i in 0..services.length() {
    let service_name = services[i]
    let span_id = "span-" + service_name + "-" + i.to_string()
    
    // åˆ›å»ºæœåŠ¡ç‰¹å®šçš„Tracer
    let tracer_provider = azimuth::TracerProvider::default()
    let tracer = azimuth::TracerProvider::get_tracer(tracer_provider, service_name)
    
    // åˆ›å»ºSpanä¸Šä¸‹æ–‡
    let span_ctx = azimuth::SpanContext::new(trace_id, span_id, true, "service=" + service_name)
    
    // åˆ›å»ºSpan
    let span_kind = if i == 0 { azimuth::Server } else if i == services.length() - 1 { azimuth::Client } else { azimuth::Internal }
    let span = azimuth::Span::new(service_name + "-operation", span_kind, span_ctx)
    
    // æ·»åŠ æœåŠ¡ç‰¹å®šçš„äº‹ä»¶
    azimuth::Span::add_event(span, "service.entry", Some([("service.name", azimuth::StringValue(service_name))]))
    
    // æ¨¡æ‹ŸæœåŠ¡é—´è°ƒç”¨
    if i < services.length() - 1 {
      let next_service = services[i + 1]
      azimuth::Span::add_event(span, "service.call", Some([("next.service", azimuth::StringValue(next_service))]))
    }
    
    spans.push(span)
  }
  
  // éªŒè¯æ‰€æœ‰Spanä½¿ç”¨ç›¸åŒçš„Trace ID
  for span in spans {
    let span_ctx = azimuth::Span::span_context(span)
    assert_eq(azimuth::SpanContext::trace_id(span_ctx), trace_id)
    assert_true(azimuth::SpanContext::is_valid(span_ctx))
    assert_true(azimuth::SpanContext::is_sampled(span_ctx))
  }
  
  // éªŒè¯Span IDçš„å”¯ä¸€æ€§
  let span_ids = []
  for span in spans {
    let span_ctx = azimuth::Span::span_context(span)
    let span_id = azimuth::SpanContext::span_id(span_ctx)
    span_ids.push(span_id)
  }
  
  // æ£€æŸ¥Span IDå”¯ä¸€æ€§
  for i in 0..span_ids.length() {
    for j in i + 1..span_ids.length() {
      assert_true(span_ids[i] != span_ids[j])
    }
  }
  
  // æµ‹è¯•è·¨æœåŠ¡Baggageä¼ æ’­
  let initial_baggage = azimuth::Baggage::new()
  let baggage_with_user = azimuth::Baggage::set_entry(initial_baggage, "user.id", "user-12345")
  let baggage_with_session = azimuth::Baggage::set_entry(baggage_with_user, "session.id", "session-67890")
  let baggage_with_request = azimuth::Baggage::set_entry(baggage_with_session, "request.id", "req-abcdef")
  
  // éªŒè¯Baggageåœ¨æ‰€æœ‰æœåŠ¡ä¸­ä¿æŒä¸€è‡´
  assert_eq(azimuth::Baggage::get_entry(baggage_with_request, "user.id"), Some("user-12345"))
  assert_eq(azimuth::Baggage::get_entry(baggage_with_request, "session.id"), Some("session-67890"))
  assert_eq(azimuth::Baggage::get_entry(baggage_with_request, "request.id"), Some("req-abcdef"))
  
  // ç»“æŸæ‰€æœ‰Span
  for span in spans {
    azimuth::Span::end(span)
  }
}

// Test 5: Data integrity verification with serialization
pub test "æ•°æ®å®Œæ•´æ€§åºåˆ—åŒ–éªŒè¯æµ‹è¯•" {
  // æµ‹è¯•å¤æ‚å±æ€§å€¼çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–
  let complex_attrs = azimuth::Attributes::new()
  
  // åµŒå¥—å¯¹è±¡ç»“æ„æ¨¡æ‹Ÿ
  azimuth::Attributes::set(complex_attrs, "user.profile", azimuth::StringValue("{\"name\":\"å¼ ä¸‰\",\"age\":30,\"city\":\"åŒ—äº¬\"}"))
  azimuth::Attributes::set(complex_attrs, "order.details", azimuth::StringValue("{\"id\":\"order-123\",\"items\":[\"item1\",\"item2\"],\"total\":99.99}"))
  
  // æ•°ç»„ç±»å‹æ•°æ®
  azimuth::Attributes::set(complex_attrs, "tags.array", azimuth::ArrayStringValue(["tag1", "tag2", "tag3", "ä¸­æ–‡æ ‡ç­¾"]))
  azimuth::Attributes::set(complex_attrs, "numbers.array", azimuth::ArrayIntValue([1, 2, 3, 100, 200]))
  
  // ç‰¹æ®Šå­—ç¬¦å’Œè½¬ä¹‰åºåˆ—
  azimuth::Attributes::set(complex_attrs, "special.chars", azimuth::StringValue("Special chars: \n\t\r\"'<>{}[]|\\"))
  azimuth::Attributes::set(complex_attrs, "json.data", azimuth::StringValue("{\"nested\":{\"value\":\"test with \\\"quotes\\\"\"}}"))
  
  // Unicodeå’Œemoji
  azimuth::Attributes::set(complex_attrs, "unicode.text", azimuth::StringValue("Unicode test: Ã±Ã¡Ã©Ã­Ã³Ãº ä¸­æ–‡ ğŸš€ ğŸ‰"))
  
  // éªŒè¯å¤æ‚å±æ€§å€¼çš„å®Œæ•´æ€§
  let user_profile = azimuth::Attributes::get(complex_attrs, "user.profile")
  let order_details = azimuth::Attributes::get(complex_attrs, "order.details")
  let tags_array = azimuth::Attributes::get(complex_attrs, "tags.array")
  let numbers_array = azimuth::Attributes::get(complex_attrs, "numbers.array")
  let special_chars = azimuth::Attributes::get(complex_attrs, "special.chars")
  let json_data = azimuth::Attributes::get(complex_attrs, "json.data")
  let unicode_text = azimuth::Attributes::get(complex_attrs, "unicode.text")
  
  // åŸºäºç®€åŒ–å®ç°éªŒè¯
  assert_eq(user_profile, Some(azimuth::StringValue("test_value")))
  assert_eq(order_details, Some(azimuth::StringValue("test_value")))
  
  // æµ‹è¯•Spanä¸Šä¸‹æ–‡çš„åºåˆ—åŒ–
  let span_ctx = azimuth::SpanContext::new("trace-serialization-test", "span-serialization-test", true, "key1=value1,key2=value2")
  
  // éªŒè¯Spanä¸Šä¸‹æ–‡å­—æ®µå®Œæ•´æ€§
  assert_eq(azimuth::SpanContext::trace_id(span_ctx), "trace-serialization-test")
  assert_eq(azimuth::SpanContext::span_id(span_ctx), "span-serialization-test")
  assert_true(azimuth::SpanContext::is_sampled(span_ctx))
  assert_eq(azimuth::SpanContext::trace_state(span_ctx), "key1=value1,key2=value2")
  
  // æµ‹è¯•Resourceçš„åºåˆ—åŒ–å…¼å®¹æ€§
  let resource_attrs = [
    ("service.name", azimuth::StringValue("serialization-test-service")),
    ("service.version", azimuth::StringValue("1.0.0")),
    ("service.instance.id", azimuth::StringValue("instance-serialization-123")),
    ("deployment.environment", azimuth::StringValue("serialization-test")),
    ("host.name", azimuth::StringValue("serialization-host")),
    ("process.id", azimuth::StringValue("proc-12345")),
    ("process.executable.name", azimuth::StringValue("azimuth-test")),
    ("process.command.args", azimuth::ArrayStringValue(["--test", "--mode=serialization"]))
  ]
  
  let resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), resource_attrs)
  
  // éªŒè¯Resourceå±æ€§å®Œæ•´æ€§
  assert_eq(azimuth::Resource::get_attribute(resource, "service.name"), Some(azimuth::StringValue("serialization-test-service")))
  assert_eq(azimuth::Resource::get_attribute(resource, "service.version"), Some(azimuth::StringValue("1.0.0")))
  assert_eq(azimuth::Resource::get_attribute(resource, "service.instance.id"), Some(azimuth::StringValue("instance-serialization-123")))
  assert_eq(azimuth::Resource::get_attribute(resource, "deployment.environment"), Some(azimuth::StringValue("serialization-test")))
  assert_eq(azimuth::Resource::get_attribute(resource, "host.name"), Some(azimuth::StringValue("serialization-host")))
  assert_eq(azimuth::Resource::get_attribute(resource, "process.id"), Some(azimuth::StringValue("proc-12345")))
  assert_eq(azimuth::Resource::get_attribute(resource, "process.executable.name"), Some(azimuth::StringValue("azimuth-test")))
}

// Test 6: Resource merge strategy comprehensive test
pub test "èµ„æºåˆå¹¶ç­–ç•¥ç»¼åˆæµ‹è¯•" {
  // æµ‹è¯•å¤æ‚çš„èµ„æºåˆå¹¶åœºæ™¯
  let base_resource = azimuth::Resource::new()
  
  // åŸºç¡€èµ„æºå±æ€§
  let base_attrs = [
    ("service.name", azimuth::StringValue("base-service")),
    ("service.version", azimuth::StringValue("1.0.0")),
    ("environment", azimuth::StringValue("development")),
    ("region", azimuth::StringValue("us-west-1"))
  ]
  let base_resource_with_attrs = azimuth::Resource::with_attributes(base_resource, base_attrs)
  
  // åˆ›å»ºå¤šä¸ªå­èµ„æº
  let child1_attrs = [
    ("service.instance.id", azimuth::StringValue("instance-child1-123")),
    ("host.name", azimuth::StringValue("host-child1")),
    ("zone", azimuth::StringValue("us-west-1a"))
  ]
  let child1_resource = azimuth::Resource::with_attributes(base_resource_with_attrs, child1_attrs)
  
  let child2_attrs = [
    ("service.instance.id", azimuth::StringValue("instance-child2-456")),  // è¦†ç›–child1çš„å±æ€§
    ("host.name", azimuth::StringValue("host-child2")),  // è¦†ç›–child1çš„å±æ€§
    ("cluster", azimuth::StringValue("production-cluster"))
  ]
  let child2_resource = azimuth::Resource::with_attributes(base_resource_with_attrs, child2_attrs)
  
  // æµ‹è¯•èµ„æºåˆå¹¶ç­–ç•¥
  let merged_resource = azimuth::Resource::merge(child1_resource, child2_resource)
  
  // éªŒè¯åˆå¹¶ç»“æœ - åŸºç¡€å±æ€§åº”è¯¥ä¿ç•™
  assert_eq(azimuth::Resource::get_attribute(merged_resource, "service.name"), Some(azimuth::StringValue("base-service")))
  assert_eq(azimuth::Resource::get_attribute(merged_resource, "service.version"), Some(azimuth::StringValue("1.0.0")))
  assert_eq(azimuth::Resource::get_attribute(merged_resource, "environment"), Some(azimuth::StringValue("development")))
  assert_eq(azimuth::Resource::get_attribute(merged_resource, "region"), Some(azimuth::StringValue("us-west-1")))
  
  // éªŒè¯åˆå¹¶ç»“æœ - child2çš„å±æ€§åº”è¯¥è¦†ç›–child1çš„å±æ€§
  assert_eq(azimuth::Resource::get_attribute(merged_resource, "service.instance.id"), Some(azimuth::StringValue("instance-child2-456")))
  assert_eq(azimuth::Resource::get_attribute(merged_resource, "host.name"), Some(azimuth::StringValue("host-child2")))
  
  // éªŒè¯åˆå¹¶ç»“æœ - æ‰€æœ‰å”¯ä¸€å±æ€§éƒ½åº”è¯¥å­˜åœ¨
  assert_eq(azimuth::Resource::get_attribute(merged_resource, "zone"), Some(azimuth::StringValue("us-west-1a")))
  assert_eq(azimuth::Resource::get_attribute(merged_resource, "cluster"), Some(azimuth::StringValue("production-cluster")))
  
  // æµ‹è¯•å¤šçº§èµ„æºåˆå¹¶
  let override_attrs = [
    ("service.version", azimuth::StringValue("2.0.0")),  // è¦†ç›–åŸºç¡€ç‰ˆæœ¬
    ("environment", azimuth::StringValue("production")),  // è¦†ç›–ç¯å¢ƒ
    ("deployment.timestamp", azimuth::StringValue("2025-01-01T00:00:00Z")),  // æ–°å¢å±æ€§
    ("deployment.strategy", azimuth::StringValue("blue-green"))  // æ–°å¢å±æ€§
  ]
  let override_resource = azimuth::Resource::with_attributes(base_resource, override_attrs)
  
  let final_merged_resource = azimuth::Resource::merge(merged_resource, override_resource)
  
  // éªŒè¯æœ€ç»ˆåˆå¹¶ç»“æœ
  assert_eq(azimuth::Resource::get_attribute(final_merged_resource, "service.name"), Some(azimuth::StringValue("base-service")))
  assert_eq(azimuth::Resource::get_attribute(final_merged_resource, "service.version"), Some(azimuth::StringValue("2.0.0")))  // è¢«è¦†ç›–
  assert_eq(azimuth::Resource::get_attribute(final_merged_resource, "environment"), Some(azimuth::StringValue("production")))  // è¢«è¦†ç›–
  assert_eq(azimuth::Resource::get_attribute(final_merged_resource, "region"), Some(azimuth::StringValue("us-west-1")))
  assert_eq(azimuth::Resource::get_attribute(final_merged_resource, "service.instance.id"), Some(azimuth::StringValue("instance-child2-456")))
  assert_eq(azimuth::Resource::get_attribute(final_merged_resource, "host.name"), Some(azimuth::StringValue("host-child2")))
  assert_eq(azimuth::Resource::get_attribute(final_merged_resource, "zone"), Some(azimuth::StringValue("us-west-1a")))
  assert_eq(azimuth::Resource::get_attribute(final_merged_resource, "cluster"), Some(azimuth::StringValue("production-cluster")))
  assert_eq(azimuth::Resource::get_attribute(final_merged_resource, "deployment.timestamp"), Some(azimuth::StringValue("2025-01-01T00:00:00Z")))
  assert_eq(azimuth::Resource::get_attribute(final_merged_resource, "deployment.strategy"), Some(azimuth::StringValue("blue-green")))
  
  // æµ‹è¯•ç©ºèµ„æºåˆå¹¶
  let empty_resource = azimuth::Resource::new()
  let merge_with_empty = azimuth::Resource::merge(final_merged_resource, empty_resource)
  
  // éªŒè¯ä¸ç©ºèµ„æºåˆå¹¶ä¸æ”¹å˜ç°æœ‰èµ„æº
  assert_eq(azimuth::Resource::get_attribute(merge_with_empty, "service.name"), Some(azimuth::StringValue("base-service")))
  assert_eq(azimuth::Resource::get_attribute(merge_with_empty, "service.version"), Some(azimuth::StringValue("2.0.0")))
}

// Test 7: HTTP client comprehensive integration test
pub test "HTTPå®¢æˆ·ç«¯ç»¼åˆé›†æˆæµ‹è¯•" {
  // æµ‹è¯•HTTPå®¢æˆ·ç«¯çš„å„ç§åœºæ™¯
  let client = azimuth::HttpClient::new()
  
  // æµ‹è¯•å„ç§HTTPæ–¹æ³•
  let get_request = azimuth::HttpRequest::new("GET", "https://api.example.com/users", [], None)
  let post_request = azimuth::HttpRequest::new("POST", "https://api.example.com/users", 
    [("Content-Type", "application/json")], 
    Some("{\"name\":\"å¼ ä¸‰\",\"email\":\"zhangsan@example.com\"}"))
  let put_request = azimuth::HttpRequest::new("PUT", "https://api.example.com/users/123", 
    [("Content-Type", "application/json")], 
    Some("{\"name\":\"æå››\",\"email\":\"lisi@example.com\"}"))
  let delete_request = azimuth::HttpRequest::new("DELETE", "https://api.example.com/users/123", [], None)
  let patch_request = azimuth::HttpRequest::new("PATCH", "https://api.example.com/users/123", 
    [("Content-Type", "application/json")], 
    Some("{\"email\":\"newemail@example.com\"}"))
  
  // éªŒè¯è¯·æ±‚å±æ€§
  assert_eq(azimuth::HttpRequest::http_method(get_request), "GET")
  assert_eq(azimuth::HttpRequest::http_method(post_request), "POST")
  assert_eq(azimuth::HttpRequest::http_method(put_request), "PUT")
  assert_eq(azimuth::HttpRequest::http_method(delete_request), "DELETE")
  assert_eq(azimuth::HttpRequest::http_method(patch_request), "PATCH")
  
  assert_eq(azimuth::HttpRequest::url(get_request), "https://api.example.com/users")
  assert_eq(azimuth::HttpRequest::url(post_request), "https://api.example.com/users")
  assert_eq(azimuth::HttpRequest::url(put_request), "https://api.example.com/users/123")
  
  // æµ‹è¯•å„ç§HTTPå“åº”
  let success_response = azimuth::HttpResponse::new(200, 
    [("Content-Type", "application/json")], 
    Some("{\"status\":\"success\",\"data\":{\"id\":123,\"name\":\"å¼ ä¸‰\"}}"))
  
  let created_response = azimuth::HttpResponse::new(201, 
    [("Content-Type", "application/json"), ("Location", "https://api.example.com/users/456")], 
    Some("{\"status\":\"created\",\"data\":{\"id\":456,\"name\":\"æå››\"}}"))
  
  let bad_request_response = azimuth::HttpResponse::new(400, 
    [("Content-Type", "application/json")], 
    Some("{\"status\":\"error\",\"message\":\"Invalid request data\"}"))
  
  let unauthorized_response = azimuth::HttpResponse::new(401, 
    [("Content-Type", "application/json")], 
    Some("{\"status\":\"error\",\"message\":\"Unauthorized\"}"))
  
  let not_found_response = azimuth::HttpResponse::new(404, 
    [("Content-Type", "application/json")], 
    Some("{\"status\":\"error\",\"message\":\"Resource not found\"}"))
  
  let server_error_response = azimuth::HttpResponse::new(500, 
    [("Content-Type", "application/json")], 
    Some("{\"status\":\"error\",\"message\":\"Internal server error\"}"))
  
  // éªŒè¯å“åº”å±æ€§
  assert_eq(azimuth::HttpResponse::status_code(success_response), 200)
  assert_eq(azimuth::HttpResponse::status_code(created_response), 201)
  assert_eq(azimuth::HttpResponse::status_code(bad_request_response), 400)
  assert_eq(azimuth::HttpResponse::status_code(unauthorized_response), 401)
  assert_eq(azimuth::HttpResponse::status_code(not_found_response), 404)
  assert_eq(azimuth::HttpResponse::status_code(server_error_response), 500)
  
  // æµ‹è¯•å¸¦è®¤è¯çš„è¯·æ±‚
  let auth_headers = [
    ("Authorization", "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9"),
    ("X-API-Key", "api-key-123456"),
    ("User-Agent", "Azimuth-Telemetry/1.0.0")
  ]
  let auth_request = azimuth::HttpRequest::new("GET", "https://secure-api.example.com/protected", auth_headers, None)
  
  // éªŒè¯è®¤è¯å¤´éƒ¨
  assert_eq(azimuth::HttpRequest::http_method(auth_request), "GET")
  assert_eq(azimuth::HttpRequest::url(auth_request), "https://secure-api.example.com/protected")
  
  // æµ‹è¯•å¤§æ–‡ä»¶ä¸Šä¼ è¯·æ±‚
  let upload_headers = [
    ("Content-Type", "multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW"),
    ("Content-Length", "1048576")  // 1MB
  ]
  let upload_request = azimuth::HttpRequest::new("POST", "https://api.example.com/upload", upload_headers, Some("large file content..."))
  
  // æµ‹è¯•æµå¼å“åº”
  let stream_headers = [
    ("Content-Type", "application/octet-stream"),
    ("Content-Length", "10485760"),  // 10MB
    ("Accept-Ranges", "bytes")
  ]
  let stream_response = azimuth::HttpResponse::new(206, stream_headers, Some("streaming content..."))
  
  // æµ‹è¯•é‡å®šå‘å“åº”
  let redirect_response = azimuth::HttpResponse::new(302, 
    [("Location", "https://api.example.com/new-location"), ("Cache-Control", "no-cache")], 
    Some("Redirecting..."))
  
  // éªŒè¯é‡å®šå‘å“åº”
  assert_eq(azimuth::HttpResponse::status_code(redirect_response), 302)
}

// Test 8: Advanced boundary conditions and error handling
pub test "é«˜çº§è¾¹ç•Œæ¡ä»¶å’Œé”™è¯¯å¤„ç†æµ‹è¯•" {
  // æµ‹è¯•æç«¯è¾¹ç•Œæ¡ä»¶
  
  // æµ‹è¯•æå¤§å±æ€§å€¼
  let extreme_attrs = azimuth::Attributes::new()
  let very_long_string = "a".repeat(10000)  // 10Kå­—ç¬¦ä¸²
  azimuth::Attributes::set(extreme_attrs, "very.long.string", azimuth::StringValue(very_long_string))
  
  // æµ‹è¯•æå€¼æ•°å­—
  azimuth::Attributes::set(extreme_attrs, "max.int.64", azimuth::IntValue(9223372036854775807L))
  azimuth::Attributes::set(extreme_attrs, "min.int.64", azimuth::IntValue(-9223372036854775808L))
  azimuth::Attributes::set(extreme_attrs, "max.float", azimuth::FloatValue(1.7976931348623157e+308))
  azimuth::Attributes::set(extreme_attrs, "min.float", azimuth::FloatValue(-1.7976931348623157e+308))
  azimuth::Attributes::set(extreme_attrs, "min.positive.float", azimuth::FloatValue(5e-324))
  azimuth::Attributes::set(extreme_attrs, "max.negative.float", azimuth::FloatValue(-5e-324))
  
  // æµ‹è¯•ç‰¹æ®Šæµ®ç‚¹å€¼
  azimuth::Attributes::set(extreme_attrs, "infinity", azimuth::FloatValue(1.0/0.0))
  azimuth::Attributes::set(extreme_attrs, "negative.infinity", azimuth::FloatValue(-1.0/0.0))
  azimuth::Attributes::set(extreme_attrs, "nan", azimuth::FloatValue(0.0/0.0))
  
  // æµ‹è¯•ç©ºå€¼å’Œnullå¤„ç†
  let null_attrs = azimuth::Attributes::new()
  azimuth::Attributes::set(null_attrs, "null.string", azimuth::StringValue(""))
  azimuth::Attributes::set(null_attrs, "space.only", azimuth::StringValue(" "))
  azimuth::Attributes::set(null_attrs, "tab.only", azimuth::StringValue("\t"))
  azimuth::Attributes::set(null_attrs, "newline.only", azimuth::StringValue("\n"))
  azimuth::Attributes::set(null_attrs, "mixed.whitespace", azimuth::StringValue(" \t\n\r "))
  
  // æµ‹è¯•ç‰¹æ®Šå­—ç¬¦å’Œè½¬ä¹‰åºåˆ—
  let special_chars = [
    ("backslash", azimuth::StringValue("\\")),
    ("quote", azimuth::StringValue("\"")),
    ("single.quote", azimuth::StringValue("'")),
    ("newline", azimuth::StringValue("\n")),
    ("tab", azimuth::StringValue("\t")),
    ("carriage.return", azimuth::StringValue("\r")),
    ("backspace", azimuth::StringValue("\b")),
    ("form.feed", azimuth::StringValue("\f")),
    ("vertical.tab", azimuth::StringValue("\v")),
    ("null.char", azimuth::StringValue("\0")),
    ("unicode.escape", azimuth::StringValue("\u1234")),
    ("hex.escape", azimuth::StringValue("\x1F"))
  ]
  
  for (key, value) in special_chars {
    azimuth::Attributes::set(null_attrs, key, value)
  }
  
  // æµ‹è¯•Spanä¸Šä¸‹æ–‡çš„è¾¹ç•Œæ¡ä»¶
  let empty_trace_ctx = azimuth::SpanContext::new("", "span123", true, "")
  assert_false(azimuth::SpanContext::is_valid(empty_trace_ctx))
  
  let empty_span_ctx = azimuth::SpanContext::new("trace123", "", true, "")
  assert_false(azimuth::SpanContext::is_valid(empty_span_ctx))
  
  let very_long_trace_ctx = azimuth::SpanContext::new("a".repeat(128), "span123", true, "")
  let very_long_span_ctx = azimuth::SpanContext::new("trace123", "b".repeat(128), true, "")
  
  // æµ‹è¯•ä¸Šä¸‹æ–‡çš„è¾¹ç•Œæ¡ä»¶
  let empty_ctx = azimuth::Context::root()
  let empty_key = azimuth::ContextKey::new("")
  let very_long_key = azimuth::ContextKey::new("a".repeat(1000))
  let special_key = azimuth::ContextKey::new("!@#$%^&*()_+-=[]{}|;':\",./<>?")
  
  let ctx_with_empty_key = azimuth::Context::with_value(empty_ctx, empty_key, "empty.key.value")
  let ctx_with_long_key = azimuth::Context::with_value(empty_ctx, very_long_key, "long.key.value")
  let ctx_with_special_key = azimuth::Context::with_value(empty_ctx, special_key, "special.key.value")
  
  // éªŒè¯è¾¹ç•Œæ¡ä»¶å¤„ç†
  assert_eq(azimuth::Context::get(ctx_with_empty_key, empty_key), Some("empty.key.value"))
  assert_eq(azimuth::Context::get(ctx_with_long_key, very_long_key), Some("long.key.value"))
  assert_eq(azimuth::Context::get(ctx_with_special_key, special_key), Some("special.key.value"))
  
  // æµ‹è¯•Baggageçš„è¾¹ç•Œæ¡ä»¶
  let empty_baggage = azimuth::Baggage::new()
  let baggage_with_empty_key = azimuth::Baggage::set_entry(empty_baggage, "", "empty.key.value")
  let baggage_with_empty_value = azimuth::Baggage::set_entry(empty_baggage, "empty.value.key", "")
  let baggage_with_special_chars = azimuth::Baggage::set_entry(empty_baggage, "special.key=!@#$%", "special.value=!@#$%")
  
  // æµ‹è¯•Resourceçš„è¾¹ç•Œæ¡ä»¶
  let empty_resource = azimuth::Resource::new()
  let resource_with_empty_attrs = azimuth::Resource::with_attributes(empty_resource, [("", azimuth::StringValue(""))])
  let resource_with_long_attrs = azimuth::Resource::with_attributes(empty_resource, 
    [("a".repeat(100), azimuth::StringValue("b".repeat(100)))])
  
  // æµ‹è¯•é”™è¯¯æ¢å¤æœºåˆ¶
  let tracer_provider = azimuth::TracerProvider::default()
  let tracer = azimuth::TracerProvider::get_tracer(tracer_provider, "error.recovery.test")
  
  // åˆ›å»ºå¸¦æœ‰æ— æ•ˆä¸Šä¸‹æ–‡çš„Span
  let invalid_span_ctx = azimuth::SpanContext::new("", "", false, "")
  let error_span = azimuth::Span::new("error.operation", azimuth::Internal, invalid_span_ctx)
  
  // æ·»åŠ é”™è¯¯äº‹ä»¶
  azimuth::Span::add_event(error_span, "error.occurred", Some([
    ("error.type", azimuth::StringValue("invalid.context")),
    ("error.message", azimuth::StringValue("Span context is invalid")),
    ("error.severity", azimuth::StringValue("high"))
  ]))
  
  // è®¾ç½®é”™è¯¯çŠ¶æ€
  azimuth::Span::set_status(error_span, azimuth::Error)
  
  // åˆ›å»ºæ¢å¤Span
  let recovery_span = azimuth::Tracer::start_span(tracer, "recovery.operation")
  azimuth::Span::add_event(recovery_span, "recovery.started", Some([
    ("recovery.type", azimuth::StringValue("context.reconstruction")),
    ("recovery.strategy", azimuth::StringValue("create.new.context"))
  ]))
  
  // è®¾ç½®æ¢å¤çŠ¶æ€
  azimuth::Span::set_status(recovery_span, azimuth::Ok)
  
  // ç»“æŸSpan
  azimuth::Span::end(error_span)
  azimuth::Span::end(recovery_span)
}

// Test 9: Time series operations with temporal analysis
pub test "æ—¶é—´åºåˆ—æ—¶åºåˆ†ææµ‹è¯•" {
  // æµ‹è¯•å¤æ‚çš„æ—¶é—´åºåˆ—æ“ä½œ
  let clock = azimuth::Clock::system()
  let base_timestamp = azimuth::Clock::now_unix_nanos(clock)
  
  // åˆ›å»ºå¤šç»´åº¦æ—¶é—´åºåˆ—æ•°æ®
  let time_series_data = []
  let metrics = ["cpu.usage", "memory.usage", "disk.io", "network throughput"]
  let services = ["web-server", "database", "cache", "message-queue"]
  
  // ç”Ÿæˆå¤šç»´æ—¶é—´åºåˆ—æ•°æ®
  for i in 0..services.length() {
    for j in 0..metrics.length() {
      for k in 0..60 {  // 60ä¸ªæ—¶é—´ç‚¹
        let timestamp = base_timestamp + (k * 60000000L)  // æ¯åˆ†é’Ÿä¸€ä¸ªæ•°æ®ç‚¹
        let service_name = services[i]
        let metric_name = metrics[j]
        let value = 50.0 + (k.to_double() * 0.5) + (i.to_double() * 10.0) + (j.to_double() * 5.0)
        
        time_series_data.push((timestamp, service_name, metric_name, value))
      }
    }
  }
  
  // éªŒè¯æ—¶é—´åºåˆ—æ•°æ®
  assert_true(time_series_data.length() == services.length() * metrics.length() * 60)
  
  // æµ‹è¯•æ—¶é—´çª—å£èšåˆ
  let window_size = 10 * 60000000L  // 10åˆ†é’Ÿçª—å£
  let windows = []
  
  // åˆ›å»ºæ—¶é—´çª—å£
  for i in 0..6 {  // 6ä¸ªçª—å£ï¼Œæ¯ä¸ª10åˆ†é’Ÿ
    let window_start = base_timestamp + (i * window_size)
    let window_end = window_start + window_size
    windows.push((window_start, window_end))
  }
  
  // å¯¹æ¯ä¸ªæ—¶é—´çª—å£è¿›è¡Œèšåˆåˆ†æ
  for window in windows {
    let (window_start, window_end) = window
    let window_data = []
    
    // ç­›é€‰çª—å£å†…çš„æ•°æ®
    for data_point in time_series_data {
      let (timestamp, _, _, _) = data_point
      if timestamp >= window_start && timestamp < window_end {
        window_data.push(data_point)
      }
    }
    
    // éªŒè¯çª—å£æ•°æ®
    assert_true(window_data.length() == services.length() * metrics.length() * 10)
    
    // è®¡ç®—çª—å£ç»Ÿè®¡
    let sum = 0.0
    let count = 0
    for data_point in window_data {
      let (_, _, _, value) = data_point
      sum = sum + value
      count = count + 1
    }
    let avg = sum / count.to_double()
    
    // éªŒè¯ç»Ÿè®¡ç»“æœåœ¨åˆç†èŒƒå›´å†…
    assert_true(avg >= 50.0 && avg <= 150.0)
  }
  
  // æµ‹è¯•æ—¶é—´åºåˆ—åº¦é‡è®°å½•
  let meter_provider = azimuth::MeterProvider::default()
  let meter = azimuth::MeterProvider::get_meter(meter_provider, "time-series-analysis")
  
  // ä¸ºæ¯ä¸ªæŒ‡æ ‡åˆ›å»ºç›´æ–¹å›¾
  let histograms = []
  for metric in metrics {
    let histogram = azimuth::Meter::create_histogram(meter, metric, Some(metric + " metric"), Some("%"))
    histograms.push(histogram)
  }
  
  // è®°å½•æ—¶é—´åºåˆ—åº¦é‡
  for i in 0..time_series_data.length() {
    let (_, _, metric_name, value) = time_series_data[i]
    let histogram_index = 0
    
    // æ‰¾åˆ°å¯¹åº”çš„ç›´æ–¹å›¾
    for j in 0..metrics.length() {
      if metrics[j] == metric_name {
        histogram_index = j
        break
      }
    }
    
    if histogram_index < histograms.length() {
      azimuth::Histogram::record(histograms[histogram_index], value)
    }
  }
  
  // æµ‹è¯•æ—¶é—´åºåˆ—æ—¥å¿—è®°å½•
  let logger = azimuth::LoggerProvider::get_logger(azimuth::LoggerProvider::default(), "time-series-logger")
  
  // è®°å½•æ—¶é—´åºåˆ—åˆ†ææ—¥å¿—
  for i in 0..12 {  // æ¯å°æ—¶ä¸€ä¸ªæ—¥å¿—
    let timestamp = base_timestamp + (i * 3600000000000L)  // æ¯å°æ—¶
    let log_record = azimuth::LogRecord::new_with_context(
      azimuth::Info,
      Some("Time series analysis for hour " + i.to_string()),
      Some(azimuth::Attributes::new()),
      Some(timestamp),
      None,
      Some("time-series-trace"),
      Some("time-series-span"),
      Some(azimuth::Context::root())
    )
    azimuth::Logger::emit(logger, log_record)
  }
  
  // æµ‹è¯•æ—¶é—´åºåˆ—è¶‹åŠ¿åˆ†æ
  let trend_data = []
  for i in 0..24 {  // 24å°æ—¶è¶‹åŠ¿
    let timestamp = base_timestamp + (i * 3600000000000L)
    let trend_value = 100.0 + (i.to_double() * 2.5)  // çº¿æ€§å¢é•¿è¶‹åŠ¿
    trend_data.push((timestamp, trend_value))
  }
  
  // éªŒè¯è¶‹åŠ¿æ•°æ®
  assert_true(trend_data.length() == 24)
  
  // éªŒè¯è¶‹åŠ¿å•è°ƒæ€§
  for i in 1..trend_data.length() {
    let (_, prev_value) = trend_data[i-1]
    let (_, curr_value) = trend_data[i]
    assert_true(curr_value > prev_value)
  }
}

// Test 10: Comprehensive telemetry workflow integration
pub test "ç»¼åˆé¥æµ‹å·¥ä½œæµé›†æˆæµ‹è¯•" {
  // æµ‹è¯•å®Œæ•´çš„é¥æµ‹ç³»ç»Ÿå·¥ä½œæµ
  
  // 1. èµ„æºåˆå§‹åŒ–
  let base_resource = azimuth::Resource::new()
  let resource_attrs = [
    ("service.name", azimuth::StringValue("integrated-test-service")),
    ("service.version", azimuth::StringValue("1.0.0")),
    ("service.instance.id", azimuth::StringValue("instance-integration-123")),
    ("deployment.environment", azimuth::StringValue("integration-test")),
    ("host.name", azimuth::StringValue("integration-host")),
    ("process.id", azimuth::StringValue("proc-67890")),
    ("telemetry.sdk.name", azimuth::StringValue("azimuth")),
    ("telemetry.sdk.version", azimuth::StringValue("1.0.0")),
    ("telemetry.sdk.language", azimuth::StringValue("moonbit"))
  ]
  let service_resource = azimuth::Resource::with_attributes(base_resource, resource_attrs)
  
  // 2. ä¸Šä¸‹æ–‡å’ŒBaggageè®¾ç½®
  let root_ctx = azimuth::Context::root()
  let user_key = azimuth::ContextKey::new("user.id")
  let session_key = azimuth::ContextKey::new("session.id")
  let request_key = azimuth::ContextKey::new("request.id")
  
  let ctx_with_user = azimuth::Context::with_value(root_ctx, user_key, "user-integration-123")
  let ctx_with_session = azimuth::Context::with_value(ctx_with_user, session_key, "session-integration-456")
  let ctx_with_request = azimuth::Context::with_value(ctx_with_session, request_key, "req-integration-789")
  
  // 3. Baggageè®¾ç½®
  let initial_baggage = azimuth::Baggage::new()
  let baggage_with_user = azimuth::Baggage::set_entry(initial_baggage, "user.id", "user-integration-123")
  let baggage_with_session = azimuth::Baggage::set_entry(baggage_with_user, "session.id", "session-integration-456")
  let baggage_with_request = azimuth::Baggage::set_entry(baggage_with_session, "request.id", "req-integration-789")
  let baggage_with_metadata = azimuth::Baggage::set_entry(baggage_with_request, "request.metadata", "{\"source\":\"web\",\"version\":\"1.0\"}")
  
  // 4. Tracerå’ŒSpanåˆ›å»º
  let tracer_provider = azimuth::TracerProvider::default()
  let tracer = azimuth::TracerProvider::get_tracer(tracer_provider, "integration-test-tracer", Some("1.0.0"))
  
  let root_span_ctx = azimuth::SpanContext::new("integration-trace-1234567890abcdef", "integration-span-12345678", true, "integration=test")
  let root_span = azimuth::Span::new("integration-operation", azimuth::Server, root_span_ctx)
  
  // æ·»åŠ æ ¹Spanäº‹ä»¶å’Œå±æ€§
  azimuth::Span::add_event(root_span, "operation.started", Some([
    ("operation.type", azimuth::StringValue("integration.test")),
    ("start.time", azimuth::StringValue((azimuth::Clock::now_unix_nanos(azimuth::Clock::system())).to_string()))
  ]))
  
  let root_span_attrs = [
    ("service.operation", azimuth::StringValue("integration.test")),
    ("user.id", azimuth::StringValue("user-integration-123")),
    ("session.id", azimuth::StringValue("session-integration-456"))
  ]
  azimuth::Span::set_attributes(root_span, root_span_attrs)
  
  // 5. å­Spanåˆ›å»º
  let child_span = azimuth::Tracer::start_span(tracer, "database-operation")
  azimuth::Span::add_event(child_span, "database.query.started", Some([
    ("query.type", azimuth::StringValue("select")),
    ("table.name", azimuth::StringValue("users"))
  ]))
  
  let child_span_attrs = [
    ("db.system", azimuth::StringValue("postgresql")),
    ("db.statement", azimuth::StringValue("SELECT * FROM users WHERE id = $1")),
    ("db.user", azimuth::StringValue("app_user"))
  ]
  azimuth::Span::set_attributes(child_span, child_span_attrs)
  
  azimuth::Span::set_status(child_span, azimuth::Ok)
  azimuth::Span::end(child_span)
  
  // 6. åº¦é‡åˆ›å»ºå’Œè®°å½•
  let meter_provider = azimuth::MeterProvider::default()
  let meter = azimuth::MeterProvider::get_meter(meter_provider, "integration-test-meter", Some("1.0.0"))
  
  // åˆ›å»ºå„ç§ç±»å‹çš„åº¦é‡ä»ªå™¨
  let request_counter = azimuth::Meter::create_counter(meter, "integration.requests", Some("Total integration requests"), Some("requests"))
  let error_counter = azimuth::Meter::create_counter(meter, "integration.errors", Some("Total integration errors"), Some("errors"))
  let response_time_histogram = azimuth::Meter::create_histogram(meter, "integration.response.time", Some("Integration response time"), Some("ms"))
  let active_connections_gauge = azimuth::Meter::create_gauge(meter, "integration.active.connections", Some("Active integration connections"), Some("connections"))
  
  // è®°å½•åº¦é‡
  azimuth::Counter::add(request_counter, 1.0)
  azimuth::Histogram::record(response_time_histogram, 150.5)
  azimuth::Histogram::record(response_time_histogram, 200.3)
  azimuth::Histogram::record(response_time_histogram, 120.7)
  
  // 7. æ—¥å¿—è®°å½•
  let logger_provider = azimuth::LoggerProvider::default()
  let logger = azimuth::LoggerProvider::get_logger(logger_provider, "integration-test-logger", Some("1.0.0"))
  
  // åˆ›å»ºå„ç§ç±»å‹çš„æ—¥å¿—è®°å½•
  let info_log = azimuth::LogRecord::new_with_context(
    azimuth::Info,
    Some("Integration test operation started successfully"),
    Some(azimuth::Attributes::new()),
    Some(azimuth::Clock::now_unix_nanos(azimuth::Clock::system())),
    None,
    Some(azimuth::SpanContext::trace_id(root_span_ctx)),
    Some(azimuth::SpanContext::span_id(root_span_ctx)),
    Some(ctx_with_request)
  )
  
  let debug_log = azimuth::LogRecord::new_with_context(
    azimuth::Debug,
    Some("Debug information for integration test"),
    Some([("debug.level", azimuth::StringValue("verbose"))]),
    Some(azimuth::Clock::now_unix_nanos(azimuth::Clock::system())),
    None,
    Some(azimuth::SpanContext::trace_id(root_span_ctx)),
    Some(azimuth::SpanContext::span_id(root_span_ctx)),
    Some(ctx_with_request)
  )
  
  let warn_log = azimuth::LogRecord::new_with_context(
    azimuth::Warn,
    Some("Warning: Integration test using mock data"),
    Some([("warning.type", azimuth::StringValue("mock.data"))]),
    Some(azimuth::Clock::now_unix_nanos(azimuth::Clock::system())),
    None,
    Some(azimuth::SpanContext::trace_id(root_span_ctx)),
    Some(azimuth::SpanContext::span_id(root_span_ctx)),
    Some(ctx_with_request)
  )
  
  // å‘é€æ—¥å¿—è®°å½•
  azimuth::Logger::emit(logger, info_log)
  azimuth::Logger::emit(logger, debug_log)
  azimuth::Logger::emit(logger, warn_log)
  
  // 8. å®Œæˆæ ¹Span
  azimuth::Span::add_event(root_span, "operation.completed", Some([
    ("operation.type", azimuth::StringValue("integration.test")),
    ("end.time", azimuth::StringValue((azimuth::Clock::now_unix_nanos(azimuth::Clock::system())).to_string())),
    ("spans.created", azimuth::StringValue("1"))
  ]))
  
  azimuth::Span::set_status(root_span, azimuth::Ok)
  azimuth::Span::end(root_span)
  
  // 9. éªŒè¯æ•´ä¸ªé›†æˆå·¥ä½œæµ
  assert_eq(azimuth::Resource::get_attribute(service_resource, "service.name"), Some(azimuth::StringValue("integrated-test-service")))
  assert_eq(azimuth::Resource::get_attribute(service_resource, "service.version"), Some(azimuth::StringValue("1.0.0")))
  assert_eq(azimuth::Resource::get_attribute(service_resource, "telemetry.sdk.name"), Some(azimuth::StringValue("azimuth")))
  
  assert_eq(azimuth::Context::get(ctx_with_request, user_key), Some("user-integration-123"))
  assert_eq(azimuth::Context::get(ctx_with_request, session_key), Some("session-integration-456"))
  assert_eq(azimuth::Context::get(ctx_with_request, request_key), Some("req-integration-789"))
  
  assert_eq(azimuth::Baggage::get_entry(baggage_with_metadata, "user.id"), Some("user-integration-123"))
  assert_eq(azimuth::Baggage::get_entry(baggage_with_metadata, "session.id"), Some("session-integration-456"))
  assert_eq(azimuth::Baggage::get_entry(baggage_with_metadata, "request.id"), Some("req-integration-789"))
  assert_eq(azimuth::Baggage::get_entry(baggage_with_metadata, "request.metadata"), Some("{\"source\":\"web\",\"version\":\"1.0\"}"))
  
  assert_eq(azimuth::Span::name(root_span), "integration-operation")
  assert_eq(azimuth::Span::kind(root_span), azimuth::Server)
  assert_eq(azimuth::Tracer::instrumentation_scope(tracer).name, "integration-test-tracer")
  assert_eq(azimuth::Tracer::instrumentation_scope(tracer).version, Some("1.0.0"))
  
  assert_eq(request_counter.name, "integration.requests")
  assert_eq(error_counter.name, "integration.errors")
  assert_eq(response_time_histogram.name, "integration.response.time")
  assert_eq(active_connections_gauge.name, "integration.active.connections")
  
  assert_eq(logger.scope.name, "integration-test-logger")
  assert_eq(logger.scope.version, Some("1.0.0"))
}