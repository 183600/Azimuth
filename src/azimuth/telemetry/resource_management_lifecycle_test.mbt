// èµ„æºç®¡ç†ç”Ÿå‘½å‘¨æœŸæµ‹è¯•ç”¨ä¾‹
// æµ‹è¯•Azimuth Telemetryä¸­èµ„æºç®¡ç†çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸ

test "resource_creation_and_default_configuration" {
  // æµ‹è¯•èµ„æºåˆ›å»ºå’Œé»˜è®¤é…ç½®
  
  // ä½¿ç”¨é»˜è®¤å·¥å‚æ–¹æ³•åˆ›å»ºèµ„æº
  let default_resource = common::Resource::default("test-service")
  
  // éªŒè¯é»˜è®¤å€¼
  assert_eq(default_resource.service_name, "test-service")
  assert_eq(default_resource.service_version, None)
  assert_eq(default_resource.telemetry_sdk_name, "azimuth")
  assert_eq(default_resource.telemetry_sdk_version, "0.1.0")
  assert_eq(default_resource.attributes.length(), 0)
  
  // åˆ›å»ºå¸¦ç‰ˆæœ¬çš„èµ„æº
  let resource_with_version = common::Resource::default("api-gateway")
  let resource_with_version_set = common::Resource::{
    ..resource_with_version,
    service_version: Some("2.1.0")
  }
  
  match resource_with_version_set.service_version {
    Some(version) => assert_eq(version, "2.1.0")
    None => assert_eq(false, true, "Expected version to be Some")
  }
  
  // åˆ›å»ºå®Œå…¨è‡ªå®šä¹‰çš„èµ„æº
  let custom_resource = common::Resource::{
    service_name: "payment-service",
    service_version: Some("1.5.2"),
    telemetry_sdk_name: "azimuth",
    telemetry_sdk_version: "0.1.0",
    attributes: [
      ("environment", common::AttributeValue::string("production")),
      ("region", common::AttributeValue::string("us-west-2")),
      ("zone", common::AttributeValue::string("us-west-2a"))
    ]
  }
  
  assert_eq(custom_resource.service_name, "payment-service")
  match custom_resource.service_version {
    Some(version) => assert_eq(version, "1.5.2")
    None => assert_eq(false, true, "Expected version to be Some")
  }
  assert_eq(custom_resource.attributes.length(), 3)
}

test "resource_attributes_management" {
  // æµ‹è¯•èµ„æºå±æ€§ç®¡ç†
  
  // åˆ›å»ºå¸¦åŸºæœ¬å±æ€§çš„èµ„æº
  let basic_resource = common::Resource::default("web-service")
  
  // æ·»åŠ æœåŠ¡ç›¸å…³å±æ€§
  let resource_with_service_attrs = common::Resource::{
    ..basic_resource,
    attributes: [
      ("service.name", common::AttributeValue::string("web-service")),
      ("service.version", common::AttributeValue::string("1.0.0")),
      ("service.namespace", common::AttributeValue::string("frontend")),
      ("service.instance.id", common::AttributeValue::string("instance-12345"))
    ]
  }
  
  assert_eq(resource_with_service_attrs.attributes.length(), 4)
  
  // éªŒè¯æœåŠ¡å±æ€§
  let mut found_service_name = false
  let mut found_service_version = false
  let mut found_service_namespace = false
  let mut found_service_instance_id = false
  
  let mut i = 0
  while i < resource_with_service_attrs.attributes.length() {
    let (key, value) = resource_with_service_attrs.attributes[i]
    
    if key == "service.name" {
      match value {
        common::StringValue(name) => {
          assert_eq(name, "web-service")
          found_service_name = true
        }
        _ => assert_eq(false, true, "Expected StringValue for service.name")
      }
    }
    
    if key == "service.version" {
      match value {
        common::StringValue(version) => {
          assert_eq(version, "1.0.0")
          found_service_version = true
        }
        _ => assert_eq(false, true, "Expected StringValue for service.version")
      }
    }
    
    if key == "service.namespace" {
      match value {
        common::StringValue(namespace) => {
          assert_eq(namespace, "frontend")
          found_service_namespace = true
        }
        _ => assert_eq(false, true, "Expected StringValue for service.namespace")
      }
    }
    
    if key == "service.instance.id" {
      match value {
        common::StringValue(instance_id) => {
          assert_eq(instance_id, "instance-12345")
          found_service_instance_id = true
        }
        _ => assert_eq(false, true, "Expected StringValue for service.instance.id")
      }
    }
    
    i = i + 1
  }
  
  assert_eq(found_service_name, true, "Should find service.name")
  assert_eq(found_service_version, true, "Should find service.version")
  assert_eq(found_service_namespace, true, "Should find service.namespace")
  assert_eq(found_service_instance_id, true, "Should find service.instance.id")
  
  // åˆ›å»ºå¸¦éƒ¨ç½²å±æ€§çš„èµ„æº
  let resource_with_deployment_attrs = common::Resource::{
    ..basic_resource,
    attributes: [
      ("deployment.environment", common::AttributeValue::string("production")),
      ("deployment.region", common::AttributeValue::string("us-east-1")),
      ("deployment.availability_zone", common::AttributeValue::string("us-east-1a")),
      ("deployment.cluster", common::AttributeValue::string("main-cluster")),
      ("deployment.pod", common::AttributeValue::string("web-service-7f8d9c2"))
    ]
  }
  
  assert_eq(resource_with_deployment_attrs.attributes.length(), 5)
  
  // åˆ›å»ºå¸¦ä¸»æœºå±æ€§çš„èµ„æºé…ç½®
  let resource_with_host_attrs = common::Resource::{
    ..basic_resource,
    attributes: [
      ("host.name", common::AttributeValue::string("web-server-01.example.com")),
      ("host.id", common::AttributeValue::string("host-abcdef123456")),
      ("host.type", common::AttributeValue::string("virtual_machine")),
      ("host.image.name", common::AttributeValue::string("ubuntu-20.04")),
      ("host.image.id", common::AttributeValue::string("ami-1234567890abcdef0")),
      ("host.cpu.count", common::AttributeValue::int(4L)),
      ("host.memory.available", common::AttributeValue::int(8589934592L)),
      ("host.arch", common::AttributeValue::string("x86_64"))
    ]
  }
  
  assert_eq(resource_with_host_attrs.attributes.length(), 8)
  
  // éªŒè¯æ•°å€¼å±æ€§
  let mut found_cpu_count = false
  let mut found_memory_available = false
  
  i = 0
  while i < resource_with_host_attrs.attributes.length() {
    let (key, value) = resource_with_host_attrs.attributes[i]
    
    if key == "host.cpu.count" {
      match value {
        common::IntValue(cpu_count) => {
          assert_eq(cpu_count, 4L)
          found_cpu_count = true
        }
        _ => assert_eq(false, true, "Expected IntValue for host.cpu.count")
      }
    }
    
    if key == "host.memory.available" {
      match value {
        common::IntValue(memory) => {
          assert_eq(memory, 8589934592L)  // 8GB in bytes
          found_memory_available = true
        }
        _ => assert_eq(false, true, "Expected IntValue for host.memory.available")
      }
    }
    
    i = i + 1
  }
  
  assert_eq(found_cpu_count, true, "Should find host.cpu.count")
  assert_eq(found_memory_available, true, "Should find host.memory.available")
}

test "resource_inheritance_and_merging" {
  // æµ‹è¯•èµ„æºç»§æ‰¿å’Œåˆå¹¶
  
  // åˆ›å»ºåŸºç¡€èµ„æº
  let base_resource = common::Resource::{
    service_name: "base-service",
    service_version: Some("1.0.0"),
    telemetry_sdk_name: "azimuth",
    telemetry_sdk_version: "0.1.0",
    attributes: [
      ("environment", common::AttributeValue::string("development")),
      ("team", common::AttributeValue::string("platform"))
    ]
  }
  
  // åˆ›å»ºç»§æ‰¿èµ„æºï¼ˆæ·»åŠ æ›´å¤šå±æ€§ï¼‰
  let inherited_resource = common::Resource::{
    service_name: base_resource.service_name,
    service_version: base_resource.service_version,
    telemetry_sdk_name: base_resource.telemetry_sdk_name,
    telemetry_sdk_version: base_resource.telemetry_sdk_version,
    attributes: [
      // ç»§æ‰¿çš„å±æ€§
      ("environment", common::AttributeValue::string("development")),
      ("team", common::AttributeValue::string("platform")),
      // æ–°å¢çš„å±æ€§
      ("service.namespace", common::AttributeValue::string("api")),
      ("service.instance.id", common::AttributeValue::string("instance-67890")),
      ("region", common::AttributeValue::string("us-west-2"))
    ]
  }
  
  assert_eq(inherited_resource.attributes.length(), 5)
  
  // éªŒè¯ç»§æ‰¿çš„å±æ€§å­˜åœ¨
  let mut found_environment = false
  let mut found_team = false
  let mut found_namespace = false
  
  let mut i = 0
  while i < inherited_resource.attributes.length() {
    let (key, _) = inherited_resource.attributes[i]
    
    if key == "environment" {
      found_environment = true
    }
    
    if key == "team" {
      found_team = true
    }
    
    if key == "service.namespace" {
      found_namespace = true
    }
    
    i = i + 1
  }
  
  assert_eq(found_environment, true, "Should inherit environment attribute")
  assert_eq(found_team, true, "Should inherit team attribute")
  assert_eq(found_namespace, true, "Should have new namespace attribute")
  
  // æµ‹è¯•å±æ€§è¦†ç›–ï¼ˆåœ¨å®é™…å®ç°ä¸­å¯èƒ½æœ‰åˆå¹¶ç­–ç•¥ï¼‰
  let override_resource = common::Resource::{
    service_name: base_resource.service_name,
    service_version: base_resource.service_version,
    telemetry_sdk_name: base_resource.telemetry_sdk_name,
    telemetry_sdk_version: base_resource.telemetry_sdk_version,
    attributes: [
      // è¦†ç›–çš„å±æ€§
      ("environment", common::AttributeValue::string("production")),
      // ä¿ç•™çš„å±æ€§
      ("team", common::AttributeValue::string("platform")),
      // æ–°å¢çš„å±æ€§
      ("deployment.region", common::AttributeValue::string("us-east-1"))
    ]
  }
  
  // éªŒè¯è¦†ç›–åçš„å±æ€§
  let mut found_production_env = false
  let mut found_team_kept = false
  let mut found_deployment_region = false
  
  i = 0
  while i < override_resource.attributes.length() {
    let (key, value) = override_resource.attributes[i]
    
    if key == "environment" {
      match value {
        common::StringValue(env) => {
          assert_eq(env, "production")
          found_production_env = true
        }
        _ => {}
      }
    }
    
    if key == "team" {
      match value {
        common::StringValue(team) => {
          assert_eq(team, "platform")
          found_team_kept = true
        }
        _ => {}
      }
    }
    
    if key == "deployment.region" {
      found_deployment_region = true
    }
    
    i = i + 1
  }
  
  assert_eq(found_production_env, true, "Should have overridden environment")
  assert_eq(found_team_kept, true, "Should keep team attribute")
  assert_eq(found_deployment_region, true, "Should have new deployment.region")
}

test "resource_validation_and_constraints" {
  // æµ‹è¯•èµ„æºéªŒè¯å’Œçº¦æŸ
  
  // æµ‹è¯•ç©ºæœåŠ¡åç§°ï¼ˆåœ¨å®é™…å®ç°ä¸­åº”è¯¥è¢«æ‹’ç»ï¼‰
  let empty_name_resource = common::Resource::default("")
  assert_eq(empty_name_resource.service_name, "")
  
  // æµ‹è¯•é•¿æœåŠ¡åç§°
  let long_name = "this.is.a.very.long.service.name.that.tests.the.systems.ability.to.handle.extended.service.names.without.issues"
  let long_name_resource = common::Resource::default(long_name)
  assert_eq(long_name_resource.service_name.length(), long_name.length())
  
  // æµ‹è¯•ç‰¹æ®Šå­—ç¬¦æœåŠ¡åç§°
  let special_chars_name = "service.with-special_chars@123#$%^&*()"
  let special_chars_resource = common::Resource::default(special_chars_name)
  assert_eq(special_chars_resource.service_name, special_chars_name)
  
  // æµ‹è¯•UnicodeæœåŠ¡åç§°
  let unicode_name = "æœåŠ¡åç§°.æµ‹è¯•.ğŸš€"
  let unicode_resource = common::Resource::default(unicode_name)
  assert_eq(unicode_resource.service_name, unicode_name)
  
  // æµ‹è¯•ç‰ˆæœ¬çº¦æŸ
  let resources_with_versions = [
    common::Resource::{ service_name: "service1", service_version: Some("1.0.0"), telemetry_sdk_name: "azimuth", telemetry_sdk_version: "0.1.0", attributes: [] },
    common::Resource::{ service_name: "service2", service_version: Some("v2.1.0"), telemetry_sdk_name: "azimuth", telemetry_sdk_version: "0.1.0", attributes: [] },
    common::Resource::{ service_name: "service3", service_version: Some("2023.01.15"), telemetry_sdk_name: "azimuth", telemetry_sdk_version: "0.1.0", attributes: [] },
    common::Resource::{ service_name: "service4", service_version: Some("latest"), telemetry_sdk_name: "azimuth", telemetry_sdk_version: "0.1.0", attributes: [] },
    common::Resource::{ service_name: "service5", service_version: Some(""), telemetry_sdk_name: "azimuth", telemetry_sdk_version: "0.1.0", attributes: [] }
  ]
  
  let mut i = 0
  while i < resources_with_versions.length() {
    let resource = resources_with_versions[i]
    match resource.service_version {
      Some(version) => {
        assert_eq(version.length() >= 0, true)
        // éªŒè¯å„ç§ç‰ˆæœ¬æ ¼å¼
        if i == 0 { assert_eq(version, "1.0.0") }
        if i == 1 { assert_eq(version, "v2.1.0") }
        if i == 2 { assert_eq(version, "2023.01.15") }
        if i == 3 { assert_eq(version, "latest") }
        if i == 4 { assert_eq(version, "") }
      }
      None => assert_eq(false, true, "Expected version to be Some")
    }
    i = i + 1
  }
  
  // æµ‹è¯•å±æ€§æ•°é‡é™åˆ¶ï¼ˆåœ¨å®é™…å®ç°ä¸­å¯èƒ½æœ‰é™åˆ¶ï¼‰
  let many_attributes = []
  i = 0
  while i < 1000 {
    many_attributes.push(("attr." + i.to_string(), common::AttributeValue::string("value." + i.to_string())))
    i = i + 1
  }
  
  let resource_with_many_attrs = common::Resource::{
    service_name: "service-with-many-attrs",
    service_version: Some("1.0.0"),
    telemetry_sdk_name: "azimuth",
    telemetry_sdk_version: "0.1.0",
    attributes: many_attributes
  }
  
  assert_eq(resource_with_many_attrs.attributes.length(), 1000)
}

test "resource_lifecycle_operations" {
  // æµ‹è¯•èµ„æºç”Ÿå‘½å‘¨æœŸæ“ä½œ
  
  // åˆ›å»ºèµ„æº
  let initial_resource = common::Resource::default("lifecycle-service")
  
  // æ¨¡æ‹Ÿèµ„æºåˆå§‹åŒ–é˜¶æ®µ
  let init_resource = common::Resource::{
    ..initial_resource,
    attributes: [
      ("lifecycle.phase", common::AttributeValue::string("initializing")),
      ("startup.time", common::AttributeValue::int(1640995200L)),
      ("pid", common::AttributeValue::int(12345L))
    ]
  }
  
  assert_eq(init_resource.attributes.length(), 3)
  
  // æ¨¡æ‹Ÿèµ„æºè¿è¡Œé˜¶æ®µ
  let running_resource = common::Resource::{
    ..init_resource,
    attributes: [
      // æ›´æ–°ç”Ÿå‘½å‘¨æœŸé˜¶æ®µ
      ("lifecycle.phase", common::AttributeValue::string("running")),
      // ä¿ç•™å¯åŠ¨ä¿¡æ¯
      ("startup.time", common::AttributeValue::int(1640995200L)),
      ("pid", common::AttributeValue::int(12345L)),
      // æ·»åŠ è¿è¡Œæ—¶å±æ€§
      ("runtime.start", common::AttributeValue::int(1640995300L)),
      ("port", common::AttributeValue::int(8080L)),
      ("ready", common::AttributeValue::bool(true))
    ]
  }
  
  assert_eq(running_resource.attributes.length(), 6)
  
  // éªŒè¯è¿è¡Œæ—¶å±æ€§
  let mut found_running_phase = false
  let mut found_ready = false
  let mut found_port = false
  
  let mut i = 0
  while i < running_resource.attributes.length() {
    let (key, value) = running_resource.attributes[i]
    
    if key == "lifecycle.phase" {
      match value {
        common::StringValue(phase) => {
          assert_eq(phase, "running")
          found_running_phase = true
        }
        _ => {}
      }
    }
    
    if key == "ready" {
      match value {
        common::BoolValue(ready) => {
          assert_eq(ready, true)
          found_ready = true
        }
        _ => {}
      }
    }
    
    if key == "port" {
      match value {
        common::IntValue(port) => {
          assert_eq(port, 8080L)
          found_port = true
        }
        _ => {}
      }
    }
    
    i = i + 1
  }
  
  assert_eq(found_running_phase, true, "Should have running phase")
  assert_eq(found_ready, true, "Should have ready status")
  assert_eq(found_port, true, "Should have port")
  
  // æ¨¡æ‹Ÿèµ„æºå…³é—­é˜¶æ®µ
  let shutdown_resource = common::Resource::{
    ..running_resource,
    attributes: [
      // æ›´æ–°ç”Ÿå‘½å‘¨æœŸé˜¶æ®µ
      ("lifecycle.phase", common::AttributeValue::string("shutting_down")),
      // ä¿ç•™å…³é”®è¿è¡Œæ—¶ä¿¡æ¯
      ("startup.time", common::AttributeValue::int(1640995200L)),
      ("runtime.start", common::AttributeValue::int(1640995300L)),
      ("pid", common::AttributeValue::int(12345L)),
      ("port", common::AttributeValue::int(8080L)),
      // æ›´æ–°çŠ¶æ€
      ("ready", common::AttributeValue::bool(false)),
      // æ·»åŠ å…³é—­ä¿¡æ¯
      ("shutdown.start", common::AttributeValue::int(1640995400L)),
      ("shutdown.reason", common::AttributeValue::string("graceful"))
    ]
  }
  
  assert_eq(shutdown_resource.attributes.length(), 8)
  
  // éªŒè¯å…³é—­é˜¶æ®µå±æ€§
  let mut found_shutdown_phase = false
  let mut found_shutdown_reason = false
  let mut found_not_ready = false
  
  i = 0
  while i < shutdown_resource.attributes.length() {
    let (key, value) = shutdown_resource.attributes[i]
    
    if key == "lifecycle.phase" {
      match value {
        common::StringValue(phase) => {
          assert_eq(phase, "shutting_down")
          found_shutdown_phase = true
        }
        _ => {}
      }
    }
    
    if key == "shutdown.reason" {
      match value {
        common::StringValue(reason) => {
          assert_eq(reason, "graceful")
          found_shutdown_reason = true
        }
        _ => {}
      }
    }
    
    if key == "ready" {
      match value {
        common::BoolValue(ready) => {
          assert_eq(ready, false)
          found_not_ready = true
        }
        _ => {}
      }
    }
    
    i = i + 1
  }
  
  assert_eq(found_shutdown_phase, true, "Should have shutdown phase")
  assert_eq(found_shutdown_reason, true, "Should have shutdown reason")
  assert_eq(found_not_ready, true, "Should be not ready during shutdown")
}

test "resource_compatibility_and_standardization" {
  // æµ‹è¯•èµ„æºå…¼å®¹æ€§å’Œæ ‡å‡†åŒ–
  
  // æµ‹è¯•OpenTelemetryèµ„æºæ ‡å‡†
  let otel_standard_resource = common::Resource::{
    service_name: "otel-service",
    service_version: Some("1.0.0"),
    telemetry_sdk_name: "azimuth",
    telemetry_sdk_version: "0.1.0",
    attributes: [
      // OpenTelemetryæ ‡å‡†å±æ€§
      ("service.name", common::AttributeValue::string("otel-service")),
      ("service.version", common::AttributeValue::string("1.0.0")),
      ("service.namespace", common::AttributeValue::string("production")),
      ("service.instance.id", common::AttributeValue::string("instance-otel-123")),
      
      // ä¸»æœºå±æ€§
      ("host.name", common::AttributeValue::string("host-otel.example.com")),
      ("host.id", common::AttributeValue::string("host-otel-456")),
      ("host.type", common::AttributeValue::string("container")),
      ("host.image.name", common::AttributeValue::string("otel/runtime:latest")),
      
      // Kuberneteså±æ€§
      ("k8s.pod.name", common::AttributeValue::string("otel-service-7f8d9c2")),
      ("k8s.namespace.name", common::AttributeValue::string("production")),
      ("k8s.deployment.name", common::AttributeValue::string("otel-service")),
      ("k8s.node.name", common::AttributeValue::string("node-otel-001")),
      
      // è¿›ç¨‹å±æ€§
      ("process.pid", common::AttributeValue::int(12345L)),
      ("process.executable.name", common::AttributeValue::string("otel-service")),
      ("process.executable.path", common::AttributeValue::string("/app/otel-service")),
      ("process.command_args", common::AttributeValue::array_string(["/app/otel-service", "--config", "/etc/config.yaml"])),
      
      // äº‘å±æ€§
      ("cloud.provider", common::AttributeValue::string("aws")),
      ("cloud.account.id", common::AttributeValue::string("123456789012")),
      ("cloud.region", common::AttributeValue::string("us-west-2")),
      ("cloud.availability_zone", common::AttributeValue::string("us-west-2a"))
    ]
  }
  
  assert_eq(otel_standard_resource.attributes.length(), 18)
  
  // éªŒè¯æ ‡å‡†å±æ€§å­˜åœ¨
  let standard_attributes = [
    "service.name", "service.version", "service.namespace", "service.instance.id",
    "host.name", "host.id", "host.type", "host.image.name",
    "k8s.pod.name", "k8s.namespace.name", "k8s.deployment.name", "k8s.node.name",
    "process.pid", "process.executable.name", "process.executable.path", "process.command_args",
    "cloud.provider", "cloud.account.id", "cloud.region", "cloud.availability_zone"
  ]
  
  let mut found_standards = 0
  let mut i = 0
  while i < otel_standard_resource.attributes.length() {
    let (key, _) = otel_standard_resource.attributes[i]
    
    let mut j = 0
    while j < standard_attributes.length() {
      if key == standard_attributes[j] {
        found_standards = found_standards + 1
        break
      }
      j = j + 1
    }
    
    i = i + 1
  }
  
  assert_eq(found_standards, 18, "Should find all standard attributes")
  
  // æµ‹è¯•æ•°ç»„å±æ€§
  let mut found_command_args = false
  i = 0
  while i < otel_standard_resource.attributes.length() {
    let (key, value) = otel_standard_resource.attributes[i]
    
    if key == "process.command_args" {
      match value {
        common::ArrayStringValue(args) => {
          assert_eq(args.length(), 3)
          assert_eq(args[0], "/app/otel-service")
          assert_eq(args[1], "--config")
          assert_eq(args[2], "/etc/config.yaml")
          found_command_args = true
        }
        _ => {}
      }
    }
    
    i = i + 1
  }
  
  assert_eq(found_command_args, true, "Should find command args array")
  
  // æµ‹è¯•è‡ªå®šä¹‰èµ„æºå±æ€§
  let custom_resource = common::Resource::{
    service_name: "custom-service",
    service_version: Some("2.0.0"),
    telemetry_sdk_name: "azimuth",
    telemetry_sdk_version: "0.1.0",
    attributes: [
      // æ ‡å‡†å±æ€§
      ("service.name", common::AttributeValue::string("custom-service")),
      ("service.version", common::AttributeValue::string("2.0.0")),
      
      // è‡ªå®šä¹‰ä¸šåŠ¡å±æ€§
      ("business.unit", common::AttributeValue::string("payments")),
      ("business.criticality", common::AttributeValue::string("high")),
      ("business.owner", common::AttributeValue::string("payments-team@example.com")),
      
      // è‡ªå®šä¹‰æŠ€æœ¯å±æ€§
      ("tech.stack", common::AttributeValue::array_string(["nodejs", "express", "postgresql"])),
      ("tech.version.nodejs", common::AttributeValue::string("18.17.0")),
      ("tech.version.express", common::AttributeValue::string("4.18.2")),
      
      // è‡ªå®šä¹‰ç›‘æ§å±æ€§
      ("monitoring.enabled", common::AttributeValue::bool(true)),
      ("monitoring.metrics.endpoints", common::AttributeValue::array_string(["/metrics", "/health"])),
      ("monitoring.alerts.enabled", common::AttributeValue::bool(true)),
      ("monitoring.alerts.channels", common::AttributeValue::array_string(["email", "slack", "pagerduty"]))
    ]
  }
  
  assert_eq(custom_resource.attributes.length(), 13)
  
  // éªŒè¯è‡ªå®šä¹‰å±æ€§
  let mut found_business_unit = false
  let mut found_tech_stack = false
  let mut found_monitoring_channels = false
  
  i = 0
  while i < custom_resource.attributes.length() {
    let (key, value) = custom_resource.attributes[i]
    
    if key == "business.unit" {
      match value {
        common::StringValue(unit) => {
          assert_eq(unit, "payments")
          found_business_unit = true
        }
        _ => {}
      }
    }
    
    if key == "tech.stack" {
      match value {
        common::ArrayStringValue(stack) => {
          assert_eq(stack.length(), 3)
          assert_eq(stack.contains("nodejs"), true)
          assert_eq(stack.contains("express"), true)
          assert_eq(stack.contains("postgresql"), true)
          found_tech_stack = true
        }
        _ => {}
      }
    }
    
    if key == "monitoring.alerts.channels" {
      match value {
        common::ArrayStringValue(channels) => {
          assert_eq(channels.length(), 3)
          assert_eq(channels.contains("email"), true)
          assert_eq(channels.contains("slack"), true)
          assert_eq(channels.contains("pagerduty"), true)
          found_monitoring_channels = true
        }
        _ => {}
      }
    }
    
    i = i + 1
  }
  
  assert_eq(found_business_unit, true, "Should find business.unit")
  assert_eq(found_tech_stack, true, "Should find tech.stack")
  assert_eq(found_monitoring_channels, true, "Should find monitoring.alerts.channels")
}