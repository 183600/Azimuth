// æŒ‡æ ‡æ”¶é›†å’ŒèšåˆåŠŸèƒ½æµ‹è¯•
// æµ‹è¯•å„ç§æŒ‡æ ‡ç±»å‹çš„åˆ›å»ºã€æ•°æ®æ”¶é›†å’Œèšåˆè®¡ç®—

use azimuth.telemetry.api.common
use azimuth.telemetry.api.metrics

test "counter_metric_functionality" {
  // æµ‹è¯•è®¡æ•°å™¨æŒ‡æ ‡åŠŸèƒ½
  
  let noop_meter_provider = metrics::NoopMeterProvider::{}
  let meter = noop_meter_provider.get_meter("test-meter", "1.0.0")
  
  // åˆ›å»ºè®¡æ•°å™¨
  let counter = meter.create_counter("http_requests_total", "count", "Total HTTP requests")
  
  // æµ‹è¯•è®¡æ•°å™¨å¢åŠ æ“ä½œ
  counter.add(1L, [("method", common::AttributeValue::string("GET"))])
  counter.add(5L, [("method", common::AttributeValue::string("POST"))])
  counter.add(3L, [("method", common::AttributeValue::string("GET"))])
  counter.add(2L, [("method", common::AttributeValue::string("PUT"))])
  counter.add(10L, [("method", common::AttributeValue::string("GET"))])
  
  // éªŒè¯è®¡æ•°å™¨æ“ä½œï¼ˆNo-opå®ç°ä¸ä¼šå®é™…ç´¯åŠ ï¼Œä½†ä¸åº”è¯¥æŠ›å‡ºå¼‚å¸¸ï¼‰
  assert_eq(true, true)
  
  // æµ‹è¯•å¸¦å¤šä¸ªå±æ€§çš„è®¡æ•°å™¨
  counter.add(1L, [
    ("method", common::AttributeValue::string("GET")),
    ("status", common::AttributeValue::string("200")),
    ("endpoint", common::AttributeValue::string("/api/users"))
  ])
  
  counter.add(1L, [
    ("method", common::AttributeValue::string("POST")),
    ("status", common::AttributeValue::string("201")),
    ("endpoint", common::AttributeValue::string("/api/users"))
  ])
  
  counter.add(1L, [
    ("method", common::AttributeValue::string("GET")),
    ("status", common::AttributeValue::string("404")),
    ("endpoint", common::AttributeValue::string("/api/nonexistent"))
  ])
  
  assert_eq(true, true)
  
  // æµ‹è¯•è´Ÿå€¼ï¼ˆè®¡æ•°å™¨é€šå¸¸ä¸å…è®¸è´Ÿå€¼ï¼Œä½†APIä¸é˜»æ­¢ï¼‰
  counter.add(-5L, [("method", common::AttributeValue::string("DELETE"))])
  
  assert_eq(true, true)
  
  // æµ‹è¯•é›¶å€¼
  counter.add(0L, [("method", common::AttributeValue::string("OPTIONS"))])
  
  assert_eq(true, true)
}

test "histogram_metric_functionality" {
  // æµ‹è¯•ç›´æ–¹å›¾æŒ‡æ ‡åŠŸèƒ½
  
  let noop_meter_provider = metrics::NoopMeterProvider::{}
  let meter = noop_meter_provider.get_meter("test-meter", "1.0.0")
  
  // åˆ›å»ºç›´æ–¹å›¾
  let response_time_histogram = meter.create_histogram("http_request_duration_seconds", "seconds", "HTTP request duration")
  
  // æµ‹è¯•ç›´æ–¹å›¾è®°å½•æ“ä½œ
  response_time_histogram.record(0.1, [("endpoint", common::AttributeValue::string("/api/fast"))])
  response_time_histogram.record(0.5, [("endpoint", common::AttributeValue::string("/api/medium"))])
  response_time_histogram.record(1.2, [("endpoint", common::AttributeValue::string("/api/slow"))])
  response_time_histogram.record(2.5, [("endpoint", common::AttributeValue::string("/api/very_slow"))])
  response_time_histogram.record(0.05, [("endpoint", common::AttributeValue::string("/api/very_fast"))])
  
  // éªŒè¯ç›´æ–¹å›¾æ“ä½œ
  assert_eq(true, true)
  
  // æµ‹è¯•è¾¹ç•Œå€¼
  response_time_histogram.record(0.0, [("endpoint", common::AttributeValue::string("/api/instant"))])
  response_time_histogram.record(999.999, [("endpoint", common::AttributeValue::string("/api/timeout"))])
  
  // æµ‹è¯•è´Ÿå€¼ï¼ˆå“åº”æ—¶é—´ä¸åº”è¯¥ä¸ºè´Ÿï¼Œä½†APIä¸é˜»æ­¢ï¼‰
  response_time_histogram.record(-1.0, [("endpoint", common::AttributeValue::string("/api/error"))])
  
  // æµ‹è¯•æ— ç©·å¤§å€¼
  response_time_histogram.record(1.0/0.0, [("endpoint", common::AttributeValue::string("/api/infinite"))])
  response_time_histogram.record(-1.0/0.0, [("endpoint", common::AttributeValue::string("/api/negative_infinite"))])
  
  // æµ‹è¯•NaNå€¼
  response_time_histogram.record(0.0/0.0, [("endpoint", common::AttributeValue::string("/api/nan"))])
  
  assert_eq(true, true)
  
  // åˆ›å»ºä¸åŒç±»å‹çš„ç›´æ–¹å›¾
  let cpu_usage_histogram = meter.create_histogram("cpu_usage_percent", "percent", "CPU usage percentage")
  let memory_usage_histogram = meter.create_histogram("memory_usage_bytes", "bytes", "Memory usage in bytes")
  
  // è®°å½•CPUä½¿ç”¨ç‡ï¼ˆ0-100%ï¼‰
  cpu_usage_histogram.record(25.5, [("instance", common::AttributeValue::string("server-1"))])
  cpu_usage_histogram.record(78.2, [("instance", common::AttributeValue::string("server-1"))])
  cpu_usage_histogram.record(45.0, [("instance", common::AttributeValue::string("server-2"))])
  cpu_usage_histogram.record(92.1, [("instance", common::AttributeValue::string("server-2"))])
  
  // è®°å½•å†…å­˜ä½¿ç”¨é‡
  memory_usage_histogram.record(1024.0 * 1024.0 * 512.0, [("instance", common::AttributeValue::string("server-1"))]) // 512MB
  memory_usage_histogram.record(1024.0 * 1024.0 * 1024.0 * 2.0, [("instance", common::AttributeValue::string("server-2"))]) // 2GB
  
  assert_eq(true, true)
}

test "up_down_counter_functionality" {
  // æµ‹è¯•ä¸Šä¸‹è®¡æ•°å™¨åŠŸèƒ½
  
  let noop_meter_provider = metrics::NoopMeterProvider::{}
  let meter = noop_meter_provider.get_meter("test-meter", "1.0.0")
  
  // åˆ›å»ºä¸Šä¸‹è®¡æ•°å™¨
  let active_connections = meter.create_up_down_counter("active_connections", "count", "Current active connections")
  
  // æµ‹è¯•å¢åŠ å’Œå‡å°‘æ“ä½œ
  active_connections.add(10L, [("service", common::AttributeValue::string("api-gateway"))])
  active_connections.add(5L, [("service", common::AttributeValue::string("api-gateway"))])
  active_connections.add(-3L, [("service", common::AttributeValue::string("api-gateway"))])
  active_connections.add(8L, [("service", common::AttributeValue::string("database"))])
  active_connections.add(-2L, [("service", common::AttributeValue::string("database"))])
  
  // éªŒè¯ä¸Šä¸‹è®¡æ•°å™¨æ“ä½œ
  assert_eq(true, true)
  
  // æµ‹è¯•é˜Ÿåˆ—é•¿åº¦æŒ‡æ ‡
  let queue_size = meter.create_up_down_counter("queue_size", "count", "Current queue size")
  
  // æ¨¡æ‹Ÿé˜Ÿåˆ—æ“ä½œ
  queue_size.add(100L, [("queue_name", common::AttributeValue::string("email_queue"))]) // åˆå§‹100ä¸ªé‚®ä»¶
  queue_size.add(-25L, [("queue_name", common::AttributeValue::string("email_queue"))]) // å¤„ç†äº†25ä¸ª
  queue_size.add(50L, [("queue_name", common::AttributeValue::string("email_queue"))]) // æ–°å¢50ä¸ª
  queue_size.add(-10L, [("queue_name", common::AttributeValue::string("email_queue"))]) // å¤„ç†äº†10ä¸ª
  
  // æ¨¡æ‹Ÿå¦ä¸€ä¸ªé˜Ÿåˆ—
  queue_size.add(20L, [("queue_name", common::AttributeValue::string("sms_queue"))])
  queue_size.add(-5L, [("queue_name", common::AttributeValue::string("sms_queue"))])
  queue_size.add(15L, [("queue_name", common::AttributeValue::string("sms_queue"))])
  
  assert_eq(true, true)
  
  // æµ‹è¯•å†…å­˜æ± æŒ‡æ ‡
  let memory_pool_size = meter.create_up_down_counter("memory_pool_size_bytes", "bytes", "Memory pool size in bytes")
  
  memory_pool_size.add(1024.0 * 1024.0 * 100.0, [("pool_type", common::AttributeValue::string("buffer"))]) // 100MB
  memory_pool_size.add(-1024.0 * 1024.0 * 25.0, [("pool_type", common::AttributeValue::string("buffer"))]) // é‡Šæ”¾25MB
  memory_pool_size.add(1024.0 * 1024.0 * 50.0, [("pool_type", common::AttributeValue::string("cache"))]) // 50MBç¼“å­˜
  
  assert_eq(true, true)
}

test "gauge_metric_functionality" {
  // æµ‹è¯•ä»ªè¡¨æŒ‡æ ‡åŠŸèƒ½
  
  let noop_meter_provider = metrics::NoopMeterProvider::{}
  let meter = noop_meter_provider.get_meter("test-meter", "1.0.0")
  
  // åˆ›å»ºä»ªè¡¨æŒ‡æ ‡
  let cpu_temperature = meter.create_gauge("cpu_temperature_celsius", "celsius", "CPU temperature")
  let memory_usage_percent = meter.create_gauge("memory_usage_percent", "percent", "Memory usage percentage")
  let disk_usage_bytes = meter.create_gauge("disk_usage_bytes", "bytes", "Disk usage in bytes")
  
  // æµ‹è¯•ä»ªè¡¨è®°å½•æ“ä½œ
  cpu_temperature.record(45.5, [("cpu_id", common::AttributeValue::string("cpu-0"))])
  cpu_temperature.record(52.1, [("cpu_id", common::AttributeValue::string("cpu-0"))])
  cpu_temperature.record(38.7, [("cpu_id", common::AttributeValue::string("cpu-1"))])
  cpu_temperature.record(41.2, [("cpu_id", common::AttributeValue::string("cpu-1"))])
  
  memory_usage_percent.record(67.8, [("instance", common::AttributeValue::string("web-server-1"))])
  memory_usage_percent.record(45.2, [("instance", common::AttributeValue::string("web-server-2"))])
  memory_usage_percent.record(89.1, [("instance", common::AttributeValue::string("database-server"))])
  
  disk_usage_bytes.record(1024.0 * 1024.0 * 1024.0 * 100.0, [("mount_point", common::AttributeValue::string("/"))]) // 100GB
  disk_usage_bytes.record(1024.0 * 1024.0 * 1024.0 * 50.0, [("mount_point", common::AttributeValue::string("/var"))]) // 50GB
  disk_usage_bytes.record(1024.0 * 1024.0 * 1024.0 * 200.0, [("mount_point", common::AttributeValue::string("/data"))]) // 200GB
  
  // éªŒè¯ä»ªè¡¨æ“ä½œ
  assert_eq(true, true)
  
  // æµ‹è¯•è¾¹ç•Œå€¼
  cpu_temperature.record(-10.0, [("cpu_id", common::AttributeValue::string("cpu-error"))]) // ä¸å¯èƒ½çš„æ¸©åº¦
  cpu_temperature.record(150.0, [("cpu_id", common::AttributeValue::string("cpu-overheat"))]) // è¿‡çƒ­æ¸©åº¦
  
  memory_usage_percent.record(-5.0, [("instance", common::AttributeValue::string("error-instance"))]) // è´Ÿç™¾åˆ†æ¯”
  memory_usage_percent.record(150.0, [("instance", common::AttributeValue::string("overflow-instance"))]) // è¶…è¿‡100%
  
  disk_usage_bytes.record(0.0, [("mount_point", common::AttributeValue::string("/empty"))]) // ç©ºç£ç›˜
  disk_usage_bytes.record(-1.0, [("mount_point", common::AttributeValue::string("/error"))]) // è´Ÿä½¿ç”¨é‡
  
  assert_eq(true, true)
}

test "metric_attributes_and_dimensions" {
  // æµ‹è¯•æŒ‡æ ‡å±æ€§å’Œç»´åº¦
  
  let noop_meter_provider = metrics::NoopMeterProvider::{}
  let meter = noop_meter_provider.get_meter("test-meter", "1.0.0")
  
  let request_counter = meter.create_counter("http_requests_total", "count", "HTTP requests")
  
  // æµ‹è¯•å•ç»´åº¦å±æ€§
  request_counter.add(1L, [("method", common::AttributeValue::string("GET"))])
  request_counter.add(1L, [("method", common::AttributeValue::string("POST"))])
  request_counter.add(1L, [("method", common::AttributeValue::string("PUT"))])
  request_counter.add(1L, [("method", common::AttributeValue::string("DELETE"))])
  
  // æµ‹è¯•å¤šç»´åº¦å±æ€§
  request_counter.add(1L, [
    ("method", common::AttributeValue::string("GET")),
    ("status", common::AttributeValue::string("200")),
    ("endpoint", common::AttributeValue::string("/api/users"))
  ])
  
  request_counter.add(1L, [
    ("method", common::AttributeValue::string("GET")),
    ("status", common::AttributeValue::string("404")),
    ("endpoint", common::AttributeValue::string("/api/users"))
  ])
  
  request_counter.add(1L, [
    ("method", common::AttributeValue::string("POST")),
    ("status", common::AttributeValue::string("201")),
    ("endpoint", common::AttributeValue::string("/api/users"))
  ])
  
  request_counter.add(1L, [
    ("method", common::AttributeValue::string("POST")),
    ("status", common::AttributeValue::string("400")),
    ("endpoint", common::AttributeValue::string("/api/users"))
  ])
  
  // æµ‹è¯•ä¸åŒç±»å‹çš„å±æ€§å€¼
  request_counter.add(1L, [
    ("method", common::AttributeValue::string("GET")),
    ("status_code", common::AttributeValue::int(200L)),
    ("response_time_ms", common::AttributeValue::float(123.4)),
    ("cache_hit", common::AttributeValue::bool(true)),
    ("server_version", common::AttributeValue::string("1.2.3"))
  ])
  
  // æµ‹è¯•æ•°ç»„å±æ€§å€¼
  request_counter.add(1L, [
    ("method", common::AttributeValue::string("GET")),
    ("allowed_methods", common::AttributeValue::array_string(["GET", "POST", "PUT"])),
    ("status_codes", common::AttributeValue::array_int([200L, 201L, 400L, 404L])),
    ("response_times", common::AttributeValue::array_float([100.0, 150.0, 200.0])),
    ("feature_flags", common::AttributeValue::array_bool([true, false, true]))
  ])
  
  assert_eq(true, true)
  
  // æµ‹è¯•ç‰¹æ®Šå­—ç¬¦å’Œé•¿å±æ€§å€¼
  request_counter.add(1L, [
    ("method", common::AttributeValue::string("GET")),
    ("endpoint", common::AttributeValue::string("/api/users/1234567890abcdefghijklmnopqrstuvwxyz")),
    ("user_agent", common::AttributeValue::string("Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36")),
    ("query_string", common::AttributeValue::string("param1=value1&param2=value2&param3=value%20with%20spaces")),
    ("special_chars", common::AttributeValue::string("ç‰¹æ®Šå­—ç¬¦_æµ‹è¯•_ğŸš€_emoji"))
  ])
  
  assert_eq(true, true)
}

test "metric_measurement_aggregations" {
  // æµ‹è¯•æŒ‡æ ‡æµ‹é‡èšåˆ
  
  // æ¨¡æ‹Ÿæµ‹é‡æ•°æ®
  let response_time_measurements = [
    metrics::Measurement::{ value: 10.5, attributes: [("endpoint", common::AttributeValue::string("/api/fast"))] },
    metrics::Measurement::{ value: 15.2, attributes: [("endpoint", common::AttributeValue::string("/api/fast"))] },
    metrics::Measurement::{ value: 12.8, attributes: [("endpoint", common::AttributeValue::string("/api/fast"))] },
    metrics::Measurement::{ value: 8.9, attributes: [("endpoint", common::AttributeValue::string("/api/fast"))] },
    metrics::Measurement::{ value: 11.1, attributes: [("endpoint", common::AttributeValue::string("/api/fast"))] }
  ]
  
  let cpu_usage_measurements = [
    metrics::Measurement::{ value: 25.5, attributes: [("instance", common::AttributeValue::string("server-1"))] },
    metrics::Measurement::{ value: 78.2, attributes: [("instance", common::AttributeValue::string("server-1"))] },
    metrics::Measurement::{ value: 45.0, attributes: [("instance", common::AttributeValue::string("server-2"))] },
    metrics::Measurement::{ value: 92.1, attributes: [("instance", common::AttributeValue::string("server-2"))] },
    metrics::Measurement::{ value: 67.8, attributes: [("instance", common::AttributeValue::string("server-3"))] }
  ]
  
  // éªŒè¯æµ‹é‡æ•°æ®
  assert_eq(response_time_measurements.length(), 5)
  assert_eq(cpu_usage_measurements.length(), 5)
  
  // è®¡ç®—å“åº”æ—¶é—´ç»Ÿè®¡
  let mut response_time_sum = 0.0
  let mut response_time_min = response_time_measurements[0].value
  let mut response_time_max = response_time_measurements[0].value
  let mut i = 0
  
  while i < response_time_measurements.length() {
    let value = response_time_measurements[i].value
    response_time_sum = response_time_sum + value
    
    if value < response_time_min {
      response_time_min = value
    }
    
    if value > response_time_max {
      response_time_max = value
    }
    
    i = i + 1
  }
  
  let response_time_avg = response_time_sum / response_time_measurements.length().to_double()
  
  // éªŒè¯å“åº”æ—¶é—´ç»Ÿè®¡
  assert_eq(response_time_sum, 58.5)
  assert_eq(response_time_min, 8.9)
  assert_eq(response_time_max, 15.2)
  assert_eq(response_time_avg, 11.7)
  
  // è®¡ç®—CPUä½¿ç”¨ç‡ç»Ÿè®¡
  let mut cpu_usage_sum = 0.0
  let mut cpu_usage_min = cpu_usage_measurements[0].value
  let mut cpu_usage_max = cpu_usage_measurements[0].value
  i = 0
  
  while i < cpu_usage_measurements.length() {
    let value = cpu_usage_measurements[i].value
    cpu_usage_sum = cpu_usage_sum + value
    
    if value < cpu_usage_min {
      cpu_usage_min = value
    }
    
    if value > cpu_usage_max {
      cpu_usage_max = value
    }
    
    i = i + 1
  }
  
  let cpu_usage_avg = cpu_usage_sum / cpu_usage_measurements.length().to_double()
  
  // éªŒè¯CPUä½¿ç”¨ç‡ç»Ÿè®¡
  assert_eq(cpu_usage_sum, 308.6)
  assert_eq(cpu_usage_min, 25.5)
  assert_eq(cpu_usage_max, 92.1)
  assert_eq(cpu_usage_avg, 61.72)
}

test "metric_instrument_types_validation" {
  // æµ‹è¯•æŒ‡æ ‡å·¥å…·ç±»å‹éªŒè¯
  
  let noop_meter_provider = metrics::NoopMeterProvider::{}
  let meter = noop_meter_provider.get_meter("test-meter", "1.0.0")
  
  // éªŒè¯ä¸åŒç±»å‹çš„æŒ‡æ ‡å·¥å…·åˆ›å»º
  let counter = meter.create_counter("test_counter", "count", "Test counter")
  let histogram = meter.create_histogram("test_histogram", "ms", "Test histogram")
  let up_down_counter = meter.create_up_down_counter("test_up_down_counter", "count", "Test up-down counter")
  let gauge = meter.create_gauge("test_gauge", "percent", "Test gauge")
  
  // éªŒè¯æŒ‡æ ‡å·¥å…·ç±»å‹
  assert_eq(counter is metrics::Counter, true)
  assert_eq(histogram is metrics::Histogram, true)
  assert_eq(up_down_counter is metrics::UpDownCounter, true)
  assert_eq(gauge is metrics::Gauge, true)
  
  // æµ‹è¯•æ‰€æœ‰æŒ‡æ ‡å·¥å…·çš„æ“ä½œ
  counter.add(10L, [("test", common::AttributeValue::string("counter"))])
  histogram.record(100.0, [("test", common::AttributeValue::string("histogram"))])
  up_down_counter.add(-5L, [("test", common::AttributeValue::string("up_down"))])
  gauge.record(75.0, [("test", common::AttributeValue::string("gauge"))])
  
  assert_eq(true, true)
  
  // æµ‹è¯•å¤šä¸ªMeterå®ä¾‹
  let meter2 = noop_meter_provider.get_meter("test-meter-2", "2.0.0", "http://example.com/schema")
  let counter2 = meter2.create_counter("test_counter_2", "count", "Test counter 2")
  
  counter2.add(20L, [("meter", common::AttributeValue::string("meter2"))])
  
  assert_eq(true, true)
}

test "metric_boundary_conditions" {
  // æµ‹è¯•æŒ‡æ ‡è¾¹ç•Œæ¡ä»¶
  
  let noop_meter_provider = metrics::NoopMeterProvider::{}
  let meter = noop_meter_provider.get_meter("test-meter", "1.0.0")
  
  let counter = meter.create_counter("boundary_counter", "count", "Boundary test counter")
  let histogram = meter.create_histogram("boundary_histogram", "ms", "Boundary test histogram")
  let up_down_counter = meter.create_up_down_counter("boundary_up_down", "count", "Boundary test up-down counter")
  let gauge = meter.create_gauge("boundary_gauge", "percent", "Boundary test gauge")
  
  // æµ‹è¯•æå€¼
  let max_int64 = 9223372036854775807L
  let min_int64 = -9223372036854775808L
  let max_double = 1.7976931348623157e+308
  let min_double = -1.7976931348623157e+308
  
  // æµ‹è¯•è®¡æ•°å™¨æå€¼
  counter.add(max_int64, [("test", common::AttributeValue::string("max"))])
  counter.add(min_int64, [("test", common::AttributeValue::string("min"))])
  counter.add(0L, [("test", common::AttributeValue::string("zero"))])
  
  // æµ‹è¯•ä¸Šä¸‹è®¡æ•°å™¨æå€¼
  up_down_counter.add(max_int64, [("test", common::AttributeValue::string("max"))])
  up_down_counter.add(min_int64, [("test", common::AttributeValue::string("min"))])
  up_down_counter.add(0L, [("test", common::AttributeValue::string("zero"))])
  
  // æµ‹è¯•ç›´æ–¹å›¾æå€¼
  histogram.record(max_double, [("test", common::AttributeValue::string("max"))])
  histogram.record(min_double, [("test", common::AttributeValue::string("min"))])
  histogram.record(0.0, [("test", common::AttributeValue::string("zero"))])
  histogram.record(1.0/0.0, [("test", common::AttributeValue::string("inf"))])
  histogram.record(-1.0/0.0, [("test", common::AttributeValue::string("neg_inf"))])
  histogram.record(0.0/0.0, [("test", common::AttributeValue::string("nan"))])
  
  // æµ‹è¯•ä»ªè¡¨æå€¼
  gauge.record(max_double, [("test", common::AttributeValue::string("max"))])
  gauge.record(min_double, [("test", common::AttributeValue::string("min"))])
  gauge.record(0.0, [("test", common::AttributeValue::string("zero"))])
  gauge.record(1.0/0.0, [("test", common::AttributeValue::string("inf"))])
  gauge.record(-1.0/0.0, [("test", common::AttributeValue::string("neg_inf"))])
  gauge.record(0.0/0.0, [("test", common::AttributeValue::string("nan"))])
  
  assert_eq(true, true)
  
  // æµ‹è¯•ç©ºå±æ€§å’Œå¤§é‡å±æ€§
  let empty_attrs = [] : Array[(String, common::AttributeValue)]
  let many_attrs = [] : Array[(String, common::AttributeValue)]
  let mut i = 0
  
  while i < 50 {
    many_attrs.push(("attr" + i.to_string(), common::AttributeValue::string("value" + i.to_string())))
    i = i + 1
  }
  
  counter.add(1L, empty_attrs)
  counter.add(1L, many_attrs)
  
  assert_eq(true, true)
}

test "metric_meter_and_provider_operations" {
  // æµ‹è¯•Meterå’ŒProvideræ“ä½œ
  
  let noop_meter_provider = metrics::NoopMeterProvider::{}
  
  // æµ‹è¯•å¤šä¸ªMeteråˆ›å»º
  let meter1 = noop_meter_provider.get_meter("meter1", "1.0.0")
  let meter2 = noop_meter_provider.get_meter("meter2", "2.0.0", "http://example.com/schema1")
  let meter3 = noop_meter_provider.get_meter("meter3", "3.0.0", "http://example.com/schema2")
  let meter4 = noop_meter_provider.get_meter("meter4", None, None) // ä½¿ç”¨å¯é€‰å‚æ•°
  let meter5 = noop_meter_provider.get_meter("meter5", "5.0.0", None) // éƒ¨åˆ†å¯é€‰å‚æ•°
  
  // éªŒè¯Meteråˆ›å»º
  assert_eq(meter1 is metrics::Meter, true)
  assert_eq(meter2 is metrics::Meter, true)
  assert_eq(meter3 is metrics::Meter, true)
  assert_eq(meter4 is metrics::Meter, true)
  assert_eq(meter5 is metrics::Meter, true)
  
  // ä»ä¸åŒMeteråˆ›å»ºæŒ‡æ ‡
  let counter1 = meter1.create_counter("counter1", "count", "Counter from meter1")
  let histogram2 = meter2.create_histogram("histogram2", "ms", "Histogram from meter2")
  let up_down_counter3 = meter3.create_up_down_counter("up_down3", "count", "UpDownCounter from meter3")
  let gauge4 = meter4.create_gauge("gauge4", "percent", "Gauge from meter4")
  let counter5 = meter5.create_counter("counter5", "count", "Counter from meter5")
  
  // æµ‹è¯•æ‰€æœ‰æŒ‡æ ‡æ“ä½œ
  counter1.add(1L, [("meter", common::AttributeValue::string("meter1"))])
  histogram2.record(100.0, [("meter", common::AttributeValue::string("meter2"))])
  up_down_counter3.add(-1L, [("meter", common::AttributeValue::string("meter3"))])
  gauge4.record(50.0, [("meter", common::AttributeValue::string("meter4"))])
  counter5.add(1L, [("meter", common::AttributeValue::string("meter5"))])
  
  assert_eq(true, true)
  
  // æµ‹è¯•ç›¸åŒåç§°çš„å¤šæ¬¡åˆ›å»º
  let counter1_dup = meter1.create_counter("counter1", "count", "Duplicate counter")
  let meter1_dup = noop_meter_provider.get_meter("meter1", "1.0.0")
  
  counter1_dup.add(1L, [("test", common::AttributeValue::string("duplicate"))])
  
  assert_eq(true, true)
}