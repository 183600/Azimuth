// Azimuth Telemetry - Error Recovery and Edge Cases Tests
// æµ‹è¯•é”™è¯¯æ¢å¤å’Œè¾¹ç•Œæƒ…å†µ

test "error_recovery_malformed_data_handling" {
  // æµ‹è¯•æ ¼å¼é”™è¯¯æ•°æ®çš„å¤„ç†å’Œæ¢å¤
  let base_context = @azimuth.telemetry.api.context.Context::empty()
  
  // æµ‹è¯•åŒ…å«æ ¼å¼é”™è¯¯çš„Spanå±æ€§
  let malformed_span_attrs = [
    ("empty.key", @azimuth.telemetry.api.common.AttributeValue::string("")),
    ("key.with.dots", @azimuth.telemetry.api.common.AttributeValue::string("valid.value")),
    ("key with spaces", @azimuth.telemetry.api.common.AttributeValue::string("spaces.in.key")),
    ("key@with#special", @azimuth.telemetry.api.common.AttributeValue::string("special.chars")),
    ("", @azimuth.telemetry.api.common.AttributeValue::string("empty.key.name"))
  ]
  
  let (_, malformed_span) = @azimuth.telemetry.api.trace.NoopTracer::start_span(
    base_context,
    "malformed-attributes-span",
    Some(@azimuth.telemetry.api.trace.Server),
    Some(malformed_span_attrs)
  )
  
  // éªŒè¯æ ¼å¼é”™è¯¯çš„å±æ€§èƒ½å¤Ÿæ­£å¸¸å¤„ç†
  assert_eq(malformed_span.name, "malformed-attributes-span")
  assert_eq(malformed_span.attributes.length(), 5)
  
  // æµ‹è¯•åŒ…å«æ ¼å¼é”™è¯¯çš„LogRecordå±æ€§
  let malformed_log = @azimuth.telemetry.api.logs.LogRecord::builder()
    .timestamp(1640995200000000000L)
    .severity(@azimuth.telemetry.api.logs.Info)
    .body("Malformed data test")
    .with_attribute("empty.key", @azimuth.telemetry.api.common.AttributeValue::string(""))
    .with_attribute("key.with.dots", @azimuth.telemetry.api.common.AttributeValue::string("valid.value"))
    .with_attribute("key with spaces", @azimuth.telemetry.api.common.AttributeValue::string("spaces.in.key"))
    .with_attribute("", @azimuth.telemetry.api.common.AttributeValue::string("empty.key.name"))
    .build()
  
  // éªŒè¯æ ¼å¼é”™è¯¯çš„æ—¥å¿—èƒ½å¤Ÿæ­£å¸¸å¤„ç†
  assert_eq(malformed_log.body, Some("Malformed data test"))
  assert_eq(malformed_log.attributes.length(), 4)
}

test "error_recovery_extreme_numeric_values" {
  // æµ‹è¯•æå€¼æ•°å€¼çš„é”™è¯¯æ¢å¤
  let base_context = @azimuth.telemetry.api.context.Context::empty()
  
  // æµ‹è¯•æå€¼Int64å±æ€§
  let extreme_int_attrs = [
    ("min.int", @azimuth.telemetry.api.common.AttributeValue::int(-9223372036854775808L)),
    ("max.int", @azimuth.telemetry.api.common.AttributeValue::int(9223372036854775807L)),
    ("zero.int", @azimuth.telemetry.api.common.AttributeValue::int(0L)),
    ("negative.one", @azimuth.telemetry.api.common.AttributeValue::int(-1L)),
    ("positive.one", @azimuth.telemetry.api.common.AttributeValue::int(1L))
  ]
  
  let (_, extreme_int_span) = @azimuth.telemetry.api.trace.NoopTracer::start_span(
    base_context,
    "extreme-int-span",
    Some(@azimuth.telemetry.api.trace.Server),
    Some(extreme_int_attrs)
  )
  
  // éªŒè¯æå€¼Int64èƒ½å¤Ÿæ­£å¸¸å¤„ç†
  assert_eq(extreme_int_span.name, "extreme-int-span")
  assert_eq(extreme_int_span.attributes.length(), 5)
  
  // æµ‹è¯•æå€¼Float64å±æ€§
  let extreme_float_attrs = [
    ("min.float", @azimuth.telemetry.api.common.AttributeValue::float(-1.7976931348623157e+308)),
    ("max.float", @azimuth.telemetry.api.common.AttributeValue::float(1.7976931348623157e+308)),
    ("zero.float", @azimuth.telemetry.api.common.AttributeValue::float(0.0)),
    ("negative.zero", @azimuth.telemetry.api.common.AttributeValue::float(-0.0)),
    ("nan.float", @azimuth.telemetry.api.common.AttributeValue::float(0.0/0.0)),
    ("positive.inf", @azimuth.telemetry.api.common.AttributeValue::float(1.0/0.0)),
    ("negative.inf", @azimuth.telemetry.api.common.AttributeValue::float(-1.0/0.0)),
    ("very.small", @azimuth.telemetry.api.common.AttributeValue::float(1e-308)),
    ("very.large", @azimuth.telemetry.api.common.AttributeValue::float(1e308))
  ]
  
  let extreme_float_log = @azimuth.telemetry.api.logs.LogRecord::builder()
    .timestamp(1640995200000000000L)
    .severity(@azimuth.telemetry.api.logs.Warn)
    .body("Extreme float values test")
    .with_attribute("min.float", @azimuth.telemetry.api.common.AttributeValue::float(-1.7976931348623157e+308))
    .with_attribute("max.float", @azimuth.telemetry.api.common.AttributeValue::float(1.7976931348623157e+308))
    .with_attribute("nan.float", @azimuth.telemetry.api.common.AttributeValue::float(0.0/0.0))
    .with_attribute("positive.inf", @azimuth.telemetry.api.common.AttributeValue::float(1.0/0.0))
    .build()
  
  // éªŒè¯æå€¼Float64èƒ½å¤Ÿæ­£å¸¸å¤„ç†
  assert_eq(extreme_float_log.body, Some("Extreme float values test"))
  assert_eq(extreme_float_log.attributes.length(), 4)
  
  // éªŒè¯NaNå’Œæ— ç©·å€¼
  match extreme_float_log.attributes[2] {
    ("nan.float", @azimuth.telemetry.api.common.AttributeValue::FloatValue(nan_val)) => {
      assert_eq(nan_val/nan_val != nan_val/nan_val, true) // NaNæ£€æŸ¥
    }
    _ => @test.fail("Expected NaN float value")
  }
  
  match extreme_float_log.attributes[3] {
    ("positive.inf", @azimuth.telemetry.api.common.AttributeValue::FloatValue(inf_val)) => {
      assert_eq(inf_val > 0.0, true) // æ­£æ— ç©·æ£€æŸ¥
    }
    _ => @test.fail("Expected infinity float value")
  }
}

test "error_recovery_unicode_and_encoding_issues" {
  // æµ‹è¯•Unicodeå’Œç¼–ç é—®é¢˜çš„é”™è¯¯æ¢å¤
  let base_context = @azimuth.telemetry.api.context.Context::empty()
  
  // æµ‹è¯•å„ç§Unicodeå­—ç¬¦
  let unicode_attrs = [
    ("chinese", @azimuth.telemetry.api.common.AttributeValue::string("ä¸­æ–‡æµ‹è¯•")),
    ("japanese", @azimuth.telemetry.api.common.AttributeValue::string("æ—¥æœ¬èªãƒ†ã‚¹ãƒˆ")),
    ("korean", @azimuth.telemetry.api.common.AttributeValue::string("í•œêµ­ì–´ í…ŒìŠ¤íŠ¸")),
    ("arabic", @azimuth.telemetry.api.common.AttributeValue::string("Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©")),
    ("emoji", @azimuth.telemetry.api.common.AttributeValue::string("ğŸ”¥ ğŸš€ âœ¨ ğŸ‰ ğŸŠ")),
    ("mixed", @azimuth.telemetry.api.common.AttributeValue::string("Mixed: ä¸­æ–‡ ğŸš€ English æ—¥æœ¬èª ğŸ‰")),
    ("symbols", @azimuth.telemetry.api.common.AttributeValue::string("Symbols: â™ ï¸ â™¥ï¸ â™¦ï¸ â™£ï¸ â˜… â˜†")),
    ("currency", @azimuth.telemetry.api.common.AttributeValue::string("Currency: $ â‚¬ Â£ Â¥ â‚© â‚¹")),
    ("math", @azimuth.telemetry.api.common.AttributeValue::string("Math: âˆ‘ âˆ âˆ« âˆ‚ âˆ‡ âˆ† âˆ‡")),
    ("control.chars", @azimuth.telemetry.api.common.AttributeValue::string("Control: \n\t\r"))
  ]
  
  let (_, unicode_span) = @azimuth.telemetry.api.trace.NoopTracer::start_span(
    base_context,
    "unicode-span",
    Some(@azimuth.telemetry.api.trace.Server),
    Some(unicode_attrs)
  )
  
  // éªŒè¯Unicodeå­—ç¬¦èƒ½å¤Ÿæ­£å¸¸å¤„ç†
  assert_eq(unicode_span.name, "unicode-span")
  assert_eq(unicode_span.attributes.length(), 10)
  
  // æµ‹è¯•åŒ…å«Unicodeçš„æ—¥å¿—
  let unicode_log = @azimuth.telemetry.api.logs.LogRecord::builder()
    .timestamp(1640995200000000000L)
    .severity(@azimuth.telemetry.api.logs.Info)
    .body("Unicodeæ—¥å¿—æ¶ˆæ¯: åŒ…å«ä¸­æ–‡ã€Englishã€æ—¥æœ¬èªã€í•œêµ­ì–´")
    .with_attribute("unicode.body", @azimuth.telemetry.api.common.AttributeValue::string("Unicodeæµ‹è¯•: ğŸ”¥ ğŸš€ âœ¨"))
    .with_attribute("mixed.script", @azimuth.telemetry.api.common.AttributeValue::string("Mixed: ä¸­æ–‡Englishæ—¥æœ¬èªí•œêµ­ì–´"))
    .build()
  
  // éªŒè¯Unicodeæ—¥å¿—èƒ½å¤Ÿæ­£å¸¸å¤„ç†
  assert_eq(unicode_log.body, Some("Unicodeæ—¥å¿—æ¶ˆæ¯: åŒ…å«ä¸­æ–‡ã€Englishã€æ—¥æœ¬èªã€í•œêµ­ì–´"))
  assert_eq(unicode_log.attributes.length(), 2)
}

test "error_recovery_propagation_malformed_headers" {
  // æµ‹è¯•ä¼ æ’­ä¸­æ ¼å¼é”™è¯¯çš„headerå¤„ç†
  let base_context = @azimuth.telemetry.api.context.Context::empty()
  
  // æµ‹è¯•å„ç§æ ¼å¼é”™è¯¯çš„traceparent header
  let malformed_traceparents = [
    "", // ç©ºå­—ç¬¦ä¸²
    "invalid-format", // å®Œå…¨æ— æ•ˆæ ¼å¼
    "00-", // ç¼ºå°‘trace_id, span_id, flags
    "00-0af7651916cd43dd8448eb211c80319c", // ç¼ºå°‘span_id, flags
    "00-0af7651916cd43dd8448eb211c80319c-b7ad6b7169203331", // ç¼ºå°‘flags
    "00-0af7651916cd43dd8448eb211c80319c-b7ad6b7169203331-011", // flagså¤ªé•¿
    "00-0af7651916cd43dd8448eb211c80319g-b7ad6b7169203331-01", // æ— æ•ˆçš„trace_idå­—ç¬¦
    "00-0af7651916cd43dd8448eb211c80319c-b7ad6b716920333z-01", // æ— æ•ˆçš„span_idå­—ç¬¦
    "00-0af7651916cd43dd8448eb211c80319c-b7ad6b7169203331-1z", // æ— æ•ˆçš„flagså­—ç¬¦
    "01-0af7651916cd43dd8448eb211c80319c-b7ad6b7169203331-01", // ä¸æ”¯æŒçš„ç‰ˆæœ¬
    "00-0af7651916cd43dd8448eb211c80319c-b7ad6b7169203331-01-extra", // é¢å¤–å­—æ®µ
    "00--b7ad6b7169203331-01", // ç¼ºå°‘trace_id
    "00-0af7651916cd43dd8448eb211c80319c--01", // ç¼ºå°‘span_id
    "00-0af7651916cd43dd8448eb211c80319c-b7ad6b7169203331-" // ç¼ºå°‘flags
  ]
  
  // æµ‹è¯•æ¯ä¸ªæ ¼å¼é”™è¯¯çš„traceparentéƒ½èƒ½æ­£å¸¸å¤„ç†
  let mut index = 0
  while index < malformed_traceparents.length() {
    let malformed_traceparent = malformed_traceparents[index]
    let mut data = []
    data = data.push((@azimuth.telemetry.api.propagation.TRACE_PARENT_HEADER, malformed_traceparent))
    let carrier = @azimuth.telemetry.api.propagation.MapCarrier::from_map(data)
    
    // æå–æ“ä½œåº”è¯¥èƒ½å¤Ÿå¤„ç†é”™è¯¯æ ¼å¼è€Œä¸å´©æºƒ
    let recovered_ctx = @azimuth.telemetry.api.propagation.W3CTraceContextPropagator::extract(base_context, carrier)
    assert_eq(true, true) // å¦‚æœæ²¡æœ‰å´©æºƒå°±ç®—æˆåŠŸ
    
    index = index + 1
  }
  
  // æµ‹è¯•å„ç§æ ¼å¼é”™è¯¯çš„baggage header
  let malformed_baggages = [
    "", // ç©ºå­—ç¬¦ä¸²
    "invalid-format", // æ²¡æœ‰ç­‰å·
    "key=", // ç©ºå€¼
    "=value", // ç©ºé”®
    "key=value=extra", // å¤šä¸ªç­‰å·
    "key@=value", // é”®åŒ…å«æ— æ•ˆå­—ç¬¦
    "key=value,invalid@", // é€—å·åçš„æ— æ•ˆæ ¼å¼
    "key=value,key2=value2@invalid", // æ— æ•ˆåç¼€
    ",", // åªæœ‰é€—å·
    "key=value,", // ç»“å°¾é€—å·
    ",key=value", // å¼€å¤´é€—å·
    "key=value,,key2=value2", // è¿ç»­é€—å·
    "a".repeat(257) + "=value", // é”®è¿‡é•¿
    "key=" + "a".repeat(257), // å€¼è¿‡é•¿
    "key=value\\", // ä¸å®Œæ•´çš„è½¬ä¹‰
    "key=value\\invalid", // æ— æ•ˆçš„è½¬ä¹‰åºåˆ—
    "key=value\\\\", // åŒåæ–œæ 
    "key=value%2", // ä¸å®Œæ•´çš„URLç¼–ç 
    "key=value%ZZ" // æ— æ•ˆçš„URLç¼–ç 
  ]
  
  // æµ‹è¯•æ¯ä¸ªæ ¼å¼é”™è¯¯çš„baggageéƒ½èƒ½æ­£å¸¸å¤„ç†
  let mut index = 0
  while index < malformed_baggages.length() {
    let malformed_baggage = malformed_baggages[index]
    let mut data = []
    data = data.push((@azimuth.telemetry.api.propagation.BAGGAGE_HEADER, malformed_baggage))
    let carrier = @azimuth.telemetry.api.propagation.MapCarrier::from_map(data)
    
    // æå–æ“ä½œåº”è¯¥èƒ½å¤Ÿå¤„ç†é”™è¯¯æ ¼å¼è€Œä¸å´©æºƒ
    let recovered_ctx = @azimuth.telemetry.api.propagation.W3CBaggagePropagator::extract(base_context, carrier)
    assert_eq(true, true) // å¦‚æœæ²¡æœ‰å´©æºƒå°±ç®—æˆåŠŸ
    
    index = index + 1
  }
}

test "error_recovery_memory_pressure_simulation" {
  // æµ‹è¯•å†…å­˜å‹åŠ›ä¸‹çš„é”™è¯¯æ¢å¤
  let base_context = @azimuth.telemetry.api.context.Context::empty()
  
  // åˆ›å»ºå¤§é‡å¤§å‹å¯¹è±¡æ¥æ¨¡æ‹Ÿå†…å­˜å‹åŠ›
  let mut large_objects = []
  let mut index = 0
  while index < 50 {
    // åˆ›å»ºå¤§å‹å±æ€§æ•°ç»„
    let mut large_attrs = []
    let mut attr_index = 0
    while attr_index < 500 {
      large_attrs = large_attrs.push((
        "large.attr." + attr_index.to_string(),
        @azimuth.telemetry.api.common.AttributeValue::string("a".repeat(2000))
      ))
      attr_index = attr_index + 1
    }
    
    // åˆ›å»ºåŒ…å«æå€¼çš„å±æ€§
    let extreme_attrs = large_attrs.push([
      ("min.int", @azimuth.telemetry.api.common.AttributeValue::int(-9223372036854775808L)),
      ("max.float", @azimuth.telemetry.api.common.AttributeValue::float(1.7976931348623157e+308)),
      ("nan.value", @azimuth.telemetry.api.common.AttributeValue::float(0.0/0.0)),
      ("unicode.text", @azimuth.telemetry.api.common.AttributeValue::string("Unicodeæµ‹è¯•: ğŸ”¥ ğŸš€ âœ¨ ".repeat(100))),
      ("empty.value", @azimuth.telemetry.api.common.AttributeValue::string(""))
    ])
    
    // åˆ›å»ºå¤§å‹Span
    let (_, large_span) = @azimuth.telemetry.api.trace.NoopTracer::start_span(
      base_context,
      "memory-pressure-span-" + index.to_string(),
      Some(@azimuth.telemetry.api.trace.Server),
      Some(extreme_attrs)
    )
    
    // åˆ›å»ºå¤§å‹LogRecord
    let large_log = @azimuth.telemetry.api.logs.LogRecord::builder()
      .timestamp(1640995200000000000L + index.to_int64() * 1000000L)
      .severity(if index % 10 == 0 { @azimuth.telemetry.api.logs.Error } else { @azimuth.telemetry.api.logs.Info })
      .body("a".repeat(5000))
      .with_attribute("large.data", @azimuth.telemetry.api.common.AttributeValue::ArrayStringValue([
        "a".repeat(1000), "b".repeat(1000), "c".repeat(1000), "d".repeat(1000), "e".repeat(1000)
      ]))
      .with_attribute("extreme.values", @azimuth.telemetry.api.common.AttributeValue::ArrayIntValue([
        -9223372036854775808L, 0L, 9223372036854775807L
      ]))
      .build()
    
    large_objects = large_objects.push((large_span, large_log))
    index = index + 1
  }
  
  // éªŒè¯å†…å­˜å‹åŠ›ä¸‹çš„å¤§å¯¹è±¡èƒ½å¤Ÿæ­£å¸¸å¤„ç†
  assert_eq(large_objects.length(), 50)
  
  // éªŒè¯æ¯ä¸ªå¯¹è±¡éƒ½æœ‰æ­£ç¡®çš„å±æ€§
  let mut verified_objects = 0
  let mut index = 0
  while index < large_objects.length() {
    let (span, log) = large_objects[index]
    let expected_span_name = "memory-pressure-span-" + index.to_string()
    
    if span.name == expected_span_name && span.attributes.length() == 505 && log.body?.length() == 5000 {
      verified_objects = verified_objects + 1
    }
    index = index + 1
  }
  
  assert_eq(verified_objects, 50)
}

test "error_recovery_concurrent_access_simulation" {
  // æµ‹è¯•å¹¶å‘è®¿é—®çš„é”™è¯¯æ¢å¤
  let shared_context = @azimuth.telemetry.api.context.Context::empty()
    .with_value(@azimuth.telemetry.api.context.create_key("shared.resource"), "shared.value")
  
  // æ¨¡æ‹Ÿå¤šä¸ª"çº¿ç¨‹"åŒæ—¶è®¿é—®å’Œä¿®æ”¹å…±äº«èµ„æº
  let mut results = []
  let mut index = 0
  while index < 100 {
    let thread_id = "thread-" + index.to_string()
    
    // è¯»å–å…±äº«èµ„æº
    let shared_value = shared_context.get(@azimuth.telemetry.api.context.create_key("shared.resource"))
    
    // åˆ›å»ºåŸºäºå…±äº«èµ„æºçš„æ–°ä¸Šä¸‹æ–‡
    let thread_context = shared_context
      .with_value(@azimuth.telemetry.api.context.create_key("thread.id"), thread_id)
      .with_value(@azimuth.telemetry.api.context.create_key("thread.local"), "local.value-" + index.to_string())
    
    // æ¨¡æ‹Ÿé”™è¯¯æƒ…å†µï¼šå°è¯•è®¿é—®ä¸å­˜åœ¨çš„é”®
    let missing_value = thread_context.get(@azimuth.telemetry.api.context.create_key("nonexistent.key"))
    
    // æ¨¡æ‹Ÿé”™è¯¯æƒ…å†µï¼šä½¿ç”¨ç©ºé”®
    let empty_key = @azimuth.telemetry.api.context.create_key("")
    let empty_key_value = thread_context.get(empty_key)
    
    // åˆ›å»ºSpanæ¥è®°å½•çº¿ç¨‹æ“ä½œ
    let (_, span) = @azimuth.telemetry.api.trace.NoopTracer::start_span(
      thread_context,
      "concurrent-access-" + index.to_string(),
      Some(@azimuth.telemetry.api.trace.Internal),
      Some([
        ("thread.id", @azimuth.telemetry.api.common.AttributeValue::string(thread_id)),
        ("shared.value", @azimuth.telemetry.api.common.AttributeValue::string(shared_value?)),
        ("missing.value", @azimuth.telemetry.api.common.AttributeValue::string(missing_value?)),
        ("empty.key.value", @azimuth.telemetry.api.common.AttributeValue::string(empty_key_value?)),
        ("operation.type", @azimuth.telemetry.api.common.AttributeValue::string("concurrent.access"))
      ])
    )
    
    // åˆ›å»ºLogRecordæ¥è®°å½•æ“ä½œç»“æœ
    let log = @azimuth.telemetry.api.logs.LogRecord::builder()
      .timestamp(1640995200000000000L + index.to_int64() * 1000000L)
      .severity(if missing_value != None || empty_key_value != None { @azimuth.telemetry.api.logs.Warn } else { @azimuth.telemetry.api.logs.Info })
      .body("Concurrent access operation " + index.to_string())
      .with_attribute("thread.id", @azimuth.telemetry.api.common.AttributeValue::string(thread_id))
      .with_attribute("shared.access", @azimuth.telemetry.api.common.AttributeValue::bool(shared_value != None))
      .with_attribute("missing.access", @azimuth.telemetry.api.common.AttributeValue::bool(missing_value != None))
      .with_attribute("empty.key.access", @azimuth.telemetry.api.common.AttributeValue::bool(empty_key_value != None))
      .build()
    
    results = results.push((shared_value, missing_value, empty_key_value))
    index = index + 1
  }
  
  // éªŒè¯å¹¶å‘è®¿é—®çš„é”™è¯¯æ¢å¤
  let mut successful_access = 0
  let mut missing_access = 0
  let mut empty_key_access = 0
  let mut index = 0
  while index < results.length() {
    let (shared_val, missing_val, empty_val) = results[index]
    if shared_val == Some("shared.value") {
      successful_access = successful_access + 1
    }
    if missing_val == None {
      missing_access = missing_access + 1
    }
    if empty_val == None {
      empty_key_access = empty_key_access + 1
    }
    index = index + 1
  }
  
  assert_eq(successful_access, 100)
  assert_eq(missing_access, 100)
  assert_eq(empty_key_access, 100)
}

test "error_recovery_complex_failure_scenarios" {
  // æµ‹è¯•å¤æ‚å¤±è´¥åœºæ™¯çš„é”™è¯¯æ¢å¤
  let base_context = @azimuth.telemetry.api.context.Context::empty()
  
  // æ¨¡æ‹Ÿå¤æ‚çš„å¤±è´¥åœºæ™¯
  let failure_scenarios = [
    // åœºæ™¯1ï¼šæ ¼å¼é”™è¯¯çš„å±æ€§é”®å’Œå€¼
    {
      name: "malformed-attributes",
      attrs: [
        ("", @azimuth.telemetry.api.common.AttributeValue::string("empty.key")),
        ("key.with spaces", @azimuth.telemetry.api.common.AttributeValue::string("spaces.in.key")),
        ("key@with#special", @azimuth.telemetry.api.common.AttributeValue::string("special.chars"))
      ]
    },
    // åœºæ™¯2ï¼šæå€¼æ•°å€¼
    {
      name: "extreme-values",
      attrs: [
        ("min.int", @azimuth.telemetry.api.common.AttributeValue::int(-9223372036854775808L)),
        ("max.float", @azimuth.telemetry.api.common.AttributeValue::float(1.7976931348623157e+308)),
        ("nan.value", @azimuth.telemetry.api.common.AttributeValue::float(0.0/0.0)),
        ("inf.value", @azimuth.telemetry.api.common.AttributeValue::float(1.0/0.0))
      ]
    },
    // åœºæ™¯3ï¼šUnicodeå’Œç‰¹æ®Šå­—ç¬¦
    {
      name: "unicode-special",
      attrs: [
        ("chinese", @azimuth.telemetry.api.common.AttributeValue::string("ä¸­æ–‡æµ‹è¯•")),
        ("emoji", @azimuth.telemetry.api.common.AttributeValue::string("ğŸ”¥ ğŸš€ âœ¨")),
        ("control.chars", @azimuth.telemetry.api.common.AttributeValue::string("\n\t\r")),
        ("json.value", @azimuth.telemetry.api.common.AttributeValue::string("{\"key\": \"value\"}"))
      ]
    },
    // åœºæ™¯4ï¼šç©ºå€¼å’Œè¾¹ç•Œæƒ…å†µ
    {
      name: "empty-boundary",
      attrs: [
        ("empty.string", @azimuth.telemetry.api.common.AttributeValue::string("")),
        ("zero.int", @azimuth.telemetry.api.common.AttributeValue::int(0L)),
        ("zero.float", @azimuth.telemetry.api.common.AttributeValue::float(0.0)),
        ("false.bool", @azimuth.telemetry.api.common.AttributeValue::bool(false))
      ]
    }
  ]
  
  // æµ‹è¯•æ¯ä¸ªå¤±è´¥åœºæ™¯
  let mut index = 0
  while index < failure_scenarios.length() {
    let scenario = failure_scenarios[index]
    
    // åˆ›å»ºSpan
    let (_, span) = @azimuth.telemetry.api.trace.NoopTracer::start_span(
      base_context,
      scenario.name,
      Some(@azimuth.telemetry.api.trace.Server),
      Some(scenario.attrs)
    )
    
    // åˆ›å»ºLogRecord
    let log = @azimuth.telemetry.api.logs.LogRecord::builder()
      .timestamp(1640995200000000000L + index.to_int64() * 1000000L)
      .severity(@azimuth.telemetry.api.logs.Warn)
      .body("Failure scenario test: " + scenario.name)
      .with_attribute("scenario.name", @azimuth.telemetry.api.common.AttributeValue::string(scenario.name))
      .with_attribute("attribute.count", @azimuth.telemetry.api.common.AttributeValue::int(scenario.attrs.length().to_int64()))
      .build()
    
    // åˆ›å»ºæŒ‡æ ‡
    let meter = @azimuth.telemetry.api.metrics.NoopMeter
    let failure_counter = @azimuth.telemetry.api.metrics.NoopMeter::create_counter("failure.scenarios", "scenarios", "Failure scenarios")
    
    let failure_attrs = [
      ("scenario.name", @azimuth.telemetry.api.common.AttributeValue::string(scenario.name)),
      ("recovered", @azimuth.telemetry.api.common.AttributeValue::bool(true))
    ]
    
    @azimuth.telemetry.api.metrics.NoopCounter::add(1L, Some(failure_attrs))
    
    index = index + 1
  }
  
  // éªŒè¯æ‰€æœ‰å¤±è´¥åœºæ™¯éƒ½èƒ½æ­£å¸¸æ¢å¤
  assert_eq(true, true)
}