// ç»¼åˆé”™è¯¯å¤„ç†æµ‹è¯• - æµ‹è¯•å„ç§é”™è¯¯åœºæ™¯å’Œæ¢å¤æœºåˆ¶
test "error_handling_invalid_trace_data" {
  // æµ‹è¯•æ— æ•ˆTraceæ•°æ®çš„å¤„ç†
  
  // æµ‹è¯•æ— æ•ˆçš„trace_idé•¿åº¦
  let invalid_trace_id_short = [for i = 0; i < 8; i = i + 1].map(fn(_) { 0_byte })  // åº”è¯¥æ˜¯16å­—èŠ‚
  let invalid_trace_id_long = [for i = 0; i < 32; i = i + 1].map(fn(_) { 0_byte })   // åº”è¯¥æ˜¯16å­—èŠ‚
  
  // æµ‹è¯•æ— æ•ˆçš„span_idé•¿åº¦
  let invalid_span_id_short = [for i = 0; i < 4; i = i + 1].map(fn(_) { 0_byte })   // åº”è¯¥æ˜¯8å­—èŠ‚
  let invalid_span_id_long = [for i = 0; i < 16; i = i + 1].map(fn(_) { 0_byte })    // åº”è¯¥æ˜¯8å­—èŠ‚
  
  // åˆ›å»ºå¸¦æœ‰æ— æ•ˆæ•°æ®çš„SpanContextï¼ˆåœ¨å®é™…å®ç°ä¸­åº”è¯¥æœ‰éªŒè¯ï¼‰
  let span_context_invalid_trace = @azimuth.telemetry.api.trace.SpanContext::{
    trace_id: invalid_trace_id_short,
    span_id: [for i = 0; i < 8; i = i + 1].map(fn(_) { 0_byte }),
    trace_flags: 1_byte,
    trace_state: ""
  }
  
  let span_context_invalid_span = @azimuth.telemetry.api.trace.SpanContext::{
    trace_id: [for i = 0; i < 16; i = i + 1].map(fn(_) { 0_byte }),
    span_id: invalid_span_id_short,
    trace_flags: 1_byte,
    trace_state: ""
  }
  
  // éªŒè¯æ— æ•ˆæ•°æ®è¢«æ­£ç¡®å¤„ç†
  assert_eq(span_context_invalid_trace.trace_id.length(), 8)  // é•¿åº¦ä¸æ­£ç¡®ä½†è¢«æ¥å—
  assert_eq(span_context_invalid_span.span_id.length(), 4)    // é•¿åº¦ä¸æ­£ç¡®ä½†è¢«æ¥å—
}

test "error_handling_corrupted_attribute_values" {
  // æµ‹è¯•æŸåçš„å±æ€§å€¼å¤„ç†
  
  // æµ‹è¯•ç©ºå­—ç¬¦ä¸²é”®
  let attributes_with_empty_key = [
    ("", @azimuth.telemetry.api.common.AttributeValue::string("value_with_empty_key")),
    ("valid.key", @azimuth.telemetry.api.common.AttributeValue::string("valid_value"))
  ]
  
  // æµ‹è¯•Noneå€¼ï¼ˆåœ¨å®ç°ä¸­åº”è¯¥å¤„ç†ï¼‰
  let attributes_with_special_chars = [
    ("key.with.dots", @azimuth.telemetry.api.common.AttributeValue::string("value.with.dots")),
    ("key with spaces", @azimuth.telemetry.api.common.AttributeValue::string("value with spaces")),
    ("key/with/slashes", @azimuth.telemetry.api.common.AttributeValue::string("value/with/slashes")),
    ("key\\with\\backslashes", @azimuth.telemetry.api.common.AttributeValue::string("value\\with\\backslashes"))
  ]
  
  // æµ‹è¯•Unicodeå­—ç¬¦
  let attributes_with_unicode = [
    ("unicode.é”®", @azimuth.telemetry.api.common.AttributeValue::string("Unicodeå€¼")),
    ("emoji.ğŸš€", @azimuth.telemetry.api.common.AttributeValue::string("rocket")),
    ("special.chars.Ã±Ã¡Ã©Ã­Ã³Ãº", @azimuth.telemetry.api.common.AttributeValue::string("espaÃ±ol"))
  ]
  
  // éªŒè¯æ‰€æœ‰å±æ€§éƒ½èƒ½è¢«åˆ›å»º
  assert_eq(attributes_with_empty_key.length(), 2)
  assert_eq(attributes_with_special_chars.length(), 4)
  assert_eq(attributes_with_unicode.length(), 3)
}

test "error_handling_boundary_values" {
  // æµ‹è¯•è¾¹ç•Œå€¼å¤„ç†
  
  // æµ‹è¯•æå€¼
  let max_int64 = 9223372036854775807L
  let min_int64 = -9223372036854775808L
  let max_double = 1.7976931348623157e+308
  let min_double = -1.7976931348623157e+308
  let infinity = 1.0/0.0
  let neg_infinity = -1.0/0.0
  let nan = 0.0/0.0
  
  let boundary_attributes = [
    ("max.int64", @azimuth.telemetry.api.common.AttributeValue::int(max_int64)),
    ("min.int64", @azimuth.telemetry.api.common.AttributeValue::int(min_int64)),
    ("max.double", @azimuth.telemetry.api.common.AttributeValue::float(max_double)),
    ("min.double", @azimuth.telemetry.api.common.AttributeValue::float(min_double)),
    ("infinity", @azimuth.telemetry.api.common.AttributeValue::float(infinity)),
    ("neg.infinity", @azimuth.telemetry.api.common.AttributeValue::float(neg_infinity)),
    ("nan", @azimuth.telemetry.api.common.AttributeValue::float(nan))
  ]
  
  // éªŒè¯è¾¹ç•Œå€¼å±æ€§åˆ›å»º
  assert_eq(boundary_attributes.length(), 7)
  
  // æµ‹è¯•ç©ºæ•°ç»„
  let empty_arrays = [
    ("empty.string.array", @azimuth.telemetry.api.common.AttributeValue::array_string([])),
    ("empty.int.array", @azimuth.telemetry.api.common.AttributeValue::array_int([])),
    ("empty.float.array", @azimuth.telemetry.api.common.AttributeValue::array_float([])),
    ("empty.bool.array", @azimuth.telemetry.api.common.AttributeValue::array_bool([]))
  ]
  
  assert_eq(empty_arrays.length(), 4)
}