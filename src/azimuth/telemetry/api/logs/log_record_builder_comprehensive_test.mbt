// LogRecordBuilderç»¼åˆæµ‹è¯•
test "log_record_builder_basic_workflow" {
  // æµ‹è¯•LogRecordBuilderçš„åŸºæœ¬å·¥ä½œæµç¨‹
  
  let builder = LogRecord::builder()
  
  // è®¾ç½®åŸºæœ¬å­—æ®µ
  let builder_with_timestamp = builder.timestamp(1234567890L)
  let builder_with_severity = builder_with_timestamp.severity(Info)
  let builder_with_body = builder_with_severity.body("Test log message")
  
  // æ„å»ºLogRecord
  let log_record = builder_with_body.build()
  
  // éªŒè¯åŸºæœ¬å­—æ®µ
  assert_eq(log_record.timestamp_unix_nanos, 1234567890L)
  match log_record.severity_number {
    Info => assert_eq(true, true)
    _ => @test.fail("Expected Info severity")
  }
  match log_record.body {
    Some(message) => assert_eq(message, "Test log message")
    None => @test.fail("Expected body message")
  }
  
  // éªŒè¯é»˜è®¤å€¼
  assert_eq(log_record.observed_timestamp_unix_nanos, None)
  assert_eq(log_record.severity_text, None)
  assert_eq(log_record.attributes.length(), 0)
  assert_eq(log_record.trace_id, None)
  assert_eq(log_record.span_id, None)
  assert_eq(log_record.trace_flags, None)
  assert_eq(log_record.resource, None)
  assert_eq(log_record.instrumentation_scope, None)
}

test "log_record_builder_with_attributes" {
  // æµ‹è¯•ä½¿ç”¨LogRecordBuilderæ·»åŠ å±æ€§
  
  let builder = LogRecord::builder()
    .timestamp(1234567890L)
    .severity(Error)
    .body("Error occurred")
  
  // æ·»åŠ å•ä¸ªå±æ€§
  let builder_with_attr1 = builder.with_attribute("error.code", AttributeValue::int(500L))
  let builder_with_attr2 = builder_with_attr1.with_attribute("error.message", AttributeValue::string("Internal server error"))
  let builder_with_attr3 = builder_with_attr2.with_attribute("user.id", AttributeValue::int(12345L))
  
  // æ„å»ºLogRecord
  let log_record = builder_with_attr3.build()
  
  // éªŒè¯å±æ€§
  assert_eq(log_record.attributes.length(), 3)
  assert_eq(log_record.attributes[0].0, "error.code")
  assert_eq(log_record.attributes[1].0, "error.message")
  assert_eq(log_record.attributes[2].0, "user.id")
  
  // éªŒè¯å±æ€§å€¼
  match log_record.attributes[0].1 {
    IntValue(code) => assert_eq(code, 500L)
    _ => @test.fail("Expected IntValue for error.code")
  }
  
  match log_record.attributes[1].1 {
    StringValue(message) => assert_eq(message, "Internal server error")
    _ => @test.fail("Expected StringValue for error.message")
  }
  
  match log_record.attributes[2].1 {
    IntValue(user_id) => assert_eq(user_id, 12345L)
    _ => @test.fail("Expected IntValue for user.id")
  }
}

test "log_record_builder_with_complex_attributes" {
  // æµ‹è¯•LogRecordBuilderæ·»åŠ å¤æ‚å±æ€§
  
  let builder = LogRecord::builder()
    .timestamp(1234567890L)
    .severity(Warn)
    .body("Complex log with various attribute types")
  
  // æ·»åŠ å„ç§ç±»å‹çš„å±æ€§
  let builder = builder
    .with_attribute("string.value", AttributeValue::string("test string"))
    .with_attribute("int.value", AttributeValue::int(42L))
    .with_attribute("float.value", AttributeValue::float(3.14159))
    .with_attribute("bool.value", AttributeValue::bool(true))
    .with_attribute("string.array", AttributeValue::array_string(["a", "b", "c"]))
    .with_attribute("int.array", AttributeValue::array_int([1L, 2L, 3L]))
    .with_attribute("float.array", AttributeValue::array_float([1.1, 2.2, 3.3]))
    .with_attribute("bool.array", AttributeValue::array_bool([true, false, true]))
  
  // æ„å»ºLogRecord
  let log_record = builder.build()
  
  // éªŒè¯å±æ€§æ•°é‡
  assert_eq(log_record.attributes.length(), 8)
  
  // éªŒè¯å„ç§å±æ€§ç±»å‹
  match log_record.attributes[0].1 {
    StringValue(s) => assert_eq(s, "test string")
    _ => @test.fail("Expected StringValue")
  }
  
  match log_record.attributes[1].1 {
    IntValue(i) => assert_eq(i, 42L)
    _ => @test.fail("Expected IntValue")
  }
  
  match log_record.attributes[2].1 {
    FloatValue(f) => assert_eq(f, 3.14159)
    _ => @test.fail("Expected FloatValue")
  }
  
  match log_record.attributes[3].1 {
    BoolValue(b) => assert_eq(b, true)
    _ => @test.fail("Expected BoolValue")
  }
  
  match log_record.attributes[4].1 {
    ArrayStringValue(arr) => {
      assert_eq(arr.length(), 3)
      assert_eq(arr[0], "a")
      assert_eq(arr[1], "b")
      assert_eq(arr[2], "c")
    }
    _ => @test.fail("Expected ArrayStringValue")
  }
}

test "log_record_builder_with_trace_context" {
  // æµ‹è¯•LogRecordBuilderæ·»åŠ è¿½è¸ªä¸Šä¸‹æ–‡
  
  let trace_id = Array::make(16, 0x01_byte)
  let span_id = Array::make(8, 0x02_byte)
  
  let builder = LogRecord::builder()
    .timestamp(1234567890L)
    .severity(Debug)
    .body("Debug log with trace context")
  
  // ç”±äºLogRecordBuilderæ²¡æœ‰ç›´æ¥çš„trace_idå’Œspan_idè®¾ç½®æ–¹æ³•ï¼Œ
  // æˆ‘ä»¬éœ€è¦éªŒè¯é»˜è®¤æƒ…å†µä¸‹è¿™äº›å­—æ®µä¸ºNone
  let log_record = builder.build()
  
  assert_eq(log_record.trace_id, None)
  assert_eq(log_record.span_id, None)
  assert_eq(log_record.trace_flags, None)
  
  // éªŒè¯å…¶ä»–å­—æ®µè®¾ç½®æ­£ç¡®
  match log_record.severity_number {
    Debug => assert_eq(true, true)
    _ => @test.fail("Expected Debug severity")
  }
  
  match log_record.body {
    Some(message) => assert_eq(message, "Debug log with trace context")
    None => @test.fail("Expected body message")
  }
}

test "log_record_builder_all_severity_levels" {
  // æµ‹è¯•LogRecordBuilderè®¾ç½®æ‰€æœ‰ä¸¥é‡æ€§çº§åˆ«
  
  let base_timestamp = 1234567890L
  
  // æµ‹è¯•æ‰€æœ‰ä¸¥é‡æ€§çº§åˆ«
  let trace_record = LogRecord::builder()
    .timestamp(base_timestamp)
    .severity(Trace)
    .body("Trace message")
    .build()
  
  let debug_record = LogRecord::builder()
    .timestamp(base_timestamp + 1)
    .severity(Debug)
    .body("Debug message")
    .build()
  
  let info_record = LogRecord::builder()
    .timestamp(base_timestamp + 2)
    .severity(Info)
    .body("Info message")
    .build()
  
  let warn_record = LogRecord::builder()
    .timestamp(base_timestamp + 3)
    .severity(Warn)
    .body("Warning message")
    .build()
  
  let error_record = LogRecord::builder()
    .timestamp(base_timestamp + 4)
    .severity(Error)
    .body("Error message")
    .build()
  
  let fatal_record = LogRecord::builder()
    .timestamp(base_timestamp + 5)
    .severity(Fatal)
    .body("Fatal message")
    .build()
  
  // éªŒè¯æ‰€æœ‰ä¸¥é‡æ€§çº§åˆ«
  match trace_record.severity_number {
    Trace => assert_eq(true, true)
    _ => @test.fail("Expected Trace severity")
  }
  
  match debug_record.severity_number {
    Debug => assert_eq(true, true)
    _ => @test.fail("Expected Debug severity")
  }
  
  match info_record.severity_number {
    Info => assert_eq(true, true)
    _ => @test.fail("Expected Info severity")
  }
  
  match warn_record.severity_number {
    Warn => assert_eq(true, true)
    _ => @test.fail("Expected Warn severity")
  }
  
  match error_record.severity_number {
    Error => assert_eq(true, true)
    _ => @test.fail("Expected Error severity")
  }
  
  match fatal_record.severity_number {
    Fatal => assert_eq(true, true)
    _ => @test.fail("Expected Fatal severity")
  }
  
  // éªŒè¯æ—¶é—´æˆ³é€’å¢
  assert_eq(trace_record.timestamp_unix_nanos, base_timestamp)
  assert_eq(debug_record.timestamp_unix_nanos, base_timestamp + 1)
  assert_eq(info_record.timestamp_unix_nanos, base_timestamp + 2)
  assert_eq(warn_record.timestamp_unix_nanos, base_timestamp + 3)
  assert_eq(error_record.timestamp_unix_nanos, base_timestamp + 4)
  assert_eq(fatal_record.timestamp_unix_nanos, base_timestamp + 5)
}

test "log_record_builder_chaining_operations" {
  // æµ‹è¯•LogRecordBuilderçš„é“¾å¼æ“ä½œ
  
  let log_record = LogRecord::builder()
    .timestamp(1234567890L)
    .severity(Info)
    .body("Chained operations test")
    .with_attribute("attr1", AttributeValue::string("value1"))
    .with_attribute("attr2", AttributeValue::int(42L))
    .with_attribute("attr3", AttributeValue::float(3.14))
    .with_attribute("attr4", AttributeValue::bool(true))
    .with_attribute("attr5", AttributeValue::array_string(["a", "b"]))
    .build()
  
  // éªŒè¯æ‰€æœ‰å­—æ®µéƒ½æ­£ç¡®è®¾ç½®
  assert_eq(log_record.timestamp_unix_nanos, 1234567890L)
  
  match log_record.severity_number {
    Info => assert_eq(true, true)
    _ => @test.fail("Expected Info severity")
  }
  
  match log_record.body {
    Some(message) => assert_eq(message, "Chained operations test")
    None => @test.fail("Expected body message")
  }
  
  // éªŒè¯æ‰€æœ‰å±æ€§
  assert_eq(log_record.attributes.length(), 5)
  
  let attr_names = []
  let mut i = 0
  while i < log_record.attributes.length() {
    attr_names.push(log_record.attributes[i].0)
    i = i + 1
  }
  
  assert_eq(attr_names.contains("attr1"), true)
  assert_eq(attr_names.contains("attr2"), true)
  assert_eq(attr_names.contains("attr3"), true)
  assert_eq(attr_names.contains("attr4"), true)
  assert_eq(attr_names.contains("attr5"), true)
}

test "log_record_builder_edge_cases" {
  // æµ‹è¯•LogRecordBuilderçš„è¾¹ç•Œæƒ…å†µ
  
  // æµ‹è¯•ç©ºå­—ç¬¦ä¸²
  let empty_body_record = LogRecord::builder()
    .timestamp(1234567890L)
    .severity(Info)
    .body("")
    .build()
  
  match empty_body_record.body {
    Some(message) => assert_eq(message, "")
    None => @test.fail("Expected empty body message")
  }
  
  // æµ‹è¯•é›¶æ—¶é—´æˆ³
  let zero_timestamp_record = LogRecord::builder()
    .timestamp(0L)
    .severity(Debug)
    .body("Zero timestamp test")
    .build()
  
  assert_eq(zero_timestamp_record.timestamp_unix_nanos, 0L)
  
  // æµ‹è¯•è´Ÿæ—¶é—´æˆ³ï¼ˆè™½ç„¶ä¸åˆç†ï¼Œä½†æµ‹è¯•è¾¹ç•Œæƒ…å†µï¼‰
  let negative_timestamp_record = LogRecord::builder()
    .timestamp(-1L)
    .severity(Warn)
    .body("Negative timestamp test")
    .build()
  
  assert_eq(negative_timestamp_record.timestamp_unix_nanos, -1L)
  
  // æµ‹è¯•æå¤§æ—¶é—´æˆ³
  let max_timestamp_record = LogRecord::builder()
    .timestamp(9223372036854775807L)
    .severity(Error)
    .body("Max timestamp test")
    .build()
  
  assert_eq(max_timestamp_record.timestamp_unix_nanos, 9223372036854775807L)
  
  // æµ‹è¯•ç©ºå±æ€§é”®å’Œç‰¹æ®Šå­—ç¬¦
  let special_attrs_record = LogRecord::builder()
    .timestamp(1234567890L)
    .severity(Info)
    .body("Special attributes test")
    .with_attribute("", AttributeValue::string("empty key"))
    .with_attribute("special.chars!@#$%", AttributeValue::string("special value"))
    .with_attribute("unicodeæµ‹è¯•ğŸš€", AttributeValue::string("unicode value"))
    .with_attribute("spaces in key", AttributeValue::string("spaces value"))
    .build()
  
  assert_eq(special_attrs_record.attributes.length(), 4)
}

test "log_record_builder_default_values" {
  // æµ‹è¯•LogRecordBuilderçš„é»˜è®¤å€¼
  
  // ä½¿ç”¨æœ€å°é…ç½®åˆ›å»ºLogRecord
  let minimal_record = LogRecord::builder().build()
  
  // éªŒè¯é»˜è®¤å€¼
  assert_eq(minimal_record.timestamp_unix_nanos, 0L)
  assert_eq(minimal_record.observed_timestamp_unix_nanos, None)
  
  match minimal_record.severity_number {
    Info => assert_eq(true, true) // é»˜è®¤ä¸¥é‡æ€§çº§åˆ«
    _ => @test.fail("Expected default Info severity")
  }
  
  assert_eq(minimal_record.severity_text, None)
  assert_eq(minimal_record.body, None)
  assert_eq(minimal_record.attributes.length(), 0)
  assert_eq(minimal_record.trace_id, None)
  assert_eq(minimal_record.span_id, None)
  assert_eq(minimal_record.trace_flags, None)
  assert_eq(minimal_record.resource, None)
  assert_eq(minimal_record.instrumentation_scope, None)
}