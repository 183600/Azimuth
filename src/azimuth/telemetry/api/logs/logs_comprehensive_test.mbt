// Logsæ¨¡å—çš„LogRecordBuilderæµ‹è¯•ç”¨ä¾‹
test "log_record_builder_basic_usage" {
  // æµ‹è¯•LogRecordBuilderçš„åŸºæœ¬ä½¿ç”¨
  let builder = LogRecord::builder()
  
  // éªŒè¯åˆå§‹çŠ¶æ€
  assert_eq(builder.timestamp_unix_nanos, None)
  assert_eq(builder.observed_timestamp_unix_nanos, None)
  assert_eq(builder.severity_number, None)
  assert_eq(builder.severity_text, None)
  assert_eq(builder.body, None)
  assert_eq(builder.attributes.length(), 0)
  assert_eq(builder.trace_id, None)
  assert_eq(builder.span_id, None)
  assert_eq(builder.trace_flags, None)
  assert_eq(builder.resource, None)
  assert_eq(builder.instrumentation_scope, None)
  
  // è®¾ç½®åŸºæœ¬å­—æ®µ
  let builder1 = builder
    .timestamp(1640995200000000000L)
    .severity(Info)
    .body("Application started successfully")
  
  // éªŒè¯è®¾ç½®åçš„çŠ¶æ€
  match builder1.timestamp_unix_nanos {
    Some(ts) => assert_eq(ts, 1640995200000000000L)
    None => @test.fail("Test failed")
  }
  
  match builder1.severity_number {
    Some(severity) => assert_eq(severity, Info)
    None => @test.fail("Test failed")
  }
  
  match builder1.body {
    Some(body) => assert_eq(body, "Application started successfully")
    None => @test.fail("Test failed")
  }
  
  // æ„å»ºLogRecord
  let log_record = builder1.build()
  
  // éªŒè¯æ„å»ºçš„LogRecord
  assert_eq(log_record.timestamp_unix_nanos, 1640995200000000000L)
  assert_eq(log_record.severity_number, Info)
  match log_record.body {
    Some(body) => assert_eq(body, "Application started successfully")
    None => @test.fail("Test failed")
  }
}

test "log_record_builder_with_attributes" {
  // æµ‹è¯•LogRecordBuilderæ·»åŠ å±æ€§
  let builder = LogRecord::builder()
    .timestamp(1640995200000000000L)
    .severity(Debug)
    .body("Debug message")
  
  // æ·»åŠ å•ä¸ªå±æ€§
  let builder1 = builder.with_attribute(
    "service.name", 
    AttributeValue::string("payment-service")
  )
  
  assert_eq(builder1.attributes.length(), 1)
  assert_eq(builder1.attributes[0].0, "service.name")
  
  match builder1.attributes[0].1 {
    AttributeValue::StringValue(value) => assert_eq(value, "payment-service")
    _ => @test.fail("Test failed")
  }
  
  // æ·»åŠ æ›´å¤šå±æ€§
  let builder2 = builder1
    .with_attribute("service.version", AttributeValue::string("1.2.3"))
    .with_attribute("environment", AttributeValue::string("production"))
    .with_attribute("process.pid", AttributeValue::int(12345L))
    .with_attribute("process.healthy", AttributeValue::bool(true))
  
  assert_eq(builder2.attributes.length(), 5)
  
  // éªŒè¯æ‰€æœ‰å±æ€§
  let expected_attributes = [
    ("service.name", "payment-service"),
    ("service.version", "1.2.3"),
    ("environment", "production")
  ]
  
  let mut i = 0
  while i < expected_attributes.length() {
    let (key, expected_value) = expected_attributes[i]
    assert_eq(builder2.attributes[i].0, key)
    match builder2.attributes[i].1 {
      AttributeValue::StringValue(value) => assert_eq(value, expected_value)
      _ => @test.fail("Expected StringValue for " + key)
    }
    i = i + 1
  }
  
  // æ„å»ºLogRecordå¹¶éªŒè¯å±æ€§
  let log_record = builder2.build()
  assert_eq(log_record.attributes.length(), 5)
}

test "log_record_builder_complex_attributes" {
  // æµ‹è¯•LogRecordBuilderæ·»åŠ å¤æ‚å±æ€§
  let builder = LogRecord::builder()
    .severity(Error)
    .body("Error occurred during processing")
  
  // æ·»åŠ å¤æ‚å±æ€§
  let builder_with_complex = builder
    .with_attribute("error.type", AttributeValue::string("DatabaseConnectionError"))
    .with_attribute("error.message", AttributeValue::string("Connection timeout after 30 seconds"))
    .with_attribute("error.code", AttributeValue::int(5001L))
    .with_attribute("error.retry_count", AttributeValue::int(3L))
    .with_attribute("error.timeout_seconds", AttributeValue::float(30.0))
    .with_attribute("error.recoverable", AttributeValue::bool(false))
    .with_attribute("error.stack_trace", AttributeValue::string("at com.example.Service.process(Service.java:123)"))
    .with_attribute("tags", AttributeValue::array_string(["database", "timeout", "critical"]))
    .with_attribute("error.codes", AttributeValue::array_int([5001L, 5002L, 5003L]))
    .with_attribute("error.thresholds", AttributeValue::array_float([10.0, 30.0, 60.0]))
    .with_attribute("error.flags", AttributeValue::array_bool([false, true, false]))
  
  // æ„å»ºLogRecord
  let log_record = builder_with_complex.build()
  
  // éªŒè¯å¤æ‚å±æ€§
  assert_eq(log_record.attributes.length(), 11)
  
  // éªŒè¯æ•°ç»„å±æ€§
  match log_record.attributes[7].1 {
    AttributeValue::ArrayStringValue(tags) => {
      assert_eq(tags.length(), 3)
      assert_eq(tags[0], "database")
      assert_eq(tags[1], "timeout")
      assert_eq(tags[2], "critical")
    }
    _ => @test.fail("Test failed")
  }
  
  match log_record.attributes[8].1 {
    AttributeValue::ArrayIntValue(codes) => {
      assert_eq(codes.length(), 3)
      assert_eq(codes[0], 5001L)
      assert_eq(codes[1], 5002L)
      assert_eq(codes[2], 5003L)
    }
    _ => @test.fail("Test failed")
  }
}

test "log_record_builder_all_severity_levels" {
  // æµ‹è¯•æ‰€æœ‰ä¸¥é‡æ€§çº§åˆ«
  
  // Traceçº§åˆ«
  let trace_log = LogRecord::builder()
    .severity(Trace)
    .body("Trace message")
    .build()
  assert_eq(trace_log.severity_number, Trace)
  
  // Debugçº§åˆ«
  let debug_log = LogRecord::builder()
    .severity(Debug)
    .body("Debug message")
    .build()
  assert_eq(debug_log.severity_number, Debug)
  
  // Infoçº§åˆ«
  let info_log = LogRecord::builder()
    .severity(Info)
    .body("Info message")
    .build()
  assert_eq(info_log.severity_number, Info)
  
  // Warnçº§åˆ«
  let warn_log = LogRecord::builder()
    .severity(Warn)
    .body("Warning message")
    .build()
  assert_eq(warn_log.severity_number, Warn)
  
  // Errorçº§åˆ«
  let error_log = LogRecord::builder()
    .severity(Error)
    .body("Error message")
    .build()
  assert_eq(error_log.severity_number, Error)
  
  // Fatalçº§åˆ«
  let fatal_log = LogRecord::builder()
    .severity(Fatal)
    .body("Fatal error message")
    .build()
  assert_eq(fatal_log.severity_number, Fatal)
}

test "log_record_builder_with_trace_context" {
  // æµ‹è¯•LogRecordBuilderæ·»åŠ è¿½è¸ªä¸Šä¸‹æ–‡
  let trace_id = [for i = 0; i < 16; i = i + 1].map(fn(_) { 1_byte })
  let span_id = [for i = 0; i < 8; i = i + 1].map(fn(_) { 1_byte })
  let trace_flags = 1_byte
  
  let builder = LogRecord::builder()
    .timestamp(1640995200000000000L)
    .severity(Info)
    .body("Request processed")
  
  // åœ¨å®é™…å®ç°ä¸­ï¼Œæˆ‘ä»¬éœ€è¦èƒ½å¤Ÿè®¾ç½®trace_idã€span_idå’Œtrace_flags
  // è¿™é‡Œæˆ‘ä»¬éªŒè¯LogRecordç»“æ„æ˜¯å¦æ­£ç¡®
  let log_record = builder.build()
  
  // éªŒè¯é»˜è®¤å€¼
  match log_record.trace_id {
    None => assert_eq(true, true)
    Some(_) => @test.fail("Test failed")
  }
  
  match log_record.span_id {
    None => assert_eq(true, true)
    Some(_) => @test.fail("Test failed")
  }
  
  match log_record.trace_flags {
    None => assert_eq(true, true)
    Some(_) => @test.fail("Test failed")
  }
}

test "log_record_builder_with_resource_and_scope" {
  // æµ‹è¯•LogRecordBuilderä¸èµ„æºå’Œä»ªå™¨ä½œç”¨åŸŸçš„é›†æˆ
  let resource = Resource::default("test-service")
  let builder = LogRecord::builder()
    .severity(Info)
    .body("Test log with resource")
  
  // åœ¨å®é™…å®ç°ä¸­ï¼Œæˆ‘ä»¬éœ€è¦èƒ½å¤Ÿè®¾ç½®resourceå’Œinstrumentation_scope
  let log_record = builder.build()
  
  // éªŒè¯é»˜è®¤å€¼
  match log_record.resource {
    None => assert_eq(true, true)
    Some(_) => @test.fail("Test failed")
  }
  
  match log_record.instrumentation_scope {
    None => assert_eq(true, true)
    Some(_) => @test.fail("Test failed")
  }
}

test "log_record_builder_edge_cases" {
  // æµ‹è¯•LogRecordBuilderçš„è¾¹ç•Œæƒ…å†µ
  
  // ç©ºå­—ç¬¦ä¸²body
  let empty_body_log = LogRecord::builder()
    .body("")
    .build()
  match empty_body_log.body {
    Some(body) => assert_eq(body, "")
    None => @test.fail("Test failed")
  }
  
  // é•¿å­—ç¬¦ä¸²body
  let long_body = "a".repeat(10000)
  let long_body_log = LogRecord::builder()
    .body(long_body)
    .build()
  match long_body_log.body {
    Some(body) => assert_eq(body.length(), 10000)
    None => @test.fail("Test failed")
  }
  
  // ç‰¹æ®Šå­—ç¬¦body
  let special_body_log = LogRecord::builder()
    .body("Special chars: !@#$%^&*(){}[]|\\:;\"'<>?,./ Unicode: æµ‹è¯•ä¸­æ–‡ğŸš€")
    .build()
  match special_body_log.body {
    Some(body) => {
      assert_eq(body.contains("!@#$%^&*()"), true)
      assert_eq(body.contains("æµ‹è¯•ä¸­æ–‡ğŸš€"), true)
    }
    None => @test.fail("Test failed")
  }
  
  // æå€¼æ—¶é—´æˆ³
  let min_timestamp_log = LogRecord::builder()
    .timestamp(-9223372036854775808L)
    .build()
  assert_eq(min_timestamp_log.timestamp_unix_nanos, -9223372036854775808L)
  
  let max_timestamp_log = LogRecord::builder()
    .timestamp(9223372036854775807L)
    .build()
  assert_eq(max_timestamp_log.timestamp_unix_nanos, 9223372036854775807L)
  
  // é›¶æ—¶é—´æˆ³
  let zero_timestamp_log = LogRecord::builder()
    .timestamp(0L)
    .build()
  assert_eq(zero_timestamp_log.timestamp_unix_nanos, 0L)
}

test "log_record_builder_chaining" {
  // æµ‹è¯•LogRecordBuilderçš„æ–¹æ³•é“¾å¼è°ƒç”¨
  let log_record = LogRecord::builder()
    .timestamp(1640995200000000000L)
    .severity(Error)
    .body("Database connection failed")
    .with_attribute("error.type", AttributeValue::string("ConnectionTimeout"))
    .with_attribute("error.code", AttributeValue::int(1001L))
    .with_attribute("retry.count", AttributeValue::int(3L))
    .with_attribute("service.name", AttributeValue::string("user-service"))
    .with_attribute("environment", AttributeValue::string("production"))
    .build()
  
  // éªŒè¯æ‰€æœ‰å­—æ®µéƒ½æ­£ç¡®è®¾ç½®
  assert_eq(log_record.timestamp_unix_nanos, 1640995200000000000L)
  assert_eq(log_record.severity_number, Error)
  match log_record.body {
    Some(body) => assert_eq(body, "Database connection failed")
    None => @test.fail("Test failed")
  }
  
  assert_eq(log_record.attributes.length(), 5)
  assert_eq(log_record.attributes[0].0, "error.type")
  assert_eq(log_record.attributes[1].0, "error.code")
  assert_eq(log_record.attributes[2].0, "retry.count")
  assert_eq(log_record.attributes[3].0, "service.name")
  assert_eq(log_record.attributes[4].0, "environment")
}

test "log_record_builder_default_values" {
  // æµ‹è¯•LogRecordBuilderçš„é»˜è®¤å€¼
  let log_record = LogRecord::builder().build()
  
  // éªŒè¯é»˜è®¤å€¼
  assert_eq(log_record.timestamp_unix_nanos, 0L)
  match log_record.observed_timestamp_unix_nanos {
    None => assert_eq(true, true)
    Some(_) => @test.fail("Test failed")
  }
  assert_eq(log_record.severity_number, Info) // é»˜è®¤ä¸¥é‡æ€§çº§åˆ«
  match log_record.severity_text {
    None => assert_eq(true, true)
    Some(_) => @test.fail("Test failed")
  }
  match log_record.body {
    None => assert_eq(true, true)
    Some(_) => @test.fail("Test failed")
  }
  assert_eq(log_record.attributes.length(), 0)
  match log_record.trace_id {
    None => assert_eq(true, true)
    Some(_) => @test.fail("Test failed")
  }
  match log_record.span_id {
    None => assert_eq(true, true)
    Some(_) => @test.fail("Test failed")
  }
  match log_record.trace_flags {
    None => assert_eq(true, true)
    Some(_) => @test.fail("Test failed")
  }
  match log_record.resource {
    None => assert_eq(true, true)
    Some(_) => @test.fail("Test failed")
  }
  match log_record.instrumentation_scope {
    None => assert_eq(true, true)
    Some(_) => @test.fail("Test failed")
  }
}