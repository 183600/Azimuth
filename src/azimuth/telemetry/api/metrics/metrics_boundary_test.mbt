// Metricsæ¨¡å—è¾¹ç•Œæµ‹è¯•ç”¨ä¾‹
test "instrument_boundary_conditions" {
  let meter = NoopMeter::{}
  
  // æµ‹è¯•è¾¹ç•Œæ¡ä»¶çš„instrumentåç§°
  let empty_name_counter = meter.create_counter("", None, None)
  let very_long_name_histogram = meter.create_histogram("a".repeat(1000), Some("ms"), Some("Very long name"))
  let unicode_name_gauge = meter.create_gauge("æµ‹è¯•ä»ªè¡¨ğŸš€", Some("%"), Some("Unicode gauge"))
  
  // æµ‹è¯•è¾¹ç•Œæ¡ä»¶çš„unitå’Œdescription
  let counter_with_empty_unit = meter.create_counter("test", Some(""), Some(""))
  let histogram_with_long_unit = meter.create_histogram("test", Some("milliseconds-per-request-microseconds"), Some("Test"))
  let gauge_with_special_unit = meter.create_gauge("test", Some("!@#$%^&*()"), Some("Special unit"))
  
  // æµ‹è¯•æ“ä½œä¸ä¼šå´©æºƒ
  empty_name_counter.add(1L, [])
  very_long_name_histogram.record(100.0, [])
  unicode_name_gauge.record(50.0, [])
  counter_with_empty_unit.add(10L, [])
  histogram_with_long_unit.record(200.0, [])
  gauge_with_special_unit.record(75.0, [])
  
  assert_eq(true, true)
}

test "measurement_boundary_values" {
  // æµ‹è¯•æå€¼æµ‹é‡
  
  // æœ€å¤§å€¼æµ‹è¯•
  let max_int_measurement = Measurement::{
    value: 9223372036854775807.0,  // Int64æœ€å¤§å€¼è½¬ä¸ºDouble
    attributes: [
      ("max.value", AttributeValue::int(9223372036854775807L))
    ]
  }
  
  // æœ€å°å€¼æµ‹è¯•
  let min_int_measurement = Measurement::{
    value: -9223372036854775808.0,  // Int64æœ€å°å€¼è½¬ä¸ºDouble
    attributes: [
      ("min.value", AttributeValue::int(-9223372036854775808L))
    ]
  }
  
  // é›¶å€¼æµ‹è¯•
  let zero_measurement = Measurement::{
    value: 0.0,
    attributes: [
      ("zero.int", AttributeValue::int(0L)),
      ("zero.float", AttributeValue::float(0.0))
    ]
  }
  
  // æå°å€¼æµ‹è¯•
  let tiny_measurement = Measurement::{
    value: 1.0e-308,
    attributes: [
      ("tiny.value", AttributeValue::float(1.0e-308))
    ]
  }
  
  // æ— ç©·å¤§æµ‹è¯•
  let infinity_measurement = Measurement::{
    value: 1.0/0.0,
    attributes: [
      ("infinity", AttributeValue::float(1.0/0.0)),
      ("negative.infinity", AttributeValue::float(-1.0/0.0))
    ]
  }
  
  // NaNæµ‹è¯•
  let nan_measurement = Measurement::{
    value: 0.0/0.0,
    attributes: [
      ("nan.value", AttributeValue::float(0.0/0.0))
    ]
  }
  
  assert_eq(max_int_measurement.value, 9223372036854775807.0)
  assert_eq(min_int_measurement.value, -9223372036854775808.0)
  assert_eq(zero_measurement.value, 0.0)
  assert_eq(tiny_measurement.value, 1.0e-308)
  
  // éªŒè¯å±æ€§å€¼
  match max_int_measurement.attributes[0].1 {
    IntValue(max_val) => assert_eq(max_val, 9223372036854775807L)
    _ => @test.fail("Test failed")
  }
  
  match min_int_measurement.attributes[0].1 {
    IntValue(min_val) => assert_eq(min_val, -9223372036854775808L)
    _ => @test.fail("Test failed")
  }
}

test "counter_extreme_values" {
  let counter = NoopCounter::{}
  
  // æµ‹è¯•æå€¼åŠ æ³•æ“ä½œ
  counter.add(9223372036854775807L, [])  // Int64æœ€å¤§å€¼
  counter.add(-9223372036854775808L, [])  // Int64æœ€å°å€¼
  counter.add(0L, [])  // é›¶å€¼
  counter.add(1L, [])  // æœ€å°æ­£å€¼
  counter.add(-1L, [])  // æœ€å¤§è´Ÿå€¼
  
  // æµ‹è¯•å¸¦å±æ€§çš„æå€¼
  counter.add(9223372036854775807L, [
    ("max.operation", AttributeValue::string("maximum")),
    ("service.name", AttributeValue::string("test-service"))
  ])
  
  counter.add(-9223372036854775808L, [
    ("min.operation", AttributeValue::string("minimum")),
    ("service.name", AttributeValue::string("test-service"))
  ])
  
  assert_eq(true, true)
}

test "histogram_extreme_values" {
  let histogram = NoopHistogram::{}
  
  // æµ‹è¯•æå€¼è®°å½•æ“ä½œ
  histogram.record(1.7976931348623157e+308, [])  // Doubleæœ€å¤§å€¼
  histogram.record(-1.7976931348623157e+308, [])  // Doubleæœ€å°å€¼
  histogram.record(0.0, [])  // é›¶å€¼
  histogram.record(1.0e-308, [])  // æå°å€¼
  histogram.record(1.0/0.0, [])  // æ­£æ— ç©·
  histogram.record(-1.0/0.0, [])  // è´Ÿæ— ç©·
  histogram.record(0.0/0.0, [])  // NaN
  
  // æµ‹è¯•å¸¦å±æ€§çš„æå€¼
  histogram.record(1.7976931348623157e+308, [
    ("max.latency", AttributeValue::string("maximum")),
    ("operation.type", AttributeValue::string("slow_operation"))
  ])
  
  histogram.record(0.0, [
    ("zero.latency", AttributeValue::string("instant")),
    ("operation.type", AttributeValue::string("fast_operation"))
  ])
  
  assert_eq(true, true)
}

test "up_down_counter_boundary_conditions" {
  let up_down_counter = NoopUpDownCounter::{}
  
  // æµ‹è¯•æ­£è´Ÿå€¼äº¤æ›¿
  up_down_counter.add(1000L, [])
  up_down_counter.add(-500L, [])
  up_down_counter.add(250L, [])
  up_down_counter.add(-750L, [])
  up_down_counter.add(0L, [])
  
  // æµ‹è¯•æå€¼
  up_down_counter.add(9223372036854775807L, [])
  up_down_counter.add(-9223372036854775808L, [])
  up_down_counter.add(1L, [])
  up_down_counter.add(-1L, [])
  
  // æµ‹è¯•å¸¦å¤æ‚å±æ€§çš„è¾¹ç•Œæ“ä½œ
  up_down_counter.add(100L, [
    ("pool.type", AttributeValue::string("connection")),
    ("pool.name", AttributeValue::string("database")),
    ("operation", AttributeValue::string("acquire"))
  ])
  
  up_down_counter.add(-50L, [
    ("pool.type", AttributeValue::string("connection")),
    ("pool.name", AttributeValue::string("database")),
    ("operation", AttributeValue::string("release"))
  ])
  
  assert_eq(true, true)
}

test "gauge_boundary_conditions" {
  let gauge = NoopGauge::{}
  
  // æµ‹è¯•å„ç§è¾¹ç•Œå€¼
  gauge.record(1.7976931348623157e+308, [])  // æœ€å¤§å€¼
  gauge.record(-1.7976931348623157e+308, [])  // æœ€å°å€¼
  gauge.record(0.0, [])  // é›¶å€¼
  gauge.record(1.0e-308, [])  // æå°æ­£å€¼
  gauge.record(-1.0e-308, [])  // æå°è´Ÿå€¼
  gauge.record(1.0/0.0, [])  // æ­£æ— ç©·
  gauge.record(-1.0/0.0, [])  // è´Ÿæ— ç©·
  gauge.record(0.0/0.0, [])  // NaN
  
  // æµ‹è¯•å¸¦å±æ€§çš„è¾¹ç•Œå€¼
  gauge.record(100.0, [
    ("metric.name", AttributeValue::string("cpu_usage")),
    ("host.name", AttributeValue::string("server-01")),
    ("process.name", AttributeValue::string("azimuth"))
  ])
  
  gauge.record(0.0, [
    ("metric.name", AttributeValue::string("cpu_usage")),
    ("host.name", AttributeValue::string("server-01")),
    ("process.name", AttributeValue::string("azimuth"))
  ])
  
  assert_eq(true, true)
}

test "meter_boundary_scenarios" {
  let provider = NoopMeterProvider::{}
  
  // æµ‹è¯•è¾¹ç•Œæ¡ä»¶çš„meteråˆ›å»º
  let meter_empty_name = provider.get_meter("", None, None)
  let meter_long_name = provider.get_meter("a".repeat(1000), Some("1.0.0"), Some("schema"))
  let meter_unicode_name = provider.get_meter("æµ‹è¯•ä»ªè¡¨ğŸš€", Some("ç‰ˆæœ¬1.0"), Some("https://æµ‹è¯•.com/schema"))
  let meter_special_chars = provider.get_meter("!@#$%^&*()_+-=[]{}|;':\",./<>?", None, None)
  
  // æµ‹è¯•æ‰€æœ‰meterséƒ½èƒ½æ­£å¸¸å·¥ä½œ
  let meters = [meter_empty_name, meter_long_name, meter_unicode_name, meter_special_chars]
  let mut i = 0
  while i < meters.length() {
    let meter = meters[i]
    
    let counter = meter.create_counter("boundary_counter", None, None)
    let histogram = meter.create_histogram("boundary_histogram", None, None)
    let up_down_counter = meter.create_up_down_counter("boundary_up_down", None, None)
    let gauge = meter.create_gauge("boundary_gauge", None, None)
    
    // æµ‹è¯•æ‰€æœ‰instrumentçš„åŸºæœ¬æ“ä½œ
    counter.add(1L, [])
    histogram.record(1.0, [])
    up_down_counter.add(1L, [])
    gauge.record(1.0, [])
    
    i = i + 1
  }
  
  assert_eq(true, true)
}

test "attributes_boundary_conditions" {
  let meter = NoopMeter::{}
  let counter = meter.create_counter("boundary_attrs", None, None)
  
  // æµ‹è¯•è¾¹ç•Œæ¡ä»¶çš„å±æ€§
  
  // ç©ºå±æ€§æ•°ç»„
  counter.add(1L, [])
  
  // å•ä¸ªå±æ€§
  counter.add(1L, [("single", AttributeValue::string("value"))])
  
  // å¤§é‡å±æ€§
  let many_attrs = []
  let mut i = 0
  while i < 100 {
    many_attrs.push(("key" + i.to_string(), AttributeValue::string("value" + i.to_string())))
    i = i + 1
  }
  counter.add(1L, many_attrs)
  
  // ç‰¹æ®Šå­—ç¬¦é”®å
  counter.add(1L, [
    ("", AttributeValue::string("empty_key")),
    (" ", AttributeValue::string("space_key")),
    ("!@#$%^&*()", AttributeValue::string("special_chars")),
    ("ä¸­æ–‡é”®", AttributeValue::string("ä¸­æ–‡å€¼")),
    ("ğŸš€", AttributeValue::string("rocket")),
    ("a".repeat(1000), AttributeValue::string("long_key"))
  ])
  
  // è¾¹ç•Œå€¼å±æ€§
  counter.add(1L, [
    ("empty.string", AttributeValue::string("")),
    ("max.int", AttributeValue::int(9223372036854775807L)),
    ("min.int", AttributeValue::int(-9223372036854775808L)),
    ("zero.int", AttributeValue::int(0L)),
    ("max.float", AttributeValue::float(1.7976931348623157e+308)),
    ("min.float", AttributeValue::float(-1.7976931348623157e+308)),
    ("zero.float", AttributeValue::float(0.0)),
    ("infinity", AttributeValue::float(1.0/0.0)),
    ("nan", AttributeValue::float(0.0/0.0)),
    ("empty.array", AttributeValue::array_string([])),
    ("large.array", AttributeValue::array_string(["item".repeat(100)]))
  ])
  
  assert_eq(true, true)
}