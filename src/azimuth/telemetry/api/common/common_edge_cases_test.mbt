// Commonæ¨¡å—çš„è¾¹ç•Œæµ‹è¯•ç”¨ä¾‹
test "resource_edge_cases_and_validation" {
  // æµ‹è¯•Resourceçš„è¾¹ç•Œæƒ…å†µå’ŒéªŒè¯
  
  // 1. ç©ºå­—ç¬¦ä¸²æœåŠ¡åç§°
  let empty_resource = Resource::default("")
  assert_eq(empty_resource.service_name, "")
  assert_eq(empty_resource.telemetry_sdk_name, "azimuth")
  assert_eq(empty_resource.telemetry_sdk_version, "0.1.0")
  assert_eq(empty_resource.service_version, None)
  assert_eq(empty_resource.attributes.length(), 0)
  
  // 2. æé•¿æœåŠ¡åç§°
  let long_name = "a".repeat(10000)
  let long_resource = Resource::default(long_name)
  assert_eq(long_resource.service_name.length(), 10000)
  assert_eq(long_resource.telemetry_sdk_name, "azimuth")
  
  // 3. ç‰¹æ®Šå­—ç¬¦æœåŠ¡åç§°
  let special_resource = Resource::default("service!@#$%^&*(){}[]|\\:;\"'<>?,./")
  assert_eq(special_resource.service_name, "service!@#$%^&*(){}[]|\\:;\"'<>?,./")
  
  // 4. UnicodeæœåŠ¡åç§°
  let unicode_resource = Resource::default("UnicodeæœåŠ¡æµ‹è¯•ğŸš€emoji")
  assert_eq(unicode_resource.service_name, "UnicodeæœåŠ¡æµ‹è¯•ğŸš€emoji")
  
  // 5. åŒ…å«ç©ºæ ¼çš„æœåŠ¡åç§°
  let space_resource = Resource::default("service with spaces")
  assert_eq(space_resource.service_name, "service with spaces")
  
  // 6. æ•°å­—å’Œå­—æ¯æ··åˆçš„æœåŠ¡åç§°
  let mixed_resource = Resource::default("service123v2.0-test")
  assert_eq(mixed_resource.service_name, "service123v2.0-test")
  
  // 7. ä»…åŒ…å«æ•°å­—çš„æœåŠ¡åç§°
  let numeric_resource = Resource::default("123456789")
  assert_eq(numeric_resource.service_name, "123456789")
  
  // 8. ä»…åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„æœåŠ¡åç§°
  let only_special_resource = Resource::default("!@#$%^&*()")
  assert_eq(only_special_resource.service_name, "!@#$%^&*()")
}

test "resource_attributes_complex_scenarios" {
  // æµ‹è¯•Resourceå±æ€§çš„å¤æ‚åœºæ™¯
  
  let resource = Resource::default("test-service")
  
  // 1. åŸºæœ¬å±æ€§ç±»å‹
  let basic_attrs = [
    ("string.attr", AttributeValue::string("string value")),
    ("int.attr", AttributeValue::int(42L)),
    ("float.attr", AttributeValue::float(3.14159)),
    ("bool.attr", AttributeValue::bool(true))
  ]
  
  // 2. æ•°ç»„å±æ€§ç±»å‹
  let array_attrs = [
    ("string.array", AttributeValue::array_string(["a", "b", "c"])),
    ("int.array", AttributeValue::array_int([1L, 2L, 3L])),
    ("float.array", AttributeValue::array_float([1.1, 2.2, 3.3])),
    ("bool.array", AttributeValue::array_bool([true, false, true]))
  ]
  
  // 3. è¾¹ç•Œå€¼å±æ€§
  let boundary_attrs = [
    ("empty.string", AttributeValue::string("")),
    ("zero.int", AttributeValue::int(0L)),
    ("negative.int", AttributeValue::int(-1L)),
    ("max.int", AttributeValue::int(9223372036854775807L)),
    ("min.int", AttributeValue::int(-9223372036854775808L)),
    ("zero.float", AttributeValue::float(0.0)),
    ("negative.float", AttributeValue::float(-1.0)),
    ("infinity", AttributeValue::float(1.0/0.0)),
    ("neg.infinity", AttributeValue::float(-1.0/0.0)),
    ("nan", AttributeValue::float(0.0/0.0)),
    ("false.bool", AttributeValue::bool(false))
  ]
  
  // 4. ç©ºæ•°ç»„å±æ€§
  let empty_array_attrs = [
    ("empty.string.array", AttributeValue::array_string([])),
    ("empty.int.array", AttributeValue::array_int([])),
    ("empty.float.array", AttributeValue::array_float([])),
    ("empty.bool.array", AttributeValue::array_bool([]))
  ]
  
  // 5. é•¿æ•°ç»„å±æ€§
  let long_string_array = [for i = 0; i < 1000; i = i + 1].map(fn(_) { "item" })
  let long_int_array = [for i = 0; i < 1000; i = i + 1].map(fn(_) { 1L })
  let long_float_array = [for i = 0; i < 1000; i = i + 1].map(fn(_) { 1.0 })
  let long_bool_array = [for i = 0; i < 1000; i = i + 1].map(fn(_) { true })
  
  let long_array_attrs = [
    ("long.string.array", AttributeValue::array_string(long_string_array)),
    ("long.int.array", AttributeValue::array_int(long_int_array)),
    ("long.float.array", AttributeValue::array_float(long_float_array)),
    ("long.bool.array", AttributeValue::array_bool(long_bool_array))
  ]
  
  // 6. ç‰¹æ®Šå­—ç¬¦å±æ€§
  let special_attrs = [
    ("special.chars", AttributeValue::string("!@#$%^&*(){}[]|\\:;\"'<>?,./")),
    ("unicode.chars", AttributeValue::string("æµ‹è¯•ä¸­æ–‡ğŸš€Ã†Ã˜Ã¥ÃŸ")),
    ("newlines", AttributeValue::string("line1\nline2\rline3")),
    ("tabs", AttributeValue::string("col1\tcol2\tcol3")),
    ("quotes", AttributeValue::string("\"single\" and 'double' quotes"))
  ]
  
  // 7. éªŒè¯æ‰€æœ‰å±æ€§ç±»å‹
  let all_attrs = basic_attrs + array_attrs + boundary_attrs + empty_array_attrs + long_array_attrs + special_attrs
  
  let mut i = 0
  while i < all_attrs.length() {
    let (key, value) = all_attrs[i]
    // éªŒè¯å±æ€§é”®ä¸ä¸ºç©º
    assert_eq(key.length() > 0, true)
    
    // éªŒè¯å±æ€§å€¼ç±»å‹
    match value {
      AttributeValue::StringValue(s) => assert_eq(true, true)
      AttributeValue::IntValue(i) => assert_eq(true, true)
      AttributeValue::FloatValue(f) => assert_eq(true, true)
      AttributeValue::BoolValue(b) => assert_eq(true, true)
      AttributeValue::ArrayStringValue(arr) => assert_eq(true, true)
      AttributeValue::ArrayIntValue(arr) => assert_eq(true, true)
      AttributeValue::ArrayFloatValue(arr) => assert_eq(true, true)
      AttributeValue::ArrayBoolValue(arr) => assert_eq(true, true)
    }
    
    i = i + 1
  }
}

test "attribute_value_type_conversions_and_edge_cases" {
  // æµ‹è¯•AttributeValueçš„ç±»å‹è½¬æ¢å’Œè¾¹ç•Œæƒ…å†µ
  
  // 1. å­—ç¬¦ä¸²å±æ€§å€¼çš„è¾¹ç•Œæƒ…å†µ
  let empty_string = AttributeValue::string("")
  let space_string = AttributeValue::string(" ")
  let long_string = AttributeValue::string("a".repeat(100000))
  let special_string = AttributeValue::string("\x00\x01\x02\x03")
  let unicode_string = AttributeValue::string("ğŸš€æµ‹è¯•Ã†Ã˜Ã¥")
  
  match empty_string {
    AttributeValue::StringValue(s) => assert_eq(s, "")
    _ => @test.fail("Test failed")
  }
  
  match space_string {
    AttributeValue::StringValue(s) => assert_eq(s, " ")
    _ => @test.fail("Test failed")
  }
  
  match long_string {
    AttributeValue::StringValue(s) => assert_eq(s.length(), 100000)
    _ => @test.fail("Test failed")
  }
  
  // 2. æ•´æ•°å±æ€§å€¼çš„è¾¹ç•Œæƒ…å†µ
  let zero_int = AttributeValue::int(0L)
  let max_int = AttributeValue::int(9223372036854775807L)
  let min_int = AttributeValue::int(-9223372036854775808L)
  let negative_one = AttributeValue::int(-1L)
  
  match zero_int {
    AttributeValue::IntValue(i) => assert_eq(i, 0L)
    _ => @test.fail("Test failed")
  }
  
  match max_int {
    AttributeValue::IntValue(i) => assert_eq(i, 9223372036854775807L)
    _ => @test.fail("Test failed")
  }
  
  match min_int {
    AttributeValue::IntValue(i) => assert_eq(i, -9223372036854775808L)
    _ => @test.fail("Test failed")
  }
  
  // 3. æµ®ç‚¹æ•°å±æ€§å€¼çš„è¾¹ç•Œæƒ…å†µ
  let zero_float = AttributeValue::float(0.0)
  let negative_zero = AttributeValue::float(-0.0)
  let positive_inf = AttributeValue::float(1.0/0.0)
  let negative_inf = AttributeValue::float(-1.0/0.0)
  let nan_value = AttributeValue::float(0.0/0.0)
  let max_float = AttributeValue::float(1.7976931348623157e+308)
  let min_float = AttributeValue::float(4.9e-324)
  
  match zero_float {
    AttributeValue::FloatValue(f) => assert_eq(f, 0.0)
    _ => @test.fail("Test failed")
  }
  
  match positive_inf {
    AttributeValue::FloatValue(f) => assert_eq(f > 1.0e308, true)
    _ => @test.fail("Test failed")
  }
  
  // 4. å¸ƒå°”å±æ€§å€¼çš„è¾¹ç•Œæƒ…å†µ
  let true_value = AttributeValue::bool(true)
  let false_value = AttributeValue::bool(false)
  
  match true_value {
    AttributeValue::BoolValue(b) => assert_eq(b, true)
    _ => @test.fail("Test failed")
  }
  
  match false_value {
    AttributeValue::BoolValue(b) => assert_eq(b, false)
    _ => @test.fail("Test failed")
  }
  
  // 5. æ•°ç»„å±æ€§å€¼çš„è¾¹ç•Œæƒ…å†µ
  let empty_string_array = AttributeValue::array_string([])
  let single_string_array = AttributeValue::array_string(["single"])
  let large_string_array = AttributeValue::array_string([for i = 0; i < 10000; i = i + 1].map(fn(_) { "item" }))
  
  let empty_int_array = AttributeValue::array_int([])
  let mixed_int_array = AttributeValue::array_int([0L, -1L, 1L, 9223372036854775807L, -9223372036854775808L])
  
  match empty_string_array {
    AttributeValue::ArrayStringValue(arr) => assert_eq(arr.length(), 0)
    _ => @test.fail("Test failed")
  }
  
  match single_string_array {
    AttributeValue::ArrayStringValue(arr) => {
      assert_eq(arr.length(), 1)
      assert_eq(arr[0], "single")
    }
    _ => @test.fail("Test failed")
  }
  
  match mixed_int_array {
    AttributeValue::ArrayIntValue(arr) => {
      assert_eq(arr.length(), 5)
      assert_eq(arr[0], 0L)
      assert_eq(arr[1], -1L)
      assert_eq(arr[2], 1L)
      assert_eq(arr[3], 9223372036854775807L)
      assert_eq(arr[4], -9223372036854775808L)
    }
    _ => @test.fail("Test failed")
  }
}

test "resource_creation_patterns_and_best_practices" {
  // æµ‹è¯•Resourceåˆ›å»ºæ¨¡å¼å’Œæœ€ä½³å®è·µ
  
  // 1. å¾®æœåŠ¡èµ„æºæ¨¡å¼
  let microservice_resource = Resource::default("user-service")
  let microservice_attrs = [
    ("service.name", AttributeValue::string("user-service")),
    ("service.version", AttributeValue::string("2.1.0")),
    ("service.namespace", AttributeValue::string("production")),
    ("service.instance.id", AttributeValue::string("user-service-abc123")),
    ("deployment.environment", AttributeValue::string("prod")),
    ("host.name", AttributeValue::string("k8s-node-01")),
    ("host.ip", AttributeValue::string("10.0.1.100")),
    ("process.pid", AttributeValue::int(12345L)),
    ("process.executable.name", AttributeValue::string("user-service")),
    ("process.command_line", AttributeValue::string("./user-service --config prod.yaml"))
  ]
  
  assert_eq(microservice_resource.service_name, "user-service")
  assert_eq(microservice_attrs.length(), 10)
  
  // 2. æ‰¹å¤„ç†ä½œä¸šèµ„æºæ¨¡å¼
  let batch_resource = Resource::default("data-processing-job")
  let batch_attrs = [
    ("job.name", AttributeValue::string("daily-data-aggregation")),
    ("job.version", AttributeValue::string("1.5.2")),
    ("job.run.id", AttributeValue::string("run-20231225-001")),
    ("job.type", AttributeValue::string("batch")),
    ("job.schedule", AttributeValue::string("cron(0 2 * * *)")),
    ("cloud.provider", AttributeValue::string("aws")),
    ("cloud.region", AttributeValue::string("us-west-2")),
    ("cloud.availability_zone", AttributeValue::string("us-west-2a")),
    ("k8s.cluster.name", AttributeValue::string("production-cluster")),
    ("k8s.namespace", AttributeValue::string("data-processing")),
    ("k8s.pod.name", AttributeValue::string("data-processing-xyz789"))
  ]
  
  assert_eq(batch_resource.service_name, "data-processing-job")
  assert_eq(batch_attrs.length(), 11)
  
  // 3. å‡½æ•°è®¡ç®—èµ„æºæ¨¡å¼
  let function_resource = Resource::default("image-processor-function")
  let function_attrs = [
    ("faas.name", AttributeValue::string("image-processor")),
    ("faas.version", AttributeValue::string("v1.0.0")),
    ("faas.instance", AttributeValue::string("lambda-function-123")),
    ("faas.max_memory", AttributeValue::int(512000000L)),
    ("cloud.provider", AttributeValue::string("aws")),
    ("cloud.region", AttributeValue::string("us-east-1")),
    ("aws.lambda.function_name", AttributeValue::string("image-processor")),
    ("aws.lambda.function_version", AttributeValue::string("$LATEST")),
    ("aws.lambda.arn", AttributeValue::string("arn:aws:lambda:us-east-1:123456789:function:image-processor"))
  ]
  
  assert_eq(function_resource.service_name, "image-processor-function")
  assert_eq(function_attrs.length(), 9)
  
  // 4. ç§»åŠ¨åº”ç”¨èµ„æºæ¨¡å¼
  let mobile_resource = Resource::default("mobile-app-client")
  let mobile_attrs = [
    ("service.name", AttributeValue::string("mobile-app")),
    ("service.version", AttributeValue::string("3.2.1")),
    ("device.model", AttributeValue::string("iPhone 14 Pro")),
    ("device.manufacturer", AttributeValue::string("Apple")),
    ("os.type", AttributeValue::string("iOS")),
    ("os.version", AttributeValue::string("17.1.1")),
    ("app.version", AttributeValue::string("3.2.1")),
    ("app.build", AttributeValue::string("20231225001")),
    ("network.type", AttributeValue::string("wifi")),
    ("carrier.name", AttributeValue::string("Verizon")),
    ("user.locale", AttributeValue::string("en_US"))
  ]
  
  assert_eq(mobile_resource.service_name, "mobile-app-client")
  assert_eq(mobile_attrs.length(), 11)
}

test "attribute_value_serialization_compatibility" {
  // æµ‹è¯•AttributeValueçš„åºåˆ—åŒ–å…¼å®¹æ€§
  
  // 1. åŸºæœ¬ç±»å‹åºåˆ—åŒ–åœºæ™¯
  let serializable_attrs = [
    ("port.number", AttributeValue::int(8080L)),
    ("enable.ssl", AttributeValue::bool(true)),
    ("timeout.seconds", AttributeValue::float(30.0)),
    ("service.name", AttributeValue::string("api-gateway"))
  ]
  
  // 2. JSONå…¼å®¹æ€§åœºæ™¯
  let json_compatible_attrs = [
    ("json.object", AttributeValue::string("{\"key\":\"value\",\"number\":42}")),
    ("json.array", AttributeValue::string("[\"item1\",\"item2\",\"item3\"]")),
    ("json.boolean", AttributeValue::string("true")),
    ("json.null", AttributeValue::string("null"))
  ]
  
  // 3. URLç¼–ç åœºæ™¯
  let url_encoded_attrs = [
    ("url.path", AttributeValue::string("/api/v1/users%20123")),
    ("url.query", AttributeValue::string("key=value%20with%20spaces")),
    ("url.fragment", AttributeValue::string("#section%20name"))
  ]
  
  // 4. Base64ç¼–ç åœºæ™¯
  let base64_attrs = [
    ("binary.data", AttributeValue::string("SGVsbG8gV29ybGQ=")), // "Hello World"
    ("image.thumbnail", AttributeValue::string("iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg=="))
  ]
  
  // 5. æ—¶é—´åºåˆ—åŒ–åœºæ™¯
  let time_attrs = [
    ("timestamp.iso8601", AttributeValue::string("2023-12-25T10:30:00Z")),
    ("timestamp.unix", AttributeValue::string("1703506200")),
    ("timestamp.unix.ms", AttributeValue::string("1703506200000")),
    ("timestamp.unix.ns", AttributeValue::string("1703506200000000000")),
    ("duration.iso8601", AttributeValue::string("PT1H30M45S")),
    ("duration.ms", AttributeValue::string("5445000"))
  ]
  
  // 6. ç‰ˆæœ¬å’Œè¯­ä¹‰åŒ–ç‰ˆæœ¬
  let version_attrs = [
    ("version.semantic", AttributeValue::string("2.1.3")),
    ("version.maven", AttributeValue::string("2.1.3-RELEASE")),
    ("version.npm", AttributeValue::string("2.1.3-beta.1+build.123")),
    ("version.git", AttributeValue::string("v2.1.3-4-gabc123")),
    ("version.docker", AttributeValue::string("2.1.3-alpine"))
  ]
  
  // 7. éªŒè¯æ‰€æœ‰å±æ€§çš„å…¼å®¹æ€§
  let all_compatible_attrs = serializable_attrs + json_compatible_attrs + url_encoded_attrs + base64_attrs + time_attrs + version_attrs
  
  let mut i = 0
  while i < all_compatible_attrs.length() {
    let (key, value) = all_compatible_attrs[i]
    
    // éªŒè¯é”®çš„æ ¼å¼
    assert_eq(key.length() > 0, true)
    assert_eq(key.contains("\x00"), false) // ä¸åº”åŒ…å«nullå­—ç¬¦
    
    // éªŒè¯å€¼çš„æœ‰æ•ˆæ€§
    match value {
      AttributeValue::StringValue(s) => {
        // å­—ç¬¦ä¸²å€¼åº”è¯¥æ˜¯æœ‰æ•ˆçš„UTF-8ï¼ˆåœ¨MoonBitä¸­é»˜è®¤ï¼‰
        assert_eq(s.length() >= 0, true)
      }
      _ => assert_eq(true, true)
    }
    
    i = i + 1
  }
}

test "resource_attribute_performance_considerations" {
  // æµ‹è¯•Resourceå±æ€§çš„æ€§èƒ½è€ƒè™‘
  
  // 1. å¤§é‡å±æ€§çš„æ€§èƒ½æµ‹è¯•
  let large_attrs = []
  let mut i = 0
  while i < 1000 {
    large_attrs.push(("attr." + i.to_string(), AttributeValue::string("value." + i.to_string())))
    i = i + 1
  }
  
  assert_eq(large_attrs.length(), 1000)
  
  // 2. é•¿å­—ç¬¦ä¸²å±æ€§çš„æ€§èƒ½æµ‹è¯•
  let long_string_values = [
    ("long.text", AttributeValue::string("a".repeat(100000))),
    ("long.json", AttributeValue::string("{".repeat(50000) + "}".repeat(50000))),
    ("long.csv", AttributeValue::string("value1,".repeat(10000)))
  ]
  
  match long_string_values[0] {
    (key, AttributeValue::StringValue(s)) => assert_eq(s.length(), 100000)
    _ => @test.fail("Test failed")
  }
  
  // 3. æ·±å±‚åµŒå¥—æ•°æ®ç»“æ„
  let nested_attrs = [
    ("nested.json", AttributeValue::string("{\"level1\":{\"level2\":{\"level3\":{\"deep\":\"value\"}}}}")),
    ("array.nested", AttributeValue::string("[[1,2,3],[4,5,6],[7,8,9]]")),
    ("mixed.nested", AttributeValue::string("{\"users\":[{\"id\":1,\"name\":\"Alice\"},{\"id\":2,\"name\":\"Bob\"}]}"))
  ]
  
  // 4. é«˜é¢‘æ›´æ–°å±æ€§æ¨¡å¼
  let high_freq_attrs = [
    ("request.count", AttributeValue::int(1000000L)),
    ("error.rate", AttributeValue::float(0.001)),
    ("cpu.usage", AttributeValue::float(75.5)),
    ("memory.usage", AttributeValue::int(8589934592L)), // 8GB
    ("disk.usage", AttributeValue::int(107374182400L)), // 100GB
    ("network.in", AttributeValue::int(1048576000L)), // 1GB
    ("network.out", AttributeValue::int(524288000L)), // 500MB
    ("cache.hit.rate", AttributeValue::float(0.95)),
    ("active.connections", AttributeValue::int(1000L)),
    ("queue.size", AttributeValue::int(500L))
  ]
  
  assert_eq(high_freq_attrs.length(), 10)
  
  // 5. éªŒè¯æ€§èƒ½æµ‹è¯•å®Œæˆ
  assert_eq(true, true)
}