// Resourceå’ŒInstrumentationScopeè¯¦ç»†æµ‹è¯•ç”¨ä¾‹
// æµ‹è¯•èµ„æºåˆ›å»ºã€å±æ€§ç®¡ç†å’Œå¤æ‚åœºæ™¯

test "resource_default_creation_variants" {
  // æµ‹è¯•ä¸åŒç±»å‹çš„é»˜è®¤Resourceåˆ›å»º
  let simple_resource = Resource::default("simple-service")
  assert_eq(simple_resource.service_name, "simple-service")
  assert_eq(simple_resource.service_version, None)
  assert_eq(simple_resource.telemetry_sdk_name, "azimuth")
  assert_eq(simple_resource.telemetry_sdk_version, "0.1.0")
  assert_eq(simple_resource.attributes.length(), 0)
  
  // æµ‹è¯•å¸¦æœ‰ç‰ˆæœ¬çš„æœåŠ¡åç§°
  let versioned_resource = Resource::default("service:v1.2.3")
  assert_eq(versioned_resource.service_name, "service:v1.2.3")
  assert_eq(versioned_resource.telemetry_sdk_name, "azimuth")
  assert_eq(versioned_resource.telemetry_sdk_version, "0.1.0")
  
  // æµ‹è¯•é•¿æœåŠ¡åç§°
  let long_name_resource = Resource::default("this-is-a-very-long-service-name-with-many-components-and-subdomains")
  assert_eq(long_name_resource.service_name, "this-is-a-very-long-service-name-with-many-components-and-subdomains")
  assert_eq(long_name_resource.telemetry_sdk_name, "azimuth")
}

test "resource_with_comprehensive_attributes" {
  // æµ‹è¯•Resourceä¸å„ç§ç±»å‹çš„å±æ€§ç»„åˆ
  let resource = Resource::default("comprehensive-test-service")
  
  // å­—ç¬¦ä¸²å±æ€§
  let string_attrs : Attributes = [
    ("service.namespace", AttributeValue::string("production")),
    ("service.instance.id", AttributeValue::string("instance-123")),
    ("deployment.environment", AttributeValue::string("staging")),
    ("host.name", AttributeValue::string("web-server-01")),
    ("k8s.pod.name", AttributeValue::string("my-pod-7d4b8c9f-abc")),
    ("k8s.namespace", AttributeValue::string("default"))
  ]
  
  // æ•°å€¼å±æ€§
  let numeric_attrs : Attributes = [
    ("process.pid", AttributeValue::int(12345L)),
    ("process.start.time", AttributeValue::int(1640995200L)),
    ("cpu.usage", AttributeValue::float(75.5)),
    ("memory.usage", AttributeValue::float(1024.5)),
    ("network.bytes.in", AttributeValue::int(1048576L)),
    ("network.bytes.out", AttributeValue::int(2097152L))
  ]
  
  // å¸ƒå°”å±æ€§
  let bool_attrs : Attributes = [
    ("service.healthy", AttributeValue::bool(true)),
    ("maintenance.mode", AttributeValue::bool(false)),
    ("debug.enabled", AttributeValue::bool(true)),
    ("ssl.enabled", AttributeValue::bool(true))
  ]
  
  // æ•°ç»„å±æ€§
  let array_attrs : Attributes = [
    ("service.tags", AttributeValue::array_string(["web", "api", "critical", "production"])),
    ("service.ports", AttributeValue::array_int([8080L, 8443L, 9090L, 3000L])),
    ("cpu.thresholds", AttributeValue::array_float([60.0, 80.0, 95.0, 99.0])),
    ("feature.flags", AttributeValue::array_bool([true, false, true, false]))
  ]
  
  // éªŒè¯å±æ€§æ•°é‡
  assert_eq(string_attrs.length(), 6)
  assert_eq(numeric_attrs.length(), 6)
  assert_eq(bool_attrs.length(), 4)
  assert_eq(array_attrs.length(), 4)
  
  // éªŒè¯å…·ä½“å±æ€§å€¼
  match string_attrs[0].1 {
    StringValue(s) => assert_eq(s, "production")
    _ => @test.fail("Expected StringValue")
  }
  
  match numeric_attrs[2].1 {
    FloatValue(f) => assert_eq(f, 75.5)
    _ => @test.fail("Expected FloatValue")
  }
  
  match bool_attrs[1].1 {
    BoolValue(b) => assert_eq(b, false)
    _ => @test.fail("Expected BoolValue")
  }
  
  match array_attrs[0].1 {
    ArrayStringValue(arr) => {
      assert_eq(arr.length(), 4)
      assert_eq(arr[0], "web")
      assert_eq(arr[3], "production")
    }
    _ => @test.fail("Expected ArrayStringValue")
  }
}

test "resource_edge_cases_and_special_values" {
  // æµ‹è¯•Resourceçš„è¾¹ç•Œæƒ…å†µå’Œç‰¹æ®Šå€¼
  
  // ç©ºå­—ç¬¦ä¸²æœåŠ¡åç§°
  let empty_name_resource = Resource::default("")
  assert_eq(empty_name_resource.service_name, "")
  assert_eq(empty_name_resource.telemetry_sdk_name, "azimuth")
  
  // åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„æœåŠ¡åç§°
  let special_chars_resource = Resource::default("service!@#$%^&*()_+-=[]{}|;':\",./<>?")
  assert_eq(special_chars_resource.service_name, "service!@#$%^&*()_+-=[]{}|;':\",./<>?")
  
  // Unicodeå’ŒemojiæœåŠ¡åç§°
  let unicode_resource = Resource::default("æµ‹è¯•æœåŠ¡ğŸš€ğŸŒŸğŸ’«")
  assert_eq(unicode_resource.service_name, "æµ‹è¯•æœåŠ¡ğŸš€ğŸŒŸğŸ’«")
  
  // ä»…åŒ…å«ç©ºæ ¼çš„æœåŠ¡åç§°
  let spaces_resource = Resource::default("   ")
  assert_eq(spaces_resource.service_name, "   ")
  
  // æ•°å­—å¼€å¤´çš„æœåŠ¡åç§°
  let numeric_start_resource = Resource::default("123service")
  assert_eq(numeric_start_resource.service_name, "123service")
  
  // éå¸¸é•¿çš„æœåŠ¡åç§°
  let long_name = "a".repeat(1000)
  let very_long_resource = Resource::default(long_name)
  assert_eq(very_long_resource.service_name.length(), 1000)
}

test "resource_attributes_edge_cases" {
  // æµ‹è¯•å±æ€§çš„è¾¹ç•Œæƒ…å†µ
  
  // ç©ºå±æ€§æ•°ç»„
  let empty_attrs : Attributes = []
  assert_eq(empty_attrs.length(), 0)
  
  // å•ä¸ªå±æ€§
  let single_attr : Attributes = [
    ("single.key", AttributeValue::string("single.value"))
  ]
  assert_eq(single_attr.length(), 1)
  
  // åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„å±æ€§é”®
  let special_key_attrs : Attributes = [
    ("key.with.dots", AttributeValue::string("value1")),
    ("key_with_underscores", AttributeValue::string("value2")),
    ("key-with-dashes", AttributeValue::string("value3")),
    ("key.with.all separators!@#$%", AttributeValue::string("value4"))
  ]
  assert_eq(special_key_attrs.length(), 4)
  
  // ç©ºå­—ç¬¦ä¸²å±æ€§é”®å’Œå€¼
  let empty_string_attrs : Attributes = [
    ("", AttributeValue::string("empty.key")),
    ("empty.value", AttributeValue::string("")),
    ("", AttributeValue::string(""))
  ]
  assert_eq(empty_string_attrs.length(), 3)
  
  // æå€¼æ•°å€¼å±æ€§
  let extreme_value_attrs : Attributes = [
    ("max.int", AttributeValue::int(9223372036854775807L)),
    ("min.int", AttributeValue::int(-9223372036854775808L)),
    ("zero.int", AttributeValue::int(0L)),
    ("max.float", AttributeValue::float(1.7976931348623157e+308)),
    ("min.float", AttributeValue::float(-1.7976931348623157e+308)),
    ("zero.float", AttributeValue::float(0.0)),
    ("inf.float", AttributeValue::float(1.0/0.0)),
    ("neg.inf.float", AttributeValue::float(-1.0/0.0)),
    ("nan.float", AttributeValue::float(0.0/0.0))
  ]
  assert_eq(extreme_value_attrs.length(), 9)
  
  // ç©ºæ•°ç»„å±æ€§
  let empty_array_attrs : Attributes = [
    ("empty.string.array", AttributeValue::array_string([])),
    ("empty.int.array", AttributeValue::array_int([])),
    ("empty.float.array", AttributeValue::array_float([])),
    ("empty.bool.array", AttributeValue::array_bool([]))
  ]
  assert_eq(empty_array_attrs.length(), 4)
  
  // å•å…ƒç´ æ•°ç»„å±æ€§
  let single_element_array_attrs : Attributes = [
    ("single.string.array", AttributeValue::array_string(["single"])),
    ("single.int.array", AttributeValue::array_int([1L])),
    ("single.float.array", AttributeValue::array_float([1.0])),
    ("single.bool.array", AttributeValue::array_bool([true]))
  ]
  assert_eq(single_element_array_attrs.length(), 4)
}

test "instrumentation_scope_comprehensive_scenarios" {
  // æµ‹è¯•InstrumentationScopeçš„å¤æ‚åœºæ™¯
  // ç”±äºInstrumentationScopeæ˜¯åªè¯»ç±»å‹ï¼Œæˆ‘ä»¬é€šè¿‡Resourceæµ‹è¯•ç›¸å…³åŠŸèƒ½
  
  // æ¨¡æ‹Ÿä¸åŒç±»å‹çš„InstrumentationScopeä½¿ç”¨åœºæ™¯
  let web_server_resource = Resource::default("web-server")
  let web_attrs : Attributes = [
    ("instrumentation.name", AttributeValue::string("web-server")),
    ("instrumentation.version", AttributeValue::string("1.2.3")),
    ("instrumentation.schema", AttributeValue::string("https://opentelemetry.io/schemas/1.20.0")),
    ("server.type", AttributeValue::string("http")),
    ("server.port", AttributeValue::int(8080L)),
    ("server.ssl", AttributeValue::bool(true))
  ]
  
  let database_resource = Resource::default("database-client")
  let db_attrs : Attributes = [
    ("instrumentation.name", AttributeValue::string("database-client")),
    ("instrumentation.version", AttributeValue::string("2.1.0")),
    ("db.system", AttributeValue::string("postgresql")),
    ("db.port", AttributeValue::int(5432L)),
    ("db.ssl", AttributeValue::bool(true)),
    ("db.pool.size", AttributeValue::int(10L))
  ]
  
  let messaging_resource = Resource::default("messaging-client")
  let messaging_attrs : Attributes = [
    ("instrumentation.name", AttributeValue::string("messaging-client")),
    ("instrumentation.version", AttributeValue::string("3.0.1")),
    ("messaging.system", AttributeValue::string("kafka")),
    ("messaging.broker", AttributeValue::string("broker-1:9092")),
    ("messaging.topic", AttributeValue::string("user-events"))
  ]
  
  // éªŒè¯ä¸åŒåœºæ™¯çš„å±æ€§
  assert_eq(web_server_resource.service_name, "web-server")
  assert_eq(web_attrs.length(), 6)
  
  assert_eq(database_resource.service_name, "database-client")
  assert_eq(db_attrs.length(), 6)
  
  assert_eq(messaging_resource.service_name, "messaging-client")
  assert_eq(messaging_attrs.length(), 4)
  
  // éªŒè¯å…·ä½“å±æ€§å€¼
  match web_attrs[0].1 {
    StringValue(s) => assert_eq(s, "web-server")
    _ => @test.fail("Expected StringValue")
  }
  
  match db_attrs[2].1 {
    StringValue(s) => assert_eq(s, "postgresql")
    _ => @test.fail("Expected StringValue")
  }
  
  match messaging_attrs[2].1 {
    StringValue(s) => assert_eq(s, "kafka")
    _ => @test.fail("Expected StringValue")
  }
}

test "resource_and_attributes_performance_considerations" {
  // æµ‹è¯•å¤§é‡å±æ€§çš„æ€§èƒ½åœºæ™¯
  
  // åˆ›å»ºå¤§é‡å±æ€§
  let mut large_attrs : Attributes = []
  let mut i = 0
  while i < 100 {
    let key = "attr." + i.to_string()
    let value = AttributeValue::string("value." + i.to_string())
    large_attrs.push((key, value))
    i = i + 1
  }
  
  assert_eq(large_attrs.length(), 100)
  
  // éªŒè¯ç‰¹å®šç´¢å¼•çš„å±æ€§
  match large_attrs[0].1 {
    StringValue(s) => assert_eq(s, "value.0")
    _ => @test.fail("Expected StringValue")
  }
  
  match large_attrs[99].1 {
    StringValue(s) => assert_eq(s, "value.99")
    _ => @test.fail("Expected StringValue")
  }
  
  // æµ‹è¯•æ··åˆç±»å‹çš„å¤§é‡å±æ€§
  let mut mixed_attrs : Attributes = []
  let mut j = 0
  while j < 50 {
    let string_key = "string.attr." + j.to_string()
    let int_key = "int.attr." + j.to_string()
    let float_key = "float.attr." + j.to_string()
    let bool_key = "bool.attr." + j.to_string()
    
    mixed_attrs.push((string_key, AttributeValue::string("value." + j.to_string())))
    mixed_attrs.push((int_key, AttributeValue::int(j.to_int64())))
    mixed_attrs.push((float_key, AttributeValue::float(j.to_double() * 1.1)))
    mixed_attrs.push((bool_key, AttributeValue::bool(j % 2 == 0)))
    
    j = j + 1
  }
  
  assert_eq(mixed_attrs.length(), 200)
  
  // éªŒè¯æ··åˆç±»å‹çš„å±æ€§
  match mixed_attrs[0].1 {
    StringValue(s) => assert_eq(s, "value.0")
    _ => @test.fail("Expected StringValue")
  }
  
  match mixed_attrs[1].1 {
    IntValue(i) => assert_eq(i, 0L)
    _ => @test.fail("Expected IntValue")
  }
  
  match mixed_attrs[2].1 {
    FloatValue(f) => assert_eq(f, 0.0)
    _ => @test.fail("Expected FloatValue")
  }
  
  match mixed_attrs[3].1 {
    BoolValue(b) => assert_eq(b, true)
    _ => @test.fail("Expected BoolValue")
  }
}