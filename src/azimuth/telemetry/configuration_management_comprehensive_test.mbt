// é…ç½®ç®¡ç†æµ‹è¯• - æµ‹è¯•é¥æµ‹ç³»ç»Ÿçš„é…ç½®ç®¡ç†åŠŸèƒ½

test "telemetry_configuration_basic" {
  // æµ‹è¯•åŸºæœ¬çš„é¥æµ‹é…ç½®
  
  // æ¨¡æ‹ŸåŸºæœ¬é…ç½®ç»“æ„
  let basic_config = {
    "service.name": "test-service",
    "service.version": "1.0.0",
    "telemetry.sdk.name": "azimuth",
    "telemetry.sdk.version": "0.1.0",
    "environment": "test"
  }
  
  // éªŒè¯åŸºæœ¬é…ç½®å¯ä»¥æ­£ç¡®åˆ›å»ºResource
  let resource = Resource::{
    service_name: "test-service",
    service_version: Some("1.0.0"),
    telemetry_sdk_name: "azimuth",
    telemetry_sdk_version: "0.1.0",
    attributes: [
      ("environment", AttributeValue::string("test"))
    ]
  }
  
  assert_eq(resource.service_name, "test-service")
  assert_eq(resource.service_version, Some("1.0.0"))
  assert_eq(resource.telemetry_sdk_name, "azimuth")
  assert_eq(resource.telemetry_sdk_version, "0.1.0")
  assert_eq(resource.attributes.length(), 1)
  
  match resource.attributes[0].1 {
    StringValue(env) => assert_eq(env, "test")
    _ => @test.fail("Test failed")
  }
  
  // æµ‹è¯•InstrumentationScopeé…ç½®
  let scope_config = {
    "instrumentation.name": "test-instrumentation",
    "instrumentation.version": "1.5.0",
    "instrumentation.schema_url": "https://example.com/schema"
  }
  
  let instrumentation_scope = InstrumentationScope::{
    name: "test-instrumentation",
    version: Some("1.5.0"),
    schema_url: Some("https://example.com/schema")
  }
  
  assert_eq(instrumentation_scope.name, "test-instrumentation")
  assert_eq(instrumentation_scope.version, Some("1.5.0"))
  assert_eq(instrumentation_scope.schema_url, Some("https://example.com/schema"))
}

test "telemetry_configuration_complex" {
  // æµ‹è¯•å¤æ‚çš„é¥æµ‹é…ç½®
  
  // æ¨¡æ‹Ÿå¤æ‚é…ç½®ç»“æ„
  let complex_config_attributes = [
    ("service.name", AttributeValue::string("complex-service")),
    ("service.version", AttributeValue::string("2.1.0-beta.1")),
    ("service.namespace", AttributeValue::string("payments")),
    ("deployment.environment", AttributeValue::string("production")),
    ("deployment.region", AttributeValue::string("us-west-2")),
    ("deployment.zone", AttributeValue::string("us-west-2a")),
    ("host.name", AttributeValue::string("prod-payment-01")),
    ("host.ip", AttributeValue::string("10.0.1.100")),
    ("host.id", AttributeValue::string("i-1234567890abcdef0")),
    ("host.type", AttributeValue::string("t3.medium")),
    ("process.id", AttributeValue::int(12345L)),
    ("process.executable.name", AttributeValue::string("payment-service")),
    ("process.executable.path", AttributeValue::string("/opt/payment-service/bin/payment-service")),
    ("process.command", AttributeValue::string("./payment-service")),
    ("process.command_args", AttributeValue::array_string(["./payment-service", "--config", "/etc/payment/config.yaml"])),
    ("process.owner", AttributeValue::string("payment-user")),
    ("process.runtime.name", AttributeValue::string("nodejs")),
    ("process.runtime.version", AttributeValue::string("18.17.0")),
    ("process.runtime.description", AttributeValue::string("Node.js JavaScript Runtime")),
    ("telemetry.sdk.name", AttributeValue::string("azimuth")),
    ("telemetry.sdk.version", AttributeValue::string("0.1.0")),
    ("telemetry.sdk.language", AttributeValue::string("moonbit")),
    ("telemetry.auto_instrumentation.version", AttributeValue::string("0.1.0")),
    ("telemetry.distros.version", AttributeValue::string("0.1.0")),
    ("container.id", AttributeValue::string("container-123456")),
    ("container.name", AttributeValue::string("payment-container")),
    ("container.image.name", AttributeValue::string("payment-service:2.1.0-beta.1")),
    ("container.image.tag", AttributeValue::string("2.1.0-beta.1")),
    ("k8s.pod.name", AttributeValue::string("payment-service-7d4f8c9b5-xyz12")),
    ("k8s.namespace.name", AttributeValue::string("payments")),
    ("k8s.deployment.name", AttributeValue::string("payment-service")),
    ("k8s.node.name", AttributeValue::string("ip-10-0-1-100.us-west-2.compute.internal")),
    ("cloud.provider", AttributeValue::string("aws")),
    ("cloud.account.id", AttributeValue::string("123456789012")),
    ("cloud.region", AttributeValue::string("us-west-2")),
    ("cloud.availability_zone", AttributeValue::string("us-west-2a")),
    ("cloud.platform", AttributeValue::string("aws_ec2")),
    ("service.instance.id", AttributeValue::string("instance-123456")),
    ("service.namespace", AttributeValue::string("payments")),
    ("service.version", AttributeValue::string("2.1.0-beta.1")),
    ("service.name", AttributeValue::string("payment-service")),
    ("os.type", AttributeValue::string("linux")),
    ("os.description", AttributeValue::string("Amazon Linux 2")),
    ("os.name", AttributeValue::string("Amazon Linux")),
    ("os.version", AttributeValue::string("2")),
    ("os.build_id", AttributeValue::string("kernel-5.10.0-197.736.amzn2.x86_64"))
  ]
  
  let complex_resource = Resource::{
    service_name: "complex-service",
    service_version: Some("2.1.0-beta.1"),
    telemetry_sdk_name: "azimuth",
    telemetry_sdk_version: "0.1.0",
    attributes: complex_config_attributes
  }
  
  // éªŒè¯å¤æ‚é…ç½®
  assert_eq(complex_resource.service_name, "complex-service")
  assert_eq(complex_resource.service_version, Some("2.1.0-beta.1"))
  assert_eq(complex_resource.attributes.length(), 42)
  
  // éªŒè¯ç‰¹å®šé…ç½®é¡¹
  let mut found_service_name = false
  let mut found_deployment_env = false
  let mut found_cloud_provider = false
  let mut found_k8s_pod = false
  let mut found_container = false
  let mut found_process_args = false
  
  let mut i = 0
  while i < complex_resource.attributes.length() {
    let (key, value) = complex_resource.attributes[i]
    
    match key {
      "service.name" => {
        match value {
          StringValue(name) => {
            assert_eq(name, "complex-service")
            found_service_name = true
          }
          _ => @test.fail("Test failed")
        }
      }
      "deployment.environment" => {
        match value {
          StringValue(env) => {
            assert_eq(env, "production")
            found_deployment_env = true
          }
          _ => @test.fail("Test failed")
        }
      }
      "cloud.provider" => {
        match value {
          StringValue(provider) => {
            assert_eq(provider, "aws")
            found_cloud_provider = true
          }
          _ => @test.fail("Test failed")
        }
      }
      "k8s.pod.name" => {
        match value {
          StringValue(pod) => {
            assert_eq(pod, "payment-service-7d4f8c9b5-xyz12")
            found_k8s_pod = true
          }
          _ => @test.fail("Test failed")
        }
      }
      "container.id" => {
        match value {
          StringValue(id) => {
            assert_eq(id, "container-123456")
            found_container = true
          }
          _ => @test.fail("Test failed")
        }
      }
      "process.command_args" => {
        match value {
          ArrayStringValue(args) => {
            assert_eq(args.length(), 3)
            assert_eq(args[0], "./payment-service")
            assert_eq(args[1], "--config")
            assert_eq(args[2], "/etc/payment/config.yaml")
            found_process_args = true
          }
          _ => @test.fail("Test failed")
        }
      }
      _ => ()  // å¿½ç•¥å…¶ä»–é”®
    }
    i = i + 1
  }
  
  assert_eq(found_service_name, true)
  assert_eq(found_deployment_env, true)
  assert_eq(found_cloud_provider, true)
  assert_eq(found_k8s_pod, true)
  assert_eq(found_container, true)
  assert_eq(found_process_args, true)
}

test "telemetry_configuration_validation" {
  // æµ‹è¯•é¥æµ‹é…ç½®çš„éªŒè¯
  
  // æµ‹è¯•æœ‰æ•ˆé…ç½®
  let valid_configs = [
    ("service.name", "valid-service"),
    ("service.version", "1.0.0"),
    ("telemetry.sdk.name", "azimuth"),
    ("telemetry.sdk.version", "0.1.0"),
    ("deployment.environment", "production"),
    ("host.name", "valid-host-name"),
    ("process.id", "12345"),
    ("container.id", "valid-container-id"),
    ("k8s.pod.name", "valid-pod-name"),
    ("cloud.provider", "aws")
  ]
  
  let mut valid_i = 0
  while valid_i < valid_configs.length() {
    let (key, value) = valid_configs[valid_i]
    
    // éªŒè¯é…ç½®é”®å’Œå€¼ä¸ä¸ºç©º
    assert_eq(key.length() > 0, true)
    assert_eq(value.length() > 0, true)
    
    // éªŒè¯é…ç½®é”®æ ¼å¼
    assert_eq(key.contains(" "), false)  // é…ç½®é”®ä¸åº”åŒ…å«ç©ºæ ¼
    assert_eq(key[0].is_alphabetic(), true)  // é…ç½®é”®åº”ä»¥å­—æ¯å¼€å¤´
    
    valid_i = valid_i + 1
  }
  
  // æµ‹è¯•æ— æ•ˆé…ç½®
  let invalid_config_keys = [
    "",  // ç©ºé”®
    " ",  // åªæœ‰ç©ºæ ¼çš„é”®
    "invalid key with spaces",  // åŒ…å«ç©ºæ ¼çš„é”®
    "123invalid",  // ä»¥æ•°å­—å¼€å¤´çš„é”®
    "invalid@key",  // åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„é”®
    "invalid.key.with.many.dots.and.very.long.name.that.exceeds.reasonable.limits"
  ]
  
  let mut invalid_i = 0
  while invalid_i < invalid_config_keys.length() {
    let invalid_key = invalid_config_keys[invalid_i]
    
    // éªŒè¯æ— æ•ˆé…ç½®é”®è¢«æ­£ç¡®è¯†åˆ«
    if invalid_key.length() == 0 {
      assert_eq(invalid_key.length() == 0, true)  // ç©ºé”®
    } else if invalid_key.contains(" ") {
      assert_eq(invalid_key.contains(" "), true)  // åŒ…å«ç©ºæ ¼
    } else if invalid_key.length() > 0 && invalid_key[0].is_digit() {
      assert_eq(invalid_key[0].is_digit(), true)  // ä»¥æ•°å­—å¼€å¤´
    }
    
    invalid_i = invalid_i + 1
  }
  
  // æµ‹è¯•è¾¹ç•Œå€¼é…ç½®
  let boundary_config_values = [
    ("service.name", ""),  // ç©ºå€¼
    ("service.name", "a" * 1000),  // éå¸¸é•¿çš„å€¼
    ("service.name", "!@#$%^&*()_+-={}[]|\\:;\"'<>?,./æµ‹è¯•ä¸­æ–‡ğŸš€"),  // ç‰¹æ®Šå­—ç¬¦
    ("process.id", "0"),  // æœ€å°è¿›ç¨‹ID
    ("process.id", "9223372036854775807"),  // æœ€å¤§è¿›ç¨‹ID
    ("telemetry.sdk.version", "1.0.0-alpha.1+build.123"),  // å¤æ‚ç‰ˆæœ¬å·
    ("deployment.environment", "production_with_underscores_and_numbers_123")
  ]
  
  let mut boundary_i = 0
  while boundary_i < boundary_config_values.length() {
    let (key, value) = boundary_config_values[boundary_i]
    
    // éªŒè¯è¾¹ç•Œå€¼é…ç½®
    assert_eq(key.length() > 0, true)
    
    if value.length() == 0 {
      assert_eq(value, "")  // ç©ºå€¼
    } else if value.length() == 1000 {
      assert_eq(value.length(), 1000)  // é•¿å€¼
    } else if value.contains("æµ‹è¯•ä¸­æ–‡") {
      assert_eq(value.contains("æµ‹è¯•ä¸­æ–‡"), true)  // Unicodeå­—ç¬¦
    }
    
    boundary_i = boundary_i + 1
  }
}

test "telemetry_configuration_inheritance" {
  // æµ‹è¯•é¥æµ‹é…ç½®çš„ç»§æ‰¿å’Œè¦†ç›–
  
  // æ¨¡æ‹Ÿå…¨å±€é…ç½®
  let global_config = Resource::{
    service_name: "global-service",
    service_version: Some("1.0.0"),
    telemetry_sdk_name: "azimuth",
    telemetry_sdk_version: "0.1.0",
    attributes: [
      ("deployment.environment", AttributeValue::string("production")),
      ("cloud.provider", AttributeValue::string("aws")),
      ("cloud.region", AttributeValue::string("us-west-2"))
    ]
  }
  
  // æ¨¡æ‹ŸæœåŠ¡çº§åˆ«é…ç½®ï¼ˆç»§æ‰¿å¹¶è¦†ç›–å…¨å±€é…ç½®ï¼‰
  let service_config = Resource::{
    service_name: "payment-service",  // è¦†ç›–å…¨å±€service.name
    service_version: Some("2.1.0"),   // è¦†ç›–å…¨å±€service.version
    telemetry_sdk_name: "azimuth",     // ç»§æ‰¿å…¨å±€
    telemetry_sdk_version: "0.1.0",   // ç»§æ‰¿å…¨å±€
    attributes: [
      ("deployment.environment", AttributeValue::string("staging")),  // è¦†ç›–å…¨å±€
      ("cloud.provider", AttributeValue::string("aws")),              // ç»§æ‰¿å…¨å±€
      ("cloud.region", AttributeValue::string("us-west-2")),          // ç»§æ‰¿å…¨å±€
      ("service.namespace", AttributeValue::string("payments")),      // æœåŠ¡ç‰¹å®šé…ç½®
      ("service.instance.id", AttributeValue::string("instance-123")) // æœåŠ¡ç‰¹å®šé…ç½®
    ]
  }
  
  // æ¨¡æ‹Ÿå®ä¾‹çº§åˆ«é…ç½®ï¼ˆç»§æ‰¿å¹¶è¦†ç›–æœåŠ¡é…ç½®ï¼‰
  let instance_config = Resource::{
    service_name: "payment-service",        // ç»§æ‰¿æœåŠ¡é…ç½®
    service_version: Some("2.1.0"),         // ç»§æ‰¿æœåŠ¡é…ç½®
    telemetry_sdk_name: "azimuth",           // ç»§æ‰¿æœåŠ¡é…ç½®
    telemetry_sdk_version: "0.1.0",         // ç»§æ‰¿æœåŠ¡é…ç½®
    attributes: [
      ("deployment.environment", AttributeValue::string("development")),  // è¦†ç›–æœåŠ¡é…ç½®
      ("cloud.provider", AttributeValue::string("aws")),                   // ç»§æ‰¿æœåŠ¡é…ç½®
      ("cloud.region", AttributeValue::string("us-west-2")),               // ç»§æ‰¿æœåŠ¡é…ç½®
      ("service.namespace", AttributeValue::string("payments")),           // ç»§æ‰¿æœåŠ¡é…ç½®
      ("service.instance.id", AttributeValue::string("instance-456")),     // è¦†ç›–æœåŠ¡é…ç½®
      ("host.name", AttributeValue::string("dev-host-001")),               // å®ä¾‹ç‰¹å®šé…ç½®
      ("process.id", AttributeValue::int(54321L))                         // å®ä¾‹ç‰¹å®šé…ç½®
    ]
  }
  
  // éªŒè¯å…¨å±€é…ç½®
  assert_eq(global_config.service_name, "global-service")
  assert_eq(global_config.service_version, Some("1.0.0"))
  assert_eq(global_config.attributes.length(), 3)
  
  // éªŒè¯æœåŠ¡é…ç½®ç»§æ‰¿å’Œè¦†ç›–
  assert_eq(service_config.service_name, "payment-service")  // è¦†ç›–
  assert_eq(service_config.service_version, Some("2.1.0"))   // è¦†ç›–
  assert_eq(service_config.telemetry_sdk_name, "azimuth")    // ç»§æ‰¿
  assert_eq(service_config.attributes.length(), 5)           // 3ä¸ªç»§æ‰¿ + 2ä¸ªæ–°å¢
  
  // éªŒè¯å®ä¾‹é…ç½®ç»§æ‰¿å’Œè¦†ç›–
  assert_eq(instance_config.service_name, "payment-service")  // ç»§æ‰¿
  assert_eq(instance_config.service_version, Some("2.1.0"))   // ç»§æ‰¿
  assert_eq(instance_config.attributes.length(), 7)           // 5ä¸ªç»§æ‰¿ + 2ä¸ªæ–°å¢
  
  // éªŒè¯ç‰¹å®šå±æ€§çš„è¦†ç›–é“¾
  let mut found_deployment_env = false
  let mut found_cloud_provider = false
  let mut found_service_instance = false
  let mut found_host_name = false
  let mut found_process_id = false
  
  let mut i = 0
  while i < instance_config.attributes.length() {
    let (key, value) = instance_config.attributes[i]
    
    match key {
      "deployment.environment" => {
        match value {
          StringValue(env) => {
            assert_eq(env, "development")  // æœ€ç»ˆè¦†ç›–å€¼
            found_deployment_env = true
          }
          _ => @test.fail("Test failed")
        }
      }
      "cloud.provider" => {
        match value {
          StringValue(provider) => {
            assert_eq(provider, "aws")  // ç»§æ‰¿å€¼
            found_cloud_provider = true
          }
          _ => @test.fail("Test failed")
        }
      }
      "service.instance.id" => {
        match value {
          StringValue(id) => {
            assert_eq(id, "instance-456")  // è¦†ç›–å€¼
            found_service_instance = true
          }
          _ => @test.fail("Test failed")
        }
      }
      "host.name" => {
        match value {
          StringValue(host) => {
            assert_eq(host, "dev-host-001")  // å®ä¾‹ç‰¹å®šå€¼
            found_host_name = true
          }
          _ => @test.fail("Test failed")
        }
      }
      "process.id" => {
        match value {
          IntValue(pid) => {
            assert_eq(pid, 54321L)  // å®ä¾‹ç‰¹å®šå€¼
            found_process_id = true
          }
          _ => @test.fail("Test failed")
        }
      }
      _ => ()  // å¿½ç•¥å…¶ä»–é”®
    }
    i = i + 1
  }
  
  assert_eq(found_deployment_env, true)
  assert_eq(found_cloud_provider, true)
  assert_eq(found_service_instance, true)
  assert_eq(found_host_name, true)
  assert_eq(found_process_id, true)
}

test "telemetry_configuration_dynamic_update" {
  // æµ‹è¯•é¥æµ‹é…ç½®çš„åŠ¨æ€æ›´æ–°
  
  // åˆå§‹é…ç½®
  let initial_config = Resource::{
    service_name: "initial-service",
    service_version: Some("1.0.0"),
    telemetry_sdk_name: "azimuth",
    telemetry_sdk_version: "0.1.0",
    attributes: [
      ("deployment.environment", AttributeValue::string("development")),
      ("feature.flags", AttributeValue::array_bool([true, false]))
    ]
  }
  
  // éªŒè¯åˆå§‹é…ç½®
  assert_eq(initial_config.service_name, "initial-service")
  assert_eq(initial_config.service_version, Some("1.0.0"))
  assert_eq(initial_config.attributes.length(), 2)
  
  // åŠ¨æ€æ›´æ–°é…ç½®
  let updated_config = Resource::{
    service_name: "updated-service",        // æ›´æ–°
    service_version: Some("2.0.0"),         // æ›´æ–°
    telemetry_sdk_name: "azimuth",           // ä¿æŒä¸å˜
    telemetry_sdk_version: "0.1.0",         // ä¿æŒä¸å˜
    attributes: [
      ("deployment.environment", AttributeValue::string("production")),  // æ›´æ–°
      ("feature.flags", AttributeValue::array_bool([true, true, false])), // æ›´æ–°
      ("new.attribute", AttributeValue::string("new-value"))              // æ–°å¢
    ]
  }
  
  // éªŒè¯æ›´æ–°åçš„é…ç½®
  assert_eq(updated_config.service_name, "updated-service")
  assert_eq(updated_config.service_version, Some("2.0.0"))
  assert_eq(updated_config.telemetry_sdk_name, "azimuth")
  assert_eq(updated_config.telemetry_sdk_version, "0.1.0")
  assert_eq(updated_config.attributes.length(), 3)
  
  // éªŒè¯ç‰¹å®šå±æ€§çš„æ›´æ–°
  let mut found_updated_env = false
  let mut found_updated_flags = false
  let mut found_new_attribute = false
  
  let mut i = 0
  while i < updated_config.attributes.length() {
    let (key, value) = updated_config.attributes[i]
    
    match key {
      "deployment.environment" => {
        match value {
          StringValue(env) => {
            assert_eq(env, "production")
            found_updated_env = true
          }
          _ => @test.fail("Test failed")
        }
      }
      "feature.flags" => {
        match value {
          ArrayBoolValue(flags) => {
            assert_eq(flags.length(), 3)
            assert_eq(flags[0], true)
            assert_eq(flags[1], true)
            assert_eq(flags[2], false)
            found_updated_flags = true
          }
          _ => @test.fail("Test failed")
        }
      }
      "new.attribute" => {
        match value {
          StringValue(new_val) => {
            assert_eq(new_val, "new-value")
            found_new_attribute = true
          }
          _ => @test.fail("Test failed")
        }
      }
      _ => ()  // å¿½ç•¥å…¶ä»–é”®
    }
    i = i + 1
  }
  
  assert_eq(found_updated_env, true)
  assert_eq(found_updated_flags, true)
  assert_eq(found_new_attribute, true)
  
  // æµ‹è¯•InstrumentationScopeçš„åŠ¨æ€æ›´æ–°
  let initial_scope = InstrumentationScope::{
    name: "initial-scope",
    version: Some("1.0.0"),
    schema_url: Some("https://example.com/v1")
  }
  
  let updated_scope = InstrumentationScope::{
    name: "updated-scope",           // æ›´æ–°
    version: Some("2.0.0"),         // æ›´æ–°
    schema_url: Some("https://example.com/v2")  // æ›´æ–°
  }
  
  // éªŒè¯scopeæ›´æ–°
  assert_eq(initial_scope.name, "initial-scope")
  assert_eq(initial_scope.version, Some("1.0.0"))
  assert_eq(initial_scope.schema_url, Some("https://example.com/v1"))
  
  assert_eq(updated_scope.name, "updated-scope")
  assert_eq(updated_scope.version, Some("2.0.0"))
  assert_eq(updated_scope.schema_url, Some("https://example.com/v2"))
}

test "telemetry_configuration_error_handling" {
  // æµ‹è¯•é¥æµ‹é…ç½®çš„é”™è¯¯å¤„ç†
  
  // æµ‹è¯•é…ç½®è§£æé”™è¯¯
  let invalid_config_cases = [
    ("service.name", ""),                    // ç©ºæœåŠ¡å
    ("service.version", "invalid.version"), // æ— æ•ˆç‰ˆæœ¬æ ¼å¼
    ("process.id", "not-a-number"),         // æ— æ•ˆæ•°å­—
    ("feature.flags", "not-a-boolean"),     // æ— æ•ˆå¸ƒå°”å€¼
    ("invalid.key", "any-value")            // æ— æ•ˆé…ç½®é”®
  ]
  
  let mut error_case_i = 0
  while error_case_i < invalid_config_cases.length() {
    let (key, value) = invalid_config_cases[error_case_i]
    
    // æ¨¡æ‹Ÿé…ç½®éªŒè¯é”™è¯¯å¤„ç†
    if key == "service.name" && value.length() == 0 {
      // å¤„ç†ç©ºæœåŠ¡åé”™è¯¯
      assert_eq(value.length(), 0)
    } else if key == "service.version" && value.contains("invalid") {
      // å¤„ç†æ— æ•ˆç‰ˆæœ¬æ ¼å¼é”™è¯¯
      assert_eq(value.contains("invalid"), true)
    } else if key == "process.id" && !value.chars().all(fn(c) { c.is_digit() }) {
      // å¤„ç†æ— æ•ˆæ•°å­—é”™è¯¯
      assert_eq(value.contains("not-a-number"), true)
    } else if key == "feature.flags" && ! (value == "true" || value == "false") {
      // å¤„ç†æ— æ•ˆå¸ƒå°”å€¼é”™è¯¯
      assert_eq(value == "not-a-boolean", true)
    } else if key == "invalid.key" {
      // å¤„ç†æ— æ•ˆé…ç½®é”®é”™è¯¯
      assert_eq(key, "invalid.key")
    }
    
    error_case_i = error_case_i + 1
  }
  
  // æµ‹è¯•é…ç½®ç¼ºå¤±é”™è¯¯å¤„ç†
  let required_config_keys = [
    "service.name",
    "telemetry.sdk.name",
    "telemetry.sdk.version"
  ]
  
  let mut missing_i = 0
  while missing_i < required_config_keys.length() {
    let required_key = required_config_keys[missing_i]
    
    // æ¨¡æ‹Ÿç¼ºå¤±å¿…éœ€é…ç½®çš„é”™è¯¯å¤„ç†
    if required_key == "service.name" {
      // å¤„ç†ç¼ºå¤±æœåŠ¡åçš„é”™è¯¯
      assert_eq(required_key, "service.name")
    } else if required_key == "telemetry.sdk.name" {
      // å¤„ç†ç¼ºå¤±SDKåç§°çš„é”™è¯¯
      assert_eq(required_key, "telemetry.sdk.name")
    } else if required_key == "telemetry.sdk.version" {
      // å¤„ç†ç¼ºå¤±SDKç‰ˆæœ¬çš„é”™è¯¯
      assert_eq(required_key, "telemetry.sdk.version")
    }
    
    missing_i = missing_i + 1
  }
  
  // æµ‹è¯•é…ç½®ç±»å‹é”™è¯¯å¤„ç†
  let type_error_cases = [
    ("process.id", AttributeValue::string("should-be-int")),     // åº”è¯¥æ˜¯Int64ä½†æä¾›äº†String
    ("feature.flags", AttributeValue::string("should-be-bool")), // åº”è¯¥æ˜¯Boolä½†æä¾›äº†String
    ("tags", AttributeValue::int(123)),                          // åº”è¯¥æ˜¯Arrayä½†æä¾›äº†Int
    ("timeout", AttributeValue::bool(true))                      // åº”è¯¥æ˜¯Floatä½†æä¾›äº†Bool
  ]
  
  let mut type_error_i = 0
  while type_error_i < type_error_cases.length() {
    let (key, wrong_type_value) = type_error_cases[type_error_i]
    
    // æ¨¡æ‹Ÿé…ç½®ç±»å‹é”™è¯¯å¤„ç†
    match key {
      "process.id" => {
        match wrong_type_value {
          StringValue(_) => assert_eq(true, true)  // æ£€æµ‹åˆ°ç±»å‹é”™è¯¯
          _ => @test.fail("Test failed")
        }
      }
      "feature.flags" => {
        match wrong_type_value {
          StringValue(_) => assert_eq(true, true)  // æ£€æµ‹åˆ°ç±»å‹é”™è¯¯
          _ => @test.fail("Test failed")
        }
      }
      "tags" => {
        match wrong_type_value {
          IntValue(_) => assert_eq(true, true)  // æ£€æµ‹åˆ°ç±»å‹é”™è¯¯
          _ => @test.fail("Test failed")
        }
      }
      "timeout" => {
        match wrong_type_value {
          BoolValue(_) => assert_eq(true, true)  // æ£€æµ‹åˆ°ç±»å‹é”™è¯¯
          _ => @test.fail("Test failed")
        }
      }
      _ => @test.fail("Test failed")
    }
    
    type_error_i = type_error_i + 1
  }
  
  // æµ‹è¯•é…ç½®æ¢å¤æœºåˆ¶
  let fallback_config = Resource::default("fallback-service")
  
  // éªŒè¯fallbacké…ç½®
  assert_eq(fallback_config.service_name, "fallback-service")
  assert_eq(fallback_config.service_version, None)
  assert_eq(fallback_config.telemetry_sdk_name, "azimuth")
  assert_eq(fallback_config.telemetry_sdk_version, "0.1.0")
  assert_eq(fallback_config.attributes.length(), 0)
}