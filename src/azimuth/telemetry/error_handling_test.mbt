// Azimuth Telemetry - Error Handling Tests
// é”™è¯¯å¤„ç†å’Œå¼‚å¸¸æƒ…å†µæµ‹è¯•

test "error_handling_context_invalid_operations" {
  // æµ‹è¯•Contextæ¨¡å—çš„é”™è¯¯å¤„ç†
  let empty_context = @azimuth.telemetry.api.context.Context::empty()
  
  // æµ‹è¯•ä½¿ç”¨ä¸å­˜åœ¨çš„é”®
  let missing_key = @azimuth.telemetry.api.context.create_key("nonexistent.key")
  let result = empty_context.get(missing_key)
  assert_eq(result, None) // åº”è¯¥è¿”å›Noneè€Œä¸æ˜¯å´©æºƒ
  
  // æµ‹è¯•ä½¿ç”¨ç©ºå­—ç¬¦ä¸²é”®
  let empty_key = @azimuth.telemetry.api.context.create_key("")
  let context_with_empty = empty_context.with_value(empty_key, "empty.key.value")
  let empty_result = context_with_empty.get(empty_key)
  assert_eq(empty_result, Some("empty.key.value"))
  
  // æµ‹è¯•ä½¿ç”¨éå¸¸é•¿çš„é”®å
  let long_key_name = "a".repeat(10000)
  let long_key = @azimuth.telemetry.api.context.create_key(long_key_name)
  let context_with_long = empty_context.with_value(long_key, "long.key.value")
  let long_result = context_with_long.get(long_key)
  assert_eq(long_result, Some("long.key.value"))
  
  // æµ‹è¯•ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦é”®
  let special_key = @azimuth.telemetry.api.context.create_key("key.with.special@chars#123")
  let context_with_special = empty_context.with_value(special_key, "special.key.value")
  let special_result = context_with_special.get(special_key)
  assert_eq(special_result, Some("special.key.value"))
}

test "error_handling_baggage_invalid_operations" {
  // æµ‹è¯•Baggageæ¨¡å—çš„é”™è¯¯å¤„ç†
  let empty_baggage = @azimuth.telemetry.api.context.Baggage::empty()
  
  // æµ‹è¯•ä½¿ç”¨ä¸å­˜åœ¨çš„é”®
  let missing_result = empty_baggage.get("nonexistent.key")
  assert_eq(missing_result, None) // åº”è¯¥è¿”å›Noneè€Œä¸æ˜¯å´©æºƒ
  
  // æµ‹è¯•ä½¿ç”¨ç©ºå­—ç¬¦ä¸²é”®
  let baggage_with_empty = empty_baggage.with_entry("", "empty.key.value")
  let empty_result = baggage_with_empty.get("")
  assert_eq(empty_result, Some("empty.key.value"))
  
  // æµ‹è¯•ä½¿ç”¨éå¸¸é•¿çš„é”®åå’Œå€¼
  let long_key_name = "a".repeat(10000)
  let long_value = "b".repeat(10000)
  let baggage_with_long = empty_baggage.with_entry(long_key_name, long_value)
  let long_result = baggage_with_long.get(long_key_name)
  assert_eq(long_result, Some(long_value))
  
  // æµ‹è¯•ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦é”®å’Œå€¼
  let special_key = "key.with.special@chars#123"
  let special_value = "value.with.special@chars#456"
  let baggage_with_special = empty_baggage.with_entry(special_key, special_value)
  let special_result = baggage_with_special.get(special_key)
  assert_eq(special_result, Some(special_value))
  
  // æµ‹è¯•ä½¿ç”¨Unicodeå­—ç¬¦
  let unicode_key = "é”®åä¸­æ–‡æµ‹è¯•"
  let unicode_value = "å€¼ä¸­æ–‡æµ‹è¯•"
  let baggage_with_unicode = empty_baggage.with_entry(unicode_key, unicode_value)
  let unicode_result = baggage_with_unicode.get(unicode_key)
  assert_eq(unicode_result, Some(unicode_value))
}

test "error_handling_logs_invalid_operations" {
  // æµ‹è¯•Logsæ¨¡å—çš„é”™è¯¯å¤„ç†
  let base_time = 1640995200000000000L
  
  // æµ‹è¯•åˆ›å»ºå¸¦æœ‰æ— æ•ˆå‚æ•°çš„LogRecord
  let log_with_empty_body = @azimuth.telemetry.api.logs.LogRecord::builder()
    .timestamp(base_time)
    .severity(@azimuth.telemetry.api.logs.Info)
    .body("")
    .build()
  
  assert_eq(log_with_empty_body.body, Some(""))
  
  // æµ‹è¯•åˆ›å»ºå¸¦æœ‰æå€¼æ—¶é—´æˆ³çš„LogRecord
  let log_with_min_time = @azimuth.telemetry.api.logs.LogRecord::builder()
    .timestamp(-9223372036854775808L) // Int64æœ€å°å€¼
    .severity(@azimuth.telemetry.api.logs.Info)
    .body("Min time test")
    .build()
  
  assert_eq(log_with_min_time.timestamp_unix_nanos, -9223372036854775808L)
  
  let log_with_max_time = @azimuth.telemetry.api.logs.LogRecord::builder()
    .timestamp(9223372036854775807L) // Int64æœ€å¤§å€¼
    .severity(@azimuth.telemetry.api.logs.Info)
    .body("Max time test")
    .build()
  
  assert_eq(log_with_max_time.timestamp_unix_nanos, 9223372036854775807L)
  
  // æµ‹è¯•åˆ›å»ºå¸¦æœ‰æ— æ•ˆå±æ€§çš„LogRecord
  let log_with_invalid_attrs = @azimuth.telemetry.api.logs.LogRecord::builder()
    .timestamp(base_time)
    .severity(@azimuth.telemetry.api.logs.Error)
    .body("Invalid attributes test")
    .with_attribute("", @azimuth.telemetry.api.common.AttributeValue::string("empty.key"))
    .with_attribute("valid.key", @azimuth.telemetry.api.common.AttributeValue::string(""))
    .with_attribute("long.key", @azimuth.telemetry.api.common.AttributeValue::string("a".repeat(10000)))
    .build()
  
  assert_eq(log_with_invalid_attrs.attributes.length(), 3)
  
  // æµ‹è¯•ä½¿ç”¨NoopLoggerå¤„ç†å„ç§æ—¥å¿—çº§åˆ«
  let logger = @azimuth.telemetry.api.logs.NoopLoggerProvider::get_logger("error-test")
  
  // æµ‹è¯•ä½¿ç”¨ç©ºæ¶ˆæ¯ä½“
  logger.debug("", None)
  logger.info("", Some([("test", @azimuth.telemetry.api.common.AttributeValue::bool(true))]))
  
  // æµ‹è¯•ä½¿ç”¨éå¸¸é•¿çš„æ¶ˆæ¯ä½“
  let long_message = "a".repeat(100000)
  logger.warn(long_message, None)
  
  // æµ‹è¯•ä½¿ç”¨åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„æ¶ˆæ¯ä½“
  let special_message = "Special chars: \n\t\r\"'<>{}[]|&;`"
  logger.error(special_message, None)
  
  // æµ‹è¯•ä½¿ç”¨Unicodeæ¶ˆæ¯ä½“
  let unicode_message = "Unicodeæµ‹è¯•: ğŸ”¥ ğŸš€ âœ¨ ä¸­æ–‡æµ‹è¯•"
  logger.fatal(unicode_message, None)
  
  // éªŒè¯æ‰€æœ‰æ“ä½œéƒ½èƒ½æ­£å¸¸æ‰§è¡Œï¼ˆno-opå®ç°ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼‰
  assert_eq(true, true)
}

test "error_handling_metrics_invalid_operations" {
  // æµ‹è¯•Metricsæ¨¡å—çš„é”™è¯¯å¤„ç†
  let meter = @azimuth.telemetry.api.metrics.NoopMeter
  
  // æµ‹è¯•åˆ›å»ºå¸¦æœ‰æ— æ•ˆåç§°çš„ä»ªå™¨
  let counter_with_empty_name = @azimuth.telemetry.api.metrics.NoopMeter::create_counter("", "1", "Empty name counter")
  let counter_with_long_name = @azimuth.telemetry.api.metrics.NoopMeter::create_counter("a".repeat(10000), "1", "Long name counter")
  let counter_with_special_chars = @azimuth.telemetry.api.metrics.NoopMeter::create_counter("counter.with.special@chars#123", "1", "Special chars counter")
  
  // æµ‹è¯•åˆ›å»ºå¸¦æœ‰æ— æ•ˆå•ä½å’Œæè¿°çš„ä»ªå™¨
  let histogram_with_empty_unit = @azimuth.telemetry.api.metrics.NoopMeter::create_histogram("test.histogram", "", "Empty unit histogram")
  let histogram_with_long_unit = @azimuth.telemetry.api.metrics.NoopMeter::create_histogram("test.histogram", "a".repeat(1000), "Long unit histogram")
  let histogram_with_special_unit = @azimuth.telemetry.api.metrics.NoopMeter::create_histogram("test.histogram", "unit.with.special@chars", "Special unit histogram")
  
  // æµ‹è¯•ä½¿ç”¨æå€¼è¿›è¡ŒæŒ‡æ ‡æ“ä½œ
  let test_counter = @azimuth.telemetry.api.metrics.NoopMeter::create_counter("test.counter", "1", "Test counter")
  
  // æµ‹è¯•Int64è¾¹ç•Œå€¼
  @azimuth.telemetry.api.metrics.NoopCounter::add(0L, None)
  @azimuth.telemetry.api.metrics.NoopCounter::add(1L, None)
  @azimuth.telemetry.api.metrics.NoopCounter::add(-1L, None)
  @azimuth.telemetry.api.metrics.NoopCounter::add(9223372036854775807L, None) // Int64æœ€å¤§å€¼
  @azimuth.telemetry.api.metrics.NoopCounter::add(-9223372036854775808L, None) // Int64æœ€å°å€¼
  
  let test_histogram = @azimuth.telemetry.api.metrics.NoopMeter::create_histogram("test.histogram", "ms", "Test histogram")
  
  // æµ‹è¯•Doubleè¾¹ç•Œå€¼
  @azimuth.telemetry.api.metrics.NoopHistogram::record(0.0, None)
  @azimuth.telemetry.api.metrics.NoopHistogram::record(1.7976931348623157e+308, None) // Doubleæœ€å¤§å€¼
  @azimuth.telemetry.api.metrics.NoopHistogram::record(-1.7976931348623157e+308, None) // Doubleæœ€å°å€¼
  @azimuth.telemetry.api.metrics.NoopHistogram::record(0.0/0.0, None) // NaN
  @azimuth.telemetry.api.metrics.NoopHistogram::record(1.0/0.0, None) // æ­£æ— ç©·
  @azimuth.telemetry.api.metrics.NoopHistogram::record(-1.0/0.0, None) // è´Ÿæ— ç©·
  
  let test_up_down_counter = @azimuth.telemetry.api.metrics.NoopMeter::create_up_down_counter("test.up_down", "1", "Test up-down counter")
  
  // æµ‹è¯•UpDownCounterçš„æ­£è´Ÿå€¼
  @azimuth.telemetry.api.metrics.NoopUpDownCounter::add(1000000L, None)
  @azimuth.telemetry.api.metrics.NoopUpDownCounter::add(-1000000L, None)
  
  // æµ‹è¯•ä½¿ç”¨æ— æ•ˆå±æ€§
  let invalid_attrs = [
    ("", @azimuth.telemetry.api.common.AttributeValue::string("empty.key")),
    ("valid.key", @azimuth.telemetry.api.common.AttributeValue::string("")),
    ("long.key", @azimuth.telemetry.api.common.AttributeValue::string("a".repeat(10000))),
    ("special.key", @azimuth.telemetry.api.common.AttributeValue::string("key.with.special@chars#123")),
    ("unicode.key", @azimuth.telemetry.api.common.AttributeValue::string("é”®åä¸­æ–‡æµ‹è¯•"))
  ]
  
  @azimuth.telemetry.api.metrics.NoopCounter::add(1L, Some(invalid_attrs))
  @azimuth.telemetry.api.metrics.NoopHistogram::record(100.0, Some(invalid_attrs))
  @azimuth.telemetry.api.metrics.NoopUpDownCounter::add(-1L, Some(invalid_attrs))
  @azimuth.telemetry.api.metrics.NoopGauge::record(50.0, Some(invalid_attrs))
  
  // éªŒè¯æ‰€æœ‰æ“ä½œéƒ½èƒ½æ­£å¸¸æ‰§è¡Œï¼ˆno-opå®ç°ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼‰
  assert_eq(true, true)
}

test "error_handling_trace_invalid_operations" {
  // æµ‹è¯•Traceæ¨¡å—çš„é”™è¯¯å¤„ç†
  let base_context = @azimuth.telemetry.api.context.Context::empty()
  
  // æµ‹è¯•åˆ›å»ºå¸¦æœ‰æ— æ•ˆåç§°çš„Span
  let (_, span_with_empty_name) = @azimuth.telemetry.api.trace.NoopTracer::start_span(
    base_context,
    "",
    Some(@azimuth.telemetry.api.trace.Server)
  )
  
  assert_eq(span_with_empty_name.name, "")
  
  let (_, span_with_long_name) = @azimuth.telemetry.api.trace.NoopTracer::start_span(
    base_context,
    "a".repeat(10000),
    Some(@azimuth.telemetry.api.trace.Client)
  )
  
  assert_eq(span_with_long_name.name.length(), 10000)
  
  let (_, span_with_special_chars) = @azimuth.telemetry.api.trace.NoopTracer::start_span(
    base_context,
    "span.with.special@chars#123",
    Some(@azimuth.telemetry.api.trace.Internal)
  )
  
  assert_eq(span_with_special_chars.name, "span.with.special@chars#123")
  
  // æµ‹è¯•åˆ›å»ºå¸¦æœ‰æ— æ•ˆæ—¶é—´æˆ³çš„Span
  let (_, span_with_min_time) = @azimuth.telemetry.api.trace.NoopTracer::start_span(
    base_context,
    "min-time-span",
    Some(@azimuth.telemetry.api.trace.Producer),
    Some([("test", @azimuth.telemetry.api.common.AttributeValue::bool(true))]),
    Some(-9223372036854775808L)
  )
  
  assert_eq(span_with_min_time.start_time_unix_nanos, -9223372036854775808L)
  
  let (_, span_with_max_time) = @azimuth.telemetry.api.trace.NoopTracer::start_span(
    base_context,
    "max-time-span",
    Some(@azimuth.telemetry.api.trace.Consumer),
    Some([("test", @azimuth.telemetry.api.common.AttributeValue::bool(true))]),
    Some(9223372036854775807L)
  )
  
  assert_eq(span_with_max_time.start_time_unix_nanos, 9223372036854775807L)
  
  // æµ‹è¯•åˆ›å»ºå¸¦æœ‰æ— æ•ˆå±æ€§çš„Span
  let invalid_span_attrs = [
    ("", @azimuth.telemetry.api.common.AttributeValue::string("empty.key")),
    ("valid.key", @azimuth.telemetry.api.common.AttributeValue::string("")),
    ("long.key", @azimuth.telemetry.api.common.AttributeValue::string("a".repeat(10000))),
    ("special.key", @azimuth.telemetry.api.common.AttributeValue::string("key.with.special@chars#123")),
    ("unicode.key", @azimuth.telemetry.api.common.AttributeValue::string("é”®åä¸­æ–‡æµ‹è¯•"))
  ]
  
  let (_, span_with_invalid_attrs) = @azimuth.telemetry.api.trace.NoopTracer::start_span(
    base_context,
    "invalid-attrs-span",
    Some(@azimuth.telemetry.api.trace.Server),
    Some(invalid_span_attrs)
  )
  
  assert_eq(span_with_invalid_attrs.attributes.length(), 5)
  
  // æµ‹è¯•åˆ›å»ºå¸¦æœ‰æ— æ•ˆäº‹ä»¶çš„Span
  let invalid_event = @azimuth.telemetry.api.trace.SpanEvent::{
    name: "",
    timestamp_unix_nanos: -9223372036854775808L,
    attributes: [
      ("", @azimuth.telemetry.api.common.AttributeValue::string("empty.key")),
      ("valid.key", @azimuth.telemetry.api.common.AttributeValue::string(""))
    ]
  }
  
  // æµ‹è¯•åˆ›å»ºå¸¦æœ‰æ— æ•ˆé“¾æ¥çš„Span
  let invalid_trace_id = Array::make(16, 0_byte)
  let invalid_span_id = Array::make(8, 0_byte)
  let invalid_context = @azimuth.telemetry.api.trace.SpanContext::{
    trace_id: invalid_trace_id,
    span_id: invalid_span_id,
    trace_flags: 255_byte, // æ— æ•ˆçš„trace flags
    trace_state: ""
  }
  
  let invalid_link = @azimuth.telemetry.api.trace.SpanLink::{
    context: invalid_context,
    attributes: [
      ("", @azimuth.telemetry.api.common.AttributeValue::string("empty.key")),
      ("valid.key", @azimuth.telemetry.api.common.AttributeValue::string(""))
    ]
  }
  
  // éªŒè¯æ‰€æœ‰æ“ä½œéƒ½èƒ½æ­£å¸¸æ‰§è¡Œï¼ˆno-opå®ç°ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼‰
  assert_eq(true, true)
}

test "error_handling_propagation_invalid_operations" {
  // æµ‹è¯•Propagationæ¨¡å—çš„é”™è¯¯å¤„ç†
  let base_context = @azimuth.telemetry.api.context.Context::empty()
  
  // æµ‹è¯•ä½¿ç”¨ç©ºçš„Carrier
  let empty_carrier = @azimuth.telemetry.api.propagation.MapCarrier::new()
  let result1 = @azimuth.telemetry.api.propagation.W3CTraceContextPropagator::extract(base_context, empty_carrier)
  let result2 = @azimuth.telemetry.api.propagation.W3CBaggagePropagator::extract(base_context, empty_carrier)
  
  // åº”è¯¥èƒ½å¤Ÿå¤„ç†ç©ºcarrierè€Œä¸å´©æºƒ
  assert_eq(true, true)
  
  // æµ‹è¯•ä½¿ç”¨åŒ…å«æ— æ•ˆæ•°æ®çš„Carrier
  let mut invalid_data = []
  invalid_data = invalid_data.push((@azimuth.telemetry.api.propagation.TRACE_PARENT_HEADER, ""))
  invalid_data = invalid_data.push((@azimuth.telemetry.api.propagation.BAGGAGE_HEADER, ""))
  invalid_data = invalid_data.push(("invalid.header", "invalid.value"))
  invalid_data = invalid_data.push(("", "empty.key.value"))
  invalid_data = invalid_data.push(("valid.key", ""))
  
  let invalid_carrier = @azimuth.telemetry.api.propagation.MapCarrier::from_map(invalid_data)
  
  // åº”è¯¥èƒ½å¤Ÿå¤„ç†æ— æ•ˆæ•°æ®è€Œä¸å´©æºƒ
  let result3 = @azimuth.telemetry.api.propagation.W3CTraceContextPropagator::extract(base_context, invalid_carrier)
  let result4 = @azimuth.telemetry.api.propagation.W3CBaggagePropagator::extract(base_context, invalid_carrier)
  
  assert_eq(true, true)
  
  // æµ‹è¯•ä½¿ç”¨åŒ…å«è¶…é•¿æ•°æ®çš„Carrier
  let very_long_traceparent = "00-" + "a".repeat(32) + "-" + "b".repeat(16) + "-01"
  let very_long_baggage = "key1=" + "a".repeat(100000) + ",key2=" + "b".repeat(100000)
  
  let mut long_data = []
  long_data = long_data.push((@azimuth.telemetry.api.propagation.TRACE_PARENT_HEADER, very_long_traceparent))
  long_data = long_data.push((@azimuth.telemetry.api.propagation.BAGGAGE_HEADER, very_long_baggage))
  
  let long_carrier = @azimuth.telemetry.api.propagation.MapCarrier::from_map(long_data)
  
  // åº”è¯¥èƒ½å¤Ÿå¤„ç†è¶…é•¿æ•°æ®è€Œä¸å´©æºƒ
  let result5 = @azimuth.telemetry.api.propagation.W3CTraceContextPropagator::extract(base_context, long_carrier)
  let result6 = @azimuth.telemetry.api.propagation.W3CBaggagePropagator::extract(base_context, long_carrier)
  
  assert_eq(true, true)
  
  // æµ‹è¯•ä½¿ç”¨åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„Carrier
  let special_traceparent = "00-0af7651916cd43dd8448eb211c80319c-b7ad6b7169203331-01"
  let special_baggage = "key=value with spaces,key2=value,with,commas,key3=value;with;semicolons,key4=value\\with\\backslashes"
  
  let mut special_data = []
  special_data = special_data.push((@azimuth.telemetry.api.propagation.TRACE_PARENT_HEADER, special_traceparent))
  special_data = special_data.push((@azimuth.telemetry.api.propagation.BAGGAGE_HEADER, special_baggage))
  
  let special_carrier = @azimuth.telemetry.api.propagation.MapCarrier::from_map(special_data)
  
  // åº”è¯¥èƒ½å¤Ÿå¤„ç†ç‰¹æ®Šå­—ç¬¦è€Œä¸å´©æºƒ
  let result7 = @azimuth.telemetry.api.propagation.W3CTraceContextPropagator::extract(base_context, special_carrier)
  let result8 = @azimuth.telemetry.api.propagation.W3CBaggagePropagator::extract(base_context, special_carrier)
  
  assert_eq(true, true)
  
  // æµ‹è¯•ä½¿ç”¨åŒ…å«Unicodeå­—ç¬¦çš„Carrier
  let unicode_baggage = "ä¸­æ–‡é”®=ä¸­æ–‡å€¼,emoji=ğŸ”¥ğŸš€,mixed=ä¸­mixedæ–‡"
  
  let mut unicode_data = []
  unicode_data = unicode_data.push((@azimuth.telemetry.api.propagation.BAGGAGE_HEADER, unicode_baggage))
  
  let unicode_carrier = @azimuth.telemetry.api.propagation.MapCarrier::from_map(unicode_data)
  
  // åº”è¯¥èƒ½å¤Ÿå¤„ç†Unicodeå­—ç¬¦è€Œä¸å´©æºƒ
  let result9 = @azimuth.telemetry.api.propagation.W3CBaggagePropagator::extract(base_context, unicode_carrier)
  
  assert_eq(true, true)
}

test "error_handling_resource_and_instrumentation_scope" {
  // æµ‹è¯•Resourceå’ŒInstrumentationScopeçš„é”™è¯¯å¤„ç†
  
  // æµ‹è¯•åˆ›å»ºå¸¦æœ‰æ— æ•ˆæœåŠ¡åçš„Resource
  let resource_with_empty_name = @azimuth.telemetry.api.common.Resource::default("")
  assert_eq(resource_with_empty_name.service_name, "")
  
  let resource_with_long_name = @azimuth.telemetry.api.common.Resource::default("a".repeat(10000))
  assert_eq(resource_with_long_name.service_name.length(), 10000)
  
  let resource_with_special_chars = @azimuth.telemetry.api.common.Resource::default("service.with.special@chars#123")
  assert_eq(resource_with_special_chars.service_name, "service.with.special@chars#123")
  
  let resource_with_unicode = @azimuth.telemetry.api.common.Resource::default("æœåŠ¡åç§°ä¸­æ–‡æµ‹è¯•")
  assert_eq(resource_with_unicode.service_name, "æœåŠ¡åç§°ä¸­æ–‡æµ‹è¯•")
  
  // æµ‹è¯•åˆ›å»ºå¸¦æœ‰æ— æ•ˆå­—æ®µçš„InstrumentationScope
  let scope_with_empty_name = @azimuth.telemetry.api.common.InstrumentationScope::{
    name: "",
    version: Some(""),
    schema_url: Some("")
  }
  
  assert_eq(scope_with_empty_name.name, "")
  assert_eq(scope_with_empty_name.version?, "")
  assert_eq(scope_with_empty_name.schema_url?, "")
  
  let scope_with_long_fields = @azimuth.telemetry.api.common.InstrumentationScope::{
    name: "a".repeat(10000),
    version: Some("a".repeat(1000)),
    schema_url: Some("a".repeat(5000))
  }
  
  assert_eq(scope_with_long_fields.name.length(), 10000)
  assert_eq(scope_with_long_fields.version?.length(), 1000)
  assert_eq(scope_with_long_fields.schema_url?.length(), 5000)
  
  let scope_with_special_chars = @azimuth.telemetry.api.common.InstrumentationScope::{
    name: "scope.with.special@chars#123",
    version: Some("version_1.0.0-beta+build.123"),
    schema_url: Some("https://example.com/path?query=value#fragment")
  }
  
  assert_eq(scope_with_special_chars.name, "scope.with.special@chars#123")
  assert_eq(scope_with_special_chars.version?, "version_1.0.0-beta+build.123")
  assert_eq(scope_with_special_chars.schema_url?, "https://example.com/path?query=value#fragment")
  
  let scope_with_unicode = @azimuth.telemetry.api.common.InstrumentationScope::{
    name: "èŒƒå›´åç§°ä¸­æ–‡æµ‹è¯•",
    version: Some("ç‰ˆæœ¬1.0.0"),
    schema_url: Some("https://ä¾‹å­.com/è·¯å¾„")
  }
  
  assert_eq(scope_with_unicode.name, "èŒƒå›´åç§°ä¸­æ–‡æµ‹è¯•")
  assert_eq(scope_with_unicode.version?, "ç‰ˆæœ¬1.0.0")
  assert_eq(scope_with_unicode.schema_url?, "https://ä¾‹å­.com/è·¯å¾„")
}

test "error_handling_attribute_value_edge_cases" {
  // æµ‹è¯•AttributeValueçš„è¾¹ç•Œæƒ…å†µå’Œé”™è¯¯å¤„ç†
  
  // æµ‹è¯•ç©ºå­—ç¬¦ä¸²å€¼
  let empty_string_attr = @azimuth.telemetry.api.common.AttributeValue::string("")
  match empty_string_attr {
    @azimuth.telemetry.api.common.AttributeValue::StringValue(s) => assert_eq(s, "")
    _ => @test.fail("Expected StringValue")
  }
  
  // æµ‹è¯•è¶…é•¿å­—ç¬¦ä¸²å€¼
  let long_string_attr = @azimuth.telemetry.api.common.AttributeValue::string("a".repeat(100000))
  match long_string_attr {
    @azimuth.telemetry.api.common.AttributeValue::StringValue(s) => assert_eq(s.length(), 100000)
    _ => @test.fail("Expected StringValue")
  }
  
  // æµ‹è¯•åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„å­—ç¬¦ä¸²å€¼
  let special_string_attr = @azimuth.telemetry.api.common.AttributeValue::string("Special chars: \n\t\r\"'<>{}[]|&;`")
  match special_string_attr {
    @azimuth.telemetry.api.common.AttributeValue::StringValue(s) => assert_eq(s, "Special chars: \n\t\r\"'<>{}[]|&;`")
    _ => @test.fail("Expected StringValue")
  }
  
  // æµ‹è¯•Unicodeå­—ç¬¦ä¸²å€¼
  let unicode_string_attr = @azimuth.telemetry.api.common.AttributeValue::string("Unicodeæµ‹è¯•: ğŸ”¥ ğŸš€ âœ¨ ä¸­æ–‡æµ‹è¯•")
  match unicode_string_attr {
    @azimuth.telemetry.api.common.AttributeValue::StringValue(s) => assert_eq(s, "Unicodeæµ‹è¯•: ğŸ”¥ ğŸš€ âœ¨ ä¸­æ–‡æµ‹è¯•")
    _ => @test.fail("Expected StringValue")
  }
  
  // æµ‹è¯•Int64è¾¹ç•Œå€¼
  let min_int_attr = @azimuth.telemetry.api.common.AttributeValue::int(-9223372036854775808L)
  match min_int_attr {
    @azimuth.telemetry.api.common.AttributeValue::IntValue(i) => assert_eq(i, -9223372036854775808L)
    _ => @test.fail("Expected IntValue")
  }
  
  let max_int_attr = @azimuth.telemetry.api.common.AttributeValue::int(9223372036854775807L)
  match max_int_attr {
    @azimuth.telemetry.api.common.AttributeValue::IntValue(i) => assert_eq(i, 9223372036854775807L)
    _ => @test.fail("Expected IntValue")
  }
  
  // æµ‹è¯•Doubleè¾¹ç•Œå€¼
  let min_float_attr = @azimuth.telemetry.api.common.AttributeValue::float(-1.7976931348623157e+308)
  match min_float_attr {
    @azimuth.telemetry.api.common.AttributeValue::FloatValue(f) => assert_eq(f, -1.7976931348623157e+308)
    _ => @test.fail("Expected FloatValue")
  }
  
  let max_float_attr = @azimuth.telemetry.api.common.AttributeValue::float(1.7976931348623157e+308)
  match max_float_attr {
    @azimuth.telemetry.api.common.AttributeValue::FloatValue(f) => assert_eq(f, 1.7976931348623157e+308)
    _ => @test.fail("Expected FloatValue")
  }
  
  let nan_float_attr = @azimuth.telemetry.api.common.AttributeValue::float(0.0/0.0)
  match nan_float_attr {
    @azimuth.telemetry.api.common.AttributeValue::FloatValue(f) => assert_eq(f/f != f/f, true) // NaNæ£€æŸ¥
    _ => @test.fail("Expected FloatValue")
  }
  
  let inf_float_attr = @azimuth.telemetry.api.common.AttributeValue::float(1.0/0.0)
  match inf_float_attr {
    @azimuth.telemetry.api.common.AttributeValue::FloatValue(f) => assert_eq(f > 0.0, true) // æ­£æ— ç©·æ£€æŸ¥
    _ => @test.fail("Expected FloatValue")
  }
  
  // æµ‹è¯•ç©ºæ•°ç»„å€¼
  let empty_string_array_attr = @azimuth.telemetry.api.common.AttributeValue::ArrayStringValue([])
  match empty_string_array_attr {
    @azimuth.telemetry.api.common.AttributeValue::ArrayStringValue(arr) => assert_eq(arr.length(), 0)
    _ => @test.fail("Expected ArrayStringValue")
  }
  
  // æµ‹è¯•åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„æ•°ç»„å€¼
  let special_string_array_attr = @azimuth.telemetry.api.common.AttributeValue::ArrayStringValue([
    "Special chars: \n\t\r\"'<>{}[]|&;`",
    "Unicodeæµ‹è¯•: ğŸ”¥ ğŸš€ âœ¨",
    "Empty string: ",
    "Normal string"
  ])
  
  match special_string_array_attr {
    @azimuth.telemetry.api.common.AttributeValue::ArrayStringValue(arr) => {
      assert_eq(arr.length(), 4)
      assert_eq(arr[0], "Special chars: \n\t\r\"'<>{}[]|&;`")
      assert_eq(arr[1], "Unicodeæµ‹è¯•: ğŸ”¥ ğŸš€ âœ¨")
      assert_eq(arr[2], "Empty string: ")
      assert_eq(arr[3], "Normal string")
    }
    _ => @test.fail("Expected ArrayStringValue")
  }
}