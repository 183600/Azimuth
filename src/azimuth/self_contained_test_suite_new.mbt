// è‡ªåŒ…å«çš„ MoonBit æµ‹è¯•å¥—ä»¶ - æ–°å¢æµ‹è¯•ç”¨ä¾‹
// åŒ…å«å‡½æ•°å®šä¹‰å’Œæµ‹è¯•ç”¨ä¾‹ï¼Œå¯ä»¥ç›´æ¥è¿è¡Œ

// å‡½æ•°å®šä¹‰
pub fn assert_eq(lhs : Int, rhs : Int) -> Unit {
  if lhs != rhs {
    let _ = "Assertion failed"
  } else {
    ()
  }
  ()
}

pub fn assert_eq_string(lhs : String, rhs : String) -> Unit {
  if lhs != rhs {
    let _ = "String assertion failed"
  } else {
    ()
  }
  ()
}

pub fn string_concat(lhs : String, rhs : String) -> String {
  lhs + rhs
}

pub fn add(a : Int, b : Int) -> Int {
  a + b
}

pub fn multiply(a : Int, b : Int) -> Int {
  a * b
}

pub fn greet(name : String) -> String {
  "Hello, " + name + "!"
}

pub fn divide_with_ceil(a : Int, b : Int) -> Int {
  if b == 0 { 
    0 
  } else {
    let quotient = a / b
    let remainder = a % b
    if remainder == 0 {
      quotient
    } else if a > 0 && b > 0 {
      quotient + 1
    } else if a < 0 && b < 0 {
      quotient + 1
    } else {
      quotient
    }
  }
}

// æµ‹è¯•ç”¨ä¾‹
test "add_function_boundary_values" {
  // æµ‹è¯•åŠ æ³•å‡½æ•°çš„è¾¹ç•Œå€¼
  assert_eq(0, add(2147483647, -2147483647))  // æœ€å¤§å€¼ä¸æœ€å°ç›¸åæ•°ç›¸åŠ 
  assert_eq(-2147483648, add(-2147483647, -1))  // æ¥è¿‘æœ€å°å€¼
  assert_eq(2147483646, add(2147483645, 1))  // æ¥è¿‘æœ€å¤§å€¼
  assert_eq(2147483647, add(1073741823, 1073741824))  // ä¸¤ä¸ªå¤§æ•°ç›¸åŠ 
}

test "multiply_function_large_numbers" {
  // æµ‹è¯•ä¹˜æ³•å‡½æ•°çš„å¤§æ•°è¿ç®—
  assert_eq(46340, multiply(46340, 1))  // sqrt(Intæœ€å¤§å€¼)
  assert_eq(100000000, multiply(10000, 10000))  // å¤§æ•°ç›¸ä¹˜
  assert_eq(-100000000, multiply(-10000, 10000))  // è´Ÿæ•°ä¹˜æ³•
  assert_eq(100000000, multiply(-10000, -10000))  // è´Ÿè´Ÿå¾—æ­£
}

test "divide_with_ceil_comprehensive" {
  // å…¨é¢æµ‹è¯•å‘ä¸Šå–æ•´é™¤æ³•
  // æ­£æ•°æƒ…å†µ
  assert_eq(1, divide_with_ceil(1, 1))  // å®Œå…¨ç›¸ç­‰
  assert_eq(2, divide_with_ceil(3, 2))  // 1.5 -> 2
  assert_eq(34, divide_with_ceil(100, 3))  // 33.333... -> 34
  
  // è´Ÿæ•°æƒ…å†µ
  assert_eq(-1, divide_with_ceil(-3, 2))  // -1.5 -> -1
  assert_eq(-33, divide_with_ceil(-100, 3))  // -33.333... -> -33
  
  // è´Ÿè´Ÿå¾—æ­£
  assert_eq(34, divide_with_ceil(-100, -3))  // 33.333... -> 34
  
  // é›¶å¤„ç†
  assert_eq(0, divide_with_ceil(0, 5))  // é›¶é™¤ä»¥æ­£æ•°
  assert_eq(0, divide_with_ceil(100, 0))  // é™¤æ•°ä¸ºé›¶
}

test "greet_function_unicode_and_special_chars" {
  // æµ‹è¯•é—®å€™å‡½æ•°çš„Unicodeå’Œç‰¹æ®Šå­—ç¬¦å¤„ç†
  assert_eq_string("Hello, ğŸŒŸ!", greet("ğŸŒŸ"))  // Emoji
  assert_eq_string("Hello, Î±Î²Î³Î´Îµ!", greet("Î±Î²Î³Î´Îµ"))  // å¸Œè…Šå­—æ¯
  assert_eq_string("Hello, ĞœĞ¾ÑĞºĞ²Ğ°!", greet("ĞœĞ¾ÑĞºĞ²Ğ°"))  // è¥¿é‡Œå°”å­—æ¯
  assert_eq_string("Hello, åŒ—äº¬!", greet("åŒ—äº¬"))  // ä¸­æ–‡å­—ç¬¦
  assert_eq_string("Hello, \t!", greet("\t"))  // æ§åˆ¶å­—ç¬¦
}

test "complex_business_calculation" {
  // å¤æ‚ä¸šåŠ¡è®¡ç®—åœºæ™¯ï¼šè®¢å•æ€»ä»·è®¡ç®—
  let product_price = 89
  let quantity = 12
  let tax_rate = 8
  let shipping_cost = 25
  let discount = 150
  
  // è®¡ç®—å•†å“æ€»ä»·
  let subtotal = multiply(product_price, quantity)
  
  // è®¡ç®—ç¨è´¹
  let tax_amount = divide_with_ceil(multiply(subtotal, tax_rate), 100)
  
  // è®¡ç®—æŠ˜æ‰£å‰æ€»ä»·
  let pre_discount_total = add(add(subtotal, tax_amount), shipping_cost)
  
  // åº”ç”¨æŠ˜æ‰£
  let final_total = add(pre_discount_total, -discount)
  
  assert_eq(1068, subtotal)
  assert_eq(86, tax_amount)
  assert_eq(1179, pre_discount_total)
  assert_eq(1029, final_total)
}

test "mathematical_properties_verification" {
  // éªŒè¯æ•°å­¦æ€§è´¨
  let a = 15
  let b = 25
  let c = 35
  
  // åŠ æ³•äº¤æ¢å¾‹
  assert_eq(add(a, b), add(b, a))
  
  // ä¹˜æ³•äº¤æ¢å¾‹
  assert_eq(multiply(a, b), multiply(b, a))
  
  // åŠ æ³•ç»“åˆå¾‹
  assert_eq(add(add(a, b), c), add(a, add(b, c)))
  
  // ä¹˜æ³•ç»“åˆå¾‹
  assert_eq(multiply(multiply(a, b), c), multiply(a, multiply(b, c)))
  
  // åˆ†é…å¾‹
  assert_eq(multiply(a, add(b, c)), add(multiply(a, b), multiply(a, c)))
}

test "real_world_logistics_calculation" {
  // çœŸå®ä¸–ç•Œç‰©æµè®¡ç®—ï¼šä»“åº“å­˜å‚¨ä¼˜åŒ–
  let total_products = 1250
  let pallet_capacity = 48
  let truck_capacity = 320
  let warehouse_zones = 8
  
  // è®¡ç®—éœ€è¦çš„æ‰˜ç›˜æ•°é‡
  let pallets_needed = divide_with_ceil(total_products, pallet_capacity)
  
  // è®¡ç®—éœ€è¦çš„å¡è½¦æ•°é‡
  let trucks_needed = divide_with_ceil(total_products, truck_capacity)
  
  // è®¡ç®—æ¯ä¸ªåŒºåŸŸçš„å¹³å‡äº§å“æ•°
  let products_per_zone = divide_with_ceil(total_products, warehouse_zones)
  
  // è®¡ç®—æ€»è¿è¾“æˆæœ¬ï¼ˆå‡è®¾æ¯å¡è½¦100å…ƒï¼‰
  let total_transport_cost = multiply(trucks_needed, 100)
  
  assert_eq(27, pallets_needed)  // ceil(1250/48) = 27
  assert_eq(4, trucks_needed)    // ceil(1250/320) = 4
  assert_eq(157, products_per_zone)  // ceil(1250/8) = 157
  assert_eq(400, total_transport_cost)  // 4 * 100 = 400
}

test "financial_investment_calculation" {
  // é‡‘èæŠ•èµ„è®¡ç®—ï¼šå¤åˆ©å¢é•¿æ¨¡æ‹Ÿ
  let initial_investment = 10000
  let annual_return_rate = 7
  let years = 5
  
  // ç¬¬1å¹´
  let year1_return = divide_with_ceil(multiply(initial_investment, annual_return_rate), 100)
  let year1_total = add(initial_investment, year1_return)
  
  // ç¬¬2å¹´
  let year2_return = divide_with_ceil(multiply(year1_total, annual_return_rate), 100)
  let year2_total = add(year1_total, year2_return)
  
  // ç¬¬3å¹´
  let year3_return = divide_with_ceil(multiply(year2_total, annual_return_rate), 100)
  let year3_total = add(year2_total, year3_return)
  
  // ç¬¬4å¹´
  let year4_return = divide_with_ceil(multiply(year3_total, annual_return_rate), 100)
  let year4_total = add(year3_total, year4_return)
  
  // ç¬¬5å¹´
  let year5_return = divide_with_ceil(multiply(year4_total, annual_return_rate), 100)
  let final_amount = add(year4_total, year5_return)
  
  assert_eq(700, year1_return)
  assert_eq(10700, year1_total)
  assert_eq(749, year2_return)
  assert_eq(11449, year2_total)
  assert_eq(802, year3_return)
  assert_eq(12251, year3_total)
  assert_eq(858, year4_return)
  assert_eq(13109, year4_total)
  assert_eq(918, year5_return)
  assert_eq(14027, final_amount)
}

test "error_handling_and_edge_cases" {
  // é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæƒ…å†µæµ‹è¯•
  // é™¤é›¶å®‰å…¨æ€§
  assert_eq(0, divide_with_ceil(0, 0))
  assert_eq(0, divide_with_ceil(100, 0))
  assert_eq(0, divide_with_ceil(-100, 0))
  
  // æå€¼è¿ç®—
  assert_eq(0, add(2147483647, -2147483647))
  assert_eq(1, add(2147483647, -2147483646))
  
  // é›¶çš„ä¹˜æ³•
  assert_eq(0, multiply(0, 2147483647))
  assert_eq(0, multiply(-2147483648, 0))
  
  // ä¸€çš„ä¹˜æ³•
  assert_eq(2147483647, multiply(2147483647, 1))
  assert_eq(-2147483648, multiply(-2147483648, 1))
}

test "string_processing_with_greet_function" {
  // ä½¿ç”¨é—®å€™å‡½æ•°è¿›è¡Œå­—ç¬¦ä¸²å¤„ç†æµ‹è¯•
  let first_name = "å¼ "
  let last_name = "ä¸‰"
  let company = "ç§‘æŠ€å…¬å¸"
  let department = "ç ”å‘éƒ¨"
  
  // æ„å»ºå®Œæ•´å§“å
  let full_name = string_concat(first_name, last_name)
  let name_greeting = greet(full_name)
  
  // æ„å»ºå·¥ä½œæ ‡è¯†
  let work_id = string_concat(string_concat(company, " "), department)
  let work_greeting = greet(work_id)
  
  // æ„å»ºé‚®ç®±æ ¼å¼
  let email_prefix = "zhangsan"
  let email_domain = "techcorp.com"
  let email = string_concat(string_concat(email_prefix, "@"), email_domain)
  let email_greeting = greet(email)
  
  assert_eq_string("Hello, å¼ ä¸‰!", name_greeting)
  assert_eq_string("Hello, ç§‘æŠ€å…¬å¸ ç ”å‘éƒ¨!", work_greeting)
  assert_eq_string("Hello, zhangsan@techcorp.com!", email_greeting)
}