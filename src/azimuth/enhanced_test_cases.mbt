// å¢å¼ºçš„ MoonBit æµ‹è¯•ç”¨ä¾‹
// è¦†ç›–å„ç§è¾¹ç•Œæ¡ä»¶å’Œå®é™…åº”ç”¨åœºæ™¯

test "enhanced_addition_series" {
  // æµ‹è¯•è¿ç»­åŠ æ³•çš„çº§è”æ•ˆåº”
  let base = 100
  let increment = 50
  let count = 5
  
  // è®¡ç®—ï¼šbase + (base + increment) + (base + 2*increment) + ... 
  let term1 = base
  let term2 = add(base, increment)
  let term3 = add(base, multiply(2, increment))
  let term4 = add(base, multiply(3, increment))
  let term5 = add(base, multiply(4, increment))
  
  let total = add(add(add(add(term1, term2), term3), term4), term5)
  assert_eq(1000, total)  // 100 + 150 + 200 + 250 + 300 = 1000
}

test "enhanced_multiplication_table" {
  // æµ‹è¯•ä¹˜æ³•è¡¨çš„æ­£ç¡®æ€§
  let base = 7
  
  // 7çš„ä¹˜æ³•è¡¨ï¼š7Ã—1, 7Ã—2, ..., 7Ã—5
  assert_eq(7, multiply(base, 1))
  assert_eq(14, multiply(base, 2))
  assert_eq(21, multiply(base, 3))
  assert_eq(28, multiply(base, 4))
  assert_eq(35, multiply(base, 5))
  
  // éªŒè¯ä¹˜æ³•è¡¨çš„å’Œï¼š7 + 14 + 21 + 28 + 35 = 105
  let sum = add(add(add(add(7, 14), 21), 28), 35)
  assert_eq(105, sum)
}

test "enhanced_string_concatenation_chain" {
  // æµ‹è¯•å­—ç¬¦ä¸²è¿æ¥é“¾å¼å¤„ç†
  let prefix = "Hello"
  let name = "MoonBit"
  let suffix = "2023"
  let exclamation = "!"
  
  // é€šè¿‡greetå‡½æ•°æ¨¡æ‹Ÿé“¾å¼å­—ç¬¦ä¸²å¤„ç†
  let step1 = greet(name)
  let step2 = step1 + " " + suffix + exclamation
  
  assert_eq_string("Hello, MoonBit! 2023!", step2)
  
  // æµ‹è¯•åŒ…å«æ•°å­—çš„å­—ç¬¦ä¸²
  let numeric_name = "User123"
  let numeric_result = greet(numeric_name)
  assert_eq_string("Hello, User123!", numeric_result)
}

test "enhanced_boundary_stress_test" {
  // è¾¹ç•Œå€¼å‹åŠ›æµ‹è¯•
  let max_val = 2147483647
  let min_val = -2147483648
  
  // æµ‹è¯•æ¥è¿‘è¾¹ç•Œçš„å€¼
  let near_max = max_val - 1000
  let near_min = min_val + 1000
  
  // æ¥è¿‘æœ€å¤§å€¼çš„åŠ æ³•
  let result1 = add(near_max, 500)
  assert_eq(2147482847, result1)
  
  // æ¥è¿‘æœ€å°å€¼çš„åŠ æ³•
  let result2 = add(near_min, -500)
  assert_eq(-2147483148, result2)
  
  // è¾¹ç•Œå€¼ä¹˜æ³•æµ‹è¯•
  let result3 = multiply(46340, 46340)  // æ¥è¿‘sqrt(max_val)
  assert_eq(2147395600, result3)
}

test "enhanced_financial_compound_calculation" {
  // å¤æ‚çš„é‡‘èå¤åˆè®¡ç®—
  let principal = 10000
  let rate1 = 5  // ç¬¬ä¸€å¹´åˆ©ç‡
  let rate2 = 6  // ç¬¬äºŒå¹´åˆ©ç‡
  let rate3 = 7  // ç¬¬ä¸‰å¹´åˆ©ç‡
  
  // ç¬¬ä¸€å¹´åçš„é‡‘é¢
  let year1 = multiply(principal, add(100, rate1))
  // ç¬¬äºŒå¹´åçš„é‡‘é¢
  let year2 = multiply(year1, add(100, rate2))
  // ç¬¬ä¸‰å¹´åçš„é‡‘é¢
  let year3 = multiply(year2, add(100, rate3))
  
  // è½¬æ¢ä¸ºå®é™…é‡‘é¢ï¼ˆé™¤ä»¥100^3ï¼‰
  let final_amount = year3 / 1000000
  
  assert_eq(12285, final_amount)  // çº¦ç­‰äº12285å…ƒ
}

test "enhanced_geometric_progression" {
  // å‡ ä½•çº§æ•°è®¡ç®—ï¼š1, 2, 4, 8, 16, 32
  let first_term = 1
  let ratio = 2
  
  // è®¡ç®—å‰6é¡¹
  let term1 = first_term
  let term2 = multiply(term1, ratio)
  let term3 = multiply(term2, ratio)
  let term4 = multiply(term3, ratio)
  let term5 = multiply(term4, ratio)
  let term6 = multiply(term5, ratio)
  
  // è®¡ç®—æ€»å’Œ
  let sum = add(add(add(add(add(term1, term2), term3), term4), term5), term6)
  assert_eq(63, sum)  // 1 + 2 + 4 + 8 + 16 + 32 = 63
  
  // éªŒè¯å…¬å¼ï¼ša * (r^n - 1) / (r - 1)
  let formula_result = multiply(first_term, multiply(63, 1))  // ç®€åŒ–è®¡ç®—
  assert_eq(63, formula_result)
}

test "enhanced_temperature_conversion_table" {
  // æ¸©åº¦è½¬æ¢è¡¨æµ‹è¯•ï¼ˆç®€åŒ–ç‰ˆï¼šF = C * 2 + 30ï¼‰
  let celsius_temps = [0, 10, 20, 30, 40]  // æ‘„æ°åº¦æ¸©åº¦
  let expected_fahrenheit = [30, 50, 70, 90, 110]  // é¢„æœŸçš„åæ°åº¦æ¸©åº¦
  
  // æµ‹è¯•æ¯ä¸ªè½¬æ¢
  let f1 = add(multiply(0, 2), 30)
  let f2 = add(multiply(10, 2), 30)
  let f3 = add(multiply(20, 2), 30)
  let f4 = add(multiply(30, 2), 30)
  let f5 = add(multiply(40, 2), 30)
  
  assert_eq(30, f1)
  assert_eq(50, f2)
  assert_eq(70, f3)
  assert_eq(90, f4)
  assert_eq(110, f5)
  
  // è®¡ç®—å¹³å‡æ¸©åº¦è½¬æ¢
  let avg_celsius = add(add(add(add(0, 10), 20), 30), 40) / 5
  let avg_fahrenheit = add(multiply(avg_celsius, 2), 30)
  assert_eq(70, avg_fahrenheit)
}

test "enhanced_error_recovery_scenarios" {
  // é”™è¯¯æ¢å¤åœºæ™¯æµ‹è¯•
  let max_val = 2147483647
  let min_val = -2147483648
  
  // æµ‹è¯•æº¢å‡ºåçš„æ¢å¤èƒ½åŠ›
  let overflow_result = add(max_val, 1000)
  assert_eq(max_val, overflow_result)
  
  // ä»æº¢å‡ºçŠ¶æ€ç»§ç»­è®¡ç®—
  let recovery_result = add(overflow_result, -100)
  assert_eq(max_val, recovery_result)
  
  // æµ‹è¯•æœ€å°å€¼çš„ç‰¹æ®Šæƒ…å†µ
  let min_mult = multiply(min_val, 1)
  assert_eq(min_val, min_mult)
  
  // æµ‹è¯•æ–­è¨€å‡½æ•°çš„ç¨³å®šæ€§
  assert_true(true)
  assert_false(false)
  assert_eq(42, 42)
  assert_eq_string("test", "test")
}

test "enhanced_string_unicode_handling" {
  // Unicode å­—ç¬¦ä¸²å¤„ç†æµ‹è¯•
  let unicode_names = ["ä¸–ç•Œ", "ğŸŒ", "æµ‹è¯•", "MoonBit", "Î±Î²Î³"]
  
  // æµ‹è¯•å„ç§Unicodeå­—ç¬¦ä¸²
  let result1 = greet("ä¸–ç•Œ")
  let result2 = greet("ğŸŒ")
  let result3 = greet("æµ‹è¯•")
  let result4 = greet("MoonBit")
  let result5 = greet("Î±Î²Î³")
  
  assert_eq_string("Hello, ä¸–ç•Œ!", result1)
  assert_eq_string("Hello, ğŸŒ!", result2)
  assert_eq_string("Hello, æµ‹è¯•!", result3)
  assert_eq_string("Hello, MoonBit!", result4)
  assert_eq_string("Hello, Î±Î²Î³!", result5)
  
  // æµ‹è¯•æ··åˆUnicodeå­—ç¬¦ä¸²
  let mixed = "Helloä¸–ç•ŒğŸŒ"
  let mixed_result = greet(mixed)
  assert_eq_string("Hello, Helloä¸–ç•ŒğŸŒ!", mixed_result)
}

test "enhanced_complex_business_logic" {
  // å¤æ‚ä¸šåŠ¡é€»è¾‘æµ‹è¯•ï¼šç”µå•†ä¿ƒé”€æ´»åŠ¨è®¡ç®—
  let original_price = 1000
  let customer_level = 3  // VIPç­‰çº§
  let purchase_quantity = 5
  let promotion_threshold = 3  // ä¿ƒé”€é—¨æ§›
  
  // åŸºç¡€æŠ˜æ‰£ï¼šVIPç­‰çº§ Ã— 5%
  let base_discount = multiply(customer_level, 5)
  
  // æ•°é‡æŠ˜æ‰£ï¼šè¶…è¿‡ä¿ƒé”€é—¨æ§›ï¼Œæ¯å¤šä¸€ä¸ªé¢å¤–2%æŠ˜æ‰£
  let quantity_discount = if (purchase_quantity > promotion_threshold) {
    multiply(purchase_quantity - promotion_threshold, 2)
  } else {
    0
  }
  
  // æ€»æŠ˜æ‰£ç‡
  let total_discount = add(base_discount, quantity_discount)
  
  // æŠ˜æ‰£é‡‘é¢
  let discount_amount = multiply(original_price, total_discount) / 100
  
  // æœ€ç»ˆä»·æ ¼
  let final_price = add(original_price, -discount_amount)
  
  assert_eq(750, final_price)  // 1000 - (1000 * 25 / 100) = 750
  
  // æµ‹è¯•ä¸åŒåœºæ™¯
  let regular_customer = 1
  let regular_quantity = 2
  let regular_discount = multiply(regular_customer, 5)
  let regular_final = add(original_price, -multiply(original_price, regular_discount) / 100)
  assert_eq(950, regular_final)
}