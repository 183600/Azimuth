// Azimuth å¢å¼ºæµ‹è¯•å¥—ä»¶ - 10ä¸ªé«˜è´¨é‡ MoonBit æµ‹è¯•ç”¨ä¾‹
// è¦†ç›–åŸºæœ¬åŠŸèƒ½ã€è¾¹ç•Œæƒ…å†µã€é”™è¯¯å¤„ç†å’Œå®é™…åº”ç”¨åœºæ™¯

test "enhanced_arithmetic_precision" {
  // æµ‹è¯•ç®—æœ¯è¿ç®—çš„ç²¾åº¦å’Œè¾¹ç•Œæƒ…å†µ
  assert_eq(2147483647, add(2147483646, 1))  // æ¥è¿‘ Int æœ€å¤§å€¼
  assert_eq(-2147483648, add(-2147483647, -1))  // æ¥è¿‘ Int æœ€å°å€¼
  assert_eq(0, add(2147483647, -2147483647))  // æœ€å¤§å€¼ä¸ç›¸åæ•°ç›¸åŠ 
  
  // æµ‹è¯•å¤§æ•°ä¹˜æ³•çš„ç²¾åº¦
  assert_eq(1000000, multiply(1000, 1000))
  assert_eq(-1000000, multiply(-1000, 1000))
  assert_eq(1000000, multiply(-1000, -1000))
}

test "enhanced_division_ceil_comprehensive" {
  // å…¨é¢æµ‹è¯•å‘ä¸Šå–æ•´é™¤æ³•çš„å„ç§æƒ…å†µ
  // æ­£æ•°é™¤æ³•
  assert_eq(4, divide_with_ceil(11, 3))  // 11/3 = 3.666... -> 4
  assert_eq(4, divide_with_ceil(12, 3))  // 12/3 = 4 -> 4
  assert_eq(1, divide_with_ceil(1, 100))  // 1/100 = 0.01 -> 1
  
  // è´Ÿæ•°é™¤æ³•
  assert_eq(-3, divide_with_ceil(-10, 3))  // -10/3 = -3.333... -> -3
  assert_eq(-4, divide_with_ceil(-11, 3))  // -11/3 = -3.666... -> -4
  assert_eq(4, divide_with_ceil(-11, -3))  // -11/-3 = 3.666... -> 4
  
  // è¾¹ç•Œæƒ…å†µ
  assert_eq(0, divide_with_ceil(0, 5))
  assert_eq(0, divide_with_ceil(0, -5))
  assert_eq(0, divide_with_ceil(100, 0))
  assert_eq(0, divide_with_ceil(-100, 0))
  assert_eq(0, divide_with_ceil(0, 0))
}

test "enhanced_string_greeting_international" {
  // æµ‹è¯•å›½é™…åŒ–å­—ç¬¦ä¸²é—®å€™åŠŸèƒ½
  assert_eq_string("Hello, ä¸–ç•Œ!", greet("ä¸–ç•Œ"))
  assert_eq_string("Hello, ğŸš€!", greet("ğŸš€"))
  assert_eq_string("Hello, cafÃ©!", greet("cafÃ©"))
  assert_eq_string("Hello, ĞœĞ¾ÑĞºĞ²Ğ°!", greet("ĞœĞ¾ÑĞºĞ²Ğ°"))
  assert_eq_string("Hello, Ã±oÃ±o!", greet("Ã±oÃ±o"))
  assert_eq_string("Hello, ğŸŒğŸŒğŸŒ!", greet("ğŸŒğŸŒğŸŒ"))
  assert_eq_string("Hello, Î±Î²Î³Î´Îµ!", greet("Î±Î²Î³Î´Îµ"))
  assert_eq_string("Hello, Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©!", greet("Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"))
}

test "enhanced_mathematical_properties" {
  // éªŒè¯æ•°å­¦æ€§è´¨å’Œå®šå¾‹
  let x = 42
  let y = 17
  let z = 8
  
  // åŠ æ³•äº¤æ¢å¾‹å’Œç»“åˆå¾‹
  assert_eq(add(x, y), add(y, x))  // äº¤æ¢å¾‹
  assert_eq(add(add(x, y), z), add(x, add(y, z)))  // ç»“åˆå¾‹
  
  // ä¹˜æ³•äº¤æ¢å¾‹å’Œç»“åˆå¾‹
  assert_eq(multiply(x, y), multiply(y, x))  // äº¤æ¢å¾‹
  assert_eq(multiply(multiply(x, y), z), multiply(x, multiply(y, z)))  // ç»“åˆå¾‹
  
  // åˆ†é…å¾‹
  assert_eq(multiply(x, add(y, z)), add(multiply(x, y), multiply(x, z)))
  
  // å•ä½å…ƒæ€§è´¨
  assert_eq(x, add(x, 0))
  assert_eq(x, multiply(x, 1))
  assert_eq(0, multiply(x, 0))
}

test "enhanced_financial_calculation_scenario" {
  // å¤æ‚é‡‘èè®¡ç®—åœºæ™¯ï¼šè´·æ¬¾å’ŒæŠ•èµ„è®¡ç®—
  let principal = 10000
  let annual_rate = 5  // 5%
  let years = 3
  let monthly_payment_limit = 300
  
  // è®¡ç®—å¤åˆ©ï¼ˆæ¯å¹´è®¡ç®—ä¸€æ¬¡ï¼‰
  let year1_amount = add(principal, divide_with_ceil(multiply(principal, annual_rate), 100))
  let year2_amount = add(year1_amount, divide_with_ceil(multiply(year1_amount, annual_rate), 100))
  let year3_amount = add(year2_amount, divide_with_ceil(multiply(year2_amount, annual_rate), 100))
  
  // è®¡ç®—æœˆä¾›
  let total_months = multiply(years, 12)
  let monthly_payment = divide_with_ceil(year3_amount, total_months)
  
  // éªŒè¯ç»“æœ
  assert_eq(10500, year1_amount)  // 10000 + 5%
  assert_eq(11025, year2_amount)  // 10500 + 5%
  assert_eq(11576, year3_amount)  // 11025 + 5%
  assert_eq(322, monthly_payment)  // ceil(11576/36)
  
  // éªŒè¯æœˆä¾›æ˜¯å¦åœ¨é™åˆ¶èŒƒå›´å†…
  assert_eq(1, if monthly_payment <= monthly_payment_limit { 1 } else { 0 })
}

test "enhanced_inventory_management" {
  // åº“å­˜ç®¡ç†ç³»ç»Ÿæµ‹è¯• - ç®€åŒ–ç‰ˆæœ¬ä¸ä½¿ç”¨æ•°ç»„
  
  // äº§å“1: 25ä¸ªäº§å“ï¼Œæ¯ç®±8ä¸ª
  let boxes_1 = divide_with_ceil(25, 8)  // ceil(25/8) = 4
  let capacity_1 = multiply(boxes_1, 8)  // 4 * 8 = 32
  
  // äº§å“2: 47ä¸ªäº§å“ï¼Œæ¯ç®±12ä¸ª
  let boxes_2 = divide_with_ceil(47, 12)  // ceil(47/12) = 4
  let capacity_2 = multiply(boxes_2, 12)  // 4 * 12 = 48
  
  // äº§å“3: 156ä¸ªäº§å“ï¼Œæ¯ç®±20ä¸ª
  let boxes_3 = divide_with_ceil(156, 20)  // ceil(156/20) = 8
  let capacity_3 = multiply(boxes_3, 20)  // 8 * 20 = 160
  
  // è®¡ç®—æ€»ç®±å­æ•°å’Œæ€»å®¹é‡
  let total_boxes = add(add(add(boxes_1, boxes_2), boxes_3), 3)  // åŠ ä¸Šäº§å“4å’Œ5çš„ç®±å­æ•°
  let total_capacity = add(add(add(capacity_1, capacity_2), capacity_3), 135)  // åŠ ä¸Šäº§å“4å’Œ5çš„å®¹é‡
  let total_products = add(add(add(25, 47), 156), 102)  // æ€»äº§å“æ•°
  
  assert_eq(25, total_boxes)
  assert_eq(375, total_capacity)
  assert_eq(330, total_products)
}

test "enhanced_project_resource_planning" {
  // é¡¹ç›®èµ„æºè§„åˆ’æµ‹è¯•
  let team_members = 8
  let tasks_per_person = 5
  let sprint_duration = 2  // å‘¨
  let tasks_per_sprint = 15
  let project_deadline = 4  // å‘¨
  
  // è®¡ç®—æ€»ä»»åŠ¡æ•°
  let total_tasks = multiply(team_members, tasks_per_person)
  
  // è®¡ç®—éœ€è¦çš„å†²åˆºæ•°
  let sprints_needed = divide_with_ceil(total_tasks, tasks_per_sprint)
  
  // è®¡ç®—é¡¹ç›®æ€»æ—¶é—´
  let total_weeks = multiply(sprints_needed, sprint_duration)
  
  // è®¡ç®—æ¯äººæ¯å‘¨éœ€è¦å®Œæˆçš„ä»»åŠ¡æ•°
  let tasks_per_person_per_week = divide_with_ceil(total_tasks, multiply(team_members, project_deadline))
  
  // éªŒè¯ç»“æœ
  assert_eq(40, total_tasks)
  assert_eq(3, sprints_needed)
  assert_eq(6, total_weeks)
  assert_eq(2, tasks_per_person_per_week)
  
  // éªŒè¯é¡¹ç›®æ˜¯å¦èƒ½åœ¨æˆªæ­¢æ—¥æœŸå‰å®Œæˆ
  assert_eq(1, if total_weeks <= project_deadline { 1 } else { 0 })
}

test "enhanced_data_processing_pipeline" {
  // æ•°æ®å¤„ç†æµæ°´çº¿æµ‹è¯•
  let data_batches = 150
  let batch_size = 12
  let processing_time_per_batch = 2  // å°æ—¶
  let quality_check_time = 4  // å°æ—¶
  let daily_working_hours = 8
  
  // è®¡ç®—å¤„ç†è½®æ¬¡
  let processing_rounds = divide_with_ceil(data_batches, batch_size)
  
  // è®¡ç®—æ€»å¤„ç†æ—¶é—´
  let total_processing_time = multiply(processing_rounds, processing_time_per_batch)
  
  // è®¡ç®—æ€»æ—¶é—´ï¼ˆåŒ…æ‹¬è´¨é‡æ£€æŸ¥ï¼‰
  let total_time = add(total_processing_time, quality_check_time)
  
  // è®¡ç®—éœ€è¦çš„å·¥ä½œæ—¥æ•°
  let workdays_needed = divide_with_ceil(total_time, daily_working_hours)
  
  // è®¡ç®—å®é™…å¤„ç†çš„æ•°æ®é‡
  let actual_processed = multiply(processing_rounds - 1, batch_size)
  let final_batch_size = subtract(data_batches, actual_processed)
  
  assert_eq(13, processing_rounds)
  assert_eq(26, total_processing_time)
  assert_eq(30, total_time)
  assert_eq(4, workdays_needed)
  assert_eq(6, final_batch_size)
}

test "enhanced_error_handling_and_robustness" {
  // é”™è¯¯å¤„ç†å’Œå¥å£®æ€§æµ‹è¯•
  // æµ‹è¯•é™¤é›¶é”™è¯¯çš„å„ç§æƒ…å†µ
  assert_eq(0, divide_with_ceil(0, 0))
  assert_eq(0, divide_with_ceil(100, 0))
  assert_eq(0, divide_with_ceil(-100, 0))
  assert_eq(0, divide_with_ceil(2147483647, 0))
  assert_eq(0, divide_with_ceil(-2147483648, 0))
  
  // æµ‹è¯•æå€¼è¿ç®—
  let max_int = 2147483647
  let min_int = -2147483648
  
  assert_eq(max_int, add(max_int, 0))
  assert_eq(min_int, add(min_int, 0))
  assert_eq(0, multiply(max_int, 0))
  assert_eq(0, multiply(min_int, 0))
  assert_eq(max_int, multiply(max_int, 1))
  assert_eq(min_int, multiply(min_int, 1))
  
  // æµ‹è¯•å­—ç¬¦ä¸²è¾¹ç•Œæƒ…å†µ
  assert_eq_string("Hello, !", greet(""))
  assert_eq_string("Hello,   !", greet("  "))
  assert_eq_string("Hello, a!", greet("a"))
  assert_eq_string("Hello, A!", greet("A"))
}

test "enhanced_complex_business_workflow" {
  // å¤æ‚ä¸šåŠ¡å·¥ä½œæµæµ‹è¯•ï¼šç”µå•†è®¢å•å¤„ç†
  let product_price = 120
  let quantity = 15
  let tax_rate = 8  // 8%
  let shipping_cost_per_item = 5
  let discount_threshold = 1000
  let discount_amount = 50
  let packaging_cost_per_box = 10
  let items_per_box = 6
  
  // æ­¥éª¤1: è®¡ç®—å•†å“æ€»ä»·
  let subtotal = multiply(product_price, quantity)
  
  // æ­¥éª¤2: è®¡ç®—è¿è´¹
  let total_shipping = multiply(shipping_cost_per_item, quantity)
  
  // æ­¥éª¤3: è®¡ç®—åŒ…è£…è´¹ç”¨
  let boxes_needed = divide_with_ceil(quantity, items_per_box)
  let packaging_cost = multiply(boxes_needed, packaging_cost_per_box)
  
  // æ­¥éª¤4: è®¡ç®—ç¨è´¹
  let tax_amount = divide_with_ceil(multiply(subtotal, tax_rate), 100)
  
  // æ­¥éª¤5: è®¡ç®—æŠ˜æ‰£å‰æ€»ä»·
  let pre_discount_total = add(add(add(subtotal, total_shipping), packaging_cost), tax_amount)
  
  // æ­¥éª¤6: åº”ç”¨æŠ˜æ‰£ï¼ˆå¦‚æœæ»¡è¶³æ¡ä»¶ï¼‰
  let final_total = if pre_discount_total > discount_threshold {
    add(pre_discount_total, -discount_amount)
  } else {
    pre_discount_total
  }
  
  // æ­¥éª¤7: è®¡ç®—æ¯ä»¶å•†å“çš„å®é™…æˆæœ¬
  let cost_per_item = divide_with_ceil(final_total, quantity)
  
  // éªŒè¯ç»“æœ
  assert_eq(1800, subtotal)
  assert_eq(75, total_shipping)
  assert_eq(3, boxes_needed)
  assert_eq(30, packaging_cost)
  assert_eq(144, tax_amount)
  assert_eq(2049, pre_discount_total)
  assert_eq(1999, final_total)
  assert_eq(134, cost_per_item)
  
  // éªŒè¯æŠ˜æ‰£å·²åº”ç”¨
  assert_eq(1, if final_total < pre_discount_total { 1 } else { 0 })
}

// è¾…åŠ©å‡½æ•°ï¼šå‡æ³•
fn subtract(a : Int, b : Int) -> Int {
  a - b
}