// é¢å¤–çš„ç»¼åˆæµ‹è¯•ç”¨ä¾‹ - è¡¥å……ç°æœ‰æµ‹è¯•è¦†ç›–

// æµ‹è¯•ç”¨ä¾‹1: å¤æ‚æ•°å­¦è¡¨è¾¾å¼ç»„åˆæµ‹è¯•
///|
test "complex_mathematical_expressions" {
  // æµ‹è¯• (a + b) * c çš„ç»„åˆè¿ç®—
  let a = 10
  let b = 20
  let c = 3
  let result = multiply(add(a, b), c)  // (10 + 20) * 3 = 30 * 3 = 90
  assert_eq(90, result)
  
  // æµ‹è¯• a * b + c * d çš„ç»„åˆè¿ç®—
  let a2 = 5
  let b2 = 4
  let c2 = 3
  let d2 = 2
  let result2 = add(multiply(a2, b2), multiply(c2, d2))  // 5*4 + 3*2 = 20 + 6 = 26
  assert_eq(26, result2)
  
  // æµ‹è¯•åµŒå¥—è¿ç®—: (a + (b * c)) * d
  let a3 = 2
  let b3 = 3
  let c3 = 4
  let d3 = 5
  let result3 = multiply(add(a3, multiply(b3, c3)), d3)  // (2 + (3*4)) * 5 = (2 + 12) * 5 = 14 * 5 = 70
  assert_eq(70, result3)
}

// æµ‹è¯•ç”¨ä¾‹2: æç«¯è¾¹ç•Œå€¼ç»„åˆæµ‹è¯•
///|
test "extreme_boundary_combinations" {
  let max_val = 2147483647
  let min_val = -2147483648
  
  // æµ‹è¯•æœ€å¤§å€¼ä¸æ¥è¿‘æœ€å¤§å€¼çš„è¿ç®—
  assert_eq(max_val, add(max_val - 1, 2))  // 2147483646 + 2 = 2147483647 (è¾¹ç•Œ)
  assert_eq(max_val, add(max_val - 100, 101))  // 2147483547 + 101 = 2147483647 (è¾¹ç•Œ)
  
  // æµ‹è¯•æœ€å°å€¼ä¸æ¥è¿‘æœ€å°å€¼çš„è¿ç®—
  assert_eq(min_val, add(min_val + 1, -2))  // -2147483647 + (-2) = -2147483648 (è¾¹ç•Œ)
  assert_eq(min_val, add(min_val + 100, -101))  // -2147483548 + (-101) = -2147483648 (è¾¹ç•Œ)
  
  // æµ‹è¯•æœ€å¤§å€¼ä¸æœ€å°å€¼çš„ä¹˜æ³•
  assert_eq(-2147483647, multiply(max_val, -1))  // 2147483647 * (-1) = -2147483647
  assert_eq(min_val, multiply(min_val, 1))   // -2147483648 * 1 = -2147483648
}

// æµ‹è¯•ç”¨ä¾‹3: å­—ç¬¦ä¸²å¤„ç†çš„é«˜çº§æµ‹è¯•
///|
test "advanced_string_processing" {
  // æµ‹è¯•åŒ…å«ç©ºæ ¼çš„å­—ç¬¦ä¸²
  assert_eq("Hello, Moon Bit!", greet("Moon Bit"))
  assert_eq("Hello,  !", greet(" "))
  
  // æµ‹è¯•åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„å­—ç¬¦ä¸²
  assert_eq("Hello, ä¸­æ–‡!", greet("ä¸­æ–‡"))
  assert_eq("Hello, ğŸš€!", greet("ğŸš€"))
  assert_eq("Hello, \n\t!", greet("\n\t"))
  
  // æµ‹è¯•éå¸¸é•¿çš„å­—ç¬¦ä¸²
  let long_name = "ThisIsAVeryLongNameThatMightCauseIssuesInSomeSystemsButShouldWorkFineInMoonBit"
  let expected = "Hello, " + long_name + "!"
  assert_eq(expected, greet(long_name))
}

// æµ‹è¯•ç”¨ä¾‹4: è¿ç»­è¿ç®—çš„ä¸€è‡´æ€§æµ‹è¯•
///|
test "sequential_operations_consistency" {
  // æµ‹è¯•è¿ç»­åŠ æ³•çš„ä¸€è‡´æ€§ - ä½¿ç”¨å›ºå®šæ•°ç»„
  let sum1 = add(add(add(add(add(0, 1), 2), 3), 4), 5)  // (((((0+1)+2)+3)+4)+5) = 15
  let sum2 = add(add(add(add(add(0, 5), 4), 3), 2), 1)  // (((((0+5)+4)+3)+2)+1) = 15
  
  assert_eq(sum1, sum2)  // æ­£å‘å’Œåå‘æ±‚å’Œåº”è¯¥ç›¸ç­‰
  
  // æµ‹è¯•è¿ç»­ä¹˜æ³•çš„ä¸€è‡´æ€§
  let product1 = multiply(multiply(multiply(1, 2), 3), 4)  // (((1*2)*3)*4) = 24
  let product2 = multiply(multiply(multiply(1, 4), 3), 2)  // (((1*4)*3)*2) = 24
  
  assert_eq(product1, product2)  // æ­£å‘å’Œåå‘æ±‚ç§¯åº”è¯¥ç›¸ç­‰
}

// æµ‹è¯•ç”¨ä¾‹5: å®é™…å•†ä¸šåœºæ™¯æµ‹è¯•
///|
test "real_world_business_scenarios" {
  // åœºæ™¯1: è®¡ç®—æŠ˜æ‰£ä»·æ ¼
  let original_price = 1000
  let discount_percentage = 20  // 20%æŠ˜æ‰£
  let discount_amount = multiply(original_price, discount_percentage) / 100
  let final_price = add(original_price, -discount_amount)
  assert_eq(800, final_price)  // 1000 - (1000 * 20 / 100) = 1000 - 200 = 800
  
  // åœºæ™¯2: è®¡ç®—å¤åˆ© (ç®€åŒ–ç‰ˆ)
  let principal = 1000
  let rate = 5  // 5%åˆ©ç‡
  let year1_interest = multiply(principal, rate) / 100
  let year1_amount = add(principal, year1_interest)  // 1000 + 50 = 1050
  let year2_interest = multiply(year1_amount, rate) / 100
  let year2_amount = add(year1_amount, year2_interest)  // 1050 + 52 = 1102
  let year3_interest = multiply(year2_amount, rate) / 100
  let year3_amount = add(year2_amount, year3_interest)  // 1102 + 55 = 1157
  assert_eq(1157, year3_amount)  // ç®€åŒ–è®¡ç®—ï¼Œå¿½ç•¥å°æ•°éƒ¨åˆ†
  
  // åœºæ™¯3: åº“å­˜ç®¡ç†
  let initial_stock = 100
  let sold = 30
  let restocked = 50
  let current_stock = add(add(initial_stock, -sold), restocked)
  assert_eq(120, current_stock)  // 100 - 30 + 50 = 120
}

// æµ‹è¯•ç”¨ä¾‹6: æ•°å€¼ç²¾åº¦å’Œèˆå…¥æµ‹è¯•
///|
test "numerical_precision_and_rounding" {
  // æµ‹è¯•æ•´æ•°é™¤æ³•çš„ç²¾åº¦æŸå¤±å¤„ç†
  let numerator = 100
  let denominator = 3
  let quotient = numerator / denominator
  let remainder = numerator % denominator
  let reconstructed = add(multiply(quotient, denominator), remainder)
  assert_eq(numerator, reconstructed)  // 100 = (100/3)*3 + (100%3) = 33*3 + 1 = 99 + 1 = 100
  
  // æµ‹è¯•è´Ÿæ•°é™¤æ³•çš„ç²¾åº¦
  let neg_numerator = -100
  let neg_quotient = neg_numerator / denominator
  let neg_remainder = neg_numerator % denominator
  let neg_reconstructed = add(multiply(neg_quotient, denominator), neg_remainder)
  assert_eq(neg_numerator, neg_reconstructed)
}

// æµ‹è¯•ç”¨ä¾‹7: é”™è¯¯è¾“å…¥çš„é²æ£’æ€§æµ‹è¯•
///|
test "error_input_robustness" {
  // æµ‹è¯•é‡å¤è¾¹ç•Œå€¼è¿ç®—
  let max_val = 2147483647
  
  // å¤šæ¬¡è¾¾åˆ°è¾¹ç•Œ
  let result1 = add(add(add(add(add(max_val, 0), 0), 0), 0), 0)  // åº”è¯¥ä¿æŒä¸å˜
  assert_eq(max_val, result1)
  
  // äº¤æ›¿æ­£è´Ÿè¿ç®—
  let alternate1 = add(0, 100)   // 0 + 100 = 100
  let alternate2 = add(alternate1, -50)   // 100 - 50 = 50
  let alternate3 = add(alternate2, -50)   // 50 - 50 = 0
  let alternate4 = add(alternate3, 100)   // 0 + 100 = 100
  assert_eq(100, alternate4)
}

// æµ‹è¯•ç”¨ä¾‹8: æ€§èƒ½ç›¸å…³çš„æ‰¹é‡æ“ä½œæµ‹è¯•
///|
test "performance_related_batch_operations" {
  // æµ‹è¯•å¤§é‡ç›¸åŒæ“ä½œçš„ç´¯ç§¯æ•ˆæœ
  let base_value = 1
  
  // æ‰¹é‡åŠ æ³•
  let sum_result = add(add(add(add(add(add(add(add(add(add(0, base_value), base_value), base_value), base_value), base_value), base_value), base_value), base_value), base_value), base_value)
  assert_eq(10, sum_result)  // 1 + 1 + ... + 1 (10æ¬¡) = 10
  
  // æ‰¹é‡ä¹˜æ³•ï¼ˆå‡ ä½•çº§æ•°ï¼‰
  let product_result = multiply(multiply(multiply(multiply(multiply(1, 2), 2), 2), 2), 2)
  assert_eq(32, product_result)  // 2^5 = 32
}

// æµ‹è¯•ç”¨ä¾‹9: ç‰¹æ®Šæ•°å­¦æ€§è´¨éªŒè¯
///|
test "special_mathematical_properties" {
  // æµ‹è¯•ä¹˜æ³•å¯¹åŠ æ³•çš„åˆ†é…å¾‹: a * (b + c) = a * b + a * c
  let a = 5
  let b = 10
  let c = 15
  let left_side = multiply(a, add(b, c))     // 5 * (10 + 15) = 5 * 25 = 125
  let right_side = add(multiply(a, b), multiply(a, c))  // 5*10 + 5*15 = 50 + 75 = 125
  assert_eq(left_side, right_side)
  
  // æµ‹è¯•é›¶å…ƒç´ çš„æ€§è´¨
  assert_eq(0, multiply(0, 12345))    // 0 * ä»»ä½•æ•° = 0
  assert_eq(12345, add(12345, 0))     // ä»»ä½•æ•° + 0 = ä»»ä½•æ•°
  assert_eq(0, add(0, 0))             // 0 + 0 = 0
  
  // æµ‹è¯•å•ä½å…ƒç´ çš„æ€§è´¨
  assert_eq(12345, multiply(12345, 1))  // ä»»ä½•æ•° * 1 = ä»»ä½•æ•°
  assert_eq(12345, multiply(1, 12345))  // 1 * ä»»ä½•æ•° = ä»»ä½•æ•°
}

// æµ‹è¯•ç”¨ä¾‹10: å­—ç¬¦ä¸²è¾¹ç•Œå’Œå†…å­˜å®‰å…¨æµ‹è¯•
///|
test "string_boundary_and_memory_safety" {
  // æµ‹è¯•å„ç§Unicodeå­—ç¬¦
  assert_eq("Hello, ä¸–ç•Œ!", greet("ä¸–ç•Œ"))
  assert_eq("Hello, ğŸŒ™!", greet("ğŸŒ™"))
  assert_eq("Hello, Ã±Ã¡Ã©Ã­Ã³Ãº!", greet("Ã±Ã¡Ã©Ã­Ã³Ãº"))
  
  // æµ‹è¯•åŒ…å«å¼•å·å’Œç‰¹æ®Šå­—ç¬¦çš„å­—ç¬¦ä¸²
  assert_eq("Hello, \"quoted\"!", greet("\"quoted\""))
  assert_eq("Hello, 'single'!", greet("'single'"))
  assert_eq("Hello, &amp;!", greet("&amp;"))
  
  // æµ‹è¯•æ•°å­—å’Œå­—æ¯æ··åˆ
  assert_eq("Hello, test123!", greet("test123"))
  assert_eq("Hello, 123test!", greet("123test"))
  assert_eq("Hello, t1e2s3t!", greet("t1e2s3t"))
}