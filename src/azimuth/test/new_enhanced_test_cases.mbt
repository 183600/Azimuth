// æ–°å¢çš„ MoonBit æµ‹è¯•ç”¨ä¾‹
// è¦†ç›–æ–°çš„æµ‹è¯•åœºæ™¯å’Œè¾¹ç•Œæƒ…å†µ

test "error_recovery_scenarios" {
  // æµ‹è¯•é”™è¯¯æ¢å¤åœºæ™¯ï¼šåœ¨æç«¯æ¡ä»¶ä¸‹çš„é”™è¯¯å¤„ç†
  let max_val = 2147483647
  let min_val = -2147483648
  
  // æµ‹è¯•è¿ç»­æº¢å‡ºæ“ä½œçš„æ¢å¤èƒ½åŠ›
  let overflow1 = @azimuth.add(max_val, 100)
  let overflow2 = @azimuth.add(overflow1, 100)
  let overflow3 = @azimuth.add(overflow2, 100)
  
  // æ‰€æœ‰æº¢å‡ºæ“ä½œéƒ½åº”è¯¥è¿”å›æœ€å¤§å€¼
  @azimuth.assert_eq(max_val, overflow1)
  @azimuth.assert_eq(max_val, overflow2)
  @azimuth.assert_eq(max_val, overflow3)
  
  // æµ‹è¯•è¿ç»­ä¸‹æº¢æ“ä½œçš„æ¢å¤èƒ½åŠ›
  let underflow1 = @azimuth.add(min_val, -100)
  let underflow2 = @azimuth.add(underflow1, -100)
  let underflow3 = @azimuth.add(underflow2, -100)
  
  // æ‰€æœ‰å°æº¢æ“ä½œéƒ½åº”è¯¥è¿”å›æœ€å°å€¼
  @azimuth.assert_eq(min_val, underflow1)
  @azimuth.assert_eq(min_val, underflow2)
  @azimuth.assert_eq(min_val, underflow3)
  
  // æµ‹è¯•ä¹˜æ³•æº¢å‡ºçš„æ¢å¤èƒ½åŠ›
  let mul_overflow1 = @azimuth.multiply(max_val, 2)
  let mul_overflow2 = @azimuth.multiply(mul_overflow1, 2)
  
  @azimuth.assert_eq(max_val, mul_overflow1)
  @azimuth.assert_eq(max_val, mul_overflow2)
}

test "algorithm_implementation_tests" {
  // æµ‹è¯•ç®€å•ç®—æ³•çš„å®ç°
  // å®ç°æ¬§å‡ é‡Œå¾—ç®—æ³•è®¡ç®—æœ€å¤§å…¬çº¦æ•°ï¼ˆç®€åŒ–ç‰ˆï¼‰
  let a = 48
  let b = 18
  
  // æ‰‹åŠ¨å®ç°GCDç®—æ³•çš„æ­¥éª¤
  // 48 % 18 = 12
  // 18 % 12 = 6
  // 12 % 6 = 0
  // æ‰€ä»¥GCDæ˜¯6
  let remainder1 = a - @azimuth.multiply(18, 2)  // 48 - 36 = 12
  let remainder2 = b - remainder1               // 18 - 12 = 6
  let gcd = remainder2                          // 6
  
  @azimuth.assert_eq(6, gcd)
  
  // å®ç°ç®€å•çš„ç´ æ•°æµ‹è¯•ï¼ˆæ£€æŸ¥7æ˜¯å¦ä¸ºç´ æ•°ï¼‰
  let prime_candidate = 7
  let is_prime = prime_candidate > 1 && 
                 prime_candidate != 2 && 
                 prime_candidate != 3 && 
                 prime_candidate != 5
  
  @azimuth.assert_true(is_prime)
  
  // å®ç°æ–æ³¢é‚£å¥‘æ•°åˆ—çš„ç¬¬8é¡¹
  // F(0)=0, F(1)=1, F(2)=1, F(3)=2, F(4)=3, F(5)=5, F(6)=8, F(7)=13, F(8)=21
  let fib_0 = 0
  let fib_1 = 1
  let fib_2 = @azimuth.add(fib_0, fib_1)  // 1
  let fib_3 = @azimuth.add(fib_1, fib_2)  // 2
  let fib_4 = @azimuth.add(fib_2, fib_3)  // 3
  let fib_5 = @azimuth.add(fib_3, fib_4)  // 5
  let fib_6 = @azimuth.add(fib_4, fib_5)  // 8
  let fib_7 = @azimuth.add(fib_5, fib_6)  // 13
  let fib_8 = @azimuth.add(fib_6, fib_7)  // 21
  
  @azimuth.assert_eq(21, fib_8)
}

test "data_type_boundary_tests" {
  // æµ‹è¯•ä¸åŒæ•°æ®ç±»å‹çš„è¾¹ç•Œæƒ…å†µ
  // æµ‹è¯•é›¶å€¼çš„ç‰¹æ®Šæ€§è´¨
  let zero = 0
  let positive = 42
  let negative = -42
  
  // é›¶å€¼ä¹˜æ³•æµ‹è¯•
  @azimuth.assert_eq(0, @azimuth.multiply(zero, positive))
  @azimuth.assert_eq(0, @azimuth.multiply(zero, negative))
  @azimuth.assert_eq(0, @azimuth.multiply(zero, zero))
  
  // é›¶å€¼åŠ æ³•æµ‹è¯•
  @azimuth.assert_eq(positive, @azimuth.add(zero, positive))
  @azimuth.assert_eq(negative, @azimuth.add(zero, negative))
  @azimuth.assert_eq(zero, @azimuth.add(zero, zero))
  
  // å•ä½å…ƒæµ‹è¯•
  let one = 1
  let neg_one = -1
  
  @azimuth.assert_eq(positive, @azimuth.multiply(positive, one))
  @azimuth.assert_eq(negative, @azimuth.multiply(negative, one))
  @azimuth.assert_eq(@azimuth.add(positive, -positive), @azimuth.multiply(positive, zero))
  
  // æµ‹è¯•è¾¹ç•Œå€¼çš„ç®—æœ¯è¿ç®—
  let max_val = 2147483647
  let min_val = -2147483648
  
  // è¾¹ç•Œå€¼ä¸å•ä½å…ƒçš„è¿ç®—
  @azimuth.assert_eq(max_val, @azimuth.add(max_val, zero))
  @azimuth.assert_eq(min_val, @azimuth.add(min_val, zero))
  @azimuth.assert_eq(max_val, @azimuth.multiply(max_val, one))
  @azimuth.assert_eq(min_val, @azimuth.multiply(min_val, one))
}

test "composite_function_tests" {
  // æµ‹è¯•å¤šä¸ªå‡½æ•°ç»„åˆä½¿ç”¨çš„åœºæ™¯
  // åœºæ™¯ï¼šè®¡ç®—ä¸€ä¸ªåœ†å½¢èŠ±å›­çš„å›´æ æˆæœ¬
  let radius = 5
  let fence_cost_per_meter = 10
  let gate_cost = 50
  
  // è®¡ç®—åœ†å‘¨é•¿ï¼ˆç®€åŒ–ï¼šC = 2 Ã— Ï€ Ã— r â‰ˆ 6 Ã— rï¼‰
  let circumference = @azimuth.multiply(6, radius)
  
  // è®¡ç®—å›´æ æ€»é•¿åº¦ï¼ˆåŒ…æ‹¬é—¨ï¼‰
  let total_fence_length = circumference
  
  // è®¡ç®—å›´æ æˆæœ¬
  let fence_cost = @azimuth.multiply(total_fence_length, fence_cost_per_meter)
  
  // è®¡ç®—æ€»æˆæœ¬
  let total_cost = @azimuth.add(fence_cost, gate_cost)
  
  @azimuth.assert_eq(350, total_cost)  // (6Ã—5)Ã—10 + 50 = 300 + 50 = 350
  
  // åœºæ™¯ï¼šè®¡ç®—æŠ˜æ‰£å•†å“çš„ä»·æ ¼
  let original_price = 200
  let discount_percentage = 15
  let tax_percentage = 8
  
  // è®¡ç®—æŠ˜æ‰£é‡‘é¢
  let discount_amount = @azimuth.multiply(original_price, discount_percentage) / 100
  
  // è®¡ç®—æŠ˜åä»·æ ¼
  let discounted_price = @azimuth.add(original_price, -discount_amount)
  
  // è®¡ç®—ç¨è´¹
  let tax_amount = @azimuth.multiply(discounted_price, tax_percentage) / 100
  
  // è®¡ç®—æœ€ç»ˆä»·æ ¼
  let final_price = @azimuth.add(discounted_price, tax_amount)
  
  @azimuth.assert_eq(183, final_price)  // 200 - 30 + 13 = 183
}

test "performance_stress_tests" {
  // æµ‹è¯•åœ¨è¾ƒå¤§æ•°æ®é‡ä¸‹çš„è¡¨ç°
  // å¤§æ•°ç´¯åŠ æµ‹è¯•
  let large_number = 1000000
  let iterations = 100
  
  // è®¡ç®—ï¼šlarge_number + (large_number-1) + ... + (large_number-iterations+1)
  // ä½¿ç”¨å…¬å¼ï¼šn Ã— a1 - n Ã— (n-1) / 2
  let sum_formula = @azimuth.multiply(iterations, large_number) - @azimuth.multiply(iterations, @azimuth.add(iterations, -1)) / 2
  
  // éªŒè¯å‰å‡ é¡¹
  let sum_first_5 = @azimuth.multiply(5, large_number) - @azimuth.multiply(5, 4) / 2
  @azimuth.assert_eq(4999990, sum_first_5)
  
  // éªŒè¯æ€»å’Œ
  @azimuth.assert_eq(99995000, sum_formula)
  
  // å¤§æ•°è¿ä¹˜æµ‹è¯•
  let base = 10
  let power = 6
  
  // è®¡ç®—ï¼š10^6 = 1,000,000
  let result = @azimuth.multiply(@azimuth.multiply(@azimuth.multiply(base, base), @azimuth.multiply(base, base)), @azimuth.multiply(base, base))
  @azimuth.assert_eq(1000000, result)
  
  // å¤åˆè¿ç®—å‹åŠ›æµ‹è¯•
  let complex_result = @azimuth.add(
    @azimuth.multiply(1000, 100),
    @azimuth.multiply(@azimuth.add(500, 200), 50)
  )
  @azimuth.assert_eq(185000, complex_result)
}

test "internationalization_tests" {
  // æµ‹è¯•ä¸åŒè¯­è¨€å’Œå­—ç¬¦é›†çš„å¤„ç†
  // æµ‹è¯•ä¸­æ–‡å¤„ç†
  let chinese_name = "å¼ ä¸‰"
  @azimuth.assert_eq_string("Hello, å¼ ä¸‰!", @azimuth.greet(chinese_name))
  
  // æµ‹è¯•æ—¥æ–‡å¤„ç†
  let japanese_name = "ç”°ä¸­å¤ªéƒ"
  @azimuth.assert_eq_string("Hello, ç”°ä¸­å¤ªéƒ!", @azimuth.greet(japanese_name))
  
  // æµ‹è¯•éŸ©æ–‡å¤„ç†
  let korean_name = "ê¹€ì² ìˆ˜"
  @azimuth.assert_eq_string("Hello, ê¹€ì² ìˆ˜!", @azimuth.greet(korean_name))
  
  // æµ‹è¯•é˜¿æ‹‰ä¼¯æ–‡å¤„ç†
  let arabic_name = "Ø£Ø­Ù…Ø¯"
  @azimuth.assert_eq_string("Hello, Ø£Ø­Ù…Ø¯!", @azimuth.greet(arabic_name))
  
  // æµ‹è¯•ä¿„æ–‡å¤„ç†
  let russian_name = "Ğ˜Ğ²Ğ°Ğ½"
  @azimuth.assert_eq_string("Hello, Ğ˜Ğ²Ğ°Ğ½!", @azimuth.greet(russian_name))
  
  // æµ‹è¯•æ··åˆè¯­è¨€å­—ç¬¦ä¸²
  let mixed_name = "Johnå¼ ä¸‰ç”°ä¸­ê¹€ì² ìˆ˜"
  @azimuth.assert_eq_string("Hello, Johnå¼ ä¸‰ç”°ä¸­ê¹€ì² ìˆ˜!", @azimuth.greet(mixed_name))
  
  // æµ‹è¯•åŒ…å«è¡¨æƒ…ç¬¦å·çš„å­—ç¬¦ä¸²
  let emoji_name = "ğŸŒğŸ‰ğŸš€"
  @azimuth.assert_eq_string("Hello, ğŸŒğŸ‰ğŸš€!", @azimuth.greet(emoji_name))
  
  // æµ‹è¯•åŒ…å«ç‰¹æ®Šç¬¦å·çš„å­—ç¬¦ä¸²
  let symbols_name = "!@#$%^&*()_+-=[]{}|;':\",./<>?"
  @azimuth.assert_eq_string("Hello, !@#$%^&*()_+-=[]{}|;':\",./<>?!", @azimuth.greet(symbols_name))
}

test "memory_efficiency_tests" {
  // æµ‹è¯•å†…å­˜ä½¿ç”¨æ•ˆç‡ç›¸å…³çš„åœºæ™¯
  // æµ‹è¯•é‡å¤ä½¿ç”¨ç›¸åŒå˜é‡çš„è®¡ç®—
  let base_value = 100
  
  // æ–¹å¼1ï¼šé‡å¤åˆ›å»ºä¸­é—´å˜é‡
  let temp1 = @azimuth.add(base_value, 10)
  let temp2 = @azimuth.add(temp1, 20)
  let temp3 = @azimuth.add(temp2, 30)
  let result1 = @azimuth.add(temp3, 40)
  
  // æ–¹å¼2ï¼šé“¾å¼è®¡ç®—
  let result2 = @azimuth.add(@azimuth.add(@azimuth.add(@azimuth.add(base_value, 10), 20), 30), 40)
  
  // ä¸¤ç§æ–¹å¼åº”è¯¥å¾—åˆ°ç›¸åŒç»“æœ
  @azimuth.assert_eq(result1, result2)
  @azimuth.assert_eq(200, result1)
  
  // æµ‹è¯•è®¡ç®—çš„å¤ç”¨æ€§
  let common_calculation = @azimuth.multiply(25, 4)  // 100
  
  // å¤ç”¨è®¡ç®—ç»“æœ
  let result_a = @azimuth.add(common_calculation, 50)  // 150
  let result_b = @azimuth.multiply(common_calculation, 2)  // 200
  let result_c = @azimuth.add(common_calculation, -25)  // 75
  
  @azimuth.assert_eq(150, result_a)
  @azimuth.assert_eq(200, result_b)
  @azimuth.assert_eq(75, result_c)
  
  // æµ‹è¯•æ‰¹é‡è®¡ç®—çš„æ•ˆç‡
  let batch_size = 10
  let unit_value = 5
  
  // æ‰¹é‡è®¡ç®—ï¼š5 + 10 + 15 + ... + 50
  // ä½¿ç”¨å…¬å¼ï¼šn Ã— (a1 + an) / 2
  let last_value = @azimuth.multiply(unit_value, batch_size)
  let batch_sum = @azimuth.multiply(batch_size, @azimuth.add(unit_value, last_value)) / 2
  
  @azimuth.assert_eq(275, batch_sum)
}

test "concurrency_simulation_tests" {
  // æ¨¡æ‹Ÿå¹¶å‘æ“ä½œçš„åœºæ™¯
  // åœºæ™¯1ï¼šæ¨¡æ‹Ÿä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ›´æ–°è®¡æ•°å™¨
  let counter = 0
  let increment1 = 5
  let increment2 = 3
  
  // çº¿ç¨‹1æ“ä½œ
  let counter_after_thread1 = @azimuth.add(counter, increment1)
  
  // çº¿ç¨‹2æ“ä½œï¼ˆåŸºäºåŸå§‹å€¼ï¼‰
  let counter_after_thread2 = @azimuth.add(counter, increment2)
  
  // æ¨¡æ‹Ÿåˆå¹¶ç»“æœ
  let final_counter = @azimuth.add(counter_after_thread1, increment2)
  let alternative_counter = @azimuth.add(counter_after_thread2, increment1)
  
  // ä¸¤ç§æ–¹å¼åº”è¯¥å¾—åˆ°ç›¸åŒç»“æœ
  @azimuth.assert_eq(final_counter, alternative_counter)
  @azimuth.assert_eq(8, final_counter)
  
  // åœºæ™¯2ï¼šæ¨¡æ‹Ÿé“¶è¡Œè´¦æˆ·çš„å¹¶å‘æ“ä½œ
  let account_balance = 1000
  let deposit1 = 200
  let deposit2 = 300
  let withdrawal1 = 150
  let withdrawal2 = 100
  
  // å¹¶å‘å­˜æ¬¾æ“ä½œ
  let balance_after_deposit1 = @azimuth.add(account_balance, deposit1)
  let balance_after_deposit2 = @azimuth.add(account_balance, deposit2)
  
  // å¹¶å‘å–æ¬¾æ“ä½œ
  let balance_after_withdrawal1 = @azimuth.add(account_balance, -withdrawal1)
  let balance_after_withdrawal2 = @azimuth.add(account_balance, -withdrawal2)
  
  // æ¨¡æ‹Ÿæœ€ç»ˆçŠ¶æ€ï¼šæ‰€æœ‰æ“ä½œéƒ½æˆåŠŸ
  let final_balance = @azimuth.add(@azimuth.add(@azimuth.add(account_balance, deposit1), deposit2), @azimuth.add(-withdrawal1, -withdrawal2))
  
  @azimuth.assert_eq(1250, final_balance)
  
  // åœºæ™¯3ï¼šæ¨¡æ‹Ÿåº“å­˜ç®¡ç†
  let initial_stock = 100
  let incoming_stock = 50
  let sales1 = 20
  let sales2 = 30
  let returns = 5
  
  // è®¡ç®—æœ€ç»ˆåº“å­˜
  let final_stock = @azimuth.add(@azimuth.add(@azimuth.add(initial_stock, incoming_stock), -sales1), @azimuth.add(-sales2, returns))
  
  @azimuth.assert_eq(105, final_stock)
}