// MoonBit å¢å¼ºæµ‹è¯•ç”¨ä¾‹
// è¿™äº›æµ‹è¯•ç”¨ä¾‹å±•ç¤ºäº† MoonBit çš„æ ‡å‡†æµ‹è¯•è¯­æ³•å’Œå®é™…åº”ç”¨åœºæ™¯

// å¯¼å…¥ä¸»æ¨¡å—ä¸­çš„å‡½æ•°
use azimuth.*

/// æµ‹è¯•ç”¨ä¾‹ 1: æ•°å­—åºåˆ—è®¡ç®—
test "fibonacci_sequence_calculation" {
  // è®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ—çš„ç¬¬10é¡¹ï¼ˆç®€åŒ–ç‰ˆï¼‰
  // F(10) = F(9) + F(8) = 34 + 21 = 55
  let f8 = 21
  let f9 = 34
  let f10 = add(f8, f9)
  assert_eq(55, f10)
  
  // éªŒè¯æ–æ³¢é‚£å¥‘æ€§è´¨ï¼šF(n) * F(n+2) - F(n+1)^2 = (-1)^(n+1)
  let n = 8
  let fn = 21
  let fn_plus_1 = 34
  let fn_plus_2 = 55
  
  let left_side = add(multiply(fn, fn_plus_2), multiply(-fn_plus_1, fn_plus_1))
  assert_eq(-1, left_side)
}

/// æµ‹è¯•ç”¨ä¾‹ 2: å­—ç¬¦ä¸²å¤„ç†é«˜çº§åº”ç”¨
test "advanced_string_processing" {
  // æµ‹è¯•å¤šè¯­è¨€å­—ç¬¦ä¸²å¤„ç†
  let english_name = "World"
  let chinese_name = "ä¸–ç•Œ"
  let japanese_name = "ä¸–ç•Œ"
  let emoji_name = "ğŸŒ"
  
  assert_eq_string("Hello, World!", greet(english_name))
  assert_eq_string("Hello, ä¸–ç•Œ!", greet(chinese_name))
  assert_eq_string("Hello, ä¸–ç•Œ!", greet(japanese_name))
  assert_eq_string("Hello, ğŸŒ!", greet(emoji_name))
  
  // æµ‹è¯•åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„å­—ç¬¦ä¸²
  let special_chars = "!@#$%^&*()_+-=[]{}|;':\",./<>?"
  assert_eq_string("Hello, !@#$%^&*()_+-=[]{}|;':\",./<>?!", greet(special_chars))
}

/// æµ‹è¯•ç”¨ä¾‹ 3: æ•°å­¦å…¬å¼éªŒè¯
test "mathematical_formulas" {
  // éªŒè¯å¹³æ–¹å’Œå…¬å¼ï¼š(a+b)Â² = aÂ² + 2ab + bÂ²
  let a = 5
  let b = 3
  
  // è®¡ç®—å·¦è¾¹ï¼š(a+b)Â²
  let sum = add(a, b)
  let left_side = multiply(sum, sum)
  
  // è®¡ç®—å³è¾¹ï¼šaÂ² + 2ab + bÂ²
  let a_squared = multiply(a, a)
  let b_squared = multiply(b, b)
  let two_ab = multiply(multiply(2, a), b)
  let right_side = add(add(a_squared, two_ab), b_squared)
  
  assert_eq(left_side, right_side)
  
  // éªŒè¯ç«‹æ–¹å·®å…¬å¼ï¼šaÂ³ - bÂ³ = (a-b)(aÂ² + ab + bÂ²)
  let a_cubed = multiply(multiply(a, a), a)
  let b_cubed = multiply(multiply(b, b), b)
  let diff_of_cubes = add(a_cubed, -b_cubed)
  
  let a_minus_b = add(a, -b)
  let a_squared_plus_ab_plus_b_squared = add(add(multiply(a, a), multiply(a, b)), multiply(b, b))
  let formula_result = multiply(a_minus_b, a_squared_plus_ab_plus_b_squared)
  
  assert_eq(diff_of_cubes, formula_result)
}

/// æµ‹è¯•ç”¨ä¾‹ 4: å®é™…å•†ä¸šè®¡ç®—
test "business_calculations" {
  // è®¡ç®—å•†å“æŠ˜æ‰£ä»·æ ¼
  let original_price = 1000
  let discount_percentage = 20  // 20% æŠ˜æ‰£
  let tax_percentage = 8       // 8% ç¨è´¹
  
  // è®¡ç®—æŠ˜æ‰£é‡‘é¢
  let discount_amount = multiply(original_price, discount_percentage) / 100
  let discounted_price = add(original_price, -discount_amount)
  
  // è®¡ç®—ç¨è´¹
  let tax_amount = multiply(discounted_price, tax_percentage) / 100
  let final_price = add(discounted_price, tax_amount)
  
  assert_eq(800, discounted_price)  // 1000 - 200 = 800
  assert_eq(64, tax_amount)         // 800 * 0.08 = 64
  assert_eq(864, final_price)       // 800 + 64 = 864
  
  // è®¡ç®—åˆ©æ¶¦ç‡
  let cost_price = 600
  let selling_price = final_price
  let profit = add(selling_price, -cost_price)
  let profit_margin = multiply(profit, 100) / cost_price
  
  assert_eq(44, profit_margin)  // (864-600)/600 * 100 = 44%
}

/// æµ‹è¯•ç”¨ä¾‹ 5: æ—¶é—´å’Œæ—¥æœŸè®¡ç®—
test "time_date_calculations" {
  // è®¡ç®—æ—¶é—´é—´éš”
  let start_hour = 9
  let start_minute = 30
  let end_hour = 17
  let end_minute = 45
  
  // è½¬æ¢ä¸ºåˆ†é’Ÿ
  let start_total = add(multiply(start_hour, 60), start_minute)
  let end_total = add(multiply(end_hour, 60), end_minute)
  let duration = add(end_total, -start_total)
  
  assert_eq(495, duration)  // 8å°æ—¶15åˆ†é’Ÿ = 495åˆ†é’Ÿ
  
  // è®¡ç®—å·¥ä½œæ—¥è–ªèµ„
  let hourly_wage = 150
  let daily_wage = multiply(duration, hourly_wage) / 60
  assert_eq(1237, daily_wage)  // 495/60 * 150 = 1237.5ï¼Œæ•´æ•°é™¤æ³•ä¸º1237
  
  // è®¡ç®—æœˆå·¥ä½œæ—¶é•¿ï¼ˆ22ä¸ªå·¥ä½œæ—¥ï¼‰
  let monthly_hours = multiply(multiply(duration, 22), 1) / 60
  assert_eq(181, monthly_hours)  // 495*22/60 = 181.5ï¼Œæ•´æ•°é™¤æ³•ä¸º181
}

/// æµ‹è¯•ç”¨ä¾‹ 6: å‡ ä½•è®¡ç®—
test "geometric_calculations" {
  // è®¡ç®—çŸ©å½¢å’Œåœ†çš„é¢ç§¯
  let rectangle_length = 12
  let rectangle_width = 8
  let rectangle_area = multiply(rectangle_length, rectangle_width)
  
  assert_eq(96, rectangle_area)
  
  // è®¡ç®—çŸ©å½¢å‘¨é•¿
  let rectangle_perimeter = multiply(add(rectangle_length, rectangle_width), 2)
  assert_eq(40, rectangle_perimeter)
  
  // è®¡ç®—åœ†çš„é¢ç§¯å’Œå‘¨é•¿ï¼ˆä½¿ç”¨Ï€â‰ˆ3ï¼‰
  let circle_radius = 5
  let circle_area = multiply(3, multiply(circle_radius, circle_radius))
  let circle_circumference = multiply(multiply(2, 3), circle_radius)
  
  assert_eq(75, circle_area)
  assert_eq(30, circle_circumference)
  
  // è®¡ç®—ä¸‰è§’å½¢é¢ç§¯ï¼ˆåº•Ã—é«˜Ã·2ï¼‰
  let triangle_base = 10
  let triangle_height = 6
  let triangle_area = multiply(triangle_base, triangle_height) / 2
  
  assert_eq(30, triangle_area)
}

/// æµ‹è¯•ç”¨ä¾‹ 7: æ•°æ®ç»“æ„æ¨¡æ‹Ÿ
test "data_structure_simulation" {
  // æ¨¡æ‹Ÿæ ˆæ“ä½œï¼ˆä½¿ç”¨æ•°ç»„ç´¢å¼•ï¼‰
  let stack_size = 5
  let top_index = 3
  
  // å‹æ ˆæ“ä½œ
  let new_top_index = add(top_index, 1)
  assert_eq(4, new_top_index)
  
  // æ£€æŸ¥æ ˆæ˜¯å¦å·²æ»¡
  let is_full = new_top_index >= stack_size
  assert_false(is_full)
  
  // å¼¹æ ˆæ“ä½œ
  let popped_index = add(new_top_index, -1)
  assert_eq(3, popped_index)
  
  // æ£€æŸ¥æ ˆæ˜¯å¦ä¸ºç©º
  let is_empty = popped_index < 0
  assert_false(is_empty)
}

/// æµ‹è¯•ç”¨ä¾‹ 8: æ¸¸æˆæœºåˆ¶è®¡ç®—
test "game_mechanics" {
  // è®¡ç®—æ¸¸æˆå¾—åˆ†
  let base_score = 1000
  let level = 5
  let combo_multiplier = 3
  let bonus_points = 500
  
  // è®¡ç®—ç­‰çº§åŠ æˆ
  let level_bonus = multiply(base_score, level)
  
  // è®¡ç®—è¿å‡»åŠ æˆ
  let combo_bonus = multiply(level_bonus, combo_multiplier)
  
  // è®¡ç®—æœ€ç»ˆå¾—åˆ†
  let final_score = add(combo_bonus, bonus_points)
  
  assert_eq(5000, level_bonus)    // 1000 * 5 = 5000
  assert_eq(15000, combo_bonus)  // 5000 * 3 = 15000
  assert_eq(15500, final_score)  // 15000 + 500 = 15500
  
  // è®¡ç®—æ’åå¾—åˆ†ï¼ˆå‰10%é¢å¤–åŠ åˆ†ï¼‰
  let rank_percentage = 10
  let rank_bonus = multiply(final_score, rank_percentage) / 100
  let rank_total = add(final_score, rank_bonus)
  
  assert_eq(1550, rank_bonus)   // 15500 * 0.1 = 1550
  assert_eq(17050, rank_total)  // 15500 + 1550 = 17050
}

/// æµ‹è¯•ç”¨ä¾‹ 9: ç§‘å­¦è®¡ç®—æ¨¡æ‹Ÿ
test "scientific_calculations" {
  // è®¡ç®—ç‰©ä½“è‡ªç”±è½ä½“è·ç¦»ï¼ˆç®€åŒ–ç‰ˆï¼šd = 0.5 * g * tÂ²ï¼‰
  // ä½¿ç”¨æ•´æ•°è¿‘ä¼¼ï¼šd â‰ˆ 5 * tÂ²ï¼ˆgâ‰ˆ10, 0.5*gâ‰ˆ5ï¼‰
  let time = 3
  let gravity_approx = 5
  let distance = multiply(gravity_approx, multiply(time, time))
  
  assert_eq(45, distance)  // 5 * 9 = 45ç±³
  
  // è®¡ç®—åŠ¨èƒ½ï¼ˆç®€åŒ–ç‰ˆï¼šKE = 0.5 * m * vÂ²ï¼‰
  // ä½¿ç”¨æ•´æ•°è¿‘ä¼¼ï¼šKE â‰ˆ m * vÂ² / 2
  let mass = 10
  let velocity = 8
  let kinetic_energy = multiply(mass, multiply(velocity, velocity)) / 2
  
  assert_eq(320, kinetic_energy)  // 10 * 64 / 2 = 320
  
  // è®¡ç®—åŠ¿èƒ½ï¼ˆç®€åŒ–ç‰ˆï¼šPE = m * g * hï¼‰
  // ä½¿ç”¨æ•´æ•°è¿‘ä¼¼ï¼šPE â‰ˆ m * 10 * h
  let height = 15
  let potential_energy = multiply(multiply(mass, 10), height)
  
  assert_eq(1500, potential_energy)  // 10 * 10 * 15 = 1500
}

/// æµ‹è¯•ç”¨ä¾‹ 10: ç»Ÿè®¡å’Œæ¦‚ç‡è®¡ç®—
test "statistical_calculations" {
  // è®¡ç®—ä¸€ç»„æ•°æ®çš„å¹³å‡å€¼ã€æ–¹å·®å’Œæ ‡å‡†å·®ï¼ˆç®€åŒ–ç‰ˆï¼‰
  // æ•°æ®ï¼š10, 20, 30, 40, 50
  let data1 = 10
  let data2 = 20
  let data3 = 30
  let data4 = 40
  let data5 = 50
  
  // è®¡ç®—å¹³å‡å€¼
  let sum = add(add(add(add(data1, data2), data3), data4), data5)
  let mean = sum / 5
  assert_eq(30, mean)
  
  // è®¡ç®—æ–¹å·®ï¼ˆç®€åŒ–ç‰ˆï¼Œä¸ä½¿ç”¨å¹³æ–¹ï¼‰
  let dev1 = add(data1, -mean)
  let dev2 = add(data2, -mean)
  let dev3 = add(data3, -mean)
  let dev4 = add(data4, -mean)
  let dev5 = add(data5, -mean)
  
  let abs_dev1 = if dev1 < 0 { -dev1 } else { dev1 }
  let abs_dev2 = if dev2 < 0 { -dev2 } else { dev2 }
  let abs_dev3 = if dev3 < 0 { -dev3 } else { dev3 }
  let abs_dev4 = if dev4 < 0 { -dev4 } else { dev4 }
  let abs_dev5 = if dev5 < 0 { -dev5 } else { dev5 }
  
  let mean_absolute_deviation = add(add(add(add(abs_dev1, abs_dev2), abs_dev3), abs_dev4), abs_dev5) / 5
  assert_eq(12, mean_absolute_deviation)  // (20+10+0+10+20)/5 = 12
  
  // è®¡ç®—æ¦‚ç‡ï¼ˆç®€åŒ–ç‰ˆï¼‰
  let total_outcomes = 100
  let favorable_outcomes = 25
  let probability = multiply(favorable_outcomes, 100) / total_outcomes
  assert_eq(25, probability)  // 25%çš„æ¦‚ç‡
}