pub fn add(a : Int, b : Int) -> Int {
  // ç‰¹æ®Šæƒ…å†µå¤„ç†ï¼šå¦‚æœæœ‰ä¸€ä¸ªæ˜¯0ï¼Œç›´æ¥è¿”å›å¦ä¸€ä¸ª
  if a == 0 {
    return b
  }
  if b == 0 {
    return a
  }

  // å¤„ç†æœ€å°å€¼çš„ç‰¹æ®Šæƒ…å†µï¼ˆInt32çš„æœ€å°å€¼ï¼‰
  let min_val = -2147483648
  let max_val = 2147483647

  // å¤„ç†ä¸€ä¸ªæ“ä½œæ•°æ˜¯æœ€å°å€¼çš„æƒ…å†µ
  if a == min_val {
    // æœ€å°å€¼ + è´Ÿæ•° = å¯èƒ½æº¢å‡º
    if b < 0 {
      return min_val
    }
    // æœ€å°å€¼ + éè´Ÿæ•° = ä¸ä¼šæº¢å‡ºï¼Œç›´æ¥è®¡ç®—
    return a + b
  }
  if b == min_val {
    // è´Ÿæ•° + æœ€å°å€¼ = å¯èƒ½æº¢å‡º
    if a < 0 {
      return min_val
    }
    // éè´Ÿæ•° + æœ€å°å€¼ = ä¸ä¼šæº¢å‡ºï¼Œç›´æ¥è®¡ç®—
    return a + b
  }

  // æ­£æ•°ç›¸åŠ æº¢å‡ºæ£€æŸ¥
  if a > 0 && b > 0 {
    // å¦‚æœ a > max_val - bï¼Œåˆ™ a + b ä¼šæº¢å‡º
    if a > max_val - b {
      return max_val
    }
  }

  // è´Ÿæ•°ç›¸åŠ æº¢å‡ºæ£€æŸ¥ï¼ˆæ­¤æ—¶aå’Œbéƒ½ä¸æ˜¯æœ€å°å€¼ï¼‰
  if a < 0 && b < 0 {
    // ä½¿ç”¨å‡æ³•æ£€æŸ¥ï¼ša < min_val - b
    // ç”±äºbæ˜¯è´Ÿæ•°ï¼Œmin_val - b = min_val + abs(b)
    if a < min_val - b {
      return min_val
    }
  }

  // å®‰å…¨åœ°è¿›è¡ŒåŠ æ³•è¿ç®—
  return a + b
}

///
pub fn multiply(a : Int, b : Int) -> Int {
  // å¸¸é‡å®šä¹‰
  let min_val = -2147483648
  let max_val = 2147483647

  // å¤„ç†0çš„æƒ…å†µ
  if a == 0 || b == 0 {
    return 0
  }

  // å¤„ç†1çš„æƒ…å†µ
  if a == 1 {
    return b
  }
  if b == 1 {
    return a
  }

  // å¤„ç†-1çš„æƒ…å†µï¼ˆåŒ…æ‹¬æœ€å°å€¼çš„ç‰¹æ®Šæƒ…å†µï¼‰
  if a == -1 {
    // -2147483648 * -1 = 2147483648 ä¼šæº¢å‡ºï¼Œåº”è¯¥è¿”å› min_val
    return if b == min_val { min_val } else { -b }
  }
  if b == -1 {
    // -1 * -2147483648 = 2147483648 ä¼šæº¢å‡ºï¼Œåº”è¯¥è¿”å› min_val
    return if a == min_val { min_val } else { -a }
  }

  // å¤„ç†æœ€å°å€¼çš„æƒ…å†µ
  if a == min_val {
    // æœ€å°å€¼ä¹˜ä»¥ä»»ä½•ç»å¯¹å€¼å¤§äº1çš„æ•°éƒ½ä¼šæº¢å‡º
    return if b > 1 || b < -1 { min_val } else { a * b }
  }
  if b == min_val {
    // æœ€å°å€¼ä¹˜ä»¥ä»»ä½•ç»å¯¹å€¼å¤§äº1çš„æ•°éƒ½ä¼šæº¢å‡º
    return if a > 1 || a < -1 { min_val } else { a * b }
  }

  // æ£€æŸ¥æ­£è´Ÿå·
  let sign = if (a > 0 && b > 0) || (a < 0 && b < 0) { 1 } else { -1 }

  // å®‰å…¨åœ°è®¡ç®—ç»å¯¹å€¼ï¼Œæ­¤æ—¶aå’Œbéƒ½ä¸æ˜¯æœ€å°å€¼
  let abs_a = if a < 0 { -a } else { a }
  let abs_b = if b < 0 { -b } else { b }

  // ä¼˜åŒ–çš„æº¢å‡ºæ£€æŸ¥ï¼šä½¿ç”¨é™¤æ³•æ¥é¿å…ä¹˜æ³•æº¢å‡º
  // æ£€æŸ¥ abs_a > max_val / abs_b æ¥é¿å…ä¹˜æ³•æº¢å‡º
  if abs_a > max_val / abs_b {
    return if sign > 0 { max_val } else { min_val }
  }

  // å®‰å…¨åœ°è¿›è¡Œä¹˜æ³•è¿ç®—
  return a * b
}

///
pub fn greet(name : String) -> String {
  // å­—ç¬¦ä¸²æ‹¼æ¥ï¼šç©ºå­—ç¬¦ä¸²ä¼šè‡ªåŠ¨å¤„ç†
  "Hello, " + name + "!"
}

// æµ‹è¯•è¾…åŠ©å‡½æ•°ï¼Œæä¾›æ–­è¨€åŠŸèƒ½
pub fn assert_eq(expected : Int, actual : Int) -> Unit {
  // ä½¿ç”¨æ¡ä»¶åˆ†æ”¯æ¥å®ç°æ–­è¨€ï¼Œé¿å…ä¾èµ– @builtin.abort
  if (expected == actual) {
    ()
  } else {
    // å½“æ–­è¨€å¤±è´¥æ—¶ï¼ŒæŠ›å‡ºä¸€ä¸ªé”™è¯¯
    // ä½¿ç”¨æ•´æ•°é™¤ä»¥é›¶æ¥è§¦å‘è¿è¡Œæ—¶é”™è¯¯
    let _ = 1 / 0
    ()
  }
}

pub fn assert_eq_string(expected : String, actual : String) -> Unit {
  // ä½¿ç”¨æ¡ä»¶åˆ†æ”¯æ¥å®ç°æ–­è¨€ï¼Œé¿å…ä¾èµ– @builtin.abort
  if (expected == actual) {
    ()
  } else {
    // å½“æ–­è¨€å¤±è´¥æ—¶ï¼ŒæŠ›å‡ºä¸€ä¸ªé”™è¯¯
    // ä½¿ç”¨æ•´æ•°é™¤ä»¥é›¶æ¥è§¦å‘è¿è¡Œæ—¶é”™è¯¯
    let _ = 1 / 0
    ()
  }
}

pub fn assert_true(condition : Bool) -> Unit {
  // ä½¿ç”¨æ¡ä»¶åˆ†æ”¯æ¥å®ç°æ–­è¨€ï¼Œé¿å…ä¾èµ– @builtin.abort
  if (condition) {
    ()
  } else {
    // å½“æ–­è¨€å¤±è´¥æ—¶ï¼ŒæŠ›å‡ºä¸€ä¸ªé”™è¯¯
    // ä½¿ç”¨æ•´æ•°é™¤ä»¥é›¶æ¥è§¦å‘è¿è¡Œæ—¶é”™è¯¯
    let _ = 1 / 0
    ()
  }
}

pub fn assert_false(condition : Bool) -> Unit {
  // ä½¿ç”¨æ¡ä»¶åˆ†æ”¯æ¥å®ç°æ–­è¨€ï¼Œé¿å…ä¾èµ– @builtin.abort
  if (condition) {
    // å½“æ–­è¨€å¤±è´¥æ—¶ï¼ŒæŠ›å‡ºä¸€ä¸ªé”™è¯¯
    // ä½¿ç”¨æ•´æ•°é™¤ä»¥é›¶æ¥è§¦å‘è¿è¡Œæ—¶é”™è¯¯
    let _ = 1 / 0
    ()
  } else {
    ()
  }
}

// æµ‹è¯•ç”¨ä¾‹
test "basic_add_test" {
  let result = add(2, 3)
  assert_eq(5, result)
}

test "add_with_zero" {
  // æµ‹è¯•ä¸0ç›¸åŠ çš„æƒ…å†µ
  assert_eq(5, add(5, 0))
  assert_eq(5, add(0, 5))
  assert_eq(0, add(0, 0))
}

test "add_with_min_value" {
  // æµ‹è¯•æœ€å°å€¼çš„æƒ…å†µ
  let min_val = -2147483648
  assert_eq(min_val, add(min_val, 0))
  assert_eq(min_val, add(0, min_val))
  assert_eq(min_val, add(min_val, -1))
  assert_eq(-2147483647, add(min_val, 1))
}

test "add_positive_overflow" {
  // æµ‹è¯•æ­£æ•°æº¢å‡ºçš„æƒ…å†µ
  let max_val = 2147483647
  assert_eq(max_val, add(max_val, 1))
  assert_eq(max_val, add(1000000000, 1500000000))
}

test "add_negative_overflow" {
  // æµ‹è¯•è´Ÿæ•°æº¢å‡ºçš„æƒ…å†µ
  let min_val = -2147483648
  assert_eq(min_val, add(min_val, -1))
  assert_eq(min_val, add(-1500000000, -1000000000))
}

test "basic_multiply_test" {
  let result = multiply(2, 3)
  assert_eq(6, result)
}

test "multiply_with_zero_and_one" {
  // æµ‹è¯•ä¸0å’Œ1ç›¸ä¹˜çš„æƒ…å†µ
  assert_eq(0, multiply(5, 0))
  assert_eq(0, multiply(0, 5))
  assert_eq(5, multiply(5, 1))
  assert_eq(5, multiply(1, 5))
}

test "multiply_with_negative_one" {
  // æµ‹è¯•ä¸-1ç›¸ä¹˜çš„æƒ…å†µ
  assert_eq(-5, multiply(5, -1))
  assert_eq(-5, multiply(-1, 5))
  assert_eq(5, multiply(-5, -1))
  
  // æµ‹è¯•æœ€å°å€¼ä¸-1ç›¸ä¹˜çš„ç‰¹æ®Šæƒ…å†µ
  let min_val = -2147483648
  assert_eq(min_val, multiply(min_val, -1))
}

test "multiply_overflow" {
  // æµ‹è¯•ä¹˜æ³•æº¢å‡ºçš„æƒ…å†µ
  let max_val = 2147483647
  let min_val = -2147483648
  assert_eq(max_val, multiply(46341, 46341))  // sqrt(max_val)çš„å¹³æ–¹
  assert_eq(min_val, multiply(-46341, 46341))
}

test "basic_greet_test" {
  let result = greet("World")
  assert_eq_string("Hello, World!", result)
}

test "greet_with_empty_string" {
  // æµ‹è¯•ç©ºå­—ç¬¦ä¸²çš„æƒ…å†µ
  let result = greet("")
  assert_eq_string("Hello, !", result)
}

test "greet_with_special_characters" {
  // æµ‹è¯•åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„å­—ç¬¦ä¸²
  let result = greet("æµ‹è¯•@123")
  assert_eq_string("Hello, æµ‹è¯•@123!", result)
}

// æ–°å¢æµ‹è¯•ç”¨ä¾‹
test "add_large_numbers" {
  // æµ‹è¯•å¤§æ•°ç›¸åŠ 
  assert_eq(2000000000, add(1000000000, 1000000000))
  assert_eq(-2000000000, add(-1000000000, -1000000000))
}

test "add_mixed_signs" {
  // æµ‹è¯•ä¸åŒç¬¦å·çš„æ•°ç›¸åŠ 
  assert_eq(0, add(100, -100))
  assert_eq(-50, add(100, -150))
  assert_eq(50, add(-100, 150))
}

test "multiply_large_numbers" {
  // æµ‹è¯•å¤§æ•°ç›¸ä¹˜
  assert_eq(1000000, multiply(1000, 1000))
  assert_eq(-1000000, multiply(-1000, 1000))
  assert_eq(1000000, multiply(-1000, -1000))
}

test "multiply_boundary_combinations" {
  // æµ‹è¯•è¾¹ç•Œå€¼ç»„åˆçš„ä¹˜æ³•
  let max_val = 2147483647
  let min_val = -2147483648
  assert_eq(0, multiply(max_val, 0))
  assert_eq(0, multiply(min_val, 0))
  assert_eq(max_val, multiply(max_val, 1))
  assert_eq(min_val, multiply(min_val, 1))
}

test "greet_with_whitespace" {
  // æµ‹è¯•åŒ…å«ç©ºç™½å­—ç¬¦çš„å­—ç¬¦ä¸²
  assert_eq_string("Hello,   World!", greet("  World"))
  assert_eq_string("Hello, World   !", greet("World  "))
  assert_eq_string("Hello,  World  !", greet(" World  "))
}

test "greet_with_unicode_emoji" {
  // æµ‹è¯•åŒ…å« Unicode emoji çš„å­—ç¬¦ä¸²
  assert_eq_string("Hello, ğŸŒ!", greet("ğŸŒ"))
  assert_eq_string("Hello, ğŸ‘‹!", greet("ğŸ‘‹"))
}

test "assert_functions_test" {
  // æµ‹è¯•æ–­è¨€å‡½æ•°æœ¬èº«
  assert_true(true)
  assert_false(false)
  assert_eq(42, 42)
  assert_eq_string("test", "test")
}

test "complex_calculation_scenario" {
  // æµ‹è¯•å¤æ‚è®¡ç®—åœºæ™¯ï¼šè®¡ç®—çŸ©å½¢çš„å‘¨é•¿
  let length = 10
  let width = 5
  let perimeter = add(multiply(2, length), multiply(2, width))
  assert_eq(30, perimeter)
}

test "financial_calculation_scenario" {
  // æµ‹è¯•é‡‘èè®¡ç®—åœºæ™¯ï¼šå¤åˆ©è®¡ç®—ï¼ˆç®€åŒ–ç‰ˆï¼‰
  let principal = 1000
  let rate = 5
  let years = 3
  // ç®€åŒ–çš„å¤åˆ©è®¡ç®—ï¼šæœ¬æ¯å’Œ = æœ¬é‡‘ + æœ¬é‡‘ Ã— åˆ©ç‡ Ã— å¹´æ•°
  let interest = multiply(principal, multiply(rate, years))
  let total = add(principal, interest)
  assert_eq(16000, total)  // 1000 + 1000*5*3 = 16000ï¼Œè¡¨ç¤º1600å…ƒ
}

// æ–°å¢çš„10ä¸ªæµ‹è¯•ç”¨ä¾‹
test "sequential_addition" {
  // æµ‹è¯•è¿ç»­ç›¸åŠ çš„æƒ…å†µ
  let result1 = add(add(1, 2), add(3, 4))
  assert_eq(10, result1)
  
  let result2 = add(add(100, 200), add(300, 400))
  assert_eq(1000, result2)
  
  // æµ‹è¯•åŒ…å«æœ€å°å€¼çš„è¿ç»­ç›¸åŠ 
  let min_val = -2147483648
  let result3 = add(add(min_val, 1), add(1, 1))
  assert_eq(-2147483645, result3)
}

test "sequential_multiplication" {
  // æµ‹è¯•è¿ç»­ç›¸ä¹˜çš„æƒ…å†µ
  let result1 = multiply(multiply(2, 3), multiply(4, 5))
  assert_eq(120, result1)
  
  let result2 = multiply(multiply(10, 20), multiply(30, 40))
  assert_eq(240000, result2)
  
  // æµ‹è¯•åŒ…å«è´Ÿæ•°çš„è¿ç»­ç›¸ä¹˜
  let result3 = multiply(multiply(-2, 3), multiply(4, -5))
  assert_eq(120, result3)
}

test "extreme_value_operations" {
  // æµ‹è¯•æå€¼è¿ç®—çš„ç»„åˆ
  let max_val = 2147483647
  let min_val = -2147483648
  
  // æå€¼ç›¸åŠ 
  assert_eq(-1, add(max_val, min_val))
  
  // æå€¼ä¸æ¥è¿‘æå€¼çš„æ•°ç›¸åŠ 
  assert_eq(max_val, add(max_val, 100))
  assert_eq(min_val, add(min_val, -100))
  
  // æå€¼ç›¸ä¹˜
  assert_eq(min_val, multiply(min_val, 1))
  assert_eq(min_val, multiply(min_val, -1))
}

test "string_edge_cases" {
  // æµ‹è¯•å­—ç¬¦ä¸²è¿æ¥çš„è¾¹ç•Œæƒ…å†µ
  // æµ‹è¯•éå¸¸é•¿çš„å­—ç¬¦ä¸²
  let long_name = "ThisIsAVeryLongNameThatMightCauseIssuesInSomeSystemsButShouldWorkFineInMoonBit"
  let result = greet(long_name)
  assert_eq_string("Hello, " + long_name + "!", result)
  
  // æµ‹è¯•åŒ…å«å¼•å·çš„å­—ç¬¦ä¸²
  let quoted_name = "\"John Doe\""
  let result2 = greet(quoted_name)
  assert_eq_string("Hello, \"John Doe\"!", result2)
  
  // æµ‹è¯•åŒ…å«æ¢è¡Œç¬¦çš„å­—ç¬¦ä¸²
  let newline_name = "Line1\nLine2"
  let result3 = greet(newline_name)
  assert_eq_string("Hello, Line1\nLine2!", result3)
}

test "addition_associativity" {
  // æµ‹è¯•åŠ æ³•ç»“åˆå¾‹ (a + b) + c = a + (b + c)
  let a = 100
  let b = 200
  let c = 300
  
  let result1 = add(add(a, b), c)
  let result2 = add(a, add(b, c))
  assert_eq(result1, result2)
  
  // æµ‹è¯•åŒ…å«è´Ÿæ•°çš„æƒ…å†µ
  let d = -150
  let e = 250
  let f = -100
  
  let result3 = add(add(d, e), f)
  let result4 = add(d, add(e, f))
  assert_eq(result3, result4)
}

test "multiplication_commutativity" {
  // æµ‹è¯•ä¹˜æ³•äº¤æ¢å¾‹ a * b = b * a
  let a = 12
  let b = 15
  
  let result1 = multiply(a, b)
  let result2 = multiply(b, a)
  assert_eq(result1, result2)
  
  // æµ‹è¯•åŒ…å«è´Ÿæ•°çš„æƒ…å†µ
  let c = -20
  let d = 30
  
  let result3 = multiply(c, d)
  let result4 = multiply(d, c)
  assert_eq(result3, result4)
  
  // æµ‹è¯•åŒ…å«0çš„æƒ…å†µ
  let e = 0
  let f = 100
  
  let result5 = multiply(e, f)
  let result6 = multiply(f, e)
  assert_eq(result5, result6)
}

test "complex_string_processing" {
  // æµ‹è¯•å¤æ‚å­—ç¬¦ä¸²å¤„ç†
  // æµ‹è¯•åŒ…å«å¤šç§ç‰¹æ®Šå­—ç¬¦çš„å­—ç¬¦ä¸²
  let complex_name = "John@Doe#123$%^&*()"
  let result = greet(complex_name)
  assert_eq_string("Hello, John@Doe#123$%^&*()!", result)
  
  // æµ‹è¯•åŒ…å«ä¸­æ–‡å­—ç¬¦çš„å­—ç¬¦ä¸²
  let chinese_name = "å¼ ä¸‰"
  let result2 = greet(chinese_name)
  assert_eq_string("Hello, å¼ ä¸‰!", result2)
  
  // æµ‹è¯•æ··åˆè¯­è¨€å­—ç¬¦ä¸²
  let mixed_name = "Johnå¼ ä¸‰123"
  let result3 = greet(mixed_name)
  assert_eq_string("Hello, Johnå¼ ä¸‰123!", result3)
}

test "shopping_cart_calculation" {
  // æµ‹è¯•å®é™…åº”ç”¨åœºæ™¯ï¼šè´­ç‰©è½¦è®¡ç®—
  let item1_price = 299
  let item1_quantity = 2
  let item2_price = 199
  let item2_quantity = 3
  let item3_price = 99
  let item3_quantity = 1
  
  // è®¡ç®—æ¯ç§å•†å“çš„æ€»ä»·
  let total1 = multiply(item1_price, item1_quantity)
  let total2 = multiply(item2_price, item2_quantity)
  let total3 = multiply(item3_price, item3_quantity)
  
  // è®¡ç®—è´­ç‰©è½¦æ€»ä»·
  let cart_total = add(add(total1, total2), total3)
  
  // éªŒè¯æ€»ä»·ï¼š299*2 + 199*3 + 99*1 = 598 + 597 + 99 = 1294
  assert_eq(1294, cart_total)
}

test "temperature_conversion" {
  // æµ‹è¯•å®é™…åº”ç”¨åœºæ™¯ï¼šæ¸©åº¦è½¬æ¢ï¼ˆç®€åŒ–ç‰ˆï¼‰
  // æ‘„æ°åº¦è½¬åæ°åº¦ï¼šF = C * 9/5 + 32
  // ç”±äºæˆ‘ä»¬åªæœ‰æ•´æ•°è¿ç®—ï¼Œæˆ‘ä»¬ä½¿ç”¨è¿‘ä¼¼å€¼ï¼šF = C * 2 + 30
  
  let celsius_temp = 25
  let fahrenheit_temp = add(multiply(celsius_temp, 2), 30)
  assert_eq(80, fahrenheit_temp)  // 25 * 2 + 30 = 80
  
  // æµ‹è¯•å†°ç‚¹æ¸©åº¦
  let freezing_celsius = 0
  let freezing_fahrenheit = add(multiply(freezing_celsius, 2), 30)
  assert_eq(30, freezing_fahrenheit)  // 0 * 2 + 30 = 30
  
  // æµ‹è¯•æ²¸ç‚¹æ¸©åº¦
  let boiling_celsius = 100
  let boiling_fahrenheit = add(multiply(boiling_celsius, 2), 30)
  assert_eq(230, boiling_fahrenheit)  // 100 * 2 + 30 = 230
}

test "error_handling_scenarios" {
  // æµ‹è¯•é”™è¯¯å¤„ç†åœºæ™¯
  // æµ‹è¯•æ–­è¨€å‡½æ•°çš„é”™è¯¯æƒ…å†µï¼ˆè¿™äº›æµ‹è¯•ä¼šæ•…æ„å¤±è´¥ï¼Œä½†åœ¨å®é™…ä½¿ç”¨ä¸­è¢«æ³¨é‡Šæ‰ï¼‰
  // assert_true(false)  // è¿™ä¼šå¯¼è‡´è¿è¡Œæ—¶é”™è¯¯
  // assert_false(true)  // è¿™ä¼šå¯¼è‡´è¿è¡Œæ—¶é”™è¯¯
  // assert_eq(1, 2)     // è¿™ä¼šå¯¼è‡´è¿è¡Œæ—¶é”™è¯¯
  // assert_eq_string("hello", "world")  // è¿™ä¼šå¯¼è‡´è¿è¡Œæ—¶é”™è¯¯
  
  // æµ‹è¯•è¾¹ç•Œæƒ…å†µçš„æ­£ç¡®å¤„ç†
  let max_val = 2147483647
  let min_val = -2147483648
  
  // ç¡®ä¿æº¢å‡ºè¢«æ­£ç¡®å¤„ç†
  assert_true(add(max_val, 1) == max_val)
  assert_true(add(min_val, -1) == min_val)
  assert_true(multiply(max_val, 2) == max_val)
  assert_true(multiply(min_val, -1) == min_val)
  
  // æµ‹è¯•æ­£å¸¸æƒ…å†µ
  assert_true(add(5, 3) == 8)
  assert_true(multiply(4, 6) == 24)
  assert_true(greet("Test") == "Hello, Test!")
}


