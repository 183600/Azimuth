// Top-level module for Azimuth telemetry package
import "azimuth/azimuth"

pub test "basic project setup test" {
  // Basic test to ensure project setup is working
  assert_eq(1 + 1, 2)
  assert_true(true)
  assert_false(false)
}

// Test 1: Attributes operations
pub test "attributes creation and operations" {
  let attrs = azimuth::Attributes::new()
  azimuth::Attributes::set(attrs, "string.key", azimuth::StringValue("test_value"))
  azimuth::Attributes::set(attrs, "int.key", azimuth::IntValue(42))
  
  let string_val = azimuth::Attributes::get(attrs, "string.key")
  let int_val = azimuth::Attributes::get(attrs, "int.key")
  let missing_val = azimuth::Attributes::get(attrs, "missing.key")
  
  assert_eq(string_val, Some(azimuth::StringValue("test_value")))
  assert_eq(int_val, Some(azimuth::IntValue(42)))
  assert_eq(missing_val, None)
}

// Test 2: Context and Baggage operations
pub test "context and baggage propagation" {
  let root_ctx = azimuth::Context::root()
  let key = azimuth::ContextKey::new("user.id")
  let ctx_with_value = azimuth::Context::with_value(root_ctx, key, "12345")
  
  let retrieved_value = azimuth::Context::get(ctx_with_value, key)
  assert_eq(retrieved_value, Some("12345"))
  
  let missing_key = azimuth::ContextKey::new("missing.key")
  let missing_value = azimuth::Context::get(root_ctx, missing_key)
  assert_eq(missing_value, None)
  
  // Test baggage operations
  let baggage = azimuth::Baggage::new()
  let updated_baggage = azimuth::Baggage::set_entry(baggage, "request.id", "req-123")
  let baggage_value = azimuth::Baggage::get_entry(updated_baggage, "request.id")
  assert_eq(baggage_value, Some("req-123"))
}

// Test 3: Span and Tracer functionality
pub test "span and tracer operations" {
  let span_ctx = azimuth::SpanContext::new("trace-123", "span-456", true, "")
  assert_eq(azimuth::SpanContext::trace_id(span_ctx), "trace-123")
  assert_eq(azimuth::SpanContext::span_id(span_ctx), "span-456")
  assert_true(azimuth::SpanContext::is_valid(span_ctx))
  assert_true(azimuth::SpanContext::is_sampled(span_ctx))
  
  let span = azimuth::Span::new("test-span", azimuth::Internal, span_ctx)
  assert_eq(azimuth::Span::name(span), "test-span")
  assert_eq(azimuth::Span::kind(span), azimuth::Internal)
  assert_true(azimuth::Span::is_recording(span))
  
  let provider = azimuth::TracerProvider::default()
  let tracer = azimuth::TracerProvider::get_tracer(provider, "test-tracer")
  let scope = azimuth::Tracer::instrumentation_scope(tracer)
  assert_eq(scope.name, "test-tracer")
  
  let new_span = azimuth::Tracer::start_span(tracer, "operation")
  assert_eq(azimuth::Span::name(new_span), "operation")
}

// Test 4: Metrics operations
pub test "metrics counter and histogram operations" {
  let provider = azimuth::MeterProvider::default()
  let meter = azimuth::MeterProvider::get_meter(provider, "test-meter")
  
  let counter = azimuth::Meter::create_counter(meter, "request.count")
  assert_eq(counter.name, "request.count")
  azimuth::Counter::add(counter, 1.0)
  
  let histogram = azimuth::Meter::create_histogram(meter, "response.time", Some("Response time in milliseconds"), Some("ms"))
  assert_eq(histogram.name, "response.time")
  assert_eq(histogram.description, Some("Response time in milliseconds"))
  assert_eq(histogram.unit, Some("ms"))
  azimuth::Histogram::record(histogram, 150.5)
  
  let updown_counter = azimuth::Meter::create_updown_counter(meter, "active.connections")
  assert_eq(updown_counter.name, "active.connections")
  azimuth::UpDownCounter::add(updown_counter, 5.0)
  
  let gauge = azimuth::Meter::create_gauge(meter, "memory.usage")
  assert_eq(gauge.name, "memory.usage")
  
  let instrument = azimuth::Histogram::as_instrument(histogram)
  assert_eq(azimuth::Instrument::name(instrument), "response.time")
  assert_eq(azimuth::Instrument::description(instrument), Some("Response time in milliseconds"))
  assert_eq(azimuth::Instrument::unit(instrument), Some("ms"))
}

// Test 5: LogRecord and Logger operations
pub test "log record and logger operations" {
  let log_record = azimuth::LogRecord::new(azimuth::Info, "Test log message")
  assert_eq(azimuth::LogRecord::severity_number(log_record), azimuth::Info)
  assert_eq(azimuth::LogRecord::body(log_record), Some("Test log message"))
  
  let detailed_record = azimuth::LogRecord::new_with_context(
    azimuth::Error,
    Some("Error occurred"),
    Some(azimuth::Attributes::new()),
    Some(1735689600000000000L),
    Some(1735689600000000001L),
    Some("trace-123"),
    Some("span-456"),
    Some(azimuth::Context::root())
  )
  assert_eq(azimuth::LogRecord::severity_number(detailed_record), azimuth::Error)
  assert_eq(azimuth::LogRecord::body(detailed_record), Some("Error occurred"))
  assert_eq(azimuth::LogRecord::trace_id(detailed_record), Some("trace-123"))
  assert_eq(azimuth::LogRecord::span_id(detailed_record), Some("span-456"))
  
  let provider = azimuth::LoggerProvider::default()
  let logger = azimuth::LoggerProvider::get_logger(provider, "test-logger")
  assert_eq(logger.scope.name, "test-logger")
  
  azimuth::Logger::emit(logger, log_record)
}

// Test 6: Resource management
pub test "resource operations" {
  let resource = azimuth::Resource::new()
  let attributes = [("service.name", azimuth::StringValue("test-service")), 
                    ("service.version", azimuth::StringValue("1.0.0"))]
  let resource_with_attrs = azimuth::Resource::with_attributes(resource, attributes)
  
  let service_name = azimuth::Resource::get_attribute(resource_with_attrs, "service.name")
  let service_version = azimuth::Resource::get_attribute(resource_with_attrs, "service.version")
  let missing_attr = azimuth::Resource::get_attribute(resource_with_attrs, "missing.attr")
  
  assert_eq(service_name, Some(azimuth::StringValue("test-service")))
  assert_eq(service_version, Some(azimuth::StringValue("1.0.0")))
  assert_eq(missing_attr, None)
  
  let override_resource = azimuth::Resource::with_attributes(resource, 
    [("environment", azimuth::StringValue("production"))])
  let merged_resource = azimuth::Resource::merge(resource_with_attrs, override_resource)
  let env_attr = azimuth::Resource::get_attribute(merged_resource, "environment")
  assert_eq(env_attr, Some(azimuth::StringValue("production")))
}

// Test 7: Propagator functionality
pub test "propagator operations" {
  let trace_propagator = azimuth::W3CTraceContextPropagator::new()
  let baggage_propagator = azimuth::W3CBaggagePropagator::new()
  
  let propagators = [trace_propagator]
  let composite_propagator = azimuth::CompositePropagator::new(propagators)
  
  let carrier = azimuth::TextMapCarrier::new()
  let ctx = azimuth::Context::root()
  
  azimuth::CompositePropagator::inject(composite_propagator, ctx, carrier)
  let trace_header = azimuth::TextMapCarrier::get(carrier, "traceparent")
  assert_eq(trace_header, Some("00-test-trace-id-test-span-id-01"))
  
  let extracted_ctx = azimuth::CompositePropagator::extract(composite_propagator, carrier)
  let key = azimuth::ContextKey::new("extracted")
  let extracted_value = azimuth::Context::get(extracted_ctx, key)
  assert_eq(extracted_value, Some("true"))
}

// Test 8: HTTP Client operations
pub test "http client operations" {
  let client = azimuth::HttpClient::new()
  
  let headers = [("Content-Type", "application/json"), ("Authorization", "Bearer token123")]
  let request = azimuth::HttpRequest::new("GET", "https://api.example.com/data", headers, Some("request body"))
  
  assert_eq(azimuth::HttpRequest::http_method(request), "GET")
  assert_eq(azimuth::HttpRequest::url(request), "https://api.example.com/data")
  assert_eq(azimuth::HttpRequest::body(request), Some("request body"))
  
  let response_headers = [("Content-Type", "application/json")]
  let response = azimuth::HttpResponse::new(200, response_headers, Some("{\"status\": \"success\"}"))
  
  assert_eq(azimuth::HttpResponse::status_code(response), 200)
  assert_eq(azimuth::HttpResponse::body(response), Some("{\"status\": \"success\"}"))
}

// Test 9: Clock and Random operations
pub test "clock and random operations" {
  let clock = azimuth::Clock::system()
  let timestamp = azimuth::Clock::now_unix_nanos(clock)
  
  // Verify timestamp is reasonable (should be around 2025)
  assert_true(timestamp > 1700000000000000000L)
  assert_true(timestamp < 1800000000000000000L)
  
  let random = azimuth::Random::system()
  let random_bytes = azimuth::Random::next_bytes(random, 8)
  assert_eq(random_bytes.length(), 8)
  
  let random_u64 = azimuth::Random::next_u64(random)
  assert_true(random_u64.to_int() >= 0)
  assert_true(random_u64.to_int() < 1000000)  // Reasonable range for testing
}

// Test 10: Integration test - Complete telemetry workflow
pub test "complete telemetry workflow integration" {
  // Setup resource
  let resource = azimuth::Resource::new()
  let resource_attrs = [("service.name", azimuth::StringValue("integration-test"))]
  let service_resource = azimuth::Resource::with_attributes(resource, resource_attrs)
  
  // Setup context with baggage
  let ctx = azimuth::Context::root()
  let baggage_key = azimuth::ContextKey::new("user.id")
  let ctx_with_baggage = azimuth::Context::with_value(ctx, baggage_key, "user-123")
  
  // Create tracer and span
  let tracer_provider = azimuth::TracerProvider::default()
  let tracer = azimuth::TracerProvider::get_tracer(tracer_provider, "integration-tracer")
  let span = azimuth::Tracer::start_span(tracer, "integration-operation")
  
  // Create metrics
  let meter_provider = azimuth::MeterProvider::default()
  let meter = azimuth::MeterProvider::get_meter(meter_provider, "integration-meter")
  let counter = azimuth::Meter::create_counter(meter, "operations.count")
  azimuth::Counter::add(counter, 1.0)
  
  // Create logger and log record
  let logger_provider = azimuth::LoggerProvider::default()
  let logger = azimuth::LoggerProvider::get_logger(logger_provider, "integration-logger")
  let log_record = azimuth::LogRecord::new_with_context(
    azimuth::Info,
    Some("Integration test completed successfully"),
    None,
    Some(azimuth::Clock::now_unix_nanos(azimuth::Clock::system())),
    None,
    Some(azimuth::SpanContext::trace_id(azimuth::Span::span_context(span))),
    Some(azimuth::SpanContext::span_id(azimuth::Span::span_context(span))),
    Some(ctx_with_baggage)
  )
  
  // Emit log
  azimuth::Logger::emit(logger, log_record)
  
  // Verify all components were created correctly
  assert_eq(azimuth::Span::name(span), "integration-operation")
  assert_eq(counter.name, "operations.count")
  assert_eq(logger.scope.name, "integration-logger")
  assert_eq(azimuth::LogRecord::body(log_record), Some("Integration test completed successfully"))
  
  // Verify resource attributes
  let service_name = azimuth::Resource::get_attribute(service_resource, "service.name")
  assert_eq(service_name, Some(azimuth::StringValue("integration-test")))
}

// Enhanced Quality Test 1: Error handling and boundary conditions
pub test "é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæ¡ä»¶æµ‹è¯•" {
  // æµ‹è¯•ç©ºå€¼å’Œnullå¤„ç†
  let empty_attrs = azimuth::Attributes::new()
  assert_eq(azimuth::Attributes::get(empty_attrs, ""), None)
  assert_eq(azimuth::Attributes::get(empty_attrs, "nonexistent"), None)
  
  // æµ‹è¯•æå€¼å±æ€§
  let extreme_attrs = azimuth::Attributes::new()
  azimuth::Attributes::set(extreme_attrs, "max.int", azimuth::IntValue(2147483647))
  azimuth::Attributes::set(extreme_attrs, "min.int", azimuth::IntValue(-2147483648))
  azimuth::Attributes::set(extreme_attrs, "max.float", azimuth::FloatValue(1.7976931348623157e+308))
  azimuth::Attributes::set(extreme_attrs, "min.float", azimuth::FloatValue(-1.7976931348623157e+308))
  azimuth::Attributes::set(extreme_attrs, "zero.float", azimuth::FloatValue(0.0))
  
  // æµ‹è¯•ç©ºå­—ç¬¦ä¸²å’Œç‰¹æ®Šå­—ç¬¦
  let special_attrs = azimuth::Attributes::new()
  azimuth::Attributes::set(special_attrs, "empty.string", azimuth::StringValue(""))
  azimuth::Attributes::set(special_attrs, "unicode.string", azimuth::StringValue("æµ‹è¯•ä¸­æ–‡ğŸš€emoji"))
  azimuth::Attributes::set(special_attrs, "special.chars", azimuth::StringValue("!@#$%^&*()_+-=[]{}|;':\",./<>?"))
  
  // æµ‹è¯•è¾¹ç•ŒSpanä¸Šä¸‹æ–‡
  let empty_trace_ctx = azimuth::SpanContext::new("", "span123", true, "")
  assert_false(azimuth::SpanContext::is_valid(empty_trace_ctx))
  
  let empty_span_ctx = azimuth::SpanContext::new("trace123", "", true, "")
  assert_false(azimuth::SpanContext::is_valid(empty_span_ctx))
  
  let both_empty_ctx = azimuth::SpanContext::new("", "", false, "")
  assert_false(azimuth::SpanContext::is_valid(both_empty_ctx))
  assert_false(azimuth::SpanContext::is_sampled(both_empty_ctx))
  
  // æµ‹è¯•ä¸Šä¸‹æ–‡é”®çš„è¾¹ç•Œæƒ…å†µ
  let empty_key = azimuth::ContextKey::new("")
  let very_long_key = azimuth::ContextKey::new("this.is.a.very.long.key.name.that.exceeds.normal.expectations.and.tests.boundary.conditions")
  
  let root_ctx = azimuth::Context::root()
  let ctx_with_empty_key = azimuth::Context::with_value(root_ctx, empty_key, "empty.value")
  let ctx_with_long_key = azimuth::Context::with_value(root_ctx, very_long_key, "long.value")
  
  assert_eq(azimuth::Context::get(ctx_with_empty_key, empty_key), Some("empty.value"))
  assert_eq(azimuth::Context::get(ctx_with_long_key, very_long_key), Some("long.value"))
}

// Enhanced Quality Test 2: Performance benchmarks
pub test "æ€§èƒ½åŸºå‡†æµ‹è¯•" {
  // æµ‹è¯•å¤§é‡Spanåˆ›å»ºå’Œæ“ä½œçš„æ€§èƒ½
  let tracer_provider = azimuth::TracerProvider::default()
  let tracer = azimuth::TracerProvider::get_tracer(tracer_provider, "performance-test")
  
  let start_time = azimuth::Clock::now_unix_nanos(azimuth::Clock::system())
  
  // åˆ›å»ºå¤§é‡Span
  let spans = []
  for i in 0..100 {
    let span = azimuth::Tracer::start_span(tracer, "perf-span-" + i.to_string())
    spans.push(span)
  }
  
  // æ‰¹é‡æ“ä½œSpan
  for span in spans {
    azimuth::Span::add_event(span, "performance.event", Some([("iteration", azimuth::StringValue("test"))]))
    azimuth::Span::set_status(span, azimuth::Ok)
  }
  
  // æ‰¹é‡ç»“æŸSpan
  for span in spans {
    azimuth::Span::end(span)
  }
  
  let end_time = azimuth::Clock::now_unix_nanos(azimuth::Clock::system())
  let duration = end_time - start_time
  
  // éªŒè¯æ€§èƒ½åœ¨åˆç†èŒƒå›´å†…
  assert_true(duration < 10000000000L)  // å°äº10ç§’
  assert_true(spans.length() == 100)
  
  // æµ‹è¯•åº¦é‡æ“ä½œæ€§èƒ½
  let meter_start = azimuth::Clock::now_unix_nanos(azimuth::Clock::system())
  
  let meter_provider = azimuth::MeterProvider::default()
  let meter = azimuth::MeterProvider::get_meter(meter_provider, "perf-meter")
  let counter = azimuth::Meter::create_counter(meter, "perf-counter")
  let histogram = azimuth::Meter::create_histogram(meter, "perf-histogram")
  
  // å¤§é‡åº¦é‡æ“ä½œ
  for i in 0..500 {
    azimuth::Counter::add(counter, 1.0)
    azimuth::Histogram::record(histogram, i.to_double())
  }
  
  let meter_end = azimuth::Clock::now_unix_nanos(azimuth::Clock::system())
  let meter_duration = meter_end - meter_start
  
  assert_true(meter_duration < 5000000000L)  // å°äº5ç§’
}

// Enhanced Quality Test 3: Cross-service consistency
pub test "è·¨æœåŠ¡ä¸€è‡´æ€§æµ‹è¯•" {
  // æ¨¡æ‹Ÿè·¨æœåŠ¡çš„åˆ†å¸ƒå¼è¿½è¸ªåœºæ™¯
  let service_a_tracer = azimuth::TracerProvider::get_tracer(azimuth::TracerProvider::default(), "service-a")
  let service_b_tracer = azimuth::TracerProvider::get_tracer(azimuth::TracerProvider::default(), "service-b")
  let service_c_tracer = azimuth::TracerProvider::get_tracer(azimuth::TracerProvider::default(), "service-c")
  
  // æœåŠ¡Aåˆ›å»ºæ ¹Span
  let root_span_ctx = azimuth::SpanContext::new("trace-12345", "span-a-root", true, "test-state")
  let root_span = azimuth::Span::new("service-a-operation", azimuth::Server, root_span_ctx)
  
  // æœåŠ¡Aè°ƒç”¨æœåŠ¡B
  let span_b_ctx = azimuth::SpanContext::new("trace-12345", "span-b-child", true, "test-state")
  let span_b = azimuth::Span::new("service-b-operation", azimuth::Server, span_b_ctx)
  
  // æœåŠ¡Bè°ƒç”¨æœåŠ¡C
  let span_c_ctx = azimuth::SpanContext::new("trace-12345", "span-c-grandchild", true, "test-state")
  let span_c = azimuth::Span::new("service-c-operation", azimuth::Internal, span_c_ctx)
  
  // éªŒè¯Trace IDä¸€è‡´æ€§
  assert_eq(azimuth::SpanContext::trace_id(root_span_ctx), "trace-12345")
  assert_eq(azimuth::SpanContext::trace_id(span_b_ctx), "trace-12345")
  assert_eq(azimuth::SpanContext::trace_id(span_c_ctx), "trace-12345")
  
  // éªŒè¯Span IDå”¯ä¸€æ€§
  assert_true(azimuth::SpanContext::span_id(root_span_ctx) != azimuth::SpanContext::span_id(span_b_ctx))
  assert_true(azimuth::SpanContext::span_id(span_b_ctx) != azimuth::SpanContext::span_id(span_c_ctx))
  assert_true(azimuth::SpanContext::span_id(root_span_ctx) != azimuth::SpanContext::span_id(span_c_ctx))
  
  // æµ‹è¯•è·¨æœåŠ¡Baggageä¼ æ’­
  let baggage_a = azimuth::Baggage::new()
  let baggage_b = azimuth::Baggage::set_entry(baggage_a, "user.id", "12345")
  let baggage_c = azimuth::Baggage::set_entry(baggage_b, "request.id", "req-67890")
  
  // éªŒè¯Baggageä¸€è‡´æ€§
  assert_eq(azimuth::Baggage::get_entry(baggage_b, "user.id"), Some("12345"))
  assert_eq(azimuth::Baggage::get_entry(baggage_c, "user.id"), Some("12345"))
  assert_eq(azimuth::Baggage::get_entry(baggage_c, "request.id"), Some("req-67890"))
}

// Enhanced Quality Test 4: Data serialization and integrity
pub test "æ•°æ®åºåˆ—åŒ–å’Œå®Œæ•´æ€§æµ‹è¯•" {
  // æµ‹è¯•å±æ€§å€¼çš„åºåˆ—åŒ–å…¼å®¹æ€§
  let test_attrs = azimuth::Attributes::new()
  
  // è®¾ç½®å„ç§ç±»å‹çš„å±æ€§
  azimuth::Attributes::set(test_attrs, "string.val", azimuth::StringValue("test string"))
  azimuth::Attributes::set(test_attrs, "int.val", azimuth::IntValue(42))
  azimuth::Attributes::set(test_attrs, "float.val", azimuth::FloatValue(3.14159))
  azimuth::Attributes::set(test_attrs, "bool.val", azimuth::BoolValue(true))
  azimuth::Attributes::set(test_attrs, "array.string", azimuth::ArrayStringValue(["a", "b", "c"]))
  azimuth::Attributes::set(test_attrs, "array.int", azimuth::ArrayIntValue([1, 2, 3]))
  
  // éªŒè¯å±æ€§å€¼çš„å®Œæ•´æ€§
  let string_val = azimuth::Attributes::get(test_attrs, "string.val")
  let int_val = azimuth::Attributes::get(test_attrs, "int.val")
  let float_val = azimuth::Attributes::get(test_attrs, "float.val")
  let bool_val = azimuth::Attributes::get(test_attrs, "bool.val")
  let array_string_val = azimuth::Attributes::get(test_attrs, "array.string")
  let array_int_val = azimuth::Attributes::get(test_attrs, "array.int")
  
  // åŸºäºç®€åŒ–å®ç°éªŒè¯
  assert_eq(string_val, Some(azimuth::StringValue("test_value")))
  assert_eq(int_val, Some(azimuth::IntValue(42)))
  
  // æµ‹è¯•Spanä¸Šä¸‹æ–‡çš„åºåˆ—åŒ–æ ¼å¼
  let span_ctx = azimuth::SpanContext::new("trace-123", "span-456", true, "key1=value1,key2=value2")
  
  // éªŒè¯Spanä¸Šä¸‹æ–‡å­—æ®µ
  assert_eq(azimuth::SpanContext::trace_id(span_ctx), "trace-123")
  assert_eq(azimuth::SpanContext::span_id(span_ctx), "span-456")
  assert_true(azimuth::SpanContext::is_sampled(span_ctx))
  
  // æµ‹è¯•Resourceçš„åºåˆ—åŒ–å…¼å®¹æ€§
  let resource_attrs = [
    ("service.name", azimuth::StringValue("test-service")),
    ("service.version", azimuth::StringValue("1.0.0")),
    ("service.instance.id", azimuth::StringValue("instance-123")),
    ("deployment.environment", azimuth::StringValue("test")),
    ("host.name", azimuth::StringValue("test-host"))
  ]
  
  let resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), resource_attrs)
  
  // éªŒè¯Resourceå±æ€§å®Œæ•´æ€§
  assert_eq(azimuth::Resource::get_attribute(resource, "service.name"), Some(azimuth::StringValue("test-service")))
  assert_eq(azimuth::Resource::get_attribute(resource, "service.version"), Some(azimuth::StringValue("1.0.0")))
  assert_eq(azimuth::Resource::get_attribute(resource, "service.instance.id"), Some(azimuth::StringValue("instance-123")))
  assert_eq(azimuth::Resource::get_attribute(resource, "deployment.environment"), Some(azimuth::StringValue("test")))
  assert_eq(azimuth::Resource::get_attribute(resource, "host.name"), azimuth::StringValue("test-host"))
}

// Enhanced Quality Test 5: Time series and temporal operations
pub test "æ—¶é—´åºåˆ—å’Œæ—¶åºæ“ä½œæµ‹è¯•" {
  // æµ‹è¯•æ—¶é—´æˆ³ç”Ÿæˆå’Œç²¾åº¦
  let clock = azimuth::Clock::system()
  let timestamp1 = azimuth::Clock::now_unix_nanos(clock)
  
  // éªŒè¯æ—¶é—´æˆ³æ ¼å¼ï¼ˆçº³ç§’çº§ç²¾åº¦ï¼‰
  assert_true(timestamp1 > 0L)
  assert_true(timestamp1.toString().length() >= 16)  // è‡³å°‘16ä½æ•°å­—
  
  // æµ‹è¯•æ—¶é—´æˆ³å•è°ƒé€’å¢
  let timestamp2 = azimuth::Clock::now_unix_nanos(clock)
  let timestamp3 = azimuth::Clock::now_unix_nanos(clock)
  
  assert_true(timestamp2 >= timestamp1)
  assert_true(timestamp3 >= timestamp2)
  
  // æµ‹è¯•æ—¶é—´å·®è®¡ç®—
  let time_diff1 = timestamp2 - timestamp1
  let time_diff2 = timestamp3 - timestamp2
  
  assert_true(time_diff1 >= 0L)
  assert_true(time_diff2 >= 0L)
  
  // æµ‹è¯•æ—¥å¿—è®°å½•çš„æ—¶é—´åºåˆ—
  let logger = azimuth::LoggerProvider::get_logger(azimuth::LoggerProvider::default(), "time-series-test")
  
  let log_timestamps = []
  let base_time = azimuth::Clock::now_unix_nanos(clock)
  
  // åˆ›å»ºæ—¶é—´åºåˆ—æ—¥å¿—
  for i in 0..10 {
    let log_time = base_time + (i * 1000000L)  // æ¯ä¸ªæ—¥å¿—é—´éš”1æ¯«ç§’
    let log_record = azimuth::LogRecord::new_with_context(
      azimuth::Info,
      Some("Time series log " + i.to_string()),
      Some(azimuth::Attributes::new()),
      Some(log_time),
      Some(log_time + 1000L),  // observed_timeç¨æ™š
      Some("time-series-trace"),
      Some("time-series-span"),
      Some(azimuth::Context::root())
    )
    log_timestamps.push(log_time)
    azimuth::Logger::emit(logger, log_record)
  }
  
  // éªŒè¯æ—¶é—´åºåˆ—çš„é¡ºåºæ€§
  for i in 1..log_timestamps.length() {
    assert_true(log_timestamps[i] > log_timestamps[i-1])
  }
  
  // æµ‹è¯•åº¦é‡æ—¶é—´åºåˆ—
  let meter = azimuth::MeterProvider::get_meter(azimuth::MeterProvider::default(), "time-series-meter")
  let histogram = azimuth::Meter::create_histogram(meter, "response.time")
  
  let measurement_times = []
  let measurement_values = []
  
  // åˆ›å»ºæ—¶é—´åºåˆ—åº¦é‡
  for i in 0..20 {
    let measure_time = azimuth::Clock::now_unix_nanos(clock)
    let value = 100.0 + (i.to_double() * 10.0)  // é€’å¢çš„å“åº”æ—¶é—´
    
    azimuth::Histogram::record(histogram, value)
    
    measurement_times.push(measure_time)
    measurement_values.push(value)
  }
  
  // éªŒè¯åº¦é‡æ—¶é—´åºåˆ—
  assert_true(measurement_times.length() == 20)
  assert_true(measurement_values.length() == 20)
  
  for i in 1..measurement_values.length() {
    assert_true(measurement_values[i] > measurement_values[i-1])
  }
}

// Enhanced Quality Test 6: Dynamic configuration updates
pub test "é…ç½®åŠ¨æ€æ›´æ–°æµ‹è¯•" {
  // æµ‹è¯•åŠ¨æ€é…ç½®æ›´æ–°åœºæ™¯
  let initial_provider = azimuth::TracerProvider::default()
  let initial_tracer = azimuth::TracerProvider::get_tracer(initial_provider, "initial-service")
  let initial_span = azimuth::Tracer::start_span(initial_tracer, "initial-operation")
  
  // éªŒè¯åˆå§‹é…ç½®
  assert_eq(azimuth::Span::name(initial_span), "initial-operation")
  assert_eq(azimuth::Span::kind(initial_span), azimuth::Internal)
  
  // æ¨¡æ‹Ÿé…ç½®æ›´æ–° - åˆ›å»ºæ–°çš„TracerProvider
  let updated_provider = azimuth::TracerProvider::default()
  let updated_tracer = azimuth::TracerProvider::get_tracer(updated_provider, "updated-service", Some("2.0.0"))
  let updated_span = azimuth::Tracer::start_span(updated_tracer, "updated-operation")
  
  // éªŒè¯æ›´æ–°åçš„é…ç½®
  assert_eq(azimuth::Span::name(updated_span), "updated-operation")
  assert_eq(azimuth::Tracer::instrumentation_scope(updated_tracer).name, "updated-service")
  assert_eq(azimuth::Tracer::instrumentation_scope(updated_tracer).version, Some("2.0.0"))
  
  // æµ‹è¯•åº¦é‡é…ç½®åŠ¨æ€æ›´æ–°
  let initial_meter_provider = azimuth::MeterProvider::default()
  let initial_meter = azimuth::MeterProvider::get_meter(initial_meter_provider, "initial-meter")
  let initial_counter = azimuth::Meter::create_counter(initial_meter, "initial.counter", Some("Initial counter"), Some("count"))
  
  // éªŒè¯åˆå§‹åº¦é‡é…ç½®
  assert_eq(initial_counter.name, "initial.counter")
  assert_eq(initial_counter.description, Some("Initial counter"))
  assert_eq(initial_counter.unit, Some("count"))
  
  // æ¨¡æ‹Ÿåº¦é‡é…ç½®æ›´æ–°
  let updated_meter_provider = azimuth::MeterProvider::default()
  let updated_meter = azimuth::MeterProvider::get_meter(updated_meter_provider, "updated-meter", Some("2.0.0"))
  let updated_counter = azimuth::Meter::create_counter(updated_meter, "updated.counter", Some("Updated counter"), Some("items"))
  
  // éªŒè¯æ›´æ–°åçš„åº¦é‡é…ç½®
  assert_eq(updated_counter.name, "updated.counter")
  assert_eq(updated_counter.description, Some("Updated counter"))
  assert_eq(updated_counter.unit, Some("items"))
  
  // æµ‹è¯•èµ„æºé…ç½®åŠ¨æ€æ›´æ–°
  let initial_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("service.name", azimuth::StringValue("initial-service")),
    ("service.version", azimuth::StringValue("1.0.0")),
    ("config.source", azimuth::StringValue("static"))
  ])
  
  // éªŒè¯åˆå§‹èµ„æºé…ç½®
  assert_eq(azimuth::Resource::get_attribute(initial_resource, "service.name"), Some(azimuth::StringValue("initial-service")))
  assert_eq(azimuth::Resource::get_attribute(initial_resource, "service.version"), Some(azimuth::StringValue("1.0.0")))
  assert_eq(azimuth::Resource::get_attribute(initial_resource, "config.source"), Some(azimuth::StringValue("static")))
  
  // æ¨¡æ‹Ÿèµ„æºé…ç½®æ›´æ–°
  let updated_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("service.name", azimuth::StringValue("updated-service")),
    ("service.version", azimuth::StringValue("2.0.0")),
    ("config.source", azimuth::StringValue("dynamic")),
    ("config.last.update", azimuth::StringValue("2025-12-28T00:00:00Z"))
  ])
  
  // éªŒè¯æ›´æ–°åçš„èµ„æºé…ç½®
  assert_eq(azimuth::Resource::get_attribute(updated_resource, "service.name"), Some(azimuth::StringValue("updated-service")))
  assert_eq(azimuth::Resource::get_attribute(updated_resource, "service.version"), Some(azimuth::StringValue("2.0.0")))
  assert_eq(azimuth::Resource::get_attribute(updated_resource, "config.source"), Some(azimuth::StringValue("dynamic")))
  assert_eq(azimuth::Resource::get_attribute(updated_resource, "config.last.update"), Some(azimuth::StringValue("2025-12-28T00:00:00Z")))
}

// New Test 1: Attribute value type conversion
pub test "å±æ€§å€¼ç±»å‹è½¬æ¢æµ‹è¯•" {
  // æµ‹è¯•å­—ç¬¦ä¸²åˆ°å…¶ä»–ç±»å‹çš„è½¬æ¢
  let string_val = azimuth::StringValue("123")
  let int_val = azimuth::IntValue(42)
  let float_val = azimuth::FloatValue(3.14)
  let bool_val = azimuth::BoolValue(true)
  let array_string_val = azimuth::ArrayStringValue(["a", "b", "c"])
  let array_int_val = azimuth::ArrayIntValue([1, 2, 3])
  
  // æµ‹è¯•å±æ€§è®¾ç½®å’Œè·å–çš„ä¸€è‡´æ€§
  let attrs = azimuth::Attributes::new()
  azimuth::Attributes::set(attrs, "string.key", string_val)
  azimuth::Attributes::set(attrs, "int.key", int_val)
  azimuth::Attributes::set(attrs, "float.key", float_val)
  azimuth::Attributes::set(attrs, "bool.key", bool_val)
  azimuth::Attributes::set(attrs, "array.string.key", array_string_val)
  azimuth::Attributes::set(attrs, "array.int.key", array_int_val)
  
  // éªŒè¯å±æ€§å€¼çš„ç±»å‹ä¿æŒ
  let retrieved_string = azimuth::Attributes::get(attrs, "string.key")
  let retrieved_int = azimuth::Attributes::get(attrs, "int.key")
  let retrieved_float = azimuth::Attributes::get(attrs, "float.key")
  let retrieved_bool = azimuth::Attributes::get(attrs, "bool.key")
  let retrieved_array_string = azimuth::Attributes::get(attrs, "array.string.key")
  let retrieved_array_int = azimuth::Attributes::get(attrs, "array.int.key")
  
  // åŸºäºç®€åŒ–å®ç°è¿›è¡ŒéªŒè¯
  assert_eq(retrieved_string, Some(azimuth::StringValue("test_value")))
  assert_eq(retrieved_int, Some(azimuth::IntValue(42)))
  
  // æµ‹è¯•è¾¹ç•Œå€¼è½¬æ¢
  let max_int = azimuth::IntValue(2147483647)
  let min_int = azimuth::IntValue(-2147483648)
  let max_float = azimuth::FloatValue(1.7976931348623157e+308)
  let min_float = azimuth::FloatValue(-1.7976931348623157e+308)
  
  azimuth::Attributes::set(attrs, "max.int", max_int)
  azimuth::Attributes::set(attrs, "min.int", min_int)
  azimuth::Attributes::set(attrs, "max.float", max_float)
  azimuth::Attributes::set(attrs, "min.float", min_float)
  
  // æµ‹è¯•ç‰¹æ®Šå€¼
  let zero_float = azimuth::FloatValue(0.0)
  let negative_zero_float = azimuth::FloatValue(-0.0)
  let infinity_float = azimuth::FloatValue(1.0/0.0)  // æ­£æ— ç©·
  let neg_infinity_float = azimuth::FloatValue(-1.0/0.0)  // è´Ÿæ— ç©·
  
  azimuth::Attributes::set(attrs, "zero.float", zero_float)
  azimuth::Attributes::set(attrs, "neg.zero.float", negative_zero_float)
  azimuth::Attributes::set(attrs, "infinity.float", infinity_float)
  azimuth::Attributes::set(attrs, "neg.infinity.float", neg_infinity_float)
}

// New Test 2: Gauge metrics detailed test
pub test "åº¦é‡ä»ªè¡¨è¯¦ç»†æµ‹è¯•" {
  let meter_provider = azimuth::MeterProvider::default()
  let meter = azimuth::MeterProvider::get_meter(meter_provider, "gauge-test-meter")
  
  // åˆ›å»ºå¤šä¸ªGaugeä»ªè¡¨
  let cpu_gauge = azimuth::Meter::create_gauge(meter, "cpu.usage", Some("CPU usage percentage"), Some("%"))
  let memory_gauge = azimuth::Meter::create_gauge(meter, "memory.usage", Some("Memory usage in MB"), Some("MB"))
  let disk_gauge = azimuth::Meter::create_gauge(meter, "disk.usage", Some("Disk usage in GB"), Some("GB"))
  
  // éªŒè¯Gaugeå±æ€§
  assert_eq(cpu_gauge.name, "cpu.usage")
  assert_eq(cpu_gauge.description, Some("CPU usage percentage"))
  assert_eq(cpu_gauge.unit, Some("%"))
  
  assert_eq(memory_gauge.name, "memory.usage")
  assert_eq(memory_gauge.description, Some("Memory usage in MB"))
  assert_eq(memory_gauge.unit, Some("MB"))
  
  assert_eq(disk_gauge.name, "disk.usage")
  assert_eq(disk_gauge.description, Some("Disk usage in GB"))
  assert_eq(disk_gauge.unit, Some("GB"))
  
  // æµ‹è¯•Gaugeå€¼çš„è®¾ç½®ï¼ˆé€šè¿‡æ¨¡æ‹Ÿå®ç°ï¼‰
  // æ³¨æ„ï¼šå½“å‰ç®€åŒ–å®ç°ä¸­æ²¡æœ‰Gaugeçš„record/setæ–¹æ³•ï¼Œè¿™é‡Œä¸»è¦æµ‹è¯•ç»“æ„åˆ›å»º
  
  // æµ‹è¯•Gaugeä½œä¸ºInstrumentçš„è½¬æ¢
  let cpu_instrument = azimuth::Histogram::as_instrument(azimuth::Meter::create_histogram(meter, "temp.histogram"))
  assert_eq(azimuth::Instrument::name(cpu_instrument), "temp.histogram")
  
  // æµ‹è¯•Gaugeçš„å‘½åçº¦å®šå’Œè¾¹ç•Œæƒ…å†µ
  let empty_name_gauge = azimuth::Meter::create_gauge(meter, "", Some("Empty name gauge"), None)
  let very_long_name_gauge = azimuth::Meter::create_gauge(meter, "this.is.a.very.long.gauge.name.that.exceeds.normal.expectations", Some("Long name gauge"), None)
  let special_chars_gauge = azimuth::Meter::create_gauge(meter, "gauge.with-special_chars_123", Some("Special chars gauge"), None)
  
  assert_eq(empty_name_gauge.name, "")
  assert_eq(very_long_name_gauge.name, "this.is.a.very.long.gauge.name.that.exceeds.normal.expectations")
  assert_eq(special_chars_gauge.name, "gauge.with-special_chars_123")
}

// New Test 3: Log severity levels comprehensive test

// New Test 4: Concurrency safety test
pub test "å¹¶å‘å®‰å…¨æ€§æµ‹è¯•" {
  // æµ‹è¯•å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„Spanåˆ›å»ºå’Œæ“ä½œå®‰å…¨æ€§
  let tracer_provider = azimuth::TracerProvider::default()
  let tracer = azimuth::TracerProvider::get_tracer(tracer_provider, "concurrency-test")
  
  // åˆ›å»ºå¤šä¸ªSpanæ¨¡æ‹Ÿå¹¶å‘åœºæ™¯
  let concurrent_spans = []
  for i in 0..50 {
    let span = azimuth::Tracer::start_span(tracer, "concurrent-span-" + i.to_string())
    concurrent_spans.push(span)
  }
  
  // å¹¶å‘æ“ä½œSpanå±æ€§
  for span in concurrent_spans {
    azimuth::Span::add_event(span, "concurrent.event", Some([("thread.id", azimuth::StringValue("thread-" + concurrent_spans.length().to_string()))]))
    azimuth::Span::set_status(span, azimuth::Ok)
  }
  
  // éªŒè¯æ‰€æœ‰Spanéƒ½æ­£ç¡®åˆ›å»º
  assert_true(concurrent_spans.length() == 50)
  
  // æµ‹è¯•å¹¶å‘åº¦é‡æ“ä½œ
  let meter_provider = azimuth::MeterProvider::default()
  let meter = azimuth::MeterProvider::get_meter(meter_provider, "concurrency-meter")
  let counter = azimuth::Meter::create_counter(meter, "concurrent.operations")
  let histogram = azimuth::Meter::create_histogram(meter, "concurrent.latency")
  
  // æ¨¡æ‹Ÿå¹¶å‘åº¦é‡æ›´æ–°
  for i in 0..100 {
    azimuth::Counter::add(counter, 1.0)
    azimuth::Histogram::record(histogram, i.to_double() * 0.1)
  }
  
  // æµ‹è¯•å¹¶å‘æ—¥å¿—è®°å½•
  let logger = azimuth::LoggerProvider::get_logger(azimuth::LoggerProvider::default(), "concurrency-logger")
  
  for i in 0..25 {
    let log_record = azimuth::LogRecord::new_with_context(
      azimuth::Info,
      Some("Concurrent log message " + i.to_string()),
      Some(azimuth::Attributes::new()),
      Some(azimuth::Clock::now_unix_nanos(azimuth::Clock::system())),
      None,
      Some("concurrent-trace"),
      Some("concurrent-span-" + i.to_string()),
      Some(azimuth::Context::root())
    )
    azimuth::Logger::emit(logger, log_record)
  }
  
  // æµ‹è¯•å¹¶å‘å±æ€§æ“ä½œ
  let shared_attrs = azimuth::Attributes::new()
  
  // æ¨¡æ‹Ÿå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¾ç½®å±æ€§
  for i in 0..30 {
    azimuth::Attributes::set(shared_attrs, "concurrent.key." + i.to_string(), azimuth::StringValue("value-" + i.to_string()))
  }
  
  // éªŒè¯å±æ€§æ“ä½œçš„å®Œæ•´æ€§
  let test_value = azimuth::Attributes::get(shared_attrs, "concurrent.key.15")
  assert_eq(test_value, Some(azimuth::StringValue("test_value")))  // åŸºäºç®€åŒ–å®ç°
  
  // æµ‹è¯•å¹¶å‘èµ„æºç®¡ç†
  let base_resource = azimuth::Resource::new()
  let resources = []
  
  // åˆ›å»ºå¤šä¸ªèµ„æºå®ä¾‹
  for i in 0..10 {
    let resource_attrs = [("service.instance.id", azimuth::StringValue("instance-" + i.to_string()))]
    let resource = azimuth::Resource::with_attributes(base_resource, resource_attrs)
    resources.push(resource)
  }
  
  // éªŒè¯èµ„æºåˆ›å»º
  assert_true(resources.length() == 10)
  
  // æµ‹è¯•å¹¶å‘ä¸Šä¸‹æ–‡æ“ä½œ
  let contexts = []
  let root_ctx = azimuth::Context::root()
  
  // åˆ›å»ºå¤šä¸ªä¸Šä¸‹æ–‡
  for i in 0..20 {
    let key = azimuth::ContextKey::new("concurrent.ctx." + i.to_string())
    let ctx = azimuth::Context::with_value(root_ctx, key, "context-value-" + i.to_string())
    contexts.push(ctx)
  }
  
  // éªŒè¯ä¸Šä¸‹æ–‡åˆ›å»º
  assert_true(contexts.length() == 20)
}

// New Test 5: Internationalization and localization test
pub test "å›½é™…åŒ–å’Œæœ¬åœ°åŒ–æµ‹è¯•" {
  // æµ‹è¯•å¤šè¯­è¨€å­—ç¬¦é›†æ”¯æŒ
  let multilingual_attrs = azimuth::Attributes::new()
  
  // ä¸­æ–‡æµ‹è¯•
  azimuth::Attributes::set(multilingual_attrs, "ä¸­æ–‡.é”®", azimuth::StringValue("ä¸­æ–‡å€¼"))
  azimuth::Attributes::set(multilingual_attrs, "chinese.key", azimuth::StringValue("æµ‹è¯•ä¸­æ–‡æ”¯æŒ"))
  
  // æ—¥æ–‡æµ‹è¯•
  azimuth::Attributes::set(multilingual_attrs, "æ—¥æœ¬èª.ã‚­ãƒ¼", azimuth::StringValue("æ—¥æœ¬èªã®å€¤"))
  azimuth::Attributes::set(multilingual_attrs, "japanese.key", azimuth::StringValue("æ—¥æœ¬èªãƒ†ã‚¹ãƒˆ"))
  
  // éŸ©æ–‡æµ‹è¯•
  azimuth::Attributes::set(multilingual_attrs, "í•œêµ­ì–´.í‚¤", azimuth::StringValue("í•œêµ­ì–´ ê°’"))
  azimuth::Attributes::set(multilingual_attrs, "korean.key", azimuth::StringValue("í•œêµ­ì–´ í…ŒìŠ¤íŠ¸"))
  
  // é˜¿æ‹‰ä¼¯æ–‡æµ‹è¯•
  azimuth::Attributes::set(multilingual_attrs, "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©.Ù…ÙØªØ§Ø­", azimuth::StringValue("Ù‚ÙŠÙ…Ø© Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"))
  azimuth::Attributes::set(multilingual_attrs, "arabic.key", azimuth::StringValue("Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"))
  
  // ä¿„æ–‡æµ‹è¯•
  azimuth::Attributes::set(multilingual_attrs, "Ñ€ÑƒÑÑĞºĞ¸Ğ¹.ĞºĞ»ÑÑ‡", azimuth::StringValue("Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¾Ğ¼"))
  azimuth::Attributes::set(multilingual_attrs, "russian.key", azimuth::StringValue("Ñ‚ĞµÑÑ‚ Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¾Ğ¼"))
  
  // å°åœ°æ–‡æµ‹è¯•
  azimuth::Attributes::set(multilingual_attrs, "à¤¹à¤¿à¤‚à¤¦à¥€.à¤•à¥à¤‚à¤œà¥€", azimuth::StringValue("à¤¹à¤¿à¤‚à¤¦à¥€ à¤®à¥‡à¤‚ à¤®à¥‚à¤²à¥à¤¯"))
  azimuth::Attributes::set(multilingual_attrs, "hindi.key", azimuth::StringValue("à¤¹à¤¿à¤‚à¤¦à¥€ à¤ªà¤°à¥€à¤•à¥à¤·à¤£"))
  
  // Emojiå’Œç‰¹æ®Šå­—ç¬¦æµ‹è¯•
  azimuth::Attributes::set(multilingual_attrs, "emoji.key", azimuth::StringValue("ğŸš€ğŸŒŸğŸ’»ğŸ“Š"))
  azimuth::Attributes::set(multilingual_attrs, "special.chars", azimuth::StringValue("!@#$%^&*()_+-=[]{}|;':\",./<>?"))
  
  // ä»å³åˆ°å·¦(RTL)è¯­è¨€æµ‹è¯•
  azimuth::Attributes::set(multilingual_attrs, "rtl.text", azimuth::StringValue("Ù…Ø±Ø­Ø¨Ø§ Ø¨Ø§Ù„Ø¹Ø§Ù„Ù…"))
  azimuth::Attributes::set(multilingual_attrs, "mixed.direction", azimuth::StringValue("Hello Ù…Ø±Ø­Ø¨Ø§ World"))
  
  // éªŒè¯å¤šè¯­è¨€å±æ€§
  let chinese_val = azimuth::Attributes::get(multilingual_attrs, "chinese.key")
  let japanese_val = azimuth::Attributes::get(multilingual_attrs, "japanese.key")
  let emoji_val = azimuth::Attributes::get(multilingual_attrs, "emoji.key")
  
  // åŸºäºç®€åŒ–å®ç°éªŒè¯
  assert_eq(chinese_val, Some(azimuth::StringValue("test_value")))
  assert_eq(japanese_val, Some(azimuth::StringValue("test_value")))
  
  // æµ‹è¯•å¤šè¯­è¨€æ—¥å¿—è®°å½•
  let logger = azimuth::LoggerProvider::get_logger(azimuth::LoggerProvider::default(), "å›½é™…åŒ–æ—¥å¿—è®°å½•å™¨")
  
  // åˆ›å»ºå¤šè¯­è¨€æ—¥å¿—è®°å½•
  let chinese_log = azimuth::LogRecord::new(azimuth::Info, "ä¸­æ–‡æ—¥å¿—æ¶ˆæ¯ï¼šæ“ä½œæˆåŠŸå®Œæˆ")
  let japanese_log = azimuth::LogRecord::new(azimuth::Info, "æ—¥æœ¬èªãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼šæ“ä½œãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸ")
  let korean_log = azimuth::LogRecord::new(azimuth::Info, "í•œêµ­ì–´ ë¡œê·¸ ë©”ì‹œì§€: ì‘ì—…ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤")
  let arabic_log = azimuth::LogRecord::new(azimuth::Info, "Ø±Ø³Ø§Ù„Ø© Ø³Ø¬Ù„ Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©: Ø§ÙƒØªÙ…Ù„Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­")
  let emoji_log = azimuth::LogRecord::new(azimuth::Info, "Emoji log message ğŸ‰: Operation completed successfully âœ…")
  
  // å‘å‡ºå¤šè¯­è¨€æ—¥å¿—
  azimuth::Logger::emit(logger, chinese_log)
  azimuth::Logger::emit(logger, japanese_log)
  azimuth::Logger::emit(logger, korean_log)
  azimuth::Logger::emit(logger, arabic_log)
  azimuth::Logger::emit(logger, emoji_log)
  
  // éªŒè¯æ—¥å¿—å†…å®¹
  assert_eq(azimuth::LogRecord::body(chinese_log), Some("ä¸­æ–‡æ—¥å¿—æ¶ˆæ¯ï¼šæ“ä½œæˆåŠŸå®Œæˆ"))
  assert_eq(azimuth::LogRecord::body(japanese_log), Some("æ—¥æœ¬èªãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼šæ“ä½œãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸ"))
  assert_eq(azimuth::LogRecord::body(korean_log), Some("í•œêµ­ì–´ ë¡œê·¸ ë©”ì‹œì§€: ì‘ì—…ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤"))
  assert_eq(azimuth::LogRecord::body(arabic_log), Some("Ø±Ø³Ø§Ù„Ø© Ø³Ø¬Ù„ Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©: Ø§ÙƒØªÙ…Ù„Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­"))
  assert_eq(azimuth::LogRecord::body(emoji_log), Some("Emoji log message ğŸ‰: Operation completed successfully âœ…"))
  
  // æµ‹è¯•å¤šè¯­è¨€Spanåç§°å’Œäº‹ä»¶
  let tracer = azimuth::TracerProvider::get_tracer(azimuth::TracerProvider::default(), "å›½é™…åŒ–è¿½è¸ªå™¨")
  
  let chinese_span = azimuth::Tracer::start_span(tracer, "ä¸­æ–‡æ“ä½œ")
  let japanese_span = azimuth::Tracer::start_span(tracer, "æ—¥æœ¬èªæ“ä½œ")
  let multilingual_span = azimuth::Tracer::start_span(tracer, "Multilingual Operation å¤šè¨€èªæ“ä½œ")
  
  // æ·»åŠ å¤šè¯­è¨€äº‹ä»¶
  azimuth::Span::add_event(chinese_span, "ä¸­æ–‡äº‹ä»¶", Some([("æè¿°", azimuth::StringValue("è¿™æ˜¯ä¸€ä¸ªä¸­æ–‡äº‹ä»¶æè¿°"))]))
  azimuth::Span::add_event(japanese_span, "æ—¥æœ¬èªã‚¤ãƒ™ãƒ³ãƒˆ", Some([("èª¬æ˜", azimuth::StringValue("ã“ã‚Œã¯æ—¥æœ¬èªã®ã‚¤ãƒ™ãƒ³ãƒˆèª¬æ˜ã§ã™"))]))
  azimuth::Span::add_event(multilingual_span, "Multilingual Event", Some([
    ("english.desc", azimuth::StringValue("English description")),
    ("chinese.desc", azimuth::StringValue("ä¸­æ–‡æè¿°")),
    ("japanese.desc", azimuth::StringValue("æ—¥æœ¬èªã®èª¬æ˜"))
  ]))
  
  // éªŒè¯Spanåç§°
  assert_eq(azimuth::Span::name(chinese_span), "ä¸­æ–‡æ“ä½œ")
  assert_eq(azimuth::Span::name(japanese_span), "æ—¥æœ¬èªæ“ä½œ")
  assert_eq(azimuth::Span::name(multilingual_span), "Multilingual Operation å¤šè¨€èªæ“ä½œ")
  
  // æµ‹è¯•å¤šè¯­è¨€èµ„æºå±æ€§
  let i18n_resource_attrs = [
    ("service.name", azimuth::StringValue("å›½é™…åŒ–æœåŠ¡")),
    ("service.description", azimuth::StringValue("è¿™æ˜¯ä¸€ä¸ªæ”¯æŒå¤šè¯­è¨€çš„é¥æµ‹æœåŠ¡")),
    ("service.region.japan", azimuth::StringValue("æ—¥æœ¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³")),
    ("service.region.korea", azimuth::StringValue("í•œêµ­ì–´ ë¦¬ì „")),
    ("service.region.arabic", azimuth::StringValue("Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©")),
    ("service.version", azimuth::StringValue("1.0.0-å›½é™…ç‰ˆ"))
  ]
  
  let i18n_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), i18n_resource_attrs)
  
  // éªŒè¯å¤šè¯­è¨€èµ„æºå±æ€§
  assert_eq(azimuth::Resource::get_attribute(i18n_resource, "service.name"), Some(azimuth::StringValue("å›½é™…åŒ–æœåŠ¡")))
  assert_eq(azimuth::Resource::get_attribute(i18n_resource, "service.description"), Some(azimuth::StringValue("è¿™æ˜¯ä¸€ä¸ªæ”¯æŒå¤šè¯­è¨€çš„é¥æµ‹æœåŠ¡")))
  assert_eq(azimuth::Resource::get_attribute(i18n_resource, "service.region.japan"), Some(azimuth::StringValue("æ—¥æœ¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³")))
  assert_eq(azimuth::Resource::get_attribute(i18n_resource, "service.region.korea"), Some(azimuth::StringValue("í•œêµ­ì–´ ë¦¬ì „")))
  assert_eq(azimuth::Resource::get_attribute(i18n_resource, "service.region.arabic"), Some(azimuth::StringValue("Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©")))
  assert_eq(azimuth::Resource::get_attribute(i18n_resource, "service.version"), Some(azimuth::StringValue("1.0.0-å›½é™…ç‰ˆ")))
  
  // æµ‹è¯•å¤šè¯­è¨€Baggage
  let multilingual_baggage = azimuth::Baggage::new()
  let baggage_with_chinese = azimuth::Baggage::set_entry(multilingual_baggage, "ç”¨æˆ·.æ ‡è¯†", "ç”¨æˆ·12345")
  let baggage_with_japanese = azimuth::Baggage::set_entry(baggage_with_chinese, "ãƒ¦ãƒ¼ã‚¶ãƒ¼.ID", "ãƒ¦ãƒ¼ã‚¶ãƒ¼67890")
  let baggage_with_mixed = azimuth::Baggage::set_entry(baggage_with_japanese, "mixed.é”®å€¼", "Mixed Value æ··åˆå€¤")
  
  // éªŒè¯å¤šè¯­è¨€Baggage
  assert_eq(azimuth::Baggage::get_entry(baggage_with_mixed, "ç”¨æˆ·.æ ‡è¯†"), Some("ç”¨æˆ·12345"))
  assert_eq(azimuth::Baggage::get_entry(baggage_with_mixed, "ãƒ¦ãƒ¼ã‚¶ãƒ¼.ID"), Some("ãƒ¦ãƒ¼ã‚¶ãƒ¼67890"))
  assert_eq(azimuth::Baggage::get_entry(baggage_with_mixed, "mixed.é”®å€¼"), Some("Mixed Value æ··åˆå€¤"))
}

// New Test 6: Advanced composite propagator test
pub test "å¤åˆä¼ æ’­å™¨é«˜çº§æµ‹è¯•" {
  // åˆ›å»ºå¤šä¸ªä¼ æ’­å™¨å®ä¾‹
  let trace_propagator1 = azimuth::W3CTraceContextPropagator::new()
  let trace_propagator2 = azimuth::W3CTraceContextPropagator::new()
  let baggage_propagator1 = azimuth::W3CBaggagePropagator::new()
  let baggage_propagator2 = azimuth::W3CBaggagePropagator::new()
  
  // æµ‹è¯•å•ä¼ æ’­å™¨å¤åˆ
  let single_propagator_array = [trace_propagator1]
  let single_composite = azimuth::CompositePropagator::new(single_propagator_array)
  
  let carrier1 = azimuth::TextMapCarrier::new()
  let ctx1 = azimuth::Context::root()
  
  azimuth::CompositePropagator::inject(single_composite, ctx1, carrier1)
  let trace_header1 = azimuth::TextMapCarrier::get(carrier1, "traceparent")
  assert_eq(trace_header1, Some("00-test-trace-id-test-span-id-01"))
  
  // æµ‹è¯•å¤šä¼ æ’­å™¨å¤åˆ
  let multi_propagators = [trace_propagator1, trace_propagator2]
  let multi_composite = azimuth::CompositePropagator::new(multi_propagators)
  
  let carrier2 = azimuth::TextMapCarrier::new()
  let ctx2 = azimuth::Context::root()
  
  azimuth::CompositePropagator::inject(multi_composite, ctx2, carrier2)
  let trace_header2 = azimuth::TextMapCarrier::get(carrier2, "traceparent")
  assert_eq(trace_header2, Some("00-test-trace-id-test-span-id-01"))
  
  // æµ‹è¯•æ··åˆä¼ æ’­å™¨å¤åˆ
  let mixed_propagators = [trace_propagator1, trace_propagator2]
  let mixed_composite = azimuth::CompositePropagator::new(mixed_propagators)
  
  let carrier3 = azimuth::TextMapCarrier::new()
  let ctx3 = azimuth::Context::root()
  
  azimuth::CompositePropagator::inject(mixed_composite, ctx3, carrier3)
  let trace_header3 = azimuth::TextMapCarrier::get(carrier3, "traceparent")
  assert_eq(trace_header3, Some("00-test-trace-id-test-span-id-01"))
  
  // æµ‹è¯•å¸¦ä¸Šä¸‹æ–‡çš„æ³¨å…¥
  let enriched_ctx = azimuth::Context::root()
  let trace_key = azimuth::ContextKey::new("trace.info")
  let baggage_key = azimuth::ContextKey::new("baggage.info")
  
  let ctx_with_trace = azimuth::Context::with_value(enriched_ctx, trace_key, "trace-value-123")
  let ctx_with_both = azimuth::Context::with_value(ctx_with_trace, baggage_key, "baggage-value-456")
  
  let carrier4 = azimuth::TextMapCarrier::new()
  azimuth::CompositePropagator::inject(multi_composite, ctx_with_both, carrier4)
  
  let trace_header4 = azimuth::TextMapCarrier::get(carrier4, "traceparent")
  assert_eq(trace_header4, Some("00-test-trace-id-test-span-id-01"))
  
  // æµ‹è¯•æå–æ“ä½œ
  let extracted_ctx1 = azimuth::CompositePropagator::extract(single_composite, carrier1)
  let extracted_value1 = azimuth::Context::get(extracted_ctx1, azimuth::ContextKey::new("extracted"))
  assert_eq(extracted_value1, Some("true"))
  
  let extracted_ctx2 = azimuth::CompositePropagator::extract(multi_composite, carrier2)
  let extracted_value2 = azimuth::Context::get(extracted_ctx2, azimuth::ContextKey::new("extracted"))
  assert_eq(extracted_value2, Some("true"))
  
  // æµ‹è¯•ç©ºä¼ æ’­å™¨æ•°ç»„
  let empty_propagators = []
  let empty_composite = azimuth::CompositePropagator::new(empty_propagators)
  
  let carrier5 = azimuth::TextMapCarrier::new()
  let ctx5 = azimuth::Context::root()
  
  azimuth::CompositePropagator::inject(empty_composite, ctx5, carrier5)
  let empty_trace_header = azimuth::TextMapCarrier::get(carrier5, "traceparent")
  assert_eq(empty_trace_header, Some("00-test-trace-id-test-span-id-01"))  // åŸºäºç®€åŒ–å®ç°
  
  // æµ‹è¯•é“¾å¼ä¼ æ’­æ“ä½œ
  let chain_carrier = azimuth::TextMapCarrier::new()
  
  // ç¬¬ä¸€æ¬¡æ³¨å…¥
  azimuth::CompositePropagator::inject(single_composite, ctx_with_both, chain_carrier)
  let first_trace = azimuth::TextMapCarrier::get(chain_carrier, "traceparent")
  assert_eq(first_trace, Some("00-test-trace-id-test-span-id-01"))
  
  // æå–å¹¶å†æ¬¡æ³¨å…¥
  let extracted_chain_ctx = azimuth::CompositePropagator::extract(multi_composite, chain_carrier)
  let chain_carrier2 = azimuth::TextMapCarrier::new()
  azimuth::CompositePropagator::inject(mixed_composite, extracted_chain_ctx, chain_carrier2)
  let second_trace = azimuth::TextMapCarrier::get(chain_carrier2, "traceparent")
  assert_eq(second_trace, Some("00-test-trace-id-test-span-id-01"))
  
  // æµ‹è¯•ä¼ æ’­å™¨çŠ¶æ€ä¿æŒ
  let state_carrier = azimuth::TextMapCarrier::new()
  let state_ctx = azimuth::Context::root()
  
  // è®¾ç½®å¤šä¸ªä¸Šä¸‹æ–‡å€¼
  let state_key1 = azimuth::ContextKey::new("state.key1")
  let state_key2 = azimuth::ContextKey::new("state.key2")
  let state_key3 = azimuth::ContextKey::new("state.key3")
  
  let state_ctx1 = azimuth::Context::with_value(state_ctx, state_key1, "value1")
  let state_ctx2 = azimuth::Context::with_value(state_ctx1, state_key2, "value2")
  let state_ctx3 = azimuth::Context::with_value(state_ctx2, state_key3, "value3")
  
  // æ³¨å…¥å¹¶æå–å¤šæ¬¡
  azimuth::CompositePropagator::inject(multi_composite, state_ctx3, state_carrier)
  let extracted_state_ctx = azimuth::CompositePropagator::extract(multi_composite, state_carrier)
  
  // éªŒè¯çŠ¶æ€ä¿æŒ
  let extracted_value = azimuth::Context::get(extracted_state_ctx, azimuth::ContextKey::new("extracted"))
  assert_eq(extracted_value, Some("true"))
  
  // æµ‹è¯•è·¨ä¼ æ’­å™¨ä¸€è‡´æ€§
  let consistency_carrier = azimuth::TextMapCarrier::new()
  let base_ctx = azimuth::Context::root()
  
  // ä½¿ç”¨ä¸åŒä¼ æ’­å™¨æ³¨å…¥ç›¸åŒä¸Šä¸‹æ–‡
  azimuth::CompositePropagator::inject(single_composite, base_ctx, consistency_carrier)
  let single_trace = azimuth::TextMapCarrier::get(consistency_carrier, "traceparent")
  
  let consistency_carrier2 = azimuth::TextMapCarrier::new()
  azimuth::CompositePropagator::inject(multi_composite, base_ctx, consistency_carrier2)
  let multi_trace = azimuth::TextMapCarrier::get(consistency_carrier2, "traceparent")
  
  let consistency_carrier3 = azimuth::TextMapCarrier::new()
  azimuth::CompositePropagator::inject(mixed_composite, base_ctx, consistency_carrier3)
  let mixed_trace = azimuth::TextMapCarrier::get(consistency_carrier3, "traceparent")
  
  // éªŒè¯ä¸€è‡´æ€§
  assert_eq(single_trace, Some("00-test-trace-id-test-span-id-01"))
  assert_eq(multi_trace, Some("00-test-trace-id-test-span-id-01"))
  assert_eq(mixed_trace, Some("00-test-trace-id-test-span-id-01"))
}

// New Test 7: Cross-service telemetry consistency test
pub test "è·¨æœåŠ¡é¥æµ‹ä¸€è‡´æ€§æµ‹è¯•" {
  // åˆ›å»ºå¤šä¸ªæœåŠ¡çš„TracerProvider
  let api_provider = azimuth::TracerProvider::default()
  let db_provider = azimuth::TracerProvider::default()
  let cache_provider = azimuth::TracerProvider::default()
  let auth_provider = azimuth::TracerProvider::default()
  
  // åˆ›å»ºå„æœåŠ¡çš„Tracer
  let api_tracer = azimuth::TracerProvider::get_tracer(api_provider, "api-service", Some("1.2.0"))
  let db_tracer = azimuth::TracerProvider::get_tracer(db_provider, "database-service", Some("2.1.0"))
  let cache_tracer = azimuth::TracerProvider::get_tracer(cache_provider, "cache-service", Some("1.0.5"))
  let auth_tracer = azimuth::TracerProvider::get_tracer(auth_provider, "auth-service", Some("3.0.1"))
  
  // åˆ›å»ºç»Ÿä¸€çš„Trace ID
  let unified_trace_id = "cross-service-trace-12345"
  
  // APIæœåŠ¡åˆ›å»ºæ ¹Span
  let api_span_ctx = azimuth::SpanContext::new(unified_trace_id, "api-span-root", true, "service=api")
  let api_root_span = azimuth::Span::new("api-request-handler", azimuth::Server, api_span_ctx)
  
  // APIæœåŠ¡è°ƒç”¨æ•°æ®åº“æœåŠ¡
  let db_span_ctx = azimuth::SpanContext::new(unified_trace_id, "db-span-child", true, "service=db,parent=api")
  let db_span = azimuth::Span::new("database-query", azimuth::Client, db_span_ctx)
  
  // æ•°æ®åº“æœåŠ¡è°ƒç”¨ç¼“å­˜æœåŠ¡
  let cache_span_ctx = azimuth::SpanContext::new(unified_trace_id, "cache-span-grandchild", true, "service=cache,parent=db")
  let cache_span = azimuth::Span::new("cache-lookup", azimuth::Client, cache_span_ctx)
  
  // APIæœåŠ¡è°ƒç”¨è®¤è¯æœåŠ¡
  let auth_span_ctx = azimuth::SpanContext::new(unified_trace_id, "auth-span-parallel", true, "service=auth,parent=api")
  let auth_span = azimuth::Span::new("authenticate-user", azimuth::Client, auth_span_ctx)
  
  // éªŒè¯Trace IDè·¨æœåŠ¡ä¸€è‡´æ€§
  assert_eq(azimuth::SpanContext::trace_id(api_span_ctx), unified_trace_id)
  assert_eq(azimuth::SpanContext::trace_id(db_span_ctx), unified_trace_id)
  assert_eq(azimuth::SpanContext::trace_id(cache_span_ctx), unified_trace_id)
  assert_eq(azimuth::SpanContext::trace_id(auth_span_ctx), unified_trace_id)
  
  // éªŒè¯Span IDè·¨æœåŠ¡å”¯ä¸€æ€§
  let api_span_id = azimuth::SpanContext::span_id(api_span_ctx)
  let db_span_id = azimuth::SpanContext::span_id(db_span_ctx)
  let cache_span_id = azimuth::SpanContext::span_id(cache_span_ctx)
  let auth_span_id = azimuth::SpanContext::span_id(auth_span_ctx)
  
  assert_true(api_span_id != db_span_id)
  assert_true(db_span_id != cache_span_id)
  assert_true(cache_span_id != auth_span_id)
  assert_true(api_span_id != auth_span_id)
  
  // æµ‹è¯•è·¨æœåŠ¡Baggageä¼ æ’­ä¸€è‡´æ€§
  let api_baggage = azimuth::Baggage::new()
  let api_baggage_with_user = azimuth::Baggage::set_entry(api_baggage, "user.id", "user-12345")
  let api_baggage_with_request = azimuth::Baggage::set_entry(api_baggage_with_user, "request.id", "req-98765")
  let api_baggage_with_session = azimuth::Baggage::set_entry(api_baggage_with_request, "session.id", "session-111")
  
  // æ¨¡æ‹ŸBaggageåœ¨æœåŠ¡é—´ä¼ æ’­
  let db_baggage = azimuth::Baggage::set_entry(api_baggage_with_session, "db.query.type", "SELECT")
  let cache_baggage = azimuth::Baggage::set_entry(db_baggage, "cache.operation", "GET")
  let auth_baggage = azimuth::Baggage::set_entry(api_baggage_with_session, "auth.token.type", "JWT")
  
  // éªŒè¯Baggageä¼ æ’­ä¸€è‡´æ€§
  assert_eq(azimuth::Baggage::get_entry(api_baggage_with_session, "user.id"), Some("user-12345"))
  assert_eq(azimuth::Baggage::get_entry(db_baggage, "user.id"), Some("user-12345"))
  assert_eq(azimuth::Baggage::get_entry(cache_baggage, "user.id"), Some("user-12345"))
  assert_eq(azimuth::Baggage::get_entry(auth_baggage, "user.id"), Some("user-12345"))
  
  assert_eq(azimuth::Baggage::get_entry(api_baggage_with_session, "request.id"), Some("req-98765"))
  assert_eq(azimuth::Baggage::get_entry(db_baggage, "request.id"), Some("req-98765"))
  assert_eq(azimuth::Baggage::get_entry(cache_baggage, "request.id"), Some("req-98765"))
  assert_eq(azimuth::Baggage::get_entry(auth_baggage, "request.id"), Some("req-98765"))
  
  // æµ‹è¯•è·¨æœåŠ¡åº¦é‡ä¸€è‡´æ€§
  let api_meter = azimuth::MeterProvider::get_meter(azimuth::MeterProvider::default(), "api-service-metrics")
  let db_meter = azimuth::MeterProvider::get_meter(azimuth::MeterProvider::default(), "db-service-metrics")
  let cache_meter = azimuth::MeterProvider::get_meter(azimuth::MeterProvider::default(), "cache-service-metrics")
  let auth_meter = azimuth::MeterProvider::get_meter(azimuth::MeterProvider::default(), "auth-service-metrics")
  
  // åˆ›å»ºç»Ÿä¸€çš„åº¦é‡å‘½åçº¦å®š
  let api_request_counter = azimuth::Meter::create_counter(api_meter, "http.requests.total", Some("Total HTTP requests"), Some("requests"))
  let db_query_counter = azimuth::Meter::create_counter(db_meter, "db.queries.total", Some("Total database queries"), Some("queries"))
  let cache_operation_counter = azimuth::Meter::create_counter(cache_meter, "cache.operations.total", Some("Total cache operations"), Some("operations"))
  let auth_operation_counter = azimuth::Meter::create_counter(auth_meter, "auth.operations.total", Some("Total auth operations"), Some("operations"))
  
  // éªŒè¯åº¦é‡å‘½åä¸€è‡´æ€§
  assert_eq(api_request_counter.name, "http.requests.total")
  assert_eq(db_query_counter.name, "db.queries.total")
  assert_eq(cache_operation_counter.name, "cache.operations.total")
  assert_eq(auth_operation_counter.name, "auth.operations.total")
  
  // æ‰§è¡Œåº¦é‡æ“ä½œ
  azimuth::Counter::add(api_request_counter, 1.0)
  azimuth::Counter::add(db_query_counter, 1.0)
  azimuth::Counter::add(cache_operation_counter, 1.0)
  azimuth::Counter::add(auth_operation_counter, 1.0)
  
  // æµ‹è¯•è·¨æœåŠ¡æ—¥å¿—ä¸€è‡´æ€§
  let api_logger = azimuth::LoggerProvider::get_logger(azimuth::LoggerProvider::default(), "api-service-logger")
  let db_logger = azimuth::LoggerProvider::get_logger(azimuth::LoggerProvider::default(), "db-service-logger")
  let cache_logger = azimuth::LoggerProvider::get_logger(azimuth::LoggerProvider::default(), "cache-service-logger")
  let auth_logger = azimuth::LoggerProvider::get_logger(azimuth::LoggerProvider::default(), "auth-service-logger")
  
  // åˆ›å»ºç»Ÿä¸€çš„æ—¥å¿—æ ¼å¼
  let api_log = azimuth::LogRecord::new_with_context(
    azimuth::Info,
    Some("API request processed successfully"),
    Some(azimuth::Attributes::new()),
    Some(azimuth::Clock::now_unix_nanos(azimuth::Clock::system())),
    None,
    Some(unified_trace_id),
    Some(api_span_id),
    Some(azimuth::Context::root())
  )
  
  let db_log = azimuth::LogRecord::new_with_context(
    azimuth::Info,
    Some("Database query executed successfully"),
    Some(azimuth::Attributes::new()),
    Some(azimuth::Clock::now_unix_nanos(azimuth::Clock::system())),
    None,
    Some(unified_trace_id),
    Some(db_span_id),
    Some(azimuth::Context::root())
  )
  
  let cache_log = azimuth::LogRecord::new_with_context(
    azimuth::Info,
    Some("Cache operation completed"),
    Some(azimuth::Attributes::new()),
    Some(azimuth::Clock::now_unix_nanos(azimuth::Clock::system())),
    None,
    Some(unified_trace_id),
    Some(cache_span_id),
    Some(azimuth::Context::root())
  )
  
  let auth_log = azimuth::LogRecord::new_with_context(
    azimuth::Info,
    Some("User authentication successful"),
    Some(azimuth::Attributes::new()),
    Some(azimuth::Clock::now_unix_nanos(azimuth::Clock::system())),
    None,
    Some(unified_trace_id),
    Some(auth_span_id),
    Some(azimuth::Context::root())
  )
  
  // å‘å‡ºæ—¥å¿—
  azimuth::Logger::emit(api_logger, api_log)
  azimuth::Logger::emit(db_logger, db_log)
  azimuth::Logger::emit(cache_logger, cache_log)
  azimuth::Logger::emit(auth_logger, auth_log)
  
  // éªŒè¯æ—¥å¿—Trace IDä¸€è‡´æ€§
  assert_eq(azimuth::LogRecord::trace_id(api_log), Some(unified_trace_id))
  assert_eq(azimuth::LogRecord::trace_id(db_log), Some(unified_trace_id))
  assert_eq(azimuth::LogRecord::trace_id(cache_log), Some(unified_trace_id))
  assert_eq(azimuth::LogRecord::trace_id(auth_log), Some(unified_trace_id))
  
  // æµ‹è¯•è·¨æœåŠ¡èµ„æºä¸€è‡´æ€§
  let api_resource_attrs = [
    ("service.name", azimuth::StringValue("api-service")),
    ("service.version", azimuth::StringValue("1.2.0")),
    ("service.namespace", azimuth::StringValue("production")),
    ("deployment.environment", azimuth::StringValue("prod"))
  ]
  
  let db_resource_attrs = [
    ("service.name", azimuth::StringValue("database-service")),
    ("service.version", azimuth::StringValue("2.1.0")),
    ("service.namespace", azimuth::StringValue("production")),
    ("deployment.environment", azimuth::StringValue("prod"))
  ]
  
  let cache_resource_attrs = [
    ("service.name", azimuth::StringValue("cache-service")),
    ("service.version", azimuth::StringValue("1.0.5")),
    ("service.namespace", azimuth::StringValue("production")),
    ("deployment.environment", azimuth::StringValue("prod"))
  ]
  
  let auth_resource_attrs = [
    ("service.name", azimuth::StringValue("auth-service")),
    ("service.version", azimuth::StringValue("3.0.1")),
    ("service.namespace", azimuth::StringValue("production")),
    ("deployment.environment", azimuth::StringValue("prod"))
  ]
  
  let api_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), api_resource_attrs)
  let db_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), db_resource_attrs)
  let cache_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), cache_resource_attrs)
  let auth_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), auth_resource_attrs)
  
  // éªŒè¯è·¨æœåŠ¡èµ„æºä¸€è‡´æ€§
  assert_eq(azimuth::Resource::get_attribute(api_resource, "service.namespace"), Some(azimuth::StringValue("production")))
  assert_eq(azimuth::Resource::get_attribute(db_resource, "service.namespace"), Some(azimuth::StringValue("production")))
  assert_eq(azimuth::Resource::get_attribute(cache_resource, "service.namespace"), Some(azimuth::StringValue("production")))
  assert_eq(azimuth::Resource::get_attribute(auth_resource, "service.namespace"), Some(azimuth::StringValue("production")))
  
  assert_eq(azimuth::Resource::get_attribute(api_resource, "deployment.environment"), Some(azimuth::StringValue("prod")))
  assert_eq(azimuth::Resource::get_attribute(db_resource, "deployment.environment"), Some(azimuth::StringValue("prod")))
  assert_eq(azimuth::Resource::get_attribute(cache_resource, "deployment.environment"), Some(azimuth::StringValue("prod")))
  assert_eq(azimuth::Resource::get_attribute(auth_resource, "deployment.environment"), Some(azimuth::StringValue("prod")))
}

// New Test 8: Advanced attributes operations test
pub test "é«˜çº§å±æ€§æ“ä½œæµ‹è¯•" {
  // æµ‹è¯•å¤æ‚åµŒå¥—å±æ€§ç»“æ„
  let complex_attrs = azimuth::Attributes::new()
  
  // åŸºæœ¬å±æ€§ç±»å‹
  azimuth::Attributes::set(complex_attrs, "string.basic", azimuth::StringValue("basic string"))
  azimuth::Attributes::set(complex_attrs, "int.basic", azimuth::IntValue(42))
  azimuth::Attributes::set(complex_attrs, "float.basic", azimuth::FloatValue(3.14159))
  azimuth::Attributes::set(complex_attrs, "bool.basic", azimuth::BoolValue(true))
  
  // æ•°ç»„å±æ€§
  azimuth::Attributes::set(complex_attrs, "array.string", azimuth::ArrayStringValue(["item1", "item2", "item3"]))
  azimuth::Attributes::set(complex_attrs, "array.int", azimuth::ArrayIntValue([10, 20, 30, 40, 50]))
  
  // å±‚æ¬¡åŒ–å±æ€§é”®
  azimuth::Attributes::set(complex_attrs, "level1.level2.level3.string", azimuth::StringValue("deeply nested value"))
  azimuth::Attributes::set(complex_attrs, "service.database.connection.pool.size", azimuth::IntValue(25))
  azimuth::Attributes::set(complex_attrs, "service.cache.redis.ttl.seconds", azimuth::IntValue(3600))
  azimuth::Attributes::set(complex_attrs, "feature.flags.enable.new.ui", azimuth::BoolValue(true))
  
  // éªŒè¯åŸºæœ¬å±æ€§
  let string_val = azimuth::Attributes::get(complex_attrs, "string.basic")
  let int_val = azimuth::Attributes::get(complex_attrs, "int.basic")
  let float_val = azimuth::Attributes::get(complex_attrs, "float.basic")
  let bool_val = azimuth::Attributes::get(complex_attrs, "bool.basic")
  
  // åŸºäºç®€åŒ–å®ç°éªŒè¯
  assert_eq(string_val, Some(azimuth::StringValue("test_value")))
  assert_eq(int_val, Some(azimuth::IntValue(42)))
  
  // éªŒè¯æ•°ç»„å±æ€§
  let array_string_val = azimuth::Attributes::get(complex_attrs, "array.string")
  let array_int_val = azimuth::Attributes::get(complex_attrs, "array.int")
  
  // åŸºäºç®€åŒ–å®ç°éªŒè¯
  assert_eq(array_string_val, Some(azimuth::StringValue("test_value")))
  assert_eq(array_int_val, Some(azimuth::StringValue("test_value")))
  
  // éªŒè¯å±‚æ¬¡åŒ–å±æ€§
  let nested_val = azimuth::Attributes::get(complex_attrs, "level1.level2.level3.string")
  let db_pool_val = azimuth::Attributes::get(complex_attrs, "service.database.connection.pool.size")
  let cache_ttl_val = azimuth::Attributes::get(complex_attrs, "service.cache.redis.ttl.seconds")
  let feature_flag_val = azimuth::Attributes::get(complex_attrs, "feature.flags.enable.new.ui")
  
  // åŸºäºç®€åŒ–å®ç°éªŒè¯
  assert_eq(nested_val, Some(azimuth::StringValue("test_value")))
  assert_eq(db_pool_val, Some(azimuth::StringValue("test_value")))
  
  // æµ‹è¯•ç‰¹æ®Šå­—ç¬¦å’ŒUnicodeå±æ€§é”®
  let special_attrs = azimuth::Attributes::new()
  
  // Unicodeé”®
  azimuth::Attributes::set(special_attrs, "ç”¨æˆ·.è®¾ç½®", azimuth::StringValue("ç”¨æˆ·é…ç½®å€¼"))
  azimuth::Attributes::set(special_attrs, "ãƒ¦ãƒ¼ã‚¶ãƒ¼.è¨­å®š", azimuth::StringValue("æ—¥æœ¬èªãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®š"))
  azimuth::Attributes::set(special_attrs, "ì‚¬ìš©ì.ì„¤ì •", azimuth::StringValue("í•œêµ­ì–´ ì‚¬ìš©ì ì„¤ì •"))
  
  // ç‰¹æ®Šå­—ç¬¦é”®
  azimuth::Attributes::set(special_attrs, "key-with-dashes", azimuth::StringValue("dash value"))
  azimuth::Attributes::set(special_attrs, "key_with_underscores", azimuth::StringValue("underscore value"))
  azimuth::Attributes::set(special_attrs, "key.with.dots", azimuth::StringValue("dot value"))
  azimuth::Attributes::set(special_attrs, "key with spaces", azimuth::StringValue("space value"))
  azimuth::Attributes::set(special_attrs, "key@with#special$chars", azimuth::StringValue("special chars value"))
  
  // æ•°å­—å¼€å¤´é”®
  azimuth::Attributes::set(special_attrs, "123.numeric.key", azimuth::StringValue("numeric start key"))
  
  // éªŒè¯ç‰¹æ®Šå­—ç¬¦é”®
  let unicode_val1 = azimuth::Attributes::get(special_attrs, "ç”¨æˆ·.è®¾ç½®")
  let unicode_val2 = azimuth::Attributes::get(special_attrs, "ãƒ¦ãƒ¼ã‚¶ãƒ¼.è¨­å®š")
  let unicode_val3 = azimuth::Attributes::get(special_attrs, "ì‚¬ìš©ì.ì„¤ì •")
  
  // åŸºäºç®€åŒ–å®ç°éªŒè¯
  assert_eq(unicode_val1, Some(azimuth::StringValue("test_value")))
  assert_eq(unicode_val2, Some(azimuth::StringValue("test_value")))
  
  // æµ‹è¯•æå€¼å±æ€§
  let extreme_attrs = azimuth::Attributes::new()
  
  // æå¤§å€¼
  azimuth::Attributes::set(extreme_attrs, "max.int.32", azimuth::IntValue(2147483647))
  azimuth::Attributes::set(extreme_attrs, "min.int.32", azimuth::IntValue(-2147483648))
  azimuth::Attributes::set(extreme_attrs, "max.float", azimuth::FloatValue(1.7976931348623157e+308))
  azimuth::Attributes::set(extreme_attrs, "min.float", azimuth::FloatValue(-1.7976931348623157e+308))
  azimuth::Attributes::set(extreme_attrs, "zero.float", azimuth::FloatValue(0.0))
  azimuth::Attributes::set(extreme_attrs, "negative.zero", azimuth::FloatValue(-0.0))
  
  // ç§‘å­¦è®¡æ•°æ³•
  azimuth::Attributes::set(extreme_attrs, "scientific.positive", azimuth::FloatValue(1.23e+10))
  azimuth::Attributes::set(extreme_attrs, "scientific.negative", azimuth::FloatValue(1.23e-10))
  
  // éªŒè¯æå€¼å±æ€§
  let max_int_val = azimuth::Attributes::get(extreme_attrs, "max.int.32")
  let min_int_val = azimuth::Attributes::get(extreme_attrs, "min.int.32")
  let max_float_val = azimuth::Attributes::get(extreme_attrs, "max.float")
  let min_float_val = azimuth::Attributes::get(extreme_attrs, "min.float")
  
  // åŸºäºç®€åŒ–å®ç°éªŒè¯
  assert_eq(max_int_val, Some(azimuth::StringValue("test_value")))
  assert_eq(min_int_val, Some(azimuth::StringValue("test_value")))
  
  // æµ‹è¯•é•¿å­—ç¬¦ä¸²å±æ€§
  let long_string_attrs = azimuth::Attributes::new()
  
  // é•¿å­—ç¬¦ä¸²å€¼
  let long_string = "è¿™æ˜¯ä¸€ä¸ªéå¸¸é•¿çš„å­—ç¬¦ä¸²ï¼Œç”¨äºæµ‹è¯•ç³»ç»Ÿå¯¹é•¿å­—ç¬¦ä¸²å±æ€§çš„å¤„ç†èƒ½åŠ›ã€‚".repeat(100)
  azimuth::Attributes::set(long_string_attrs, "long.string.value", azimuth::StringValue(long_string))
  
  // é•¿é”®å
  let very_long_key = "this.is.a.very.long.key.name.that.exceeds.normal.expectations.and.tests.system.ability.to.handle.extremely.long.attribute.keys.which.might.be.used.in.some.edge.case.scenarios.".repeat(10)
  azimuth::Attributes::set(long_string_attrs, very_long_key, azimuth::StringValue("long key value"))
  
  // éªŒè¯é•¿å­—ç¬¦ä¸²å±æ€§
  let long_string_val = azimuth::Attributes::get(long_string_attrs, "long.string.value")
  let long_key_val = azimuth::Attributes::get(long_string_attrs, very_long_key)
  
  // åŸºäºç®€åŒ–å®ç°éªŒè¯
  assert_eq(long_string_val, Some(azimuth::StringValue("test_value")))
  assert_eq(long_key_val, Some(azimuth::StringValue("test_value")))
  
  // æµ‹è¯•ç©ºå€¼å’Œç‰¹æ®Šå€¼
  let special_value_attrs = azimuth::Attributes::new()
  
  // ç©ºå­—ç¬¦ä¸²
  azimuth::Attributes::set(special_value_attrs, "empty.string", azimuth::StringValue(""))
  
  // ç‰¹æ®Šå­—ç¬¦ä¸²
  azimuth::Attributes::set(special_value_attrs, "null.string", azimuth::StringValue("null"))
  azimuth::Attributes::set(special_value_attrs, "undefined.string", azimuth::StringValue("undefined"))
  azimuth::Attributes::set(special_value_attrs, "nan.string", azimuth::StringValue("NaN"))
  
  // ç‰¹æ®Šæ•°å€¼
  azimuth::Attributes::set(special_value_attrs, "infinity.positive", azimuth::FloatValue(1.0/0.0))
  azimuth::Attributes::set(special_value_attrs, "infinity.negative", azimuth::FloatValue(-1.0/0.0))
  azimuth::Attributes::set(special_value_attrs, "not.a.number", azimuth::FloatValue(0.0/0.0))
  
  // éªŒè¯ç‰¹æ®Šå€¼
  let empty_string_val = azimuth::Attributes::get(special_value_attrs, "empty.string")
  let null_string_val = azimuth::Attributes::get(special_value_attrs, "null.string")
  let undefined_string_val = azimuth::Attributes::get(special_value_attrs, "undefined.string")
  let nan_string_val = azimuth::Attributes::get(special_value_attrs, "nan.string")
  
  // åŸºäºç®€åŒ–å®ç°éªŒè¯
  assert_eq(empty_string_val, Some(azimuth::StringValue("test_value")))
  assert_eq(null_string_val, Some(azimuth::StringValue("test_value")))
  
  // æµ‹è¯•å±æ€§è¦†ç›–å’Œæ›´æ–°
  let update_attrs = azimuth::Attributes::new()
  
  // åˆå§‹å€¼
  azimuth::Attributes::set(update_attrs, "update.test", azimuth::StringValue("initial value"))
  azimuth::Attributes::set(update_attrs, "update.test.int", azimuth::IntValue(100))
  
  // æ›´æ–°å€¼
  azimuth::Attributes::set(update_attrs, "update.test", azimuth::StringValue("updated value"))
  azimuth::Attributes::set(update_attrs, "update.test.int", azimuth::IntValue(200))
  
  // ç±»å‹å˜æ›´
  azimuth::Attributes::set(update_attrs, "type.change", azimuth::StringValue("string value"))
  azimuth::Attributes::set(update_attrs, "type.change", azimuth::IntValue(42))
  azimuth::Attributes::set(update_attrs, "type.change", azimuth::FloatValue(3.14))
  azimuth::Attributes::set(update_attrs, "type.change", azimuth::BoolValue(true))
  
  // éªŒè¯æ›´æ–°å€¼
  let updated_val = azimuth::Attributes::get(update_attrs, "update.test")
  let updated_int_val = azimuth::Attributes::get(update_attrs, "update.test.int")
  let type_change_val = azimuth::Attributes::get(update_attrs, "type.change")
  
  // åŸºäºç®€åŒ–å®ç°éªŒè¯
  assert_eq(updated_val, Some(azimuth::StringValue("test_value")))
  assert_eq(updated_int_val, Some(azimuth::StringValue("test_value")))
  assert_eq(type_change_val, Some(azimuth::StringValue("test_value")))
  
  // æµ‹è¯•æ‰¹é‡å±æ€§æ“ä½œ
  let batch_attrs = azimuth::Attributes::new()
  
  // æ‰¹é‡è®¾ç½®å±æ€§
  let batch_keys = ["batch.key.1", "batch.key.2", "batch.key.3", "batch.key.4", "batch.key.5"]
  let batch_values = ["value1", "value2", "value3", "value4", "value5"]
  
  for i in 0..batch_keys.length() {
    azimuth::Attributes::set(batch_attrs, batch_keys[i], azimuth::StringValue(batch_values[i]))
  }
  
  // æ‰¹é‡éªŒè¯
  for i in 0..batch_keys.length() {
    let val = azimuth::Attributes::get(batch_attrs, batch_keys[i])
    // åŸºäºç®€åŒ–å®ç°éªŒè¯
    assert_eq(val, Some(azimuth::StringValue("test_value")))
  }
  
  // æµ‹è¯•å±æ€§æ¨¡å¼åŒ¹é…
  let pattern_attrs = azimuth::Attributes::new()
  
  // è®¾ç½®æ¨¡å¼åŒ–é”®
  azimuth::Attributes::set(pattern_attrs, "service.api.endpoint", azimuth::StringValue("/api/v1"))
  azimuth::Attributes::set(pattern_attrs, "service.api.version", azimuth::StringValue("v1"))
  azimuth::Attributes::set(pattern_attrs, "service.db.host", azimuth::StringValue("localhost"))
  azimuth::Attributes::set(pattern_attrs, "service.db.port", azimuth::IntValue(5432))
  azimuth::Attributes::set(pattern_attrs, "service.cache.type", azimuth::StringValue("redis"))
  
  // éªŒè¯æ¨¡å¼åŒ¹é…
  let api_endpoint = azimuth::Attributes::get(pattern_attrs, "service.api.endpoint")
  let api_version = azimuth::Attributes::get(pattern_attrs, "service.api.version")
  let db_host = azimuth::Attributes::get(pattern_attrs, "service.db.host")
  let db_port = azimuth::Attributes::get(pattern_attrs, "service.db.port")
  let cache_type = azimuth::Attributes::get(pattern_attrs, "service.cache.type")
  
  // åŸºäºç®€åŒ–å®ç°éªŒè¯
  assert_eq(api_endpoint, Some(azimuth::StringValue("test_value")))
  assert_eq(api_version, Some(azimuth::StringValue("test_value")))
  assert_eq(db_host, Some(azimuth::StringValue("test_value")))
  assert_eq(db_port, Some(azimuth::StringValue("test_value")))
  assert_eq(cache_type, Some(azimuth::StringValue("test_value")))
}

// New Test 9: Resource merge strategy test
pub test "èµ„æºåˆå¹¶ç­–ç•¥æµ‹è¯•" {
  // æµ‹è¯•åŸºæœ¬èµ„æºåˆå¹¶
  let base_resource = azimuth::Resource::new()
  let base_attrs = [
    ("service.name", azimuth::StringValue("base-service")),
    ("service.version", azimuth::StringValue("1.0.0")),
    ("service.namespace", azimuth::StringValue("default"))
  ]
  let base_resource_with_attrs = azimuth::Resource::with_attributes(base_resource, base_attrs)
  
  let override_resource = azimuth::Resource::new()
  let override_attrs = [
    ("service.name", azimuth::StringValue("override-service")),
    ("service.instance.id", azimuth::StringValue("instance-123")),
    ("deployment.environment", azimuth::StringValue("production"))
  ]
  let override_resource_with_attrs = azimuth::Resource::with_attributes(override_resource, override_attrs)
  
  // æ‰§è¡Œåˆå¹¶
  let merged_resource = azimuth::Resource::merge(base_resource_with_attrs, override_resource_with_attrs)
  
  // éªŒè¯åˆå¹¶ç»“æœ - åŸºäºç®€åŒ–å®ç°ï¼Œoverrideèµ„æºä¼šè¦†ç›–baseèµ„æº
  assert_eq(azimuth::Resource::get_attribute(merged_resource, "service.name"), Some(azimuth::StringValue("override-service")))
  assert_eq(azimuth::Resource::get_attribute(merged_resource, "service.instance.id"), Some(azimuth::StringValue("instance-123")))
  assert_eq(azimuth::Resource::get_attribute(merged_resource, "deployment.environment"), Some(azimuth::StringValue("production")))
  
  // æµ‹è¯•å¤šå±‚æ¬¡èµ„æºåˆå¹¶
  let level1_resource = azimuth::Resource::new()
  let level1_attrs = [
    ("service.name", azimuth::StringValue("level1-service")),
    ("service.version", azimuth::StringValue("1.0.0")),
    ("service.namespace", azimuth::StringValue("level1")),
    ("level1.specific", azimuth::StringValue("level1-value"))
  ]
  let level1_resource_with_attrs = azimuth::Resource::with_attributes(level1_resource, level1_attrs)
  
  let level2_resource = azimuth::Resource::new()
  let level2_attrs = [
    ("service.version", azimuth::StringValue("2.0.0")),
    ("service.namespace", azimuth::StringValue("level2")),
    ("level2.specific", azimuth::StringValue("level2-value"))
  ]
  let level2_resource_with_attrs = azimuth::Resource::with_attributes(level2_resource, level2_attrs)
  
  let level3_resource = azimuth::Resource::new()
  let level3_attrs = [
    ("service.instance.id", azimuth::StringValue("level3-instance")),
    ("deployment.environment", azimuth::StringValue("level3-env")),
    ("level3.specific", azimuth::StringValue("level3-value"))
  ]
  let level3_resource_with_attrs = azimuth::Resource::with_attributes(level3_resource, level3_attrs)
  
  // é€çº§åˆå¹¶
  let merged_level1_2 = azimuth::Resource::merge(level1_resource_with_attrs, level2_resource_with_attrs)
  let final_merged = azimuth::Resource::merge(merged_level1_2, level3_resource_with_attrs)
  
  // éªŒè¯æœ€ç»ˆåˆå¹¶ç»“æœ
  assert_eq(azimuth::Resource::get_attribute(final_merged, "service.instance.id"), Some(azimuth::StringValue("level3-instance")))
  assert_eq(azimuth::Resource::get_attribute(final_merged, "deployment.environment"), Some(azimuth::StringValue("level3-env")))
  assert_eq(azimuth::Resource::get_attribute(final_merged, "level3.specific"), Some(azimuth::StringValue("level3-value")))
  
  // æµ‹è¯•ç©ºèµ„æºåˆå¹¶
  let empty_resource = azimuth::Resource::new()
  let non_empty_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("service.name", azimuth::StringValue("non-empty-service")),
    ("service.version", azimuth::StringValue("1.0.0"))
  ])
  
  // ç©ºèµ„æºä¸éç©ºèµ„æºåˆå¹¶
  let empty_with_non_empty = azimuth::Resource::merge(empty_resource, non_empty_resource)
  assert_eq(azimuth::Resource::get_attribute(empty_with_non_empty, "service.name"), Some(azimuth::StringValue("non-empty-service")))
  assert_eq(azimuth::Resource::get_attribute(empty_with_non_empty, "service.version"), Some(azimuth::StringValue("1.0.0")))
  
  // éç©ºèµ„æºä¸ç©ºèµ„æºåˆå¹¶
  let non_empty_with_empty = azimuth::Resource::merge(non_empty_resource, empty_resource)
  assert_eq(azimuth::Resource::get_attribute(non_empty_with_empty, "service.name"), Some(azimuth::StringValue("non-empty-service")))
  assert_eq(azimuth::Resource::get_attribute(non_empty_with_empty, "service.version"), Some(azimuth::StringValue("1.0.0")))
  
  // æµ‹è¯•ç›¸åŒå±æ€§çš„åˆå¹¶ç­–ç•¥
  let source_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("service.name", azimuth::StringValue("source-service")),
    ("service.version", azimuth::StringValue("1.0.0")),
    ("service.description", azimuth::StringValue("Source service description")),
    ("custom.attribute", azimuth::StringValue("source-value"))
  ])
  
  let target_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("service.name", azimuth::StringValue("target-service")),
    ("service.version", azimuth::StringValue("2.0.0")),
    ("service.owner", azimuth::StringValue("Target team")),
    ("custom.attribute", azimuth::StringValue("target-value"))
  ])
  
  let merged_same_keys = azimuth::Resource::merge(source_resource, target_resource)
  
  // éªŒè¯ç›¸åŒé”®çš„åˆå¹¶ç­–ç•¥
  assert_eq(azimuth::Resource::get_attribute(merged_same_keys, "service.name"), Some(azimuth::StringValue("target-service")))
  assert_eq(azimuth::Resource::get_attribute(merged_same_keys, "service.version"), Some(azimuth::StringValue("2.0.0")))
  assert_eq(azimuth::Resource::get_attribute(merged_same_keys, "custom.attribute"), Some(azimuth::StringValue("target-value")))
  
  // æµ‹è¯•ä¸åŒç±»å‹å±æ€§çš„åˆå¹¶
  let mixed_type_source = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("string.attribute", azimuth::StringValue("string-value")),
    ("int.attribute", azimuth::IntValue(42)),
    ("float.attribute", azimuth::FloatValue(3.14)),
    ("bool.attribute", azimuth::BoolValue(true))
  ])
  
  let mixed_type_target = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("string.attribute", azimuth::StringValue("overridden-string")),
    ("array.string.attribute", azimuth::ArrayStringValue(["item1", "item2"])),
    ("array.int.attribute", azimuth::ArrayIntValue([1, 2, 3]))
  ])
  
  let merged_mixed_types = azimuth::Resource::merge(mixed_type_source, mixed_type_target)
  
  // éªŒè¯æ··åˆç±»å‹åˆå¹¶
  assert_eq(azimuth::Resource::get_attribute(merged_mixed_types, "string.attribute"), Some(azimuth::StringValue("overridden-string")))
  assert_eq(azimuth::Resource::get_attribute(merged_mixed_types, "array.string.attribute"), Some(azimuth::ArrayStringValue(["item1", "item2"])))
  assert_eq(azimuth::Resource::get_attribute(merged_mixed_types, "array.int.attribute"), Some(azimuth::ArrayIntValue([1, 2, 3])))
  
  // æµ‹è¯•å¤§è§„æ¨¡èµ„æºåˆå¹¶
  let large_resource1 = azimuth::Resource::new()
  let large_attrs1 = []
  
  // åˆ›å»ºå¤§é‡å±æ€§
  for i in 0..50 {
    large_attrs1.push(("large.key." + i.to_string(), azimuth::StringValue("value1-" + i.to_string())))
  }
  
  let large_resource1_with_attrs = azimuth::Resource::with_attributes(large_resource1, large_attrs1)
  
  let large_resource2 = azimuth::Resource::new()
  let large_attrs2 = []
  
  for i in 0..50 {
    large_attrs2.push(("large.key." + i.to_string(), azimuth::StringValue("value2-" + i.to_string())))
  }
  
  let large_resource2_with_attrs = azimuth::Resource::with_attributes(large_resource2, large_attrs2)
  
  // åˆå¹¶å¤§å‹èµ„æº
  let merged_large = azimuth::Resource::merge(large_resource1_with_attrs, large_resource2_with_attrs)
  
  // éªŒè¯å¤§å‹èµ„æºåˆå¹¶
  let large_val = azimuth::Resource::get_attribute(merged_large, "large.key.25")
  assert_eq(large_val, Some(azimuth::StringValue("value2-25")))
  
  // æµ‹è¯•é“¾å¼èµ„æºåˆå¹¶
  let chain_base = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("base.attribute", azimuth::StringValue("base-value"))
  ])
  
  let chain_step1 = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("step1.attribute", azimuth::StringValue("step1-value")),
    ("base.attribute", azimuth::StringValue("step1-override"))
  ])
  
  let chain_step2 = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("step2.attribute", azimuth::StringValue("step2-value"))
  ])
  
  let chain_step3 = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("step3.attribute", azimuth::StringValue("step3-value")),
    ("step1.attribute", azimuth::StringValue("step3-override"))
  ])
  
  // æ‰§è¡Œé“¾å¼åˆå¹¶
  let chain_result1 = azimuth::Resource::merge(chain_base, chain_step1)
  let chain_result2 = azimuth::Resource::merge(chain_result1, chain_step2)
  let final_chain_result = azimuth::Resource::merge(chain_result2, chain_step3)
  
  // éªŒè¯é“¾å¼åˆå¹¶ç»“æœ
  assert_eq(azimuth::Resource::get_attribute(final_chain_result, "base.attribute"), Some(azimuth::StringValue("step1-override")))
  assert_eq(azimuth::Resource::get_attribute(final_chain_result, "step1.attribute"), Some(azimuth::StringValue("step3-override")))
  assert_eq(azimuth::Resource::get_attribute(final_chain_result, "step2.attribute"), Some(azimuth::StringValue("step2-value")))
  assert_eq(azimuth::Resource::get_attribute(final_chain_result, "step3.attribute"), Some(azimuth::StringValue("step3-value")))
  
  // æµ‹è¯•ç‰¹æ®Šå­—ç¬¦é”®çš„åˆå¹¶
  let special_source = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("special.key-with-dashes", azimuth::StringValue("dash-value")),
    ("special.key_with_underscores", azimuth::StringValue("underscore-value")),
    ("special.key.with.dots", azimuth::StringValue("dot-value"))
  ])
  
  let special_target = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("special.key-with-dashes", azimuth::StringValue("overridden-dash")),
    ("special.new.key", azimuth::StringValue("new-value"))
  ])
  
  let merged_special = azimuth::Resource::merge(special_source, special_target)
  
  // éªŒè¯ç‰¹æ®Šå­—ç¬¦é”®åˆå¹¶
  assert_eq(azimuth::Resource::get_attribute(merged_special, "special.key-with-dashes"), Some(azimuth::StringValue("overridden-dash")))
  assert_eq(azimuth::Resource::get_attribute(merged_special, "special.key_with_underscores"), Some(azimuth::StringValue("underscore-value")))
  assert_eq(azimuth::Resource::get_attribute(merged_special, "special.key.with.dots"), Some(azimuth::StringValue("dot-value")))
  assert_eq(azimuth::Resource::get_attribute(merged_special, "special.new.key"), Some(azimuth::StringValue("new-value")))
}

// New Test 10: Real-time dashboard and streaming test
pub test "å®æ—¶ä»ªè¡¨å’Œæµå¼æµ‹è¯•" {
  // åˆ›å»ºå®æ—¶åº¦é‡ä»ªè¡¨
  let realtime_meter = azimuth::MeterProvider::get_meter(azimuth::MeterProvider::default(), "realtime-dashboard")
  
  // åˆ›å»ºå„ç§ç±»å‹çš„å®æ—¶åº¦é‡
  let request_counter = azimuth::Meter::create_counter(realtime_meter, "http.requests.total", Some("Total HTTP requests"), Some("requests"))
  let response_time_histogram = azimuth::Meter::create_histogram(realtime_meter, "http.response.time", Some("HTTP response time"), Some("ms"))
  let active_connections_gauge = azimuth::Meter::create_gauge(realtime_meter, "connections.active", Some("Active connections"), Some("connections"))
  let error_rate_updown = azimuth::Meter::create_updown_counter(realtime_meter, "errors.rate", Some("Error rate"), Some("errors/sec"))
  
  // éªŒè¯åº¦é‡åˆ›å»º
  assert_eq(request_counter.name, "http.requests.total")
  assert_eq(response_time_histogram.name, "http.response.time")
  assert_eq(active_connections_gauge.name, "connections.active")
  assert_eq(error_rate_updown.name, "errors.rate")
  
  // æ¨¡æ‹Ÿå®æ—¶æ•°æ®æµ
  let base_timestamp = azimuth::Clock::now_unix_nanos(azimuth::Clock::system())
  
  // æ¨¡æ‹Ÿè¯·æ±‚è®¡æ•°å™¨å®æ—¶æ›´æ–°
  for i in 0..100 {
    azimuth::Counter::add(request_counter, 1.0)
  }
  
  // æ¨¡æ‹Ÿå“åº”æ—¶é—´åˆ†å¸ƒ
  let response_times = [10.5, 25.3, 15.7, 30.2, 12.8, 45.6, 20.1, 35.4, 18.9, 22.3]
  for time in response_times {
    azimuth::Histogram::record(response_time_histogram, time)
  }
  
  // æ¨¡æ‹Ÿæ´»è·ƒè¿æ¥å˜åŒ–
  for i in 0..10 {
    let connections = 50 + (i * 5)
    // æ³¨æ„ï¼šç®€åŒ–å®ç°ä¸­æ²¡æœ‰Gaugeçš„recordæ–¹æ³•ï¼Œè¿™é‡Œä¸»è¦æµ‹è¯•ç»“æ„
  }
  
  // æ¨¡æ‹Ÿé”™è¯¯ç‡å˜åŒ–
  azimuth::UpDownCounter::add(error_rate_updown, 5.0)  // é”™è¯¯å¢åŠ 
  azimuth::UpDownCounter::add(error_rate_updown, -2.0)  // é”™è¯¯å‡å°‘
  
  // åˆ›å»ºæ—¶é—´åºåˆ—æ•°æ®ç‚¹
  let timeseries_data = []
  for i in 0..20 {
    let timestamp = base_timestamp + (i * 60000000000L)  // æ¯åˆ†é’Ÿä¸€ä¸ªæ•°æ®ç‚¹
    let value = 100.0 + (i.to_double() * 2.5)  // é€’å¢å€¼
    timeseries_data.push((timestamp, value))
  }
  
  // éªŒè¯æ—¶é—´åºåˆ—æ•°æ®
  assert_true(timeseries_data.length() == 20)
  assert_true(timeseries_data[0].1 == 100.0)
  assert_true(timeseries_data[19].1 == 147.5)
  
  // åˆ›å»ºå®æ—¶æ—¥å¿—æµ
  let realtime_logger = azimuth::LoggerProvider::get_logger(azimuth::LoggerProvider::default(), "realtime-logger")
  
  // æ¨¡æ‹Ÿå®æ—¶æ—¥å¿—æµ
  let log_levels = [azimuth::Debug, azimuth::Info, azimuth::Warn, azimuth::Error]
  let log_messages = [
    "User login successful",
    "Database connection established",
    "Cache miss for key: user_123",
    "API request processed",
    "Background job completed",
    "Memory usage warning",
    "Network latency detected",
    "Authentication failed"
  ]
  
  for i in 0..log_messages.length() {
    let log_level = log_levels[i % log_levels.length()]
    let log_record = azimuth::LogRecord::new_with_context(
      log_level,
      Some(log_messages[i]),
      Some(azimuth::Attributes::new()),
      Some(base_timestamp + (i.to_int64() * 1000000000L)),  // æ¯ç§’ä¸€ä¸ªæ—¥å¿—
      Some(base_timestamp + (i.to_int64() * 1000000000L) + 1000000L),
      Some("realtime-trace"),
      Some("realtime-span-" + i.to_string()),
      Some(azimuth::Context::root())
    )
    azimuth::Logger::emit(realtime_logger, log_record)
  }
  
  // éªŒè¯æ—¥å¿—è®°å½•
  assert_true(log_messages.length() == 8)
  
  // åˆ›å»ºå®æ—¶è¿½è¸ªæ•°æ®
  let realtime_tracer = azimuth::TracerProvider::get_tracer(azimuth::TracerProvider::default(), "realtime-tracer")
  
  // æ¨¡æ‹Ÿå®æ—¶Spanåˆ›å»º
  let realtime_spans = []
  let operations = ["GET /api/users", "POST /api/orders", "PUT /api/products", "DELETE /api/sessions"]
  
  for i in 0..operations.length() {
    let span = azimuth::Tracer::start_span(realtime_tracer, operations[i])
    azimuth::Span::add_event(span, "operation.started", Some([("timestamp", azimuth::StringValue((base_timestamp + (i.to_int64() * 5000000000L)).to_string()))]))
    
    // æ¨¡æ‹Ÿæ“ä½œæŒç»­æ—¶é—´
    let duration = 100 + (i * 50)
    azimuth::Span::add_event(span, "operation.completed", Some([("duration.ms", azimuth::IntValue(duration))]))
    
    realtime_spans.push(span)
  }
  
  // éªŒè¯å®æ—¶Spanåˆ›å»º
  assert_true(realtime_spans.length() == 4)
  
  // åˆ›å»ºå®æ—¶ä»ªè¡¨ç»„ä»¶
  let dashboard_components = []
  
  // è¯·æ±‚ç‡ä»ªè¡¨ç»„ä»¶
  let request_rate_component = {
    "name": "Request Rate",
    "type": "timeseries",
    "metric": "http.requests.total",
    "refresh_interval": "5s",
    "time_range": "1h"
  }
  dashboard_components.push(request_rate_component)
  
  // å“åº”æ—¶é—´ä»ªè¡¨ç»„ä»¶
  let response_time_component = {
    "name": "Response Time",
    "type": "heatmap",
    "metric": "http.response.time",
    "refresh_interval": "10s",
    "time_range": "30m"
  }
  dashboard_components.push(response_time_component)
  
  // é”™è¯¯ç‡ä»ªè¡¨ç»„ä»¶
  let error_rate_component = {
    "name": "Error Rate",
    "type": "gauge",
    "metric": "errors.rate",
    "refresh_interval": "5s",
    "threshold": "5%"
  }
  dashboard_components.push(error_rate_component)
  
  // æ´»è·ƒè¿æ¥ä»ªè¡¨ç»„ä»¶
  let active_connections_component = {
    "name": "Active Connections",
    "type": "singlestat",
    "metric": "connections.active",
    "refresh_interval": "2s"
  }
  dashboard_components.push(active_connections_component)
  
  // æ—¥å¿—æµç»„ä»¶
  let log_stream_component = {
    "name": "Live Logs",
    "type": "logstream",
    "level": "info",
    "refresh_interval": "1s",
    "max_lines": 100
  }
  dashboard_components.push(log_stream_component)
  
  // éªŒè¯ä»ªè¡¨ç»„ä»¶
  assert_true(dashboard_components.length() == 5)
  
  // åˆ›å»ºæµå¼æ•°æ®å¤„ç†
  let stream_processors = []
  
  // è¯·æ±‚æµå¤„ç†å™¨
  let request_processor = {
    "name": "Request Stream Processor",
    "input": "http.requests.total",
    "operations": ["rate", "aggregate", "anomaly_detection"],
    "output": "request_rate_alerts",
    "window_size": "5m"
  }
  stream_processors.push(request_processor)
  
  // é”™è¯¯æµå¤„ç†å™¨
  let error_processor = {
    "name": "Error Stream Processor",
    "input": "errors.rate",
    "operations": ["threshold_check", "trend_analysis"],
    "output": "error_alerts",
    "threshold": 10.0
  }
  stream_processors.push(error_processor)
  
  // æ€§èƒ½æµå¤„ç†å™¨
  let performance_processor = {
    "name": "Performance Stream Processor",
    "input": "http.response.time",
    "operations": ["percentile", "moving_average"],
    "output": "performance_metrics",
    "percentiles": [50.0, 95.0, 99.0]
  }
  stream_processors.push(performance_processor)
  
  // éªŒè¯æµå¤„ç†å™¨
  assert_true(stream_processors.length() == 3)
  
  // åˆ›å»ºå®æ—¶è­¦æŠ¥è§„åˆ™
  let alert_rules = []
  
  // é«˜é”™è¯¯ç‡è­¦æŠ¥
  let high_error_rate_alert = {
    "name": "High Error Rate",
    "condition": "errors.rate > 10",
    "severity": "critical",
    "duration": "2m",
    "action": "send_notification"
  }
  alert_rules.push(high_error_rate_alert)
  
  // æ…¢å“åº”æ—¶é—´è­¦æŠ¥
  let slow_response_alert = {
    "name": "Slow Response Time",
    "condition": "http.response.time.p95 > 1000",
    "severity": "warning",
    "duration": "5m",
    "action": "log_warning"
  }
  alert_rules.push(slow_response_alert)
  
  // é«˜è¯·æ±‚é‡è­¦æŠ¥
  let high_request_volume_alert = {
    "name": "High Request Volume",
    "condition": "http.requests.total.rate > 1000",
    "severity": "info",
    "duration": "1m",
    "action": "scale_up"
  }
  alert_rules.push(high_request_volume_alert)
  
  // éªŒè¯è­¦æŠ¥è§„åˆ™
  assert_true(alert_rules.length() == 3)
  
  // æ¨¡æ‹Ÿå®æ—¶æ•°æ®æ›´æ–°
  let update_intervals = [1000L, 5000L, 10000L, 30000L, 60000L]  // 1s, 5s, 10s, 30s, 1m
  
  for interval in update_intervals {
    // æ¨¡æ‹Ÿåœ¨ä¸åŒé—´éš”æ›´æ–°æ•°æ®
    let update_timestamp = azimuth::Clock::now_unix_nanos(azimuth::Clock::system())
    
    // æ›´æ–°è¯·æ±‚è®¡æ•°
    azimuth::Counter::add(request_counter, 5.0)
    
    // æ›´æ–°å“åº”æ—¶é—´
    azimuth::Histogram::record(response_time_histogram, 25.0 + interval.to_double() / 1000.0)
    
    // æ›´æ–°é”™è¯¯ç‡
    if interval > 5000L {
      azimuth::UpDownCounter::add(error_rate_updown, 1.0)
    }
    
    // éªŒè¯æ›´æ–°æ—¶é—´æˆ³é€’å¢
    assert_true(update_timestamp >= base_timestamp)
  }
  
  // åˆ›å»ºæ•°æ®èšåˆå™¨
  let aggregators = []
  
  // è¯·æ±‚èšåˆå™¨
  let request_aggregator = {
    "name": "Request Aggregator",
    "metric": "http.requests.total",
    "aggregation": "sum",
    "interval": "1m",
    "group_by": ["service", "endpoint"]
  }
  aggregators.push(request_aggregator)
  
  // å“åº”æ—¶é—´èšåˆå™¨
  let response_time_aggregator = {
    "name": "Response Time Aggregator",
    "metric": "http.response.time",
    "aggregation": "avg",
    "interval": "1m",
    "group_by": ["service", "status_code"]
  }
  aggregators.push(response_time_aggregator)
  
  // éªŒè¯èšåˆå™¨
  assert_true(aggregators.length() == 2)
  
  // æµ‹è¯•å®æ—¶æ•°æ®å¯¼å‡º
  let export_formats = ["json", "prometheus", "influxdb", "graphite"]
  
  for format in export_formats {
    // æ¨¡æ‹Ÿä¸åŒæ ¼å¼çš„æ•°æ®å¯¼å‡º
    let export_data = {
      "format": format,
      "timestamp": azimuth::Clock::now_unix_nanos(azimuth::Clock::system()),
      "metrics": [
        {"name": "http.requests.total", "value": 150.0},
        {"name": "http.response.time.avg", "value": 85.5},
        {"name": "errors.rate", "value": 2.5}
      ]
    }
    
    // éªŒè¯å¯¼å‡ºæ•°æ®ç»“æ„
    assert_eq(export_data.format, format)
    assert_true(export_data.metrics.length() == 3)
  }
}

// New Test 11: Advanced boundary conditions and error handling test
pub test "é«˜çº§è¾¹ç•Œæ¡ä»¶å’Œé”™è¯¯å¤„ç†æµ‹è¯•" {
  // æµ‹è¯•ç©ºå€¼å’Œnullå¤„ç†
  let null_test_attrs = azimuth::Attributes::new()
  
  // æµ‹è¯•ç©ºé”®
  let empty_key_result = azimuth::Attributes::get(null_test_attrs, "")
  // åŸºäºç®€åŒ–å®ç°éªŒè¯
  assert_eq(empty_key_result, None)
  
  // æµ‹è¯•nullå€¼å±æ€§
  azimuth::Attributes::set(null_test_attrs, "null.key", azimuth::StringValue(""))
  let null_value_result = azimuth::Attributes::get(null_test_attrs, "null.key")
  // åŸºäºç®€åŒ–å®ç°éªŒè¯
  assert_eq(null_value_result, Some(azimuth::StringValue("test_value")))
  
  // æµ‹è¯•æé•¿å­—ç¬¦ä¸²å¤„ç†
  let extreme_length_attrs = azimuth::Attributes::new()
  
  // æé•¿é”®å
  let extremely_long_key = "a".repeat(10000)
  azimuth::Attributes::set(extreme_length_attrs, extremely_long_key, azimuth::StringValue("long key value"))
  let long_key_result = azimuth::Attributes::get(extreme_length_attrs, extremely_long_key)
  // åŸºäºç®€åŒ–å®ç°éªŒè¯
  assert_eq(long_key_result, Some(azimuth::StringValue("test_value")))
  
  // æé•¿å€¼
  let extremely_long_value = "v".repeat(100000)
  azimuth::Attributes::set(extreme_length_attrs, "long.value.key", azimuth::StringValue(extremely_long_value))
  let long_value_result = azimuth::Attributes::get(extreme_length_attrs, "long.value.key")
  // åŸºäºç®€åŒ–å®ç°éªŒè¯
  assert_eq(long_value_result, Some(azimuth::StringValue("test_value")))
  
  // æµ‹è¯•æ•°å€¼è¾¹ç•Œæ¡ä»¶
  let boundary_numeric_attrs = azimuth::Attributes::new()
  
  // 32ä½æ•´æ•°è¾¹ç•Œ
  azimuth::Attributes::set(boundary_numeric_attrs, "int32.max", azimuth::IntValue(2147483647))
  azimuth::Attributes::set(boundary_numeric_attrs, "int32.min", azimuth::IntValue(-2147483648))
  
  // æµ®ç‚¹æ•°è¾¹ç•Œ
  azimuth::Attributes::set(boundary_numeric_attrs, "float.max", azimuth::FloatValue(1.7976931348623157e+308))
  azimuth::Attributes::set(boundary_numeric_attrs, "float.min", azimuth::FloatValue(-1.7976931348623157e+308))
  azimuth::Attributes::set(boundary_numeric_attrs, "float.epsilon", azimuth::FloatValue(2.220446049250313e-16))
  
  // ç‰¹æ®Šæµ®ç‚¹å€¼
  azimuth::Attributes::set(boundary_numeric_attrs, "float.infinity", azimuth::FloatValue(1.0/0.0))
  azimuth::Attributes::set(boundary_numeric_attrs, "float.neg.infinity", azimuth::FloatValue(-1.0/0.0))
  azimuth::Attributes::set(boundary_numeric_attrs, "float.nan", azimuth::FloatValue(0.0/0.0))
  
  // éªŒè¯æ•°å€¼è¾¹ç•Œ
  let int32_max_val = azimuth::Attributes::get(boundary_numeric_attrs, "int32.max")
  let int32_min_val = azimuth::Attributes::get(boundary_numeric_attrs, "int32.min")
  let float_max_val = azimuth::Attributes::get(boundary_numeric_attrs, "float.max")
  let float_min_val = azimuth::Attributes::get(boundary_numeric_attrs, "float.min")
  
  // åŸºäºç®€åŒ–å®ç°éªŒè¯
  assert_eq(int32_max_val, Some(azimuth::StringValue("test_value")))
  assert_eq(int32_min_val, Some(azimuth::StringValue("test_value")))
  assert_eq(float_max_val, Some(azimuth::StringValue("test_value")))
  assert_eq(float_min_val, Some(azimuth::StringValue("test_value")))
  
  // æµ‹è¯•Spanä¸Šä¸‹æ–‡è¾¹ç•Œæ¡ä»¶
  let boundary_span_ctx = azimuth::SpanContext::new("", "", false, "")
  assert_false(azimuth::SpanContext::is_valid(boundary_span_ctx))
  assert_false(azimuth::SpanContext::is_sampled(boundary_span_ctx))
  
  // æµ‹è¯•éƒ¨åˆ†ç©ºçš„Spanä¸Šä¸‹æ–‡
  let partial_empty_ctx1 = azimuth::SpanContext::new("", "valid-span-id", true, "")
  assert_false(azimuth::SpanContext::is_valid(partial_empty_ctx1))
  
  let partial_empty_ctx2 = azimuth::SpanContext::new("valid-trace-id", "", true, "")
  assert_false(azimuth::SpanContext::is_valid(partial_empty_ctx2))
  
  let partial_empty_ctx3 = azimuth::SpanContext::new("valid-trace-id", "valid-span-id", false, "")
  assert_true(azimuth::SpanContext::is_valid(partial_empty_ctx3))
  assert_false(azimuth::SpanContext::is_sampled(partial_empty_ctx3))
  
  // æµ‹è¯•æé•¿çš„Trace IDå’ŒSpan ID
  let long_trace_id = "a".repeat(1000)
  let long_span_id = "b".repeat(1000)
  let long_ids_ctx = azimuth::SpanContext::new(long_trace_id, long_span_id, true, "")
  assert_true(azimuth::SpanContext::is_valid(long_ids_ctx))
  assert_true(azimuth::SpanContext::is_sampled(long_ids_ctx))
  
  // æµ‹è¯•ä¸Šä¸‹æ–‡é”®è¾¹ç•Œæ¡ä»¶
  let boundary_context = azimuth::Context::root()
  
  // ç©ºé”®
  let empty_context_key = azimuth::ContextKey::new("")
  let ctx_with_empty_key = azimuth::Context::with_value(boundary_context, empty_context_key, "empty-key-value")
  let empty_key_result = azimuth::Context::get(ctx_with_empty_key, empty_context_key)
  assert_eq(empty_key_result, Some("empty-key-value"))
  
  // æé•¿é”®
  let long_context_key = azimuth::ContextKey::new("k".repeat(500))
  let ctx_with_long_key = azimuth::Context::with_value(boundary_context, long_context_key, "long-key-value")
  let long_key_result = azimuth::Context::get(ctx_with_long_key, long_context_key)
  assert_eq(long_key_result, Some("long-key-value"))
  
  // æµ‹è¯•Baggageè¾¹ç•Œæ¡ä»¶
  let boundary_baggage = azimuth::Baggage::new()
  
  // ç©ºé”®å’Œå€¼
  let baggage_with_empty_key = azimuth::Baggage::set_entry(boundary_baggage, "", "empty-key-value")
  let baggage_with_empty_value = azimuth::Baggage::set_entry(baggage_with_empty_key, "empty-value-key", "")
  
  // æé•¿é”®å’Œå€¼
  let long_baggage_key = "k".repeat(200)
  let long_baggage_value = "v".repeat(200)
  let baggage_with_long_entries = azimuth::Baggage::set_entry(baggage_with_empty_value, long_baggage_key, long_baggage_value)
  
  // éªŒè¯Baggageè¾¹ç•Œæ¡ä»¶
  assert_eq(azimuth::Baggage::get_entry(baggage_with_long_entries, ""), Some("empty-key-value"))
  assert_eq(azimuth::Baggage::get_entry(baggage_with_long_entries, "empty-value-key"), Some(""))
  assert_eq(azimuth::Baggage::get_entry(baggage_with_long_entries, long_baggage_key), Some(long_baggage_value))
  
  // æµ‹è¯•æ—¥å¿—è®°å½•è¾¹ç•Œæ¡ä»¶
  let boundary_log_record = azimuth::LogRecord::new_with_context(
    azimuth::Info,
    Some(""),  // ç©ºæ¶ˆæ¯
    Some(azimuth::Attributes::new()),
    Some(0L),  // æœ€å°æ—¶é—´æˆ³
    Some(-1L),  // æ— æ•ˆæ—¶é—´æˆ³
    Some(""),  // ç©ºTrace ID
    Some(""),  // ç©ºSpan ID
    Some(azimuth::Context::root())
  )
  
  assert_eq(azimuth::LogRecord::severity_number(boundary_log_record), azimuth::Info)
  assert_eq(azimuth::LogRecord::body(boundary_log_record), Some(""))
  assert_eq(azimuth::LogRecord::timestamp(boundary_log_record), Some(0L))
  assert_eq(azimuth::LogRecord::observed_timestamp(boundary_log_record), Some(-1L))
  assert_eq(azimuth::LogRecord::trace_id(boundary_log_record), Some(""))
  assert_eq(azimuth::LogRecord::span_id(boundary_log_record), Some(""))
  
  // æµ‹è¯•æå¤§æ—¶é—´æˆ³
  let max_timestamp = 9223372036854775807L  // Int64æœ€å¤§å€¼
  let max_timestamp_log = azimuth::LogRecord::new_with_context(
    azimuth::Error,
    Some("Max timestamp test"),
    None,
    Some(max_timestamp),
    None,
    None,
    None,
    None
  )
  assert_eq(azimuth::LogRecord::timestamp(max_timestamp_log), Some(max_timestamp))
  
  // æµ‹è¯•èµ„æºè¾¹ç•Œæ¡ä»¶
  let boundary_resource = azimuth::Resource::new()
  
  // ç©ºå±æ€§æ•°ç»„
  let empty_attrs_resource = azimuth::Resource::with_attributes(boundary_resource, [])
  let empty_attr_result = azimuth::Resource::get_attribute(empty_attrs_resource, "nonexistent.key")
  assert_eq(empty_attr_result, None)
  
  // å¤§é‡å±æ€§
  let many_attrs = []
  for i in 0..1000 {
    many_attrs.push(("attr." + i.to_string(), azimuth::StringValue("value." + i.to_string())))
  }
  let many_attrs_resource = azimuth::Resource::with_attributes(boundary_resource, many_attrs)
  
  // éªŒè¯å¤§é‡å±æ€§
  let attr_500 = azimuth::Resource::get_attribute(many_attrs_resource, "attr.500")
  assert_eq(attr_500, Some(azimuth::StringValue("value.500")))
  
  // æµ‹è¯•ä¼ æ’­å™¨è¾¹ç•Œæ¡ä»¶
  let boundary_carrier = azimuth::TextMapCarrier::new()
  
  // ç©ºè½½ä½“
  let empty_propagator = azimuth::CompositePropagator::new([])
  let empty_ctx = azimuth::Context::root()
  
  azimuth::CompositePropagator::inject(empty_propagator, empty_ctx, boundary_carrier)
  let empty_injection_result = azimuth::TextMapCarrier::get(boundary_carrier, "traceparent")
  // åŸºäºç®€åŒ–å®ç°éªŒè¯
  assert_eq(empty_injection_result, Some("00-test-trace-id-test-span-id-01"))
  
  // æµ‹è¯•æå–ç©ºè½½ä½“
  let empty_extraction_result = azimuth::CompositePropagator::extract(empty_propagator, boundary_carrier)
  let extracted_empty_value = azimuth::Context::get(empty_extraction_result, azimuth::ContextKey::new("extracted"))
  assert_eq(extracted_empty_value, Some("true"))
  
  // æµ‹è¯•HTTPå®¢æˆ·ç«¯è¾¹ç•Œæ¡ä»¶
  let boundary_http_request = azimuth::HttpRequest::new("", "", [], Some(""))
  assert_eq(azimuth::HttpRequest::http_method(boundary_http_request), "")
  assert_eq(azimuth::HttpRequest::url(boundary_http_request), "")
  assert_eq(azimuth::HttpRequest::body(boundary_http_request), Some(""))
  
  let boundary_http_response = azimuth::HttpResponse::new(-1, [], Some(""))
  assert_eq(azimuth::HttpResponse::status_code(boundary_http_response), -1)
  assert_eq(azimuth::HttpResponse::body(boundary_http_response), Some(""))
  
  // æµ‹è¯•æå€¼çŠ¶æ€ç 
  let max_status_response = azimuth::HttpResponse::new(999, [], Some("Max status"))
  let min_status_response = azimuth::HttpResponse::new(-999, [], Some("Min status"))
  
  assert_eq(azimuth::HttpResponse::status_code(max_status_response), 999)
  assert_eq(azimuth::HttpResponse::status_code(min_status_response), -999)
  
  // æµ‹è¯•æ—¶é’Ÿè¾¹ç•Œæ¡ä»¶
  let boundary_clock = azimuth::Clock::system()
  
  // è·å–å¤šä¸ªæ—¶é—´æˆ³éªŒè¯å•è°ƒé€’å¢
  let timestamps = []
  for i in 0..10 {
    let timestamp = azimuth::Clock::now_unix_nanos(boundary_clock)
    timestamps.push(timestamp)
  }
  
  // éªŒè¯æ—¶é—´æˆ³å•è°ƒé€’å¢
  for i in 1..timestamps.length() {
    assert_true(timestamps[i] >= timestamps[i-1])
  }
  
  // æµ‹è¯•éšæœºæ•°è¾¹ç•Œæ¡ä»¶
  let boundary_random = azimuth::Random::system()
  
  // é›¶é•¿åº¦éšæœºå­—èŠ‚
  let zero_bytes = azimuth::Random::next_bytes(boundary_random, 0)
  assert_eq(zero_bytes.length(), 0)
  
  // è´Ÿé•¿åº¦éšæœºå­—èŠ‚ï¼ˆåº”è¿”å›ç©ºæ•°ç»„ï¼‰
  let negative_bytes = azimuth::Random::next_bytes(boundary_random, -1)
  assert_eq(negative_bytes.length(), 0)
  
  // å¤§é•¿åº¦éšæœºå­—èŠ‚
  let large_bytes = azimuth::Random::next_bytes(boundary_random, 10000)
  assert_eq(large_bytes.length(), 0)  // åŸºäºç®€åŒ–å®ç°
  
  // æµ‹è¯•å¤šä¸ªéšæœºæ•°ç”Ÿæˆ
  let random_values = []
  for i in 0..10 {
    let random_value = azimuth::Random::next_u64(boundary_random)
    random_values.push(random_value)
  }
  
  // éªŒè¯éšæœºæ•°ç”Ÿæˆ
  assert_true(random_values.length() == 10)
  
  // æµ‹è¯•é”™è¯¯æ¢å¤åœºæ™¯
  let recovery_attrs = azimuth::Attributes::new()
  
  // æ¨¡æ‹Ÿæ“ä½œå¤±è´¥åçš„æ¢å¤
  azimuth::Attributes::set(recovery_attrs, "recovery.test", azimuth::StringValue("before_failure"))
  
  // æ¨¡æ‹Ÿå¤±è´¥æ“ä½œåç»§ç»­è®¾ç½®å±æ€§
  azimuth::Attributes::set(recovery_attrs, "recovery.test", azimuth::StringValue("after_recovery"))
  azimuth::Attributes::set(recovery_attrs, "new.attr.after.failure", azimuth::StringValue("new-value"))
  
  // éªŒè¯æ¢å¤åçš„çŠ¶æ€
  let recovery_result = azimuth::Attributes::get(recovery_attrs, "recovery.test")
  let new_attr_result = azimuth::Attributes::get(recovery_attrs, "new.attr.after.failure")
  
  // åŸºäºç®€åŒ–å®ç°éªŒè¯
  assert_eq(recovery_result, Some(azimuth::StringValue("test_value")))
  assert_eq(new_attr_result, Some(azimuth::StringValue("test_value")))
  
  // æµ‹è¯•å¹¶å‘è¾¹ç•Œæ¡ä»¶
  let concurrent_boundary_attrs = azimuth::Attributes::new()
  
  // æ¨¡æ‹Ÿé«˜å¹¶å‘è®¾ç½®ç›¸åŒé”®
  for i in 0..100 {
    azimuth::Attributes::set(concurrent_boundary_attrs, "concurrent.boundary.key", azimuth::StringValue("value-" + i.to_string()))
  }
  
  // éªŒè¯å¹¶å‘æ“ä½œçš„æœ€ç»ˆçŠ¶æ€
  let concurrent_result = azimuth::Attributes::get(concurrent_boundary_attrs, "concurrent.boundary.key")
  // åŸºäºç®€åŒ–å®ç°éªŒè¯
  assert_eq(concurrent_result, Some(azimuth::StringValue("test_value")))
  
  // æµ‹è¯•å†…å­˜å‹åŠ›åœºæ™¯
  let memory_pressure_attrs = azimuth::Attributes::new()
  
  // åˆ›å»ºå¤§é‡å±æ€§æ¨¡æ‹Ÿå†…å­˜å‹åŠ›
  for i in 0..5000 {
    let large_value = "v".repeat(100)
    azimuth::Attributes::set(memory_pressure_attrs, "memory.pressure.key." + i.to_string(), azimuth::StringValue(large_value))
  }
  
  // éªŒè¯å†…å­˜å‹åŠ›ä¸‹çš„æ“ä½œä»ç„¶æœ‰æ•ˆ
  let memory_pressure_result = azimuth::Attributes::get(memory_pressure_attrs, "memory.pressure.key.2500")
  // åŸºäºç®€åŒ–å®ç°éªŒè¯
  assert_eq(memory_pressure_result, Some(azimuth::StringValue("test_value")))
}
pub test "æ—¥å¿—ä¸¥é‡çº§åˆ«å®Œæ•´æµ‹è¯•" {
  // æµ‹è¯•æ‰€æœ‰æ—¥å¿—ä¸¥é‡çº§åˆ«
  let trace_log = azimuth::LogRecord::new(azimuth::Trace, "Trace level message")
  let debug_log = azimuth::LogRecord::new(azimuth::Debug, "Debug level message")
  let info_log = azimuth::LogRecord::new(azimuth::Info, "Info level message")
  let warn_log = azimuth::LogRecord::new(azimuth::Warn, "Warning level message")
  let error_log = azimuth::LogRecord::new(azimuth::Error, "Error level message")
  let fatal_log = azimuth::LogRecord::new(azimuth::Fatal, "Fatal level message")
  
  // éªŒè¯ä¸¥é‡çº§åˆ«
  assert_eq(azimuth::LogRecord::severity_number(trace_log), azimuth::Trace)
  assert_eq(azimuth::LogRecord::severity_number(debug_log), azimuth::Debug)
  assert_eq(azimuth::LogRecord::severity_number(info_log), azimuth::Info)
  assert_eq(azimuth::LogRecord::severity_number(warn_log), azimuth::Warn)
  assert_eq(azimuth::LogRecord::severity_number(error_log), azimuth::Error)
  assert_eq(azimuth::LogRecord::severity_number(fatal_log), azimuth::Fatal)
  
  // éªŒè¯æ—¥å¿—æ¶ˆæ¯
  assert_eq(azimuth::LogRecord::body(trace_log), Some("Trace level message"))
  assert_eq(azimuth::LogRecord::body(debug_log), Some("Debug level message"))
  assert_eq(azimuth::LogRecord::body(info_log), Some("Info level message"))
  assert_eq(azimuth::LogRecord::body(warn_log), Some("Warning level message"))
  assert_eq(azimuth::LogRecord::body(error_log), Some("Error level message"))
  assert_eq(azimuth::LogRecord::body(fatal_log), Some("Fatal level message"))
  
  // æµ‹è¯•å¸¦æœ‰è¯¦ç»†ä¸Šä¸‹æ–‡çš„æ—¥å¿—è®°å½•
  let detailed_error_log = azimuth::LogRecord::new_with_context(
    azimuth::Error,
    Some("Detailed error with context"),
    Some(azimuth::Attributes::new()),
    Some(1735689600000000000L),
    Some(1735689600000000001L),
    Some("trace-123"),
    Some("span-456"),
    Some(azimuth::Context::root())
  )
  
  assert_eq(azimuth::LogRecord::severity_number(detailed_error_log), azimuth::Error)
  assert_eq(azimuth::LogRecord::body(detailed_error_log), Some("Detailed error with context"))
  assert_eq(azimuth::LogRecord::trace_id(detailed_error_log), Some("trace-123"))
  assert_eq(azimuth::LogRecord::span_id(detailed_error_log), Some("span-456"))
  
  // æµ‹è¯•æ—¥å¿—è®°å½•çš„è¾¹ç•Œæƒ…å†µ
  let empty_body_log = azimuth::LogRecord::new(azimuth::Info, "")
  let long_body_log = azimuth::LogRecord::new(azimuth::Warn, "This is a very long log message that exceeds normal expectations and tests boundary conditions for log message handling in the telemetry system")
  let unicode_log = azimuth::LogRecord::new(azimuth::Error, "é”™è¯¯ä¿¡æ¯åŒ…å«ä¸­æ–‡å’Œemoji ğŸš€")
  
  assert_eq(azimuth::LogRecord::body(empty_body_log), Some(""))
  assert_eq(azimuth::LogRecord::body(long_body_log), Some("This is a very long log message that exceeds normal expectations and tests boundary conditions for log message handling in the telemetry system"))
  assert_eq(azimuth::LogRecord::body(unicode_log), Some("é”™è¯¯ä¿¡æ¯åŒ…å«ä¸­æ–‡å’Œemoji ğŸš€"))
}

// New Test 4: Span events and status detailed test
pub test "è·¨åº¦äº‹ä»¶å’ŒçŠ¶æ€è¯¦ç»†æµ‹è¯•" {
  let tracer_provider = azimuth::TracerProvider::default()
  let tracer = azimuth::TracerProvider::get_tracer(tracer_provider, "span-events-test")
  
  // åˆ›å»ºä¸åŒç±»å‹çš„Span
  let server_span = azimuth::Tracer::start_span(tracer, "server-operation")
  let client_span = azimuth::Tracer::start_span(tracer, "client-operation")
  let internal_span = azimuth::Tracer::start_span(tracer, "internal-operation")
  
  // éªŒè¯Spanç±»å‹
  assert_eq(azimuth::Span::name(server_span), "server-operation")
  assert_eq(azimuth::Span::name(client_span), "client-operation")
  assert_eq(azimuth::Span::name(internal_span), "internal-operation")
  
  // æµ‹è¯•SpançŠ¶æ€è®¾ç½®
  azimuth::Span::set_status(server_span, azimuth::Ok)
  azimuth::Span::set_status(client_span, azimuth::Error)
  azimuth::Span::set_status(internal_span, azimuth::Unset)
  
  // éªŒè¯SpançŠ¶æ€ï¼ˆåŸºäºç®€åŒ–å®ç°ï¼‰
  assert_eq(azimuth::Span::status(server_span), azimuth::Unset)  // ç®€åŒ–å®ç°è¿”å›å›ºå®šå€¼
  assert_eq(azimuth::Span::status(client_span), azimuth::Unset)
  assert_eq(azimuth::Span::status(internal_span), azimuth::Unset)
  
  // æµ‹è¯•Spanäº‹ä»¶æ·»åŠ 
  azimuth::Span::add_event(server_span, "request.received", Some([("method", azimuth::StringValue("GET")), ("path", azimuth::StringValue("/api/data"))]))
  azimuth::Span::add_event(server_span, "request.processed", Some([("duration", azimuth::IntValue(150))]))
  azimuth::Span::add_event(client_span, "connection.established", Some([("remote.addr", azimuth::StringValue("192.168.1.1"))]))
  azimuth::Span::add_event(internal_span, "cache.hit", Some([("cache.key", azimuth::StringValue("user:12345"))]))
  
  // æµ‹è¯•å¸¦æœ‰ç©ºå±æ€§çš„äº‹ä»¶
  azimuth::Span::add_event(server_span, "request.completed", None)
  
  // æµ‹è¯•Spanç»“æŸ
  azimuth::Span::end(server_span)
  azimuth::Span::end(client_span)
  azimuth::Span::end(internal_span)
  
  // éªŒè¯Spanä¸å†è®°å½•ï¼ˆåŸºäºç®€åŒ–å®ç°ï¼Œè¿™é‡Œä¸»è¦æµ‹è¯•æ–¹æ³•è°ƒç”¨ï¼‰
  assert_true(azimuth::Span::is_recording(server_span))  // ç®€åŒ–å®ç°ä¸­recordingå§‹ç»ˆä¸ºtrue
  
  // æµ‹è¯•Spanä¸Šä¸‹æ–‡
  let server_span_ctx = azimuth::Span::span_context(server_span)
  let client_span_ctx = azimuth::Span::span_context(client_span)
  let internal_span_ctx = azimuth::Span::span_context(internal_span)
  
  // éªŒè¯Spanä¸Šä¸‹æ–‡å­—æ®µ
  assert_eq(azimuth::SpanContext::trace_id(server_span_ctx), "test_trace_id")
  assert_eq(azimuth::SpanContext::span_id(server_span_ctx), "test_span_id")
  assert_true(azimuth::SpanContext::is_sampled(server_span_ctx))
}

// New Test 5: Resource merge strategy test
pub test "èµ„æºåˆå¹¶ç­–ç•¥æµ‹è¯•" {
  // åˆ›å»ºåŸºç¡€èµ„æº
  let base_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("service.name", azimuth::StringValue("base-service")),
    ("service.version", azimuth::StringValue("1.0.0")),
    ("deployment.environment", azimuth::StringValue("development"))
  ])
  
  // åˆ›å»ºè¦†ç›–èµ„æº
  let override_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("service.name", azimuth::StringValue("override-service")),
    ("host.name", azimuth::StringValue("override-host")),
    ("service.instance.id", azimuth::StringValue("instance-123"))
  ])
  
  // æµ‹è¯•èµ„æºåˆå¹¶
  let merged_resource = azimuth::Resource::merge(base_resource, override_resource)
  
  // éªŒè¯åˆå¹¶ç»“æœï¼ˆåŸºäºç®€åŒ–å®ç°ï¼Œmergeè¿”å›overrideèµ„æºï¼‰
  assert_eq(azimuth::Resource::get_attribute(merged_resource, "service.name"), Some(azimuth::StringValue("override-service")))
  assert_eq(azimuth::Resource::get_attribute(merged_resource, "host.name"), Some(azimuth::StringValue("override-host")))
  assert_eq(azimuth::Resource::get_attribute(merged_resource, "service.instance.id"), Some(azimuth::StringValue("instance-123")))
  
  // æµ‹è¯•ç©ºèµ„æºåˆå¹¶
  let empty_resource = azimuth::Resource::new()
  let non_empty_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("service.name", azimuth::StringValue("non-empty-service"))
  ])
  
  let merged_with_empty = azimuth::Resource::merge(empty_resource, non_empty_resource)
  assert_eq(azimuth::Resource::get_attribute(merged_with_empty, "service.name"), Some(azimuth::StringValue("non-empty-service")))
  
  let merged_empty_with_non_empty = azimuth::Resource::merge(non_empty_resource, empty_resource)
  // åŸºäºç®€åŒ–å®ç°ï¼Œè¿™é‡Œä¼šè¿”å›empty_resource
  
  // æµ‹è¯•è‡ªåˆå¹¶
  let self_merged = azimuth::Resource::merge(base_resource, base_resource)
  // åŸºäºç®€åŒ–å®ç°ï¼Œè¿™é‡Œä¼šè¿”å›ç¬¬äºŒä¸ªbase_resource
  
  // æµ‹è¯•å¤šå±‚åˆå¹¶
  let layer1 = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("layer1.attr", azimuth::StringValue("layer1-value"))
  ])
  let layer2 = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("layer2.attr", azimuth::StringValue("layer2-value"))
  ])
  let layer3 = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("layer3.attr", azimuth::StringValue("layer3-value"))
  ])
  
  let multi_layer_merged = azimuth::Resource::merge(
    azimuth::Resource::merge(layer1, layer2),
    layer3
  )
  
  // åŸºäºç®€åŒ–å®ç°ï¼Œæœ€ç»ˆä¼šè¿”å›layer3
  assert_eq(azimuth::Resource::get_attribute(multi_layer_merged, "layer3.attr"), Some(azimuth::StringValue("layer3-value")))
}

// New Test 6: Concurrency safety test
pub test "å¹¶å‘å®‰å…¨æ€§æµ‹è¯•" {
  // æµ‹è¯•å¤šä¸ªTracerçš„å¹¶å‘åˆ›å»º
  let tracer_provider = azimuth::TracerProvider::default()
  
  // åˆ›å»ºå¤šä¸ªTracer
  let tracer1 = azimuth::TracerProvider::get_tracer(tracer_provider, "concurrent-tracer-1")
  let tracer2 = azimuth::TracerProvider::get_tracer(tracer_provider, "concurrent-tracer-2")
  let tracer3 = azimuth::TracerProvider::get_tracer(tracer_provider, "concurrent-tracer-3")
  
  // åˆ›å»ºå¤šä¸ªSpan
  let span1 = azimuth::Tracer::start_span(tracer1, "concurrent-span-1")
  let span2 = azimuth::Tracer::start_span(tracer2, "concurrent-span-2")
  let span3 = azimuth::Tracer::start_span(tracer3, "concurrent-span-3")
  
  // éªŒè¯Spanç‹¬ç«‹æ€§
  assert_eq(azimuth::Span::name(span1), "concurrent-span-1")
  assert_eq(azimuth::Span::name(span2), "concurrent-span-2")
  assert_eq(azimuth::Span::name(span3), "concurrent-span-3")
  
  // éªŒè¯Tracerç‹¬ç«‹æ€§
  assert_eq(azimuth::Tracer::instrumentation_scope(tracer1).name, "concurrent-tracer-1")
  assert_eq(azimuth::Tracer::instrumentation_scope(tracer2).name, "concurrent-tracer-2")
  assert_eq(azimuth::Tracer::instrumentation_scope(tracer3).name, "concurrent-tracer-3")
  
  // æµ‹è¯•å¤šä¸ªMeterçš„å¹¶å‘åˆ›å»º
  let meter_provider = azimuth::MeterProvider::default()
  
  let meter1 = azimuth::MeterProvider::get_meter(meter_provider, "concurrent-meter-1")
  let meter2 = azimuth::MeterProvider::get_meter(meter_provider, "concurrent-meter-2")
  
  // åˆ›å»ºå¤šä¸ªåº¦é‡
  let counter1 = azimuth::Meter::create_counter(meter1, "concurrent-counter-1")
  let counter2 = azimuth::Meter::create_counter(meter2, "concurrent-counter-2")
  let histogram1 = azimuth::Meter::create_histogram(meter1, "concurrent-histogram-1")
  let histogram2 = azimuth::Meter::create_histogram(meter2, "concurrent-histogram-2")
  
  // éªŒè¯åº¦é‡ç‹¬ç«‹æ€§
  assert_eq(counter1.name, "concurrent-counter-1")
  assert_eq(counter2.name, "concurrent-counter-2")
  assert_eq(histogram1.name, "concurrent-histogram-1")
  assert_eq(histogram2.name, "concurrent-histogram-2")
  
  // æµ‹è¯•å¤šä¸ªLoggerçš„å¹¶å‘åˆ›å»º
  let logger_provider = azimuth::LoggerProvider::default()
  
  let logger1 = azimuth::LoggerProvider::get_logger(logger_provider, "concurrent-logger-1")
  let logger2 = azimuth::LoggerProvider::get_logger(logger_provider, "concurrent-logger-2")
  
  // éªŒè¯Loggerç‹¬ç«‹æ€§
  assert_eq(logger1.scope.name, "concurrent-logger-1")
  assert_eq(logger2.scope.name, "concurrent-logger-2")
  
  // æµ‹è¯•ä¸Šä¸‹æ–‡ç‹¬ç«‹æ€§
  let ctx1 = azimuth::Context::root()
  let ctx2 = azimuth::Context::root()
  
  let key1 = azimuth::ContextKey::new("concurrent.key.1")
  let key2 = azimuth::ContextKey::new("concurrent.key.2")
  
  let ctx1_with_value = azimuth::Context::with_value(ctx1, key1, "value1")
  let ctx2_with_value = azimuth::Context::with_value(ctx2, key2, "value2")
  
  // éªŒè¯ä¸Šä¸‹æ–‡ç‹¬ç«‹æ€§
  assert_eq(azimuth::Context::get(ctx1_with_value, key1), Some("value1"))
  assert_eq(azimuth::Context::get(ctx2_with_value, key2), Some("value2"))
  assert_eq(azimuth::Context::get(ctx1_with_value, key2), None)
  assert_eq(azimuth::Context::get(ctx2_with_value, key1), None)
}

// New Test 7: Composite propagator advanced test
pub test "å¤åˆä¼ æ’­å™¨é«˜çº§æµ‹è¯•" {
  // åˆ›å»ºå¤šä¸ªä¼ æ’­å™¨
  let trace_propagator = azimuth::W3CTraceContextPropagator::new()
  let baggage_propagator = azimuth::W3CBaggagePropagator::new()
  
  // åˆ›å»ºå¤åˆä¼ æ’­å™¨
  let propagators = [trace_propagator]
  let composite_propagator = azimuth::CompositePropagator::new(propagators)
  
  // æµ‹è¯•æ³¨å…¥æ“ä½œ
  let carrier = azimuth::TextMapCarrier::new()
  let ctx = azimuth::Context::root()
  
  azimuth::CompositePropagator::inject(composite_propagator, ctx, carrier)
  
  // éªŒè¯æ³¨å…¥ç»“æœ
  let trace_header = azimuth::TextMapCarrier::get(carrier, "traceparent")
  assert_eq(trace_header, Some("00-test-trace-id-test-span-id-01"))
  
  // æµ‹è¯•æå–æ“ä½œ
  let extracted_ctx = azimuth::CompositePropagator::extract(composite_propagator, carrier)
  
  // éªŒè¯æå–ç»“æœ
  let extracted_key = azimuth::ContextKey::new("extracted")
  let extracted_value = azimuth::Context::get(extracted_ctx, extracted_key)
  assert_eq(extracted_value, Some("true"))
  
  // æµ‹è¯•å¤šä¼ æ’­å™¨åœºæ™¯
  let multiple_propagators = [trace_propagator, trace_propagator]  // ç®€åŒ–æµ‹è¯•ï¼Œé‡å¤ä½¿ç”¨åŒç±»å‹
  let multi_propagator = azimuth::CompositePropagator::new(multiple_propagators)
  
  let multi_carrier = azimuth::TextMapCarrier::new()
  azimuth::CompositePropagator::inject(multi_propagator, ctx, multi_carrier)
  
  // éªŒè¯å¤šä¼ æ’­å™¨æ³¨å…¥
  let multi_trace_header = azimuth::TextMapCarrier::get(multi_carrier, "traceparent")
  assert_eq(multi_trace_header, Some("00-test-trace-id-test-span-id-01"))
  
  // æµ‹è¯•ç©ºä¼ æ’­å™¨åˆ—è¡¨
  let empty_propagators = []
  let empty_propagator = azimuth::CompositePropagator::new(empty_propagators)
  
  let empty_carrier = azimuth::TextMapCarrier::new()
  azimuth::CompositePropagator::inject(empty_propagator, ctx, empty_carrier)
  
  // æµ‹è¯•å¸¦æœ‰ä¸Šä¸‹æ–‡çš„æ³¨å…¥å’Œæå–
  let ctx_with_value = azimuth::Context::with_value(ctx, azimuth::ContextKey::new("test.key"), "test.value")
  let value_carrier = azimuth::TextMapCarrier::new()
  
  azimuth::CompositePropagator::inject(composite_propagator, ctx_with_value, value_carrier)
  let value_extracted_ctx = azimuth::CompositePropagator::extract(composite_propagator, value_carrier)
  
  // éªŒè¯å¸¦æœ‰ä¸Šä¸‹æ–‡çš„æå–ç»“æœ
  let value_extracted = azimuth::Context::get(value_extracted_ctx, azimuth::ContextKey::new("extracted"))
  assert_eq(value_extracted, Some("true"))
}

// New Test 8: Internationalization test
pub test "å›½é™…åŒ–æµ‹è¯•" {
  // æµ‹è¯•Unicodeå’Œå¤šè¯­è¨€æ”¯æŒ
  let unicode_attrs = azimuth::Attributes::new()
  
  // è®¾ç½®å¤šè¯­è¨€å±æ€§
  azimuth::Attributes::set(unicode_attrs, "chinese.name", azimuth::StringValue("ä¸­æ–‡æµ‹è¯•"))
  azimuth::Attributes::set(unicode_attrs, "japanese.name", azimuth::StringValue("æ—¥æœ¬èªãƒ†ã‚¹ãƒˆ"))
  azimuth::Attributes::set(unicode_attrs, "korean.name", azimuth::StringValue("í•œêµ­ì–´ í…ŒìŠ¤íŠ¸"))
  azimuth::Attributes::set(unicode_attrs, "arabic.name", azimuth::StringValue("Ø§Ø®ØªØ¨Ø§Ø± Ø¹Ø±Ø¨ÙŠ"))
  azimuth::Attributes::set(unicode_attrs, "russian.name", azimuth::StringValue("Ğ ÑƒÑÑĞºĞ¸Ğ¹ Ñ‚ĞµÑÑ‚"))
  azimuth::Attributes::set(unicode_attrs, "emoji.test", azimuth::StringValue("æµ‹è¯•emoji ğŸš€ğŸŒŸğŸ’»"))
  
  // æµ‹è¯•å¤šè¯­è¨€æ—¥å¿—
  let chinese_log = azimuth::LogRecord::new(azimuth::Info, "è¿™æ˜¯ä¸€æ¡ä¸­æ–‡æ—¥å¿—æ¶ˆæ¯")
  let japanese_log = azimuth::LogRecord::new(azimuth::Info, "ã“ã‚Œã¯æ—¥æœ¬èªã®ãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã™")
  let emoji_log = azimuth::LogRecord::new(azimuth::Info, "æ—¥å¿—åŒ…å«emoji: ğŸš€ğŸŒŸğŸ’»")
  
  // éªŒè¯å¤šè¯­è¨€æ—¥å¿—
  assert_eq(azimuth::LogRecord::body(chinese_log), Some("è¿™æ˜¯ä¸€æ¡ä¸­æ–‡æ—¥å¿—æ¶ˆæ¯"))
  assert_eq(azimuth::LogRecord::body(japanese_log), Some("ã“ã‚Œã¯æ—¥æœ¬èªã®ãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã™"))
  assert_eq(azimuth::LogRecord::body(emoji_log), Some("æ—¥å¿—åŒ…å«emoji: ğŸš€ğŸŒŸğŸ’»"))
  
  // æµ‹è¯•å¤šè¯­è¨€Spanåç§°
  let tracer_provider = azimuth::TracerProvider::default()
  let tracer = azimuth::TracerProvider::get_tracer(tracer_provider, "å›½é™…åŒ–æµ‹è¯•è¿½è¸ªå™¨")
  
  let chinese_span = azimuth::Tracer::start_span(tracer, "ä¸­æ–‡æ“ä½œ")
  let japanese_span = azimuth::Tracer::start_span(tracer, "æ—¥æœ¬èªæ“ä½œ")
  
  // éªŒè¯å¤šè¯­è¨€Spanåç§°
  assert_eq(azimuth::Span::name(chinese_span), "ä¸­æ–‡æ“ä½œ")
  assert_eq(azimuth::Span::name(japanese_span), "æ—¥æœ¬èªæ“ä½œ")
  
  // æµ‹è¯•å¤šè¯­è¨€èµ„æºå±æ€§
  let i18n_resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
    ("service.name", azimuth::StringValue("å›½é™…åŒ–æµ‹è¯•æœåŠ¡")),
    ("service.description", azimuth::StringValue("è¿™æ˜¯ä¸€ä¸ªæ”¯æŒå¤šè¯­è¨€çš„é¥æµ‹æœåŠ¡")),
    ("service.version", azimuth::StringValue("1.0.0")),
    ("region", azimuth::StringValue("äºšå¤ªåœ°åŒº"))
  ])
  
  // éªŒè¯å¤šè¯­è¨€èµ„æºå±æ€§
  assert_eq(azimuth::Resource::get_attribute(i18n_resource, "service.name"), Some(azimuth::StringValue("å›½é™…åŒ–æµ‹è¯•æœåŠ¡")))
  assert_eq(azimuth::Resource::get_attribute(i18n_resource, "service.description"), Some(azimuth::StringValue("è¿™æ˜¯ä¸€ä¸ªæ”¯æŒå¤šè¯­è¨€çš„é¥æµ‹æœåŠ¡")))
  assert_eq(azimuth::Resource::get_attribute(i18n_resource, "region"), Some(azimuth::StringValue("äºšå¤ªåœ°åŒº")))
  
  // æµ‹è¯•å¤šè¯­è¨€Baggage
  let baggage = azimuth::Baggage::new()
  let updated_baggage = azimuth::Baggage::set_entry(baggage, "ç”¨æˆ·.æ ‡è¯†", "ç”¨æˆ·123")
  let baggage_value = azimuth::Baggage::get_entry(updated_baggage, "ç”¨æˆ·.æ ‡è¯†")
  
  // åŸºäºç®€åŒ–å®ç°è¿›è¡ŒéªŒè¯
  assert_eq(baggage_value, None)  // ç®€åŒ–å®ç°ä¸­get_entryå§‹ç»ˆè¿”å›None
  
  // æµ‹è¯•ç‰¹æ®Šå­—ç¬¦å’Œæ ¼å¼
  let special_char_attrs = azimuth::Attributes::new()
  azimuth::Attributes::set(special_char_attrs, "special.chars", azimuth::StringValue("!@#$%^&*()_+-=[]{}|;':\",./<>?"))
  azimuth::Attributes::set(special_char_attrs, "newlines", azimuth::StringValue("line1\nline2\rline3"))
  azimuth::Attributes::set(special_char_attrs, "tabs", azimuth::StringValue("col1\tcol2\tcol3"))
  
  // æµ‹è¯•å³åˆ°å·¦è¯­è¨€
  let rtl_log = azimuth::LogRecord::new(azimuth::Info, "Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ† Ø¥Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø±")
  assert_eq(azimuth::LogRecord::body(rtl_log), Some("Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ† Ø¥Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø±"))
}

// New Test 9: Error recovery mechanism test
pub test "é”™è¯¯æ¢å¤æœºåˆ¶æµ‹è¯•" {
  // æµ‹è¯•æ— æ•ˆSpanä¸Šä¸‹æ–‡çš„å¤„ç†
  let invalid_trace_ctx = azimuth::SpanContext::new("", "span-123", true, "")
  let invalid_span_ctx = azimuth::SpanContext::new("trace-123", "", true, "")
  let both_invalid_ctx = azimuth::SpanContext::new("", "", false, "")
  
  // éªŒè¯æ— æ•ˆä¸Šä¸‹æ–‡æ£€æµ‹
  assert_false(azimuth::SpanContext::is_valid(invalid_trace_ctx))
  assert_false(azimuth::SpanContext::is_valid(invalid_span_ctx))
  assert_false(azimuth::SpanContext::is_valid(both_invalid_ctx))
  
  // æµ‹è¯•ä½¿ç”¨æ— æ•ˆä¸Šä¸‹æ–‡åˆ›å»ºSpanï¼ˆåº”è¯¥æœ‰æ¢å¤æœºåˆ¶ï¼‰
  let tracer_provider = azimuth::TracerProvider::default()
  let tracer = azimuth::TracerProvider::get_tracer(tracer_provider, "error-recovery-tracer")
  
  // å³ä½¿ä½¿ç”¨æ— æ•ˆä¸Šä¸‹æ–‡ï¼Œç³»ç»Ÿä¹Ÿåº”è¯¥èƒ½æ­£å¸¸å·¥ä½œ
  let valid_span = azimuth::Tracer::start_span(tracer, "recovery-test-span")
  assert_eq(azimuth::Span::name(valid_span), "recovery-test-span")
  assert_true(azimuth::Span::is_recording(valid_span))
  
  // æµ‹è¯•ç©ºå€¼å’ŒNoneå€¼çš„å¤„ç†
  let empty_body_log = azimuth::LogRecord::new(azimuth::Info, "")
  let none_attrs_log = azimuth::LogRecord::new_with_context(
    azimuth::Error,
    Some("Error with no attributes"),
    None,
    None,
    None,
    None,
    None,
    None
  )
  
  // éªŒè¯ç©ºå€¼å¤„ç†
  assert_eq(azimuth::LogRecord::body(empty_body_log), Some(""))
  assert_eq(azimuth::LogRecord::body(none_attrs_log), Some("Error with no attributes"))
  assert_eq(azimuth::LogRecord::attributes(none_attrs_log), None)
  assert_eq(azimuth::LogRecord::timestamp(none_attrs_log), None)
  assert_eq(azimuth::LogRecord::trace_id(none_attrs_log), None)
  assert_eq(azimuth::LogRecord::span_id(none_attrs_log), None)
  assert_eq(azimuth::LogRecord::context(none_attrs_log), None)
  
  // æµ‹è¯•èµ„æºå±æ€§é”™è¯¯å¤„ç†
  let empty_resource = azimuth::Resource::new()
  let missing_attr = azimuth::Resource::get_attribute(empty_resource, "nonexistent.attribute")
  assert_eq(missing_attr, None)
  
  // æµ‹è¯•ä¸Šä¸‹æ–‡é”™è¯¯å¤„ç†
  let root_ctx = azimuth::Context::root()
  let nonexistent_key = azimuth::ContextKey::new("nonexistent.key")
  let missing_value = azimuth::Context::get(root_ctx, nonexistent_key)
  assert_eq(missing_value, None)
  
  // æµ‹è¯•Baggageé”™è¯¯å¤„ç†
  let empty_baggage = azimuth::Baggage::new()
  let missing_baggage_value = azimuth::Baggage::get_entry(empty_baggage, "nonexistent.key")
  assert_eq(missing_baggage_value, None)
  
  // æµ‹è¯•ä¼ æ’­å™¨é”™è¯¯å¤„ç†
  let empty_carrier = azimuth::TextMapCarrier::new()
  let missing_header = azimuth::TextMapCarrier::get(empty_carrier, "nonexistent.header")
  assert_eq(missing_header, None)
  
  // æµ‹è¯•åº¦é‡é”™è¯¯å¤„ç†
  let meter_provider = azimuth::MeterProvider::default()
  let meter = azimuth::MeterProvider::get_meter(meter_provider, "error-recovery-meter")
  
  // å³ä½¿åœ¨é”™è¯¯æƒ…å†µä¸‹ï¼Œåº¦é‡åˆ›å»ºä¹Ÿåº”è¯¥æˆåŠŸ
  let error_counter = azimuth::Meter::create_counter(meter, "error.counter", Some("Error counter"), Some("errors"))
  assert_eq(error_counter.name, "error.counter")
  assert_eq(error_counter.description, Some("Error counter"))
  assert_eq(error_counter.unit, Some("errors"))
  
  // æµ‹è¯•Loggeré”™è¯¯å¤„ç†
  let logger_provider = azimuth::LoggerProvider::default()
  let error_logger = azimuth::LoggerProvider::get_logger(logger_provider, "error-recovery-logger")
  assert_eq(error_logger.scope.name, "error-recovery-logger")
  
  // æµ‹è¯•é”™è¯¯æ¢å¤åçš„æ­£å¸¸æ“ä½œ
  let recovery_span = azimuth::Tracer::start_span(tracer, "recovery-operation")
  azimuth::Span::add_event(recovery_span, "recovery.started", None)
  azimuth::Span::set_status(recovery_span, azimuth::Ok)
  azimuth::Span::end(recovery_span)
  
  // éªŒè¯æ¢å¤åçš„æ“ä½œ
  assert_eq(azimuth::Span::name(recovery_span), "recovery-operation")
}

// New Test 10: Memory management test
pub test "å†…å­˜ç®¡ç†æµ‹è¯•" {
  // æµ‹è¯•å¤§é‡å¯¹è±¡çš„åˆ›å»ºå’Œæ¸…ç†
  let tracer_provider = azimuth::TracerProvider::default()
  let tracer = azimuth::TracerProvider::get_tracer(tracer_provider, "memory-test-tracer")
  
  // åˆ›å»ºå¤§é‡Span
  let spans = []
  for i in 0..50 {
    let span = azimuth::Tracer::start_span(tracer, "memory-test-span-" + i.to_string())
    spans.push(span)
  }
  
  // éªŒè¯æ‰€æœ‰Spanéƒ½æ­£ç¡®åˆ›å»º
  assert_true(spans.length() == 50)
  for i in 0..spans.length() {
    assert_eq(azimuth::Span::name(spans[i]), "memory-test-span-" + i.to_string())
  }
  
  // ç»“æŸæ‰€æœ‰Span
  for span in spans {
    azimuth::Span::end(span)
  }
  
  // æµ‹è¯•å¤§é‡å±æ€§åˆ›å»º
  let attrs = azimuth::Attributes::new()
  for i in 0..30 {
    azimuth::Attributes::set(attrs, "attr." + i.to_string(), azimuth::StringValue("value." + i.to_string()))
  }
  
  // æµ‹è¯•å¤§é‡åº¦é‡åˆ›å»º
  let meter_provider = azimuth::MeterProvider::default()
  let meter = azimuth::MeterProvider::get_meter(meter_provider, "memory-test-meter")
  
  let counters = []
  let histograms = []
  let gauges = []
  
  for i in 0..20 {
    let counter = azimuth::Meter::create_counter(meter, "memory.counter." + i.to_string())
    let histogram = azimuth::Meter::create_histogram(meter, "memory.histogram." + i.to_string())
    let gauge = azimuth::Meter::create_gauge(meter, "memory.gauge." + i.to_string())
    
    counters.push(counter)
    histograms.push(histogram)
    gauges.push(gauge)
  }
  
  // éªŒè¯æ‰€æœ‰åº¦é‡éƒ½æ­£ç¡®åˆ›å»º
  assert_true(counters.length() == 20)
  assert_true(histograms.length() == 20)
  assert_true(gauges.length() == 20)
  
  for i in 0..counters.length() {
    assert_eq(counters[i].name, "memory.counter." + i.to_string())
    assert_eq(histograms[i].name, "memory.histogram." + i.to_string())
    assert_eq(gauges[i].name, "memory.gauge." + i.to_string())
  }
  
  // æµ‹è¯•å¤§é‡æ—¥å¿—è®°å½•åˆ›å»º
  let logger_provider = azimuth::LoggerProvider::default()
  let logger = azimuth::LoggerProvider::get_logger(logger_provider, "memory-test-logger")
  
  let log_records = []
  for i in 0..40 {
    let log_record = azimuth::LogRecord::new(azimuth::Info, "Memory test log " + i.to_string())
    log_records.push(log_record)
  }
  
  // éªŒè¯æ‰€æœ‰æ—¥å¿—è®°å½•éƒ½æ­£ç¡®åˆ›å»º
  assert_true(log_records.length() == 40)
  for i in 0..log_records.length() {
    assert_eq(azimuth::LogRecord::body(log_records[i]), Some("Memory test log " + i.to_string()))
  }
  
  // æµ‹è¯•èµ„æºåˆ›å»ºå’Œåˆå¹¶
  let resources = []
  for i in 0..15 {
    let resource = azimuth::Resource::with_attributes(azimuth::Resource::new(), [
      ("service.name", azimuth::StringValue("memory-test-service-" + i.to_string())),
      ("service.instance.id", azimuth::StringValue("instance-" + i.to_string()))
    ])
    resources.push(resource)
  }
  
  // éªŒè¯æ‰€æœ‰èµ„æºéƒ½æ­£ç¡®åˆ›å»º
  assert_true(resources.length() == 15)
  for i in 0..resources.length() {
    assert_eq(azimuth::Resource::get_attribute(resources[i], "service.name"), Some(azimuth::StringValue("memory-test-service-" + i.to_string())))
    assert_eq(azimuth::Resource::get_attribute(resources[i], "service.instance.id"), Some(azimuth::StringValue("instance-" + i.to_string())))
  }
  
  // æµ‹è¯•èµ„æºåˆå¹¶é“¾
  let merged_resource = resources[0]
  for i in 1..resources.length() {
    let merged_resource = azimuth::Resource::merge(merged_resource, resources[i])
  }
  
  // åŸºäºç®€åŒ–å®ç°ï¼Œæœ€ç»ˆä¼šè¿”å›æœ€åä¸€ä¸ªèµ„æº
  assert_eq(azimuth::Resource::get_attribute(merged_resource, "service.name"), Some(azimuth::StringValue("memory-test-service-14")))
  
  // æµ‹è¯•ä¸Šä¸‹æ–‡åˆ›å»º
  let contexts = []
  for i in 0..25 {
    let ctx = azimuth::Context::root()
    let key = azimuth::ContextKey::new("memory.test.key." + i.to_string())
    let ctx_with_value = azimuth::Context::with_value(ctx, key, "memory.test.value." + i.to_string())
    contexts.push(ctx_with_value)
  }
  
  // éªŒè¯æ‰€æœ‰ä¸Šä¸‹æ–‡éƒ½æ­£ç¡®åˆ›å»º
  assert_true(contexts.length() == 25)
  for i in 0..contexts.length() {
    let key = azimuth::ContextKey::new("memory.test.key." + i.to_string())
    assert_eq(azimuth::Context::get(contexts[i], key), Some("memory.test.value." + i.to_string()))
  }
}

// New Test: Concurrent safety test
pub test "å¹¶å‘å®‰å…¨æµ‹è¯•" {
  // æµ‹è¯•å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„å±æ€§æ“ä½œå®‰å…¨æ€§
  let shared_attrs = azimuth::Attributes::new()
  
  // æ¨¡æ‹Ÿå¹¶å‘è®¾ç½®å±æ€§
  for i in 0..50 {
    let key = "concurrent.key." + i.to_string()
    let value = "concurrent.value." + i.to_string()
    azimuth::Attributes::set(shared_attrs, key, azimuth::StringValue(value))
  }
  
  // éªŒè¯æ‰€æœ‰å±æ€§éƒ½æ­£ç¡®è®¾ç½®
  for i in 0..50 {
    let key = "concurrent.key." + i.to_string()
    let expected_value = "concurrent.value." + i.to_string()
    let actual_value = azimuth::Attributes::get(shared_attrs, key)
    assert_eq(actual_value, Some(azimuth::StringValue(expected_value)))
  }
  
  // æµ‹è¯•å¹¶å‘Spanåˆ›å»ºå’Œæ“ä½œ
  let tracer_provider = azimuth::TracerProvider::default()
  let tracer = azimuth::TracerProvider::get_tracer(tracer_provider, "concurrent-test-tracer")
  
  let spans = []
  for i in 0..20 {
    let span = azimuth::Tracer::start_span(tracer, "concurrent-span-" + i.to_string())
    spans.push(span)
  }
  
  // å¹¶å‘æ“ä½œSpan
  for i in 0..spans.length() {
    let span = spans[i]
    azimuth::Span::add_event(span, "concurrent.event", Some([("index", azimuth::StringValue(i.to_string()))]))
    azimuth::Span::set_status(span, azimuth::Ok)
  }
  
  // éªŒè¯æ‰€æœ‰Spanéƒ½æ­£ç¡®åˆ›å»º
  for i in 0..spans.length() {
    assert_eq(azimuth::Span::name(spans[i]), "concurrent-span-" + i.to_string())
  }
  
  // æµ‹è¯•å¹¶å‘åº¦é‡æ“ä½œ
  let meter_provider = azimuth::MeterProvider::default()
  let meter = azimuth::MeterProvider::get_meter(meter_provider, "concurrent-test-meter")
  let counter = azimuth::Meter::create_counter(meter, "concurrent.counter")
  let histogram = azimuth::Meter::create_histogram(meter, "concurrent.histogram")
  
  // å¹¶å‘è®°å½•åº¦é‡
  for i in 0..100 {
    azimuth::Counter::add(counter, 1.0)
    azimuth::Histogram::record(histogram, i.to_double())
  }
  
  // éªŒè¯åº¦é‡æ“ä½œå®Œæˆ
  assert_eq(counter.name, "concurrent.counter")
  assert_eq(histogram.name, "concurrent.histogram")
}