// Azimuth æ•°æ®éªŒè¯å’Œå®Œæ•´æ€§æµ‹è¯•ç”¨ä¾‹
// ä¸“æ³¨äºæµ‹è¯•ç³»ç»Ÿçš„æ•°æ®éªŒè¯å’Œå®Œæ•´æ€§æ£€æŸ¥èƒ½åŠ›

// æµ‹è¯•1: æŒ‡æ ‡æ•°æ®éªŒè¯æµ‹è¯•
test "æŒ‡æ ‡æ•°æ®éªŒè¯æµ‹è¯•" {
  let provider = MeterProvider::default()
  let meter = MeterProvider::get_meter(provider, "validation.test")
  
  // æµ‹è¯•è®¡æ•°å™¨éªŒè¯
  let counter = Meter::create_counter(meter, "validation.counter")
  
  // éªŒè¯æ­£æ•°è¾“å…¥
  Counter::add(counter, 1.0)
  Counter::add(counter, 100.0)
  Counter::add(counter, 0.0)
  assert_eq(Counter::value(counter), 101.0)
  
  // éªŒè¯æµ®ç‚¹æ•°ç²¾åº¦
  Counter::add(counter, 0.1)
  Counter::add(counter, 0.2)
  Counter::add(counter, 0.3)
  let expected_value = 101.6  // 101.0 + 0.1 + 0.2 + 0.3
  assert_true(abs(Counter::value(counter) - expected_value) < 0.0001)
  
  // æµ‹è¯•ç›´æ–¹å›¾éªŒè¯
  let histogram = Meter::create_histogram(meter, "validation.histogram")
  
  // éªŒè¯æ­£å€¼è¾“å…¥
  Histogram::record(histogram, 0.0)
  Histogram::record(histogram, 1.0)
  Histogram::record(histogram, 100.0)
  Histogram::record(histogram, 0.001)
  
  // éªŒè¯è¾¹ç•Œå€¼
  Histogram::record(histogram, 3.402823466e+38)  // æ¥è¿‘f32æœ€å¤§å€¼
  Histogram::record(histogram, 1.175494351e-38)  // æ¥è¿‘f32æœ€å°æ­£å€¼
  
  // æµ‹è¯•ä»ªè¡¨éªŒè¯
  let gauge = Meter::create_gauge(meter, "validation.gauge")
  
  // éªŒè¯æ­£è´Ÿå€¼
  Gauge::set(gauge, 100.0)
  assert_eq(Gauge::value(gauge), 100.0)
  
  Gauge::set(gauge, -100.0)
  assert_eq(Gauge::value(gauge), -100.0)
  
  Gauge::set(gauge, 0.0)
  assert_eq(Gauge::value(gauge), 0.0)
}

// æµ‹è¯•2: å±æ€§æ•°æ®éªŒè¯æµ‹è¯•
test "å±æ€§æ•°æ®éªŒè¯æµ‹è¯•" {
  let provider = MeterProvider::default()
  let meter = MeterProvider::get_meter(provider, "attribute.validation.test")
  
  let counter = Meter::create_counter(meter, "attr.validation.counter")
  
  // æµ‹è¯•å­—ç¬¦ä¸²å±æ€§éªŒè¯
  Counter::add(counter, 1.0, [("string.attr", StringValue("valid_string"))])
  Counter::add(counter, 1.0, [("empty.string.attr", StringValue(""))])
  Counter::add(counter, 1.0, [("unicode.string.attr", StringValue("æµ‹è¯•ä¸­æ–‡ğŸš€"))])
  
  // æµ‹è¯•æ•´æ•°å±æ€§éªŒè¯
  Counter::add(counter, 1.0, [("int.attr", IntValue(42))])
  Counter::add(counter, 1.0, [("max.int.attr", IntValue(2147483647))])
  Counter::add(counter, 1.0, [("min.int.attr", IntValue(-2147483648))])
  Counter::add(counter, 1.0, [("zero.int.attr", IntValue(0))])
  
  // æµ‹è¯•æµ®ç‚¹å±æ€§éªŒè¯
  Counter::add(counter, 1.0, [("float.attr", FloatValue(3.14))])
  Counter::add(counter, 1.0, [("max.float.attr", FloatValue(3.402823466e+38))])
  Counter::add(counter, 1.0, [("min.float.attr", FloatValue(-3.402823466e+38))])
  Counter::add(counter, 1.0, [("zero.float.attr", FloatValue(0.0))])
  
  // æµ‹è¯•å¸ƒå°”å±æ€§éªŒè¯
  Counter::add(counter, 1.0, [("true.bool.attr", BoolValue(true))])
  Counter::add(counter, 1.0, [("false.bool.attr", BoolValue(false))])
  
  // éªŒè¯è®¡æ•°å™¨å€¼
  assert_eq(Counter::value(counter), 11.0)
}

// æµ‹è¯•3: Spanæ•°æ®å®Œæ•´æ€§éªŒè¯æµ‹è¯•
test "Spanæ•°æ®å®Œæ•´æ€§éªŒè¯æµ‹è¯•" {
  let tracer_provider = TracerProvider::default()
  let tracer = TracerProvider::get_tracer(tracer_provider, "integrity.test")
  
  // åˆ›å»ºspanå¹¶éªŒè¯æ•°æ®å®Œæ•´æ€§
  let span = Tracer::start_span(tracer, "integrity.test.span")
  
  // éªŒè¯spanåŸºæœ¬å±æ€§
  assert_eq(Span::name(span), "integrity.test.span")
  assert_true(Span::is_recording(span))
  
  // è®¾ç½®å±æ€§å¹¶éªŒè¯
  Span::set_attribute(span, "string.key", StringValue("string.value"))
  Span::set_attribute(span, "int.key", IntValue(42))
  Span::set_attribute(span, "float.key", FloatValue(3.14))
  Span::set_attribute(span, "bool.key", BoolValue(true))
  
  // éªŒè¯å±æ€§å®Œæ•´æ€§
  let string_value = Span::get_attribute(span, "string.key")
  let int_value = Span::get_attribute(span, "int.key")
  let float_value = Span::get_attribute(span, "float.key")
  let bool_value = Span::get_attribute(span, "bool.key")
  
  match string_value {
    Some(StringValue(s)) => assert_eq(s, "string.value")
    _ => assert_true(false)
  }
  
  match int_value {
    Some(IntValue(i)) => assert_eq(i, 42)
    _ => assert_true(false)
  }
  
  match float_value {
    Some(FloatValue(f)) => assert_true(abs(f - 3.14) < 0.001)
    _ => assert_true(false)
  }
  
  match bool_value {
    Some(BoolValue(b)) => assert_true(b)
    _ => assert_true(false)
  }
  
  // æ·»åŠ äº‹ä»¶å¹¶éªŒè¯
  Span::add_event(span, "test.event", Some([("event.attr", StringValue("event.value"))]))
  
  // è®¾ç½®çŠ¶æ€å¹¶éªŒè¯
  Span::set_status(span, Ok)
  assert_eq(Span::status(span), Ok)
  
  Span::set_status(span, Error, Some("Test error"))
  assert_eq(Span::status(span), Error)
  
  // ç»“æŸspanå¹¶éªŒè¯
  Span::end(span)
  assert_false(Span::is_recording(span))
}

// æµ‹è¯•4: æ—¥å¿—æ•°æ®éªŒè¯æµ‹è¯•
test "æ—¥å¿—æ•°æ®éªŒè¯æµ‹è¯•" {
  let logger_provider = LoggerProvider::default()
  let logger = LoggerProvider::get_logger(logger_provider, "log.validation.test")
  
  // æµ‹è¯•ä¸åŒä¸¥é‡çº§åˆ«çš„æ—¥å¿—
  let debug_log = LogRecord::new(Debug, "Debug message")
  let info_log = LogRecord::new(Info, "Info message")
  let warn_log = LogRecord::new(Warn, "Warning message")
  let error_log = LogRecord::new(Error, "Error message")
  
  // éªŒè¯ä¸¥é‡çº§åˆ«
  assert_eq(LogRecord::severity_number(debug_log), Debug)
  assert_eq(LogRecord::severity_number(info_log), Info)
  assert_eq(LogRecord::severity_number(warn_log), Warn)
  assert_eq(LogRecord::severity_number(error_log), Error)
  
  // éªŒè¯æ—¥å¿—æ¶ˆæ¯
  assert_eq(LogRecord::body(debug_log), Some("Debug message"))
  assert_eq(LogRecord::body(info_log), Some("Info message"))
  assert_eq(LogRecord::body(warn_log), Some("Warning message"))
  assert_eq(LogRecord::body(error_log), Some("Error message"))
  
  // æµ‹è¯•å¸¦æœ‰å®Œæ•´ä¸Šä¸‹æ–‡çš„æ—¥å¿—
  let full_context_log = LogRecord::new_with_context(
    Error,
    Some("Full context message"),
    Some("Error details"),
    Some(1234567890L),
    Some(1234567891L),
    Some("trace123"),
    Some("span123"),
    Some(Context::root())
  )
  
  // éªŒè¯å®Œæ•´ä¸Šä¸‹æ–‡
  assert_eq(LogRecord::severity_number(full_context_log), Error)
  assert_eq(LogRecord::body(full_context_log), Some("Full context message"))
  assert_eq(LogRecord::trace_id(full_context_log), Some("trace123"))
  assert_eq(LogRecord::span_id(full_context_log), Some("span123"))
  
  // æµ‹è¯•æ—¥å¿—å±æ€§
  LogRecord::set_attribute(full_context_log, "log.attr", StringValue("log.value"))
  let log_attr = LogRecord::get_attribute(full_context_log, "log.attr")
  
  match log_attr {
    Some(StringValue(s)) => assert_eq(s, "log.value")
    _ => assert_true(false)
  }
  
  // å‘é€æ‰€æœ‰æ—¥å¿—
  Logger::emit(logger, debug_log)
  Logger::emit(logger, info_log)
  Logger::emit(logger, warn_log)
  Logger::emit(logger, error_log)
  Logger::emit(logger, full_context_log)
}

// æµ‹è¯•5: ä¸Šä¸‹æ–‡æ•°æ®éªŒè¯æµ‹è¯•
test "ä¸Šä¸‹æ–‡æ•°æ®éªŒè¯æµ‹è¯•" {
  // åˆ›å»ºæ ¹ä¸Šä¸‹æ–‡
  let root_ctx = Context::root()
  
  // éªŒè¯æ ¹ä¸Šä¸‹æ–‡
  assert_true(Context::is_root(root_ctx))
  
  // æ·»åŠ è¿½è¸ªä¸Šä¸‹æ–‡
  let trace_ctx = SpanContext::new("trace123", "span456", true, "key1=value1")
  let ctx_with_trace = Context::with_span_context(root_ctx, trace_ctx)
  
  // éªŒè¯è¿½è¸ªä¸Šä¸‹æ–‡
  let extracted_trace_ctx = Context::span_context(ctx_with_trace)
  assert_eq(extracted_trace_ctx.trace_id, "trace123")
  assert_eq(extracted_trace_ctx.span_id, "span456")
  assert_true(extracted_trace_ctx.is_sampled)
  
  // æ·»åŠ è¡Œæé¡¹
  let user_key = ContextKey::new("user.id")
  let session_key = ContextKey::new("session.id")
  let request_key = ContextKey::new("request.id")
  
  let ctx_with_user = Context::with_value(ctx_with_trace, user_key, "user123")
  let ctx_with_session = Context::with_value(ctx_with_user, session_key, "session456")
  let ctx_with_request = Context::with_value(ctx_with_session, request_key, "request789")
  
  // éªŒè¯è¡Œæé¡¹
  let user_id = Context::get(ctx_with_request, user_key)
  let session_id = Context::get(ctx_with_request, session_key)
  let request_id = Context::get(ctx_with_request, request_key)
  
  assert_eq(user_id, Some("user123"))
  assert_eq(session_id, Some("session456"))
  assert_eq(request_id, Some("request789"))
  
  // æµ‹è¯•ä¸Šä¸‹æ–‡ä¼ æ’­
  let propagator = CompositePropagator::new([W3CTraceContextPropagator::new()])
  let carrier = TextMapCarrier::new()
  
  // æ³¨å…¥ä¸Šä¸‹æ–‡
  CompositePropagator::inject(propagator, ctx_with_request, carrier)
  
  // æå–ä¸Šä¸‹æ–‡
  let extracted_ctx = CompositePropagator::extract(propagator, carrier)
  
  // éªŒè¯ä¼ æ’­ç»“æœ
  let extracted_user_id = Context::get(extracted_ctx, user_key)
  let extracted_session_id = Context::get(extracted_ctx, session_key)
  let extracted_request_id = Context::get(extracted_ctx, request_key)
  
  assert_eq(extracted_user_id, Some("user123"))
  assert_eq(extracted_session_id, Some("session456"))
  assert_eq(extracted_request_id, Some("request789"))
}

// æµ‹è¯•6: èµ„æºæ•°æ®éªŒè¯æµ‹è¯•
test "èµ„æºæ•°æ®éªŒè¯æµ‹è¯•" {
  // åˆ›å»ºåŸºç¡€èµ„æº
  let resource = Resource::new()
  
  // éªŒè¯ç©ºèµ„æº
  assert_eq(Resource::attributes_count(resource), 0)
  
  // æ·»åŠ æœåŠ¡å±æ€§
  let service_attrs = [
    ("service.name", StringValue("test.service")),
    ("service.version", StringValue("1.0.0")),
    ("service.instance.id", StringValue("instance123"))
  ]
  
  let service_resource = Resource::with_attributes(resource, service_attrs)
  
  // éªŒè¯æœåŠ¡èµ„æº
  assert_eq(Resource::attributes_count(service_resource), 3)
  assert_eq(Resource::get_attribute(service_resource, "service.name"), Some(StringValue("test.service")))
  assert_eq(Resource::get_attribute(service_resource, "service.version"), Some(StringValue("1.0.0")))
  assert_eq(Resource::get_attribute(service_resource, "service.instance.id"), Some(StringValue("instance123")))
  
  // æ·»åŠ ä¸»æœºå±æ€§
  let host_attrs = [
    ("host.name", StringValue("test-host")),
    ("host.arch", StringValue("amd64")),
    ("os.type", StringValue("linux"))
  ]
  
  let host_resource = Resource::with_attributes(service_resource, host_attrs)
  
  // éªŒè¯åˆå¹¶åçš„èµ„æº
  assert_eq(Resource::attributes_count(host_resource), 6)
  assert_eq(Resource::get_attribute(host_resource, "service.name"), Some(StringValue("test.service")))
  assert_eq(Resource::get_attribute(host_resource, "host.name"), Some(StringValue("test-host")))
  
  // æµ‹è¯•èµ„æºåˆå¹¶
  let resource1 = Resource::with_attributes(Resource::new(), [("key1", StringValue("value1"))])
  let resource2 = Resource::with_attributes(Resource::new(), [("key2", StringValue("value2"))])
  
  let merged_resource = Resource::merge(resource1, resource2)
  
  // éªŒè¯åˆå¹¶ç»“æœ
  assert_eq(Resource::attributes_count(merged_resource), 2)
  assert_eq(Resource::get_attribute(merged_resource, "key1"), Some(StringValue("value1")))
  assert_eq(Resource::get_attribute(merged_resource, "key2"), Some(StringValue("value2")))
}

// æµ‹è¯•7: åºåˆ—åŒ–æ•°æ®å®Œæ•´æ€§éªŒè¯æµ‹è¯•
test "åºåˆ—åŒ–æ•°æ®å®Œæ•´æ€§éªŒè¯æµ‹è¯•" {
  let tracer = TracerProvider::get_tracer(TracerProvider::default(), "serialization.test")
  
  // åˆ›å»ºæµ‹è¯•span
  let span = Tracer::start_span(tracer, "serialization.test.span")
  
  // æ·»åŠ å„ç§ç±»å‹çš„å±æ€§
  Span::set_attribute(span, "string.attr", StringValue("test.string"))
  Span::set_attribute(span, "int.attr", IntValue(42))
  Span::set_attribute(span, "float.attr", FloatValue(3.14))
  Span::set_attribute(span, "bool.attr", BoolValue(true))
  
  // æ·»åŠ äº‹ä»¶
  Span::add_event(span, "test.event", Some([("event.attr", StringValue("event.value"))]))
  
  // è®¾ç½®çŠ¶æ€
  Span::set_status(span, Ok)
  
  // åºåˆ—åŒ–span
  let serialized_data = Span::serialize(span)
  
  // éªŒè¯åºåˆ—åŒ–æ•°æ®ä¸ä¸ºç©º
  assert_true(serialized_data.length() > 0)
  
  // ååºåˆ—åŒ–span
  let deserialized_span = Span::deserialize(serialized_data)
  
  // éªŒè¯ååºåˆ—åŒ–ç»“æœ
  assert_eq(Span::name(deserialized_span), Span::name(span))
  assert_eq(Span::kind(deserialized_span), Span::kind(span))
  assert_eq(Span::status(deserialized_span), Span::status(span))
  
  // éªŒè¯å±æ€§å®Œæ•´æ€§
  let original_string = Span::get_attribute(span, "string.attr")
  let deserialized_string = Span::get_attribute(deserialized_span, "string.attr")
  assert_eq(original_string, deserialized_string)
  
  let original_int = Span::get_attribute(span, "int.attr")
  let deserialized_int = Span::get_attribute(deserialized_span, "int.attr")
  assert_eq(original_int, deserialized_int)
  
  let original_float = Span::get_attribute(span, "float.attr")
  let deserialized_float = Span::get_attribute(deserialized_span, "float.attr")
  assert_eq(original_float, deserialized_float)
  
  let original_bool = Span::get_attribute(span, "bool.attr")
  let deserialized_bool = Span::get_attribute(deserialized_span, "bool.attr")
  assert_eq(original_bool, deserialized_bool)
  
  // ç»“æŸåŸå§‹span
  Span::end(span)
}

// æµ‹è¯•8: æ—¶é—´æˆ³æ•°æ®éªŒè¯æµ‹è¯•
test "æ—¶é—´æˆ³æ•°æ®éªŒè¯æµ‹è¯•" {
  let logger_provider = LoggerProvider::default()
  let logger = LoggerProvider::get_logger(logger_provider, "timestamp.validation.test")
  
  // è·å–å½“å‰æ—¶é—´
  let current_time = Clock::now_unix_nanos(Clock::system())
  
  // éªŒè¯å½“å‰æ—¶é—´åˆç†æ€§
  assert_true(current_time > 0L)
  
  // åˆ›å»ºå¸¦æœ‰æ—¶é—´æˆ³çš„æ—¥å¿—è®°å½•
  let log_with_timestamp = LogRecord::new_with_context(
    Info,
    Some("Timestamp validation test"),
    None,
    Some(current_time),
    None,
    Some("trace123"),
    Some("span123"),
    Some(Context::root())
  )
  
  // éªŒè¯æ—¶é—´æˆ³
  assert_eq(LogRecord::timestamp(log_with_timestamp), Some(current_time))
  
  // æµ‹è¯•è¾¹ç•Œæ—¶é—´æˆ³
  let epoch_time = 0L
  let log_with_epoch = LogRecord::new_with_context(
    Info,
    Some("Epoch time test"),
    None,
    Some(epoch_time),
    None,
    None,
    None,
    Some(Context::root())
  )
  
  assert_eq(LogRecord::timestamp(log_with_epoch), Some(epoch_time))
  
  // æµ‹è¯•æœ€å¤§æ—¶é—´æˆ³
  let max_time = 9223372036854775807L  // i64æœ€å¤§å€¼
  let log_with_max = LogRecord::new_with_context(
    Info,
    Some("Max time test"),
    None,
    Some(max_time),
    None,
    None,
    None,
    Some(Context::root())
  )
  
  assert_eq(LogRecord::timestamp(log_with_max), Some(max_time))
  
  // æµ‹è¯•è´Ÿæ—¶é—´æˆ³
  let negative_time = -1000000L
  let log_with_negative = LogRecord::new_with_context(
    Info,
    Some("Negative time test"),
    None,
    Some(negative_time),
    None,
    None,
    None,
    Some(Context::root())
  )
  
  assert_eq(LogRecord::timestamp(log_with_negative), Some(negative_time))
  
  // å‘é€æ‰€æœ‰æ—¥å¿—
  Logger::emit(logger, log_with_timestamp)
  Logger::emit(logger, log_with_epoch)
  Logger::emit(logger, log_with_max)
  Logger::emit(logger, log_with_negative)
}

// æµ‹è¯•9: æ•°æ®ç±»å‹è½¬æ¢éªŒè¯æµ‹è¯•
test "æ•°æ®ç±»å‹è½¬æ¢éªŒè¯æµ‹è¯•" {
  let provider = MeterProvider::default()
  let meter = MeterProvider::get_meter(provider, "type.conversion.test")
  
  let counter = Meter::create_counter(meter, "conversion.counter")
  
  // æµ‹è¯•æ•´æ•°åˆ°æµ®ç‚¹æ•°è½¬æ¢
  let int_value = 42
  Counter::add(counter, int_value.to_float())
  assert_eq(Counter::value(counter), 42.0)
  
  // æµ‹è¯•å­—ç¬¦ä¸²åˆ°æ•´æ•°è½¬æ¢
  let string_int = "123"
  let parsed_int = string_int.parse_int()
  match parsed_int {
    Some(i) => {
      Counter::add(counter, i.to_float())
      assert_eq(Counter::value(counter), 165.0)  // 42.0 + 123.0
    }
    None => assert_true(false)
  }
  
  // æµ‹è¯•å­—ç¬¦ä¸²åˆ°æµ®ç‚¹æ•°è½¬æ¢
  let string_float = "3.14"
  let parsed_float = string_float.parse_float()
  match parsed_float {
    Some(f) => {
      Counter::add(counter, f)
      assert_true(abs(Counter::value(counter) - 168.14) < 0.001)  // 165.0 + 3.14
    }
    None => assert_true(false)
  }
  
  // æµ‹è¯•å¸ƒå°”å€¼åˆ°æ•´æ•°è½¬æ¢
  let bool_true = true
  let bool_false = false
  Counter::add(counter, bool_true.to_int().to_float())
  Counter::add(counter, bool_false.to_int().to_float())
  assert_eq(Counter::value(counter), 169.14)  // 168.14 + 1.0 + 0.0
  
  // æµ‹è¯•æ— æ•ˆå­—ç¬¦ä¸²è½¬æ¢
  let invalid_string = "invalid_number"
  let invalid_int = invalid_string.parse_int()
  let invalid_float = invalid_string.parse_float()
  
  assert_eq(invalid_int, None)
  assert_eq(invalid_float, None)
}

// æµ‹è¯•10: æ•°æ®ä¸€è‡´æ€§éªŒè¯æµ‹è¯•
test "æ•°æ®ä¸€è‡´æ€§éªŒè¯æµ‹è¯•" {
  let provider = MeterProvider::default()
  let meter = MeterProvider::get_meter(provider, "consistency.test")
  let tracer = TracerProvider::get_tracer(TracerProvider::default(), "consistency.test")
  let logger = LoggerProvider::get_logger(LoggerProvider::default(), "consistency.test")
  
  // åˆ›å»ºä¸€è‡´æ€§æµ‹è¯•åœºæ™¯
  let test_id = "consistency.test.123"
  let test_timestamp = Clock::now_unix_nanos(Clock::system())
  
  // åœ¨æŒ‡æ ‡ä¸­è®°å½•æµ‹è¯•ä¿¡æ¯
  let counter = Meter::create_counter(meter, "consistency.counter")
  Counter::add(counter, 1.0, [
    ("test.id", StringValue(test_id)),
    ("test.timestamp", IntValue(test_timestamp)),
    ("test.type", StringValue("consistency.validation"))
  ])
  
  // åœ¨spanä¸­è®°å½•ç›¸åŒä¿¡æ¯
  let span = Tracer::start_span(tracer, "consistency.test.span")
  Span::set_attribute(span, "test.id", StringValue(test_id))
  Span::set_attribute(span, "test.timestamp", IntValue(test_timestamp))
  Span::set_attribute(span, "test.type", StringValue("consistency.validation"))
  
  // åœ¨æ—¥å¿—ä¸­è®°å½•ç›¸åŒä¿¡æ¯
  let log_record = LogRecord::new(Info, "Consistency test for " + test_id)
  LogRecord::set_attribute(log_record, "test.id", StringValue(test_id))
  LogRecord::set_attribute(log_record, "test.timestamp", IntValue(test_timestamp))
  LogRecord::set_attribute(log_record, "test.type", StringValue("consistency.validation"))
  
  // éªŒè¯æ•°æ®ä¸€è‡´æ€§
  let counter_attrs = Counter::get_attributes(counter)
  let span_attrs = Span::get_all_attributes(span)
  let log_attrs = LogRecord::get_all_attributes(log_record)
  
  // éªŒè¯test.idä¸€è‡´æ€§
  assert_eq(counter_attrs.get("test.id"), Some(StringValue(test_id)))
  assert_eq(span_attrs.get("test.id"), Some(StringValue(test_id)))
  assert_eq(log_attrs.get("test.id"), Some(StringValue(test_id)))
  
  // éªŒè¯test.timestampä¸€è‡´æ€§
  assert_eq(counter_attrs.get("test.timestamp"), Some(IntValue(test_timestamp)))
  assert_eq(span_attrs.get("test.timestamp"), Some(IntValue(test_timestamp)))
  assert_eq(log_attrs.get("test.timestamp"), Some(IntValue(test_timestamp)))
  
  // éªŒè¯test.typeä¸€è‡´æ€§
  assert_eq(counter_attrs.get("test.type"), Some(StringValue("consistency.validation")))
  assert_eq(span_attrs.get("test.type"), Some(StringValue("consistency.validation")))
  assert_eq(log_attrs.get("test.type"), Some(StringValue("consistency.validation")))
  
  // ç»“æŸspanå’Œå‘é€æ—¥å¿—
  Span::end(span)
  Logger::emit(logger, log_record)
  
  // éªŒè¯æœ€ç»ˆçŠ¶æ€
  assert_eq(Counter::value(counter), 1.0)
  assert_false(Span::is_recording(span))
}